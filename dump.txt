-- MySQL dump 10.13  Distrib 5.5.11, for Win32 (x86)
--
-- Host: testsql.analit.net    Database: accessright
-- ------------------------------------------------------
-- Server version	5.5.12

/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;
/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;
/*!40101 SET NAMES utf8 */;
/*!40103 SET @OLD_TIME_ZONE=@@TIME_ZONE */;
/*!40103 SET TIME_ZONE='+00:00' */;
/*!40014 SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0 */;
/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;
/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */;
/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */;

--
-- Current Database: `accessright`
--

/*!40000 DROP DATABASE IF EXISTS `accessright`*/;

CREATE DATABASE /*!32312 IF NOT EXISTS*/ `accessright` /*!40100 DEFAULT CHARACTER SET cp1251 */;

USE `accessright`;

--
-- Table structure for table `adminspermissions`
--

DROP TABLE IF EXISTS `adminspermissions`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `adminspermissions` (
  `AdminId` int(10) unsigned NOT NULL,
  `PermissionId` int(10) unsigned NOT NULL,
  PRIMARY KEY (`AdminId`,`PermissionId`)
) ENGINE=InnoDB DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER accessright.AdminsPermissionsLogInsert AFTER INSERT
ON accessright.AdminsPermissions FOR EACH ROW BEGIN
INSERT INTO `logs`.AdminsPermissionsLogs
SET OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
    OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
    Operation = 0,
    AdminId = NEW.AdminId,
    PermissionId = NEW.PermissionId;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER accessright.AdminsPermissionsLogDelete AFTER DELETE
ON accessright.AdminsPermissions FOR EACH ROW BEGIN
INSERT INTO `logs`.AdminsPermissionsLogs
SET OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)) ,
    OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)) ,
    Operation = 2,
    AdminId = OLD.AdminId,
    PermissionId = OLD.PermissionId;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `permissions`
--

DROP TABLE IF EXISTS `permissions`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `permissions` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `Name` varchar(255) NOT NULL,
  `Type` tinyint(1) unsigned NOT NULL,
  `Shortcut` varchar(5) NOT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=29 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `regionaladmins`
--

DROP TABLE IF EXISTS `regionaladmins`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `regionaladmins` (
  `RowID` int(11) unsigned NOT NULL AUTO_INCREMENT,
  `UserName` varchar(100) DEFAULT '',
  `ManagerName` varchar(50) NOT NULL DEFAULT '',
  `PhoneSupport` varchar(20) NOT NULL DEFAULT '',
  `InternalPhone` varchar(5) DEFAULT NULL COMMENT 'Внутренний номер телефона',
  `RegionMask` bigint(20) unsigned NOT NULL DEFAULT '0',
  `Email` varchar(100) NOT NULL DEFAULT '',
  `Department` int(10) unsigned NOT NULL COMMENT 'Идентификатор подразделения, в котором находится сотрудник: \n0 - Управление,\n1 - Бухгалтерия,\n2 - IT,\n3 - Обработка,\n4 - Техподдержка,\n5 - Отдел регионального развития',
  PRIMARY KEY (`RowID`)
) ENGINE=InnoDB AUTO_INCREMENT=113 DEFAULT CHARSET=cp1251 MIN_ROWS=10 MAX_ROWS=200 PACK_KEYS=0 CHECKSUM=1 ROW_FORMAT=COMPACT COMMENT='InnoDB free: 1414144 kB; InnoDB free: 3432448 kB';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping events for database 'accessright'
--

--
-- Dumping routines for database 'accessright'
--

--
-- Current Database: `addition`
--

/*!40000 DROP DATABASE IF EXISTS `addition`*/;

CREATE DATABASE /*!32312 IF NOT EXISTS*/ `addition` /*!40100 DEFAULT CHARACTER SET cp1251 */;

USE `addition`;

--
-- Table structure for table `action`
--

DROP TABLE IF EXISTS `action`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `action` (
  `ClientCode` int(10) unsigned NOT NULL DEFAULT '0',
  `BeginDate` date DEFAULT NULL,
  `Phone` varchar(15) DEFAULT NULL,
  `Comment` varchar(45) DEFAULT NULL,
  PRIMARY KEY (`ClientCode`),
  UNIQUE KEY `Phone` (`Phone`),
  KEY `BeginDate` (`BeginDate`)
) ENGINE=InnoDB DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `rejects`
--

DROP TABLE IF EXISTS `rejects`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `rejects` (
  `RowID` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `FirmCr` varchar(150) NOT NULL DEFAULT '',
  `CountryCr` varchar(150) NOT NULL DEFAULT '',
  `FullName` varchar(254) NOT NULL DEFAULT '',
  `Series` varchar(50) NOT NULL DEFAULT '',
  `LetterNo` varchar(50) NOT NULL DEFAULT '',
  `LetterDate` date NOT NULL DEFAULT '0000-00-00',
  `LaboratoryName` varchar(200) NOT NULL DEFAULT '',
  `CauseRejects` text NOT NULL,
  `UniqStr` varchar(100) NOT NULL DEFAULT '',
  `AccessTime` datetime NOT NULL DEFAULT '0000-00-00 00:00:00',
  PRIMARY KEY (`RowID`),
  UNIQUE KEY `idxUniqStr` (`UniqStr`)
) ENGINE=InnoDB AUTO_INCREMENT=21472 DEFAULT CHARSET=cp1251 MIN_ROWS=10000 MAX_ROWS=100000 PACK_KEYS=0 CHECKSUM=1 ROW_FORMAT=COMPACT COMMENT='InnoDB free: 3404800 kB';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping events for database 'addition'
--

--
-- Dumping routines for database 'addition'
--

--
-- Current Database: `analit`
--

/*!40000 DROP DATABASE IF EXISTS `analit`*/;

CREATE DATABASE /*!32312 IF NOT EXISTS*/ `analit` /*!40100 DEFAULT CHARACTER SET cp1251 */;

USE `analit`;

--
-- Table structure for table `SiteContent`
--

DROP TABLE IF EXISTS `SiteContent`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `SiteContent` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `Content` longtext NOT NULL,
  `ViewName` varchar(45) NOT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=6 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `menufield`
--

DROP TABLE IF EXISTS `menufield`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `menufield` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `Name` varchar(45) NOT NULL,
  `Link` varchar(255) NOT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=97 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `submenufield`
--

DROP TABLE IF EXISTS `submenufield`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `submenufield` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `MenuField` int(10) unsigned DEFAULT NULL,
  `Name` varchar(45) NOT NULL,
  `Link` varchar(255) NOT NULL,
  PRIMARY KEY (`Id`),
  KEY `FK_SubMenuField_1` (`MenuField`),
  CONSTRAINT `FK_SubMenuField_1` FOREIGN KEY (`MenuField`) REFERENCES `menufield` (`Id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=19 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping events for database 'analit'
--

--
-- Dumping routines for database 'analit'
--

--
-- Current Database: `billing`
--

/*!40000 DROP DATABASE IF EXISTS `billing`*/;

CREATE DATABASE /*!32312 IF NOT EXISTS*/ `billing` /*!40100 DEFAULT CHARACTER SET cp1251 */;

USE `billing`;

--
-- Table structure for table `Accounts`
--

DROP TABLE IF EXISTS `Accounts`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `Accounts` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `WriteTime` datetime DEFAULT NULL,
  `Type` tinyint(1) unsigned NOT NULL COMMENT 'Тип объекта\r\n0 - пользователь\r\n1 - адрес доставки',
  `Operator` varchar(255) DEFAULT NULL,
  `Payment` decimal(19,5) NOT NULL DEFAULT '0.00000',
  `BeAccounted` tinyint(1) NOT NULL DEFAULT '0',
  `ReadyForAccounting` tinyint(1) NOT NULL DEFAULT '0',
  `InvoiceGroup` int(11) NOT NULL DEFAULT '0',
  `IsFree` tinyint(1) NOT NULL DEFAULT '0',
  `ObjectId` int(10) unsigned DEFAULT NULL,
  `Description` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`Id`),
  KEY `ObjectId` (`ObjectId`)
) ENGINE=InnoDB AUTO_INCREMENT=35461 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER Billing.AccountLogInsert AFTER INSERT ON Billing.Accounts
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.AccountLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 0,
		AccountId = NEW.Id,
		WriteTime = NEW.WriteTime,
		Type = NEW.Type,
		Operator = NEW.Operator,
		Payment = NEW.Payment,
		BeAccounted = NEW.BeAccounted,
		ReadyForAccounting = NEW.ReadyForAccounting,
		InvoiceGroup = NEW.InvoiceGroup,
		IsFree = NEW.IsFree,
		ObjectId = NEW.ObjectId,
		Description = NEW.Description;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER Billing.AccountLogUpdate AFTER UPDATE ON Billing.Accounts
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.AccountLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 1,
		AccountId = OLD.Id,
		WriteTime = NULLIF(NEW.WriteTime, OLD.WriteTime),
		Type = NULLIF(NEW.Type, OLD.Type),
		Operator = NULLIF(NEW.Operator, OLD.Operator),
		Payment = NULLIF(NEW.Payment, OLD.Payment),
		BeAccounted = NULLIF(NEW.BeAccounted, OLD.BeAccounted),
		ReadyForAccounting = NULLIF(NEW.ReadyForAccounting, OLD.ReadyForAccounting),
		InvoiceGroup = NULLIF(NEW.InvoiceGroup, OLD.InvoiceGroup),
		IsFree = NULLIF(NEW.IsFree, OLD.IsFree),
		ObjectId = NULLIF(NEW.ObjectId, OLD.ObjectId),
		Description = NULLIF(NEW.Description, OLD.Description);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER Billing.AccountLogDelete AFTER DELETE ON Billing.Accounts
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.AccountLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 2,
		AccountId = OLD.Id,
		WriteTime = OLD.WriteTime,
		Type = OLD.Type,
		Operator = OLD.Operator,
		Payment = OLD.Payment,
		BeAccounted = OLD.BeAccounted,
		ReadyForAccounting = OLD.ReadyForAccounting,
		InvoiceGroup = OLD.InvoiceGroup,
		IsFree = OLD.IsFree,
		ObjectId = OLD.ObjectId,
		Description = OLD.Description;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `Acts`
--

DROP TABLE IF EXISTS `Acts`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `Acts` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `Period` char(8) DEFAULT NULL,
  `ActDate` datetime DEFAULT NULL,
  `Recipient` int(10) unsigned DEFAULT NULL,
  `Payer` int(10) unsigned DEFAULT NULL,
  `Sum` decimal(19,5) DEFAULT NULL,
  `PayerName` varchar(255) DEFAULT NULL,
  `Customer` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`Id`),
  KEY `FK_Acts_Payer` (`Payer`),
  CONSTRAINT `FK_Acts_Payer` FOREIGN KEY (`Payer`) REFERENCES `Payers` (`PayerID`) ON DELETE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=12148 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `BalanceOperations`
--

DROP TABLE IF EXISTS `BalanceOperations`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `BalanceOperations` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `Type` int(11) NOT NULL DEFAULT '0',
  `Description` varchar(255) DEFAULT NULL,
  `Date` datetime NOT NULL DEFAULT '0000-00-00 00:00:00',
  `Sum` decimal(19,5) NOT NULL DEFAULT '0.00000',
  `Payer` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=cp1251;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `InvoiceParts`
--

DROP TABLE IF EXISTS `InvoiceParts`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `InvoiceParts` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `Name` varchar(255) DEFAULT NULL,
  `Cost` decimal(19,5) DEFAULT NULL,
  `Count` int(11) DEFAULT NULL,
  `Invoice` int(10) unsigned DEFAULT NULL,
  `Ad` int(10) unsigned DEFAULT NULL,
  `PayDate` datetime NOT NULL DEFAULT '0000-00-00 00:00:00',
  `Processed` tinyint(1) NOT NULL DEFAULT '0',
  PRIMARY KEY (`Id`),
  KEY `FK_Invoice_InvoiceParts` (`Invoice`),
  CONSTRAINT `FK_Invoice_InvoiceParts` FOREIGN KEY (`Invoice`) REFERENCES `Invoices` (`Id`) ON DELETE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=42675 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `Invoices`
--

DROP TABLE IF EXISTS `Invoices`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `Invoices` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `Sum` decimal(19,5) DEFAULT NULL,
  `Date` datetime DEFAULT NULL,
  `Period` char(8) DEFAULT NULL,
  `Recipient` int(10) unsigned DEFAULT NULL,
  `Payer` int(10) unsigned DEFAULT NULL,
  `CreatedOn` datetime DEFAULT NULL,
  `SendToEmail` tinyint(1) NOT NULL DEFAULT '0',
  `LastErrorNotification` datetime DEFAULT NULL,
  `PayerName` varchar(255) DEFAULT NULL,
  `Act` int(10) unsigned DEFAULT NULL,
  `Customer` varchar(255) DEFAULT NULL,
  `PaidSum` decimal(19,5) NOT NULL DEFAULT '0.00000',
  PRIMARY KEY (`Id`),
  KEY `FK_Invoices_Act` (`Act`),
  KEY `FK_Invoices_Payer` (`Payer`),
  CONSTRAINT `FK_Invoices_Act` FOREIGN KEY (`Act`) REFERENCES `acts` (`Id`) ON DELETE SET NULL,
  CONSTRAINT `FK_Invoices_Payer` FOREIGN KEY (`Payer`) REFERENCES `Payers` (`PayerID`) ON DELETE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=201202685 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `Nomenclatures`
--

DROP TABLE IF EXISTS `Nomenclatures`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `Nomenclatures` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `Name` varchar(255) NOT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=33 DEFAULT CHARSET=cp1251;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `PayerAuditRecords`
--

DROP TABLE IF EXISTS `PayerAuditRecords`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `PayerAuditRecords` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `UserName` varchar(255) DEFAULT NULL,
  `WriteTime` datetime NOT NULL DEFAULT '0000-00-00 00:00:00',
  `ObjectId` int(10) unsigned NOT NULL DEFAULT '0',
  `ObjectType` int(11) NOT NULL DEFAULT '0',
  `Name` varchar(255) DEFAULT NULL,
  `Message` varchar(255) DEFAULT NULL,
  `Administrator` int(10) unsigned DEFAULT NULL,
  `Payer` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`Id`),
  KEY `FK_Payers_Payer` (`Payer`),
  KEY `FK_Admin_Administrator` (`Administrator`),
  CONSTRAINT `FK_Admin_Administrator` FOREIGN KEY (`Administrator`) REFERENCES `accessright`.`regionaladmins` (`RowID`) ON DELETE SET NULL,
  CONSTRAINT `FK_Payers_Payer` FOREIGN KEY (`Payer`) REFERENCES `Payers` (`PayerID`) ON DELETE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=581 DEFAULT CHARSET=cp1251;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `PayerClients`
--

DROP TABLE IF EXISTS `PayerClients`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `PayerClients` (
  `ClientId` int(10) unsigned NOT NULL,
  `PayerId` int(10) unsigned NOT NULL,
  KEY `FK_Payers_PayerId` (`PayerId`),
  KEY `FK_Clients_ClientId` (`ClientId`),
  CONSTRAINT `FK_Clients_ClientId` FOREIGN KEY (`ClientId`) REFERENCES `Future`.`Clients` (`Id`) ON DELETE CASCADE,
  CONSTRAINT `FK_Payers_PayerId` FOREIGN KEY (`PayerId`) REFERENCES `Payers` (`PayerID`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `Payers`
--

DROP TABLE IF EXISTS `Payers`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `Payers` (
  `PayerID` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `ShortName` varchar(100) NOT NULL DEFAULT '',
  `JuridicalName` varchar(255) DEFAULT NULL,
  `JuridicalAddress` varchar(255) DEFAULT NULL,
  `BeforeNamePrefix` varchar(100) DEFAULT NULL,
  `AfterNamePrefix` varchar(100) DEFAULT NULL,
  `INN` varchar(12) DEFAULT NULL,
  `KPP` varchar(9) DEFAULT NULL,
  `OKPO` varchar(8) NOT NULL DEFAULT '',
  `OKVED` varchar(20) NOT NULL DEFAULT '',
  `RS` varchar(20) NOT NULL DEFAULT '',
  `BankName` varchar(255) NOT NULL DEFAULT '',
  `KS` varchar(20) NOT NULL DEFAULT '',
  `BIK` varchar(9) NOT NULL DEFAULT '',
  `OGRN` varchar(13) NOT NULL DEFAULT '',
  `ActualAddressCountry` varchar(30) DEFAULT '?inney',
  `ActualAddressIndex` varchar(8) DEFAULT NULL,
  `ActualAddressProvince` varchar(30) DEFAULT NULL,
  `ActualAddressTown` varchar(20) DEFAULT NULL,
  `ActualAddressStreet` varchar(30) DEFAULT NULL,
  `ActualAddressHouse` varchar(8) DEFAULT NULL,
  `ActualAddressOffice` varchar(6) DEFAULT NULL,
  `ReceiverAddress` varchar(255) DEFAULT NULL,
  `OldPayDate` date NOT NULL DEFAULT '2007-01-01',
  `OldTariff` decimal(10,2) unsigned NOT NULL DEFAULT '0.00',
  `DetailInvoice` tinyint(1) unsigned NOT NULL DEFAULT '0',
  `AutoInvoice` tinyint(1) unsigned NOT NULL DEFAULT '0',
  `PayCycle` tinyint(1) unsigned DEFAULT NULL,
  `Balance` decimal(10,2) DEFAULT NULL,
  `DiscountPercent` int(10) unsigned DEFAULT NULL,
  `Comment` mediumtext,
  `ContactGroupOwnerId` int(10) unsigned DEFAULT NULL,
  `AutoLock` tinyint(1) NOT NULL,
  `NotificationType` tinyint(1) unsigned NOT NULL,
  `ActualAddressRegion` varchar(30) DEFAULT NULL,
  `HaveContract` tinyint(1) unsigned NOT NULL,
  `SendRegisteredLetter` tinyint(1) unsigned NOT NULL,
  `SendScannedDocuments` tinyint(1) unsigned NOT NULL,
  `DiscountValue` int(10) unsigned NOT NULL,
  `DiscountType` int(10) unsigned NOT NULL,
  `ChangeServiceNameTo` varchar(255) DEFAULT NULL,
  `ShowDiscount` tinyint(1) unsigned NOT NULL,
  `RecipientId` int(11) DEFAULT NULL,
  `EmailInvoice` tinyint(1) NOT NULL DEFAULT '0',
  `PrintInvoice` tinyint(1) NOT NULL DEFAULT '0',
  `SendPaymentNotification` tinyint(1) NOT NULL DEFAULT '0',
  `BeginBalance` decimal(10,0) NOT NULL DEFAULT '0',
  `BeginBalanceDate` datetime DEFAULT NULL,
  `DocumentsOnLastWorkingDay` tinyint(1) DEFAULT NULL,
  `DoNotGroupParts` tinyint(1) DEFAULT '0',
  `Customer` varchar(255) DEFAULT NULL,
  `PaymentSum` decimal(19,5) NOT NULL DEFAULT '0.00000',
  `RegistrationDate` datetime DEFAULT NULL,
  `Registrant` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`PayerID`),
  KEY `FK_payers_ContactGroupOwnerId` (`ContactGroupOwnerId`),
  CONSTRAINT `FK_payers_ContactGroupOwnerId` FOREIGN KEY (`ContactGroupOwnerId`) REFERENCES `contacts`.`contact_group_owners` (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=6186 DEFAULT CHARSET=cp1251 MIN_ROWS=1000 MAX_ROWS=100000 PACK_KEYS=0 ROW_FORMAT=COMPACT COMMENT='InnoDB free: 3367936 kB; InnoDB free: 4560896 kB; InnoDB fre';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER Billing.PayerLogInsert AFTER INSERT ON Billing.Payers
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.PayerLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 0,
		PayerID = NEW.PayerID,
		ShortName = NEW.ShortName,
		JuridicalName = NEW.JuridicalName,
		JuridicalAddress = NEW.JuridicalAddress,
		BeforeNamePrefix = NEW.BeforeNamePrefix,
		AfterNamePrefix = NEW.AfterNamePrefix,
		INN = NEW.INN,
		KPP = NEW.KPP,
		OKPO = NEW.OKPO,
		OKVED = NEW.OKVED,
		RS = NEW.RS,
		BankName = NEW.BankName,
		KS = NEW.KS,
		BIK = NEW.BIK,
		OGRN = NEW.OGRN,
		ActualAddressCountry = NEW.ActualAddressCountry,
		ActualAddressIndex = NEW.ActualAddressIndex,
		ActualAddressProvince = NEW.ActualAddressProvince,
		ActualAddressTown = NEW.ActualAddressTown,
		ActualAddressStreet = NEW.ActualAddressStreet,
		ActualAddressHouse = NEW.ActualAddressHouse,
		ActualAddressOffice = NEW.ActualAddressOffice,
		ReceiverAddress = NEW.ReceiverAddress,
		OldPayDate = NEW.OldPayDate,
		OldTariff = NEW.OldTariff,
		DetailInvoice = NEW.DetailInvoice,
		AutoInvoice = NEW.AutoInvoice,
		PayCycle = NEW.PayCycle,
		Balance = NEW.Balance,
		DiscountPercent = NEW.DiscountPercent,
		Comment = NEW.Comment,
		ContactGroupOwnerId = NEW.ContactGroupOwnerId,
		AutoLock = NEW.AutoLock,
		NotificationType = NEW.NotificationType,
		ActualAddressRegion = NEW.ActualAddressRegion,
		HaveContract = NEW.HaveContract,
		SendRegisteredLetter = NEW.SendRegisteredLetter,
		SendScannedDocuments = NEW.SendScannedDocuments,
		DiscountValue = NEW.DiscountValue,
		DiscountType = NEW.DiscountType,
		ChangeServiceNameTo = NEW.ChangeServiceNameTo,
		ShowDiscount = NEW.ShowDiscount,
		RecipientId = NEW.RecipientId,
		EmailInvoice = NEW.EmailInvoice,
		PrintInvoice = NEW.PrintInvoice,
		SendPaymentNotification = NEW.SendPaymentNotification,
		BeginBalance = NEW.BeginBalance,
		BeginBalanceDate = NEW.BeginBalanceDate,
		DocumentsOnLastWorkingDay = NEW.DocumentsOnLastWorkingDay,
		DoNotGroupParts = NEW.DoNotGroupParts,
		Customer = NEW.Customer;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER Billing.PayerLogUpdate AFTER UPDATE ON Billing.Payers
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.PayerLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 1,
		PayerID = OLD.PayerID,
		ShortName = NULLIF(NEW.ShortName, OLD.ShortName),
		JuridicalName = NULLIF(NEW.JuridicalName, OLD.JuridicalName),
		JuridicalAddress = NULLIF(NEW.JuridicalAddress, OLD.JuridicalAddress),
		BeforeNamePrefix = NULLIF(NEW.BeforeNamePrefix, OLD.BeforeNamePrefix),
		AfterNamePrefix = NULLIF(NEW.AfterNamePrefix, OLD.AfterNamePrefix),
		INN = NULLIF(NEW.INN, OLD.INN),
		KPP = NULLIF(NEW.KPP, OLD.KPP),
		OKPO = NULLIF(NEW.OKPO, OLD.OKPO),
		OKVED = NULLIF(NEW.OKVED, OLD.OKVED),
		RS = NULLIF(NEW.RS, OLD.RS),
		BankName = NULLIF(NEW.BankName, OLD.BankName),
		KS = NULLIF(NEW.KS, OLD.KS),
		BIK = NULLIF(NEW.BIK, OLD.BIK),
		OGRN = NULLIF(NEW.OGRN, OLD.OGRN),
		ActualAddressCountry = NULLIF(NEW.ActualAddressCountry, OLD.ActualAddressCountry),
		ActualAddressIndex = NULLIF(NEW.ActualAddressIndex, OLD.ActualAddressIndex),
		ActualAddressProvince = NULLIF(NEW.ActualAddressProvince, OLD.ActualAddressProvince),
		ActualAddressTown = NULLIF(NEW.ActualAddressTown, OLD.ActualAddressTown),
		ActualAddressStreet = NULLIF(NEW.ActualAddressStreet, OLD.ActualAddressStreet),
		ActualAddressHouse = NULLIF(NEW.ActualAddressHouse, OLD.ActualAddressHouse),
		ActualAddressOffice = NULLIF(NEW.ActualAddressOffice, OLD.ActualAddressOffice),
		ReceiverAddress = NULLIF(NEW.ReceiverAddress, OLD.ReceiverAddress),
		OldPayDate = NULLIF(NEW.OldPayDate, OLD.OldPayDate),
		OldTariff = NULLIF(NEW.OldTariff, OLD.OldTariff),
		DetailInvoice = NULLIF(NEW.DetailInvoice, OLD.DetailInvoice),
		AutoInvoice = NULLIF(NEW.AutoInvoice, OLD.AutoInvoice),
		PayCycle = NULLIF(NEW.PayCycle, OLD.PayCycle),
		Balance = NULLIF(NEW.Balance, OLD.Balance),
		DiscountPercent = NULLIF(NEW.DiscountPercent, OLD.DiscountPercent),
		Comment = NULLIF(NEW.Comment, OLD.Comment),
		ContactGroupOwnerId = NULLIF(NEW.ContactGroupOwnerId, OLD.ContactGroupOwnerId),
		AutoLock = NULLIF(NEW.AutoLock, OLD.AutoLock),
		NotificationType = NULLIF(NEW.NotificationType, OLD.NotificationType),
		ActualAddressRegion = NULLIF(NEW.ActualAddressRegion, OLD.ActualAddressRegion),
		HaveContract = NULLIF(NEW.HaveContract, OLD.HaveContract),
		SendRegisteredLetter = NULLIF(NEW.SendRegisteredLetter, OLD.SendRegisteredLetter),
		SendScannedDocuments = NULLIF(NEW.SendScannedDocuments, OLD.SendScannedDocuments),
		DiscountValue = NULLIF(NEW.DiscountValue, OLD.DiscountValue),
		DiscountType = NULLIF(NEW.DiscountType, OLD.DiscountType),
		ChangeServiceNameTo = NULLIF(NEW.ChangeServiceNameTo, OLD.ChangeServiceNameTo),
		ShowDiscount = NULLIF(NEW.ShowDiscount, OLD.ShowDiscount),
		RecipientId = NULLIF(NEW.RecipientId, OLD.RecipientId),
		EmailInvoice = NULLIF(NEW.EmailInvoice, OLD.EmailInvoice),
		PrintInvoice = NULLIF(NEW.PrintInvoice, OLD.PrintInvoice),
		SendPaymentNotification = NULLIF(NEW.SendPaymentNotification, OLD.SendPaymentNotification),
		BeginBalance = NULLIF(NEW.BeginBalance, OLD.BeginBalance),
		BeginBalanceDate = NULLIF(NEW.BeginBalanceDate, OLD.BeginBalanceDate),
		DocumentsOnLastWorkingDay = NULLIF(NEW.DocumentsOnLastWorkingDay, OLD.DocumentsOnLastWorkingDay),
		DoNotGroupParts = NULLIF(NEW.DoNotGroupParts, OLD.DoNotGroupParts),
		Customer = NULLIF(NEW.Customer, OLD.Customer);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER Billing.PayerLogDelete AFTER DELETE ON Billing.Payers
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.PayerLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 2,
		PayerID = OLD.PayerID,
		ShortName = OLD.ShortName,
		JuridicalName = OLD.JuridicalName,
		JuridicalAddress = OLD.JuridicalAddress,
		BeforeNamePrefix = OLD.BeforeNamePrefix,
		AfterNamePrefix = OLD.AfterNamePrefix,
		INN = OLD.INN,
		KPP = OLD.KPP,
		OKPO = OLD.OKPO,
		OKVED = OLD.OKVED,
		RS = OLD.RS,
		BankName = OLD.BankName,
		KS = OLD.KS,
		BIK = OLD.BIK,
		OGRN = OLD.OGRN,
		ActualAddressCountry = OLD.ActualAddressCountry,
		ActualAddressIndex = OLD.ActualAddressIndex,
		ActualAddressProvince = OLD.ActualAddressProvince,
		ActualAddressTown = OLD.ActualAddressTown,
		ActualAddressStreet = OLD.ActualAddressStreet,
		ActualAddressHouse = OLD.ActualAddressHouse,
		ActualAddressOffice = OLD.ActualAddressOffice,
		ReceiverAddress = OLD.ReceiverAddress,
		OldPayDate = OLD.OldPayDate,
		OldTariff = OLD.OldTariff,
		DetailInvoice = OLD.DetailInvoice,
		AutoInvoice = OLD.AutoInvoice,
		PayCycle = OLD.PayCycle,
		Balance = OLD.Balance,
		DiscountPercent = OLD.DiscountPercent,
		Comment = OLD.Comment,
		ContactGroupOwnerId = OLD.ContactGroupOwnerId,
		AutoLock = OLD.AutoLock,
		NotificationType = OLD.NotificationType,
		ActualAddressRegion = OLD.ActualAddressRegion,
		HaveContract = OLD.HaveContract,
		SendRegisteredLetter = OLD.SendRegisteredLetter,
		SendScannedDocuments = OLD.SendScannedDocuments,
		DiscountValue = OLD.DiscountValue,
		DiscountType = OLD.DiscountType,
		ChangeServiceNameTo = OLD.ChangeServiceNameTo,
		ShowDiscount = OLD.ShowDiscount,
		RecipientId = OLD.RecipientId,
		EmailInvoice = OLD.EmailInvoice,
		PrintInvoice = OLD.PrintInvoice,
		SendPaymentNotification = OLD.SendPaymentNotification,
		BeginBalance = OLD.BeginBalance,
		BeginBalanceDate = OLD.BeginBalanceDate,
		DocumentsOnLastWorkingDay = OLD.DocumentsOnLastWorkingDay,
		DoNotGroupParts = OLD.DoNotGroupParts,
		Customer = OLD.Customer;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `ReportLogProcessorStates`
--

DROP TABLE IF EXISTS `ReportLogProcessorStates`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `ReportLogProcessorStates` (
  `Id` int(11) NOT NULL AUTO_INCREMENT,
  `LastRun` datetime NOT NULL DEFAULT '0000-00-00 00:00:00',
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=cp1251;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `actparts`
--

DROP TABLE IF EXISTS `actparts`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `actparts` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `Name` varchar(255) DEFAULT NULL,
  `Cost` decimal(19,5) DEFAULT NULL,
  `Count` int(11) DEFAULT NULL,
  `Act` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=33062 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `advertisings`
--

DROP TABLE IF EXISTS `advertisings`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `advertisings` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `Begin` datetime DEFAULT NULL,
  `End` datetime DEFAULT NULL,
  `Cost` decimal(19,5) DEFAULT NULL,
  `PayedSum` decimal(19,5) DEFAULT NULL,
  `Payer` int(10) unsigned DEFAULT NULL,
  `Payment` int(10) unsigned DEFAULT NULL,
  `Invoice` int(10) unsigned DEFAULT NULL,
  `Act` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`Id`),
  KEY `FK_Advertisings_Act` (`Act`),
  KEY `FK_Advertisings_Invoice` (`Invoice`),
  CONSTRAINT `FK_Advertisings_Act` FOREIGN KEY (`Act`) REFERENCES `acts` (`Id`) ON DELETE SET NULL,
  CONSTRAINT `FK_Advertisings_Invoice` FOREIGN KEY (`Invoice`) REFERENCES `invoices` (`Id`) ON DELETE SET NULL
) ENGINE=InnoDB AUTO_INCREMENT=52 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `freeorders`
--

DROP TABLE IF EXISTS `freeorders`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `freeorders` (
  `ClientPayerId` int(10) unsigned NOT NULL,
  `SupplierPayerId` int(10) unsigned NOT NULL,
  PRIMARY KEY (`ClientPayerId`,`SupplierPayerId`),
  KEY `FK_FreeOrders_2` (`SupplierPayerId`),
  CONSTRAINT `FK_FreeOrders_1` FOREIGN KEY (`ClientPayerId`) REFERENCES `payers` (`PayerID`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `FK_FreeOrders_2` FOREIGN KEY (`SupplierPayerId`) REFERENCES `payers` (`PayerID`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `ignoredinns`
--

DROP TABLE IF EXISTS `ignoredinns`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `ignoredinns` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `Inn` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=cp1251;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `legalentities`
--

DROP TABLE IF EXISTS `legalentities`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `legalentities` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `PayerId` int(10) unsigned NOT NULL,
  `Name` varchar(100) DEFAULT NULL COMMENT 'Краткое наименование',
  `FullName` varchar(255) DEFAULT NULL COMMENT 'Полное наименование',
  PRIMARY KEY (`Id`,`PayerId`) USING BTREE,
  KEY `FK_LegalEntities_PayerId` (`PayerId`),
  CONSTRAINT `FK_LegalEntities_PayerId` FOREIGN KEY (`PayerId`) REFERENCES `payers` (`PayerID`)
) ENGINE=InnoDB AUTO_INCREMENT=3712 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER Billing.LegalEntityLogInsert AFTER INSERT ON Billing.LegalEntities
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.LegalEntityLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 0,
		EntityId = NEW.Id,
		PayerId = NEW.PayerId,
		Name = NEW.Name,
		FullName = NEW.FullName;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER Billing.LegalEntityLogUpdate AFTER UPDATE ON Billing.LegalEntities
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.LegalEntityLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 1,
		EntityId = OLD.Id,
		PayerId = NULLIF(NEW.PayerId, OLD.PayerId),
		Name = NULLIF(NEW.Name, OLD.Name),
		FullName = NULLIF(NEW.FullName, OLD.FullName);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER Billing.LegalEntityLogDelete AFTER DELETE ON Billing.LegalEntities
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.LegalEntityLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 2,
		EntityId = OLD.Id,
		PayerId = OLD.PayerId,
		Name = OLD.Name,
		FullName = OLD.FullName;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `mailsenthistory`
--

DROP TABLE IF EXISTS `mailsenthistory`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `mailsenthistory` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `SentDate` datetime NOT NULL,
  `UserName` varchar(45) NOT NULL,
  `Comment` mediumtext NOT NULL,
  `PayerId` int(10) unsigned NOT NULL,
  PRIMARY KEY (`Id`),
  KEY `FK_MailSentHistory_PayerId` (`PayerId`),
  CONSTRAINT `FK_MailSentHistory_PayerId` FOREIGN KEY (`PayerId`) REFERENCES `payers` (`PayerID`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=24383 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `payments`
--

DROP TABLE IF EXISTS `payments`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `payments` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `PayedOn` datetime NOT NULL,
  `Sum` decimal(10,2) NOT NULL DEFAULT '0.00',
  `PayerId` int(10) unsigned DEFAULT NULL,
  `RecipientId` int(10) unsigned DEFAULT NULL,
  `RegistredOn` datetime DEFAULT NULL,
  `Comment` varchar(255) DEFAULT NULL,
  `DocumentNumber` varchar(255) DEFAULT NULL,
  `PayerInn` varchar(255) DEFAULT NULL,
  `PayerName` varchar(255) DEFAULT NULL,
  `PayerAccountCode` varchar(255) DEFAULT NULL,
  `PayerBankDescription` varchar(255) DEFAULT NULL,
  `PayerBankBic` varchar(255) DEFAULT NULL,
  `PayerBankAccountCode` varchar(255) DEFAULT NULL,
  `RecipientInn` varchar(255) DEFAULT NULL,
  `RecipientName` varchar(255) DEFAULT NULL,
  `RecipientAccountCode` varchar(255) DEFAULT NULL,
  `RecipientBankDescription` varchar(255) DEFAULT NULL,
  `RecipientBankBic` varchar(255) DEFAULT NULL,
  `RecipientBankAccountCode` varchar(255) DEFAULT NULL,
  `OperatorComment` varchar(255) DEFAULT NULL,
  `ForAd` tinyint(1) DEFAULT NULL,
  `AdSum` decimal(19,5) DEFAULT NULL,
  `Ad` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`Id`) USING BTREE
) ENGINE=InnoDB AUTO_INCREMENT=17190 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER Billing.PaymentLogInsert AFTER INSERT ON Billing.Payments
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.PaymentLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 0,
		PaymentId = NEW.Id,
		PayedOn = NEW.PayedOn,
		Sum = NEW.Sum,
		PayerId = NEW.PayerId,
		RecipientId = NEW.RecipientId,
		RegistredOn = NEW.RegistredOn,
		Comment = NEW.Comment,
		DocumentNumber = NEW.DocumentNumber,
		PayerInn = NEW.PayerInn,
		PayerName = NEW.PayerName,
		PayerAccountCode = NEW.PayerAccountCode,
		PayerBankDescription = NEW.PayerBankDescription,
		PayerBankBic = NEW.PayerBankBic,
		PayerBankAccountCode = NEW.PayerBankAccountCode,
		RecipientInn = NEW.RecipientInn,
		RecipientName = NEW.RecipientName,
		RecipientAccountCode = NEW.RecipientAccountCode,
		RecipientBankDescription = NEW.RecipientBankDescription,
		RecipientBankBic = NEW.RecipientBankBic,
		RecipientBankAccountCode = NEW.RecipientBankAccountCode;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER Billing.PaymentLogUpdate AFTER UPDATE ON Billing.Payments
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.PaymentLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 1,
		PaymentId = OLD.Id,
		PayedOn = NULLIF(NEW.PayedOn, OLD.PayedOn),
		Sum = NULLIF(NEW.Sum, OLD.Sum),
		PayerId = NULLIF(NEW.PayerId, OLD.PayerId),
		RecipientId = NULLIF(NEW.RecipientId, OLD.RecipientId),
		RegistredOn = NULLIF(NEW.RegistredOn, OLD.RegistredOn),
		Comment = NULLIF(NEW.Comment, OLD.Comment),
		DocumentNumber = NULLIF(NEW.DocumentNumber, OLD.DocumentNumber),
		PayerInn = NULLIF(NEW.PayerInn, OLD.PayerInn),
		PayerName = NULLIF(NEW.PayerName, OLD.PayerName),
		PayerAccountCode = NULLIF(NEW.PayerAccountCode, OLD.PayerAccountCode),
		PayerBankDescription = NULLIF(NEW.PayerBankDescription, OLD.PayerBankDescription),
		PayerBankBic = NULLIF(NEW.PayerBankBic, OLD.PayerBankBic),
		PayerBankAccountCode = NULLIF(NEW.PayerBankAccountCode, OLD.PayerBankAccountCode),
		RecipientInn = NULLIF(NEW.RecipientInn, OLD.RecipientInn),
		RecipientName = NULLIF(NEW.RecipientName, OLD.RecipientName),
		RecipientAccountCode = NULLIF(NEW.RecipientAccountCode, OLD.RecipientAccountCode),
		RecipientBankDescription = NULLIF(NEW.RecipientBankDescription, OLD.RecipientBankDescription),
		RecipientBankBic = NULLIF(NEW.RecipientBankBic, OLD.RecipientBankBic),
		RecipientBankAccountCode = NULLIF(NEW.RecipientBankAccountCode, OLD.RecipientBankAccountCode);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER Billing.PaymentLogDelete AFTER DELETE ON Billing.Payments
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.PaymentLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 2,
		PaymentId = OLD.Id,
		PayedOn = OLD.PayedOn,
		Sum = OLD.Sum,
		PayerId = OLD.PayerId,
		RecipientId = OLD.RecipientId,
		RegistredOn = OLD.RegistredOn,
		Comment = OLD.Comment,
		DocumentNumber = OLD.DocumentNumber,
		PayerInn = OLD.PayerInn,
		PayerName = OLD.PayerName,
		PayerAccountCode = OLD.PayerAccountCode,
		PayerBankDescription = OLD.PayerBankDescription,
		PayerBankBic = OLD.PayerBankBic,
		PayerBankAccountCode = OLD.PayerBankAccountCode,
		RecipientInn = OLD.RecipientInn,
		RecipientName = OLD.RecipientName,
		RecipientAccountCode = OLD.RecipientAccountCode,
		RecipientBankDescription = OLD.RecipientBankDescription,
		RecipientBankBic = OLD.RecipientBankBic,
		RecipientBankAccountCode = OLD.RecipientBankAccountCode;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `recipients`
--

DROP TABLE IF EXISTS `recipients`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `recipients` (
  `Id` int(11) NOT NULL AUTO_INCREMENT,
  `Name` varchar(255) DEFAULT NULL,
  `FullName` varchar(255) DEFAULT NULL,
  `Address` varchar(255) DEFAULT NULL,
  `INN` varchar(255) DEFAULT NULL,
  `KPP` varchar(255) DEFAULT NULL,
  `BIC` varchar(255) DEFAULT NULL,
  `BankAccountNumber` varchar(255) DEFAULT NULL,
  `BankLoroAccount` varchar(255) DEFAULT NULL,
  `Bank` varchar(255) DEFAULT NULL,
  `Boss` varchar(255) DEFAULT NULL,
  `Accountant` varchar(255) DEFAULT NULL,
  `AccountWarranty` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=8 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping events for database 'billing'
--

--
-- Dumping routines for database 'billing'
--

--
-- Current Database: `catalogs`
--

/*!40000 DROP DATABASE IF EXISTS `catalogs`*/;

CREATE DATABASE /*!32312 IF NOT EXISTS*/ `catalogs` /*!40100 DEFAULT CHARACTER SET cp1251 */;

USE `catalogs`;

--
-- Table structure for table `NEWVI`
--

DROP TABLE IF EXISTS `NEWVI`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `NEWVI` (
  `id` int(10) unsigned NOT NULL DEFAULT '0',
  `mnn` varchar(255) DEFAULT NULL,
  `name` varchar(255) DEFAULT NULL,
  `vitallyimportant` tinyint(1) unsigned NOT NULL DEFAULT '0',
  `NEW_vi` tinyint(1) unsigned NOT NULL DEFAULT '0',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=cp1251;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `assortment`
--

DROP TABLE IF EXISTS `assortment`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `assortment` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `CatalogId` int(10) unsigned NOT NULL,
  `ProducerId` int(10) unsigned NOT NULL,
  `Checked` tinyint(1) unsigned NOT NULL DEFAULT '0',
  PRIMARY KEY (`CatalogId`,`ProducerId`) USING BTREE,
  UNIQUE KEY `Id_IDX` (`Id`),
  KEY `ProducerId_IDX` (`ProducerId`) USING BTREE,
  CONSTRAINT `FK_Assortment_2` FOREIGN KEY (`ProducerId`) REFERENCES `producers` (`Id`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `FK_Assortment_CatalogId` FOREIGN KEY (`CatalogId`) REFERENCES `catalog` (`Id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=708386 DEFAULT CHARSET=cp1251 ROW_FORMAT=DYNAMIC;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER AssortmentLogInsert AFTER INSERT ON Catalogs.Assortment
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.AssortmentLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)), 
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)), 
		Operation = 0, 
		AssortmentId = NEW.Id,
		CatalogId = NEW.CatalogId,
		ProducerId = NEW.ProducerId,
		Checked = NEW.Checked;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER AssortmentLogUpdate AFTER UPDATE ON Catalogs.Assortment
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.AssortmentLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)), 
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)), 
		Operation = 1, 
		AssortmentId = OLD.Id,
		CatalogId = NULLIF(NEW.CatalogId, OLD.CatalogId),
		ProducerId = NULLIF(NEW.ProducerId, OLD.ProducerId),
		Checked = NULLIF(NEW.Checked, OLD.Checked);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER AssortmentLogDelete AFTER DELETE ON Catalogs.Assortment
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.AssortmentLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)), 
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)), 
		Operation = 2, 
		AssortmentId = OLD.Id,
		CatalogId = OLD.CatalogId,
		ProducerId = OLD.ProducerId,
		Checked = OLD.Checked;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `catalog`
--

DROP TABLE IF EXISTS `catalog`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `catalog` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `FormId` int(10) unsigned NOT NULL,
  `NameId` int(10) unsigned NOT NULL,
  `VitallyImportant` tinyint(1) unsigned NOT NULL DEFAULT '0',
  `MandatoryList` tinyint(1) unsigned NOT NULL DEFAULT '0',
  `NeedCold` tinyint(1) unsigned NOT NULL DEFAULT '0',
  `Fragile` tinyint(1) unsigned NOT NULL DEFAULT '0',
  `Pharmacie` tinyint(1) NOT NULL DEFAULT '1',
  `Hidden` tinyint(1) unsigned NOT NULL DEFAULT '0',
  `Name` varchar(255) DEFAULT NULL,
  `UpdateTime` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`Id`) USING BTREE,
  KEY `Index_Name` (`Name`),
  KEY `NameId_Idx` (`NameId`),
  KEY `FormId_Idx` (`FormId`),
  CONSTRAINT `FK_catalog_1` FOREIGN KEY (`FormId`) REFERENCES `catalogforms` (`Id`),
  CONSTRAINT `FK_catalog_2` FOREIGN KEY (`NameId`) REFERENCES `catalognames` (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=132161 DEFAULT CHARSET=cp1251 ROW_FORMAT=DYNAMIC;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER CatalogBeforeInsert
BEFORE INSERT
ON catalog
FOR EACH ROW
BEGIN

  SET NEW.Name = (
  SELECT concat(cn.Name, ' ', cf.Form)
  FROM
    Catalogs.CatalogNames cn, Catalogs.CatalogForms cf
  WHERE
    cn.Id = New.NameId
    AND cf.Id = New.FormId
  );

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER CatalogLogInsert
AFTER INSERT
ON catalog
FOR EACH ROW
BEGIN
  INSERT INTO `logs`.CatalogLogs
  SET
    LogTime = now(), OperatorName = ifnull(@INUser, substring_index(user(), '@', 1)), OperatorHost = ifnull(@INHost, substring_index(user(), '@', -1)), Operation = 0, CatalogId = NEW.Id, FormId = NEW.FormId, NameId = NEW.NameId, VitallyImportant = NEW.VitallyImportant, MandatoryList = NEW.MandatoryList, NeedCold = NEW.NeedCold, Fragile = NEW.Fragile, Pharmacie = NEW.Pharmacie, Hidden = NEW.Hidden, Name = NEW.Name, UpdateTime = NEW.UpdateTime;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER CatalogBeforeUpdate
BEFORE UPDATE
ON catalog
FOR EACH ROW
BEGIN

  IF NEW.Hidden = 1 AND old.Hidden = 0 THEN
    UPDATE Products
    SET
      Hidden = 1
    WHERE
      CatalogId = NEW.Id;
    DELETE
    FROM
      farm.excludes
    WHERE
      catalogId = NEW.Id;
    DELETE
    FROM
      catalogs.Assortment
    WHERE
      catalogId = new.Id;

  END IF;

  IF NEW.Hidden = 0 AND old.Hidden = 1 THEN

    SET new.Name = (SELECT concat(cn.Name, ' ', cf.Form)
                    FROM
                      catalog c,
                      catalognames cn,
                      catalogforms cf
                    WHERE
                      cn.id = c.nameid
                      AND cf.id = c.formid
                      AND c.id = old.Id);
  END IF;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER CatalogLogUpdate
AFTER UPDATE
ON catalog
FOR EACH ROW
BEGIN
  INSERT INTO `logs`.CatalogLogs
  SET
    LogTime = now(), OperatorName = ifnull(@INUser, substring_index(user(), '@', 1)), OperatorHost = ifnull(@INHost, substring_index(user(), '@', -1)), Operation = 1, CatalogId = OLD.Id, FormId = nullif(NEW.FormId, OLD.FormId), NameId = nullif(NEW.NameId, OLD.NameId), VitallyImportant = nullif(NEW.VitallyImportant, OLD.VitallyImportant), MandatoryList = nullif(NEW.MandatoryList, OLD.MandatoryList), NeedCold = nullif(NEW.NeedCold, OLD.NeedCold), Fragile = nullif(NEW.Fragile, OLD.Fragile), Pharmacie = nullif(NEW.Pharmacie, OLD.Pharmacie), Hidden = nullif(NEW.Hidden, OLD.Hidden), Name = nullif(NEW.Name, OLD.Name), UpdateTime = nullif(NEW.UpdateTime, OLD.UpdateTime);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER CatalogLogDelete
AFTER DELETE
ON catalog
FOR EACH ROW
BEGIN
  INSERT INTO `logs`.CatalogLogs
  SET
    LogTime = now(), OperatorName = ifnull(@INUser, substring_index(user(), '@', 1)), OperatorHost = ifnull(@INHost, substring_index(user(), '@', -1)), Operation = 2, CatalogId = OLD.Id, FormId = OLD.FormId, NameId = OLD.NameId, VitallyImportant = OLD.VitallyImportant, MandatoryList = OLD.MandatoryList, NeedCold = OLD.NeedCold, Fragile = OLD.Fragile, Pharmacie = OLD.Pharmacie, Hidden = OLD.Hidden, Name = OLD.Name, UpdateTime = OLD.UpdateTime;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `catalog_back070112`
--

DROP TABLE IF EXISTS `catalog_back070112`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `catalog_back070112` (
  `Id` int(10) unsigned NOT NULL DEFAULT '0',
  `FormId` int(10) unsigned NOT NULL,
  `NameId` int(10) unsigned NOT NULL,
  `VitallyImportant` tinyint(1) unsigned NOT NULL DEFAULT '0',
  `MandatoryList` tinyint(1) unsigned NOT NULL DEFAULT '0',
  `NeedCold` tinyint(1) unsigned NOT NULL DEFAULT '0',
  `Fragile` tinyint(1) unsigned NOT NULL DEFAULT '0',
  `Pharmacie` tinyint(1) NOT NULL DEFAULT '1',
  `Hidden` tinyint(1) unsigned NOT NULL DEFAULT '0',
  `Name` varchar(255) DEFAULT NULL,
  `UpdateTime` timestamp NOT NULL DEFAULT '0000-00-00 00:00:00'
) ENGINE=InnoDB DEFAULT CHARSET=cp1251;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `catalogforms`
--

DROP TABLE IF EXISTS `catalogforms`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `catalogforms` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `Form` varchar(255) NOT NULL,
  PRIMARY KEY (`Id`) USING BTREE
) ENGINE=InnoDB AUTO_INCREMENT=101939 DEFAULT CHARSET=cp1251 PACK_KEYS=1 ROW_FORMAT=DYNAMIC;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER catalogs.CatalogFormBeforeUpdate
	BEFORE UPDATE
	ON catalogs.catalogforms
	FOR EACH ROW
BEGIN
  IF NEW.Form != old.Form THEN
    UPDATE
      Catalogs.Catalog c
      JOIN Catalogs.CatalogNames cn ON cn.Id = c.NameId
    SET
      c.name = CONCAT(cn.Name, ' ', NEW.Form)
    WHERE
      c.FormId = NEW.Id;
  END IF;

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER CatalogFormsDelete BEFORE DELETE ON catalogs.CatalogForms
FOR EACH ROW BEGIN
	INSERT 
    INTO `logs`.CatalogFormsLogs 
    SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)), 
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)), 
		Operation = 2, 
		FormId = OLD.Id, 
		Form = OLD.Form;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `catalognames`
--

DROP TABLE IF EXISTS `catalognames`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `catalognames` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `Name` varchar(255) NOT NULL,
  `DescriptionId` int(10) unsigned DEFAULT NULL,
  `MnnId` int(10) unsigned DEFAULT NULL,
  `UpdateTime` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=15633 DEFAULT CHARSET=cp1251 PACK_KEYS=0 ROW_FORMAT=DYNAMIC;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER catalogs.CatalogNameBeforeUpdate
	BEFORE UPDATE
	ON catalogs.catalognames
	FOR EACH ROW
BEGIN

  IF NEW.name != old.Name THEN
    UPDATE
      Catalogs.Catalog c
      JOIN Catalogs.CatalogForms cf ON cf.Id = c.FormId
    SET
      c.name = CONCAT(NEW.Name, ' ', cf.Form)
    WHERE
      c.NameId = OLD.Id;
  END IF;

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `descriptions`
--

DROP TABLE IF EXISTS `descriptions`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `descriptions` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `Name` varchar(255) NOT NULL,
  `EnglishName` varchar(255) DEFAULT NULL,
  `Description` mediumtext COMMENT 'В AnalitF обозначается как Дополнительно',
  `Interaction` mediumtext COMMENT 'Взаимодействие',
  `SideEffect` mediumtext COMMENT 'Побочное действие и противопоказания ',
  `IndicationsForUse` mediumtext COMMENT 'Показания к применению ',
  `Dosing` mediumtext COMMENT 'Способ применения и дозы',
  `Warnings` mediumtext COMMENT 'Предостережения и противопоказания',
  `ProductForm` mediumtext COMMENT 'Форма выпуска',
  `PharmacologicalAction` mediumtext COMMENT 'Фармакологическое действие',
  `Storage` mediumtext COMMENT 'Условия хранения',
  `Expiration` mediumtext COMMENT 'Срок годности',
  `Composition` mediumtext COMMENT 'Состав',
  `NeedCorrect` tinyint(1) unsigned NOT NULL DEFAULT '0',
  `UpdateTime` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`Id`),
  KEY `Name` (`Name`),
  KEY `EnglishName` (`EnglishName`)
) ENGINE=InnoDB AUTO_INCREMENT=41628 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER catalogs.DescriptionLogInsert AFTER INSERT ON catalogs.Descriptions
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.DescriptionLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 0,
		DescriptionId = NEW.Id,
		Name = NEW.Name,
		EnglishName = NEW.EnglishName,
		Description = NEW.Description,
		Interaction = NEW.Interaction,
		SideEffect = NEW.SideEffect,
		IndicationsForUse = NEW.IndicationsForUse,
		Dosing = NEW.Dosing,
		Warnings = NEW.Warnings,
		ProductForm = NEW.ProductForm,
		PharmacologicalAction = NEW.PharmacologicalAction,
		Storage = NEW.Storage,
		Expiration = NEW.Expiration,
		Composition = NEW.Composition,
		NeedCorrect = NEW.NeedCorrect;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER catalogs.DescriptionLogUpdate AFTER UPDATE ON catalogs.Descriptions
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.DescriptionLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 1,
		DescriptionId = OLD.Id,
		Name = NULLIF(NEW.Name, OLD.Name),
		EnglishName = NULLIF(NEW.EnglishName, OLD.EnglishName),
		Description = NULLIF(NEW.Description, OLD.Description),
		Interaction = NULLIF(NEW.Interaction, OLD.Interaction),
		SideEffect = NULLIF(NEW.SideEffect, OLD.SideEffect),
		IndicationsForUse = NULLIF(NEW.IndicationsForUse, OLD.IndicationsForUse),
		Dosing = NULLIF(NEW.Dosing, OLD.Dosing),
		Warnings = NULLIF(NEW.Warnings, OLD.Warnings),
		ProductForm = NULLIF(NEW.ProductForm, OLD.ProductForm),
		PharmacologicalAction = NULLIF(NEW.PharmacologicalAction, OLD.PharmacologicalAction),
		Storage = NULLIF(NEW.Storage, OLD.Storage),
		Expiration = NULLIF(NEW.Expiration, OLD.Expiration),
		Composition = NULLIF(NEW.Composition, OLD.Composition),
		NeedCorrect = NULLIF(NEW.NeedCorrect, OLD.NeedCorrect);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER catalogs.DescriptionLogDelete AFTER DELETE ON catalogs.Descriptions
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.DescriptionLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 2,
		DescriptionId = OLD.Id,
		Name = OLD.Name,
		EnglishName = OLD.EnglishName,
		Description = OLD.Description,
		Interaction = OLD.Interaction,
		SideEffect = OLD.SideEffect,
		IndicationsForUse = OLD.IndicationsForUse,
		Dosing = OLD.Dosing,
		Warnings = OLD.Warnings,
		ProductForm = OLD.ProductForm,
		PharmacologicalAction = OLD.PharmacologicalAction,
		Storage = OLD.Storage,
		Expiration = OLD.Expiration,
		Composition = OLD.Composition,
		NeedCorrect = OLD.NeedCorrect;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `mnn`
--

DROP TABLE IF EXISTS `mnn`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `mnn` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `Mnn` varchar(255) NOT NULL,
  `UpdateTime` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `RussianMnn` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`Id`),
  UNIQUE KEY `Mnn` (`Mnn`) USING BTREE,
  UNIQUE KEY `RussianMnn` (`RussianMnn`) USING BTREE
) ENGINE=InnoDB AUTO_INCREMENT=4424 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER MnnLogInsert AFTER INSERT ON Catalogs.Mnn
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.MnnLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 0,
		MnnId = NEW.Id,
		Mnn = NEW.Mnn,
		UpdateTime = NEW.UpdateTime,
		RussianMnn = NEW.RussianMnn;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER MnnLogUpdate AFTER UPDATE ON Catalogs.Mnn
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.MnnLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 1,
		MnnId = OLD.Id,
		Mnn = NULLIF(NEW.Mnn, OLD.Mnn),
		UpdateTime = NULLIF(NEW.UpdateTime, OLD.UpdateTime),
		RussianMnn = NULLIF(NEW.RussianMnn, OLD.RussianMnn);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER MnnLogDelete AFTER DELETE ON Catalogs.Mnn
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.MnnLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 2,
		MnnId = OLD.Id,
		Mnn = OLD.Mnn,
		UpdateTime = OLD.UpdateTime,
		RussianMnn = OLD.RussianMnn;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `producerequivalents`
--

DROP TABLE IF EXISTS `producerequivalents`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `producerequivalents` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `Name` varchar(255) NOT NULL,
  `ProducerId` int(10) unsigned NOT NULL,
  PRIMARY KEY (`Id`),
  KEY `FK_ProducerId` (`ProducerId`),
  CONSTRAINT `FK_ProducerId` FOREIGN KEY (`ProducerId`) REFERENCES `producers` (`Id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB AUTO_INCREMENT=2070 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER ProducerequivalentInsert AFTER INSERT ON catalogs.ProducerEquivalents
FOR EACH ROW BEGIN
	INSERT 
    INTO `logs`.ProducerequivalentLogs
    SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)), 
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)), 
		Operation = 0, 
		ProducerequivalentId = NEW.Id,
		Name = NEW.Name,
		ProducerId = NEW.ProducerId;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER ProducerequivalentUpdate AFTER UPDATE ON catalogs.ProducerEquivalents
FOR EACH ROW BEGIN
	INSERT 
    INTO `logs`.ProducerequivalentLogs
    SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)), 
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)), 
		Operation = 1, 
		ProducerequivalentId = OLD.Id,
		Name = NULLIF(NEW.Name, OLD.Name),
		ProducerId = NULLIF(NEW.ProducerId, OLD.ProducerId);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER ProducerequivalentDelete AFTER DELETE ON catalogs.ProducerEquivalents
FOR EACH ROW BEGIN
	INSERT 
    INTO `logs`.ProducerequivalentLogs
    SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)), 
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)), 
		Operation = 2, 
		ProducerequivalentId = OLD.Id,
		Name = OLD.Name,
		ProducerId = OLD.ProducerId;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `producers`
--

DROP TABLE IF EXISTS `producers`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `producers` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `Name` varchar(255) NOT NULL,
  `Checked` tinyint(1) NOT NULL DEFAULT '0',
  `UpdateTime` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`Id`),
  KEY `NameIdx` (`Name`)
) ENGINE=InnoDB AUTO_INCREMENT=7560 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER ProducerLogInsert AFTER INSERT ON Catalogs.Producers
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.ProducerLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)), 
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)), 
		Operation = 0, 
		ProducerId = NEW.Id,
		Name = NEW.Name,
		Checked = NEW.Checked;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER ProducerLogUpdate AFTER UPDATE ON Catalogs.Producers
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.ProducerLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)), 
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)), 
		Operation = 1, 
		ProducerId = OLD.Id,
		Name = NULLIF(NEW.Name, OLD.Name),
		Checked = NULLIF(NEW.Checked, OLD.Checked);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER ProducerLogDelete AFTER DELETE ON Catalogs.Producers
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.ProducerLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)), 
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)), 
		Operation = 2, 
		ProducerId = OLD.Id,
		Name = OLD.Name,
		Checked = OLD.Checked;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `productproperties`
--

DROP TABLE IF EXISTS `productproperties`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `productproperties` (
  `ProductId` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `PropertyValueId` int(10) unsigned NOT NULL,
  PRIMARY KEY (`ProductId`,`PropertyValueId`),
  KEY `FK_ProductProperties_PropertyValueId` (`PropertyValueId`),
  CONSTRAINT `FK_ProductProperties_ProductId` FOREIGN KEY (`ProductId`) REFERENCES `products` (`Id`) ON DELETE CASCADE,
  CONSTRAINT `FK_ProductProperties_PropertyValueId` FOREIGN KEY (`PropertyValueId`) REFERENCES `propertyvalues` (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=177620 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `products`
--

DROP TABLE IF EXISTS `products`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `products` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `CatalogId` int(10) unsigned NOT NULL,
  `Hidden` tinyint(1) NOT NULL,
  `UpdateTime` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`Id`,`CatalogId`) USING BTREE,
  KEY `CatalogId_Idx` (`CatalogId`),
  CONSTRAINT `FK_products_1` FOREIGN KEY (`CatalogId`) REFERENCES `catalog` (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=177629 DEFAULT CHARSET=cp1251 ROW_FORMAT=DYNAMIC;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER catalogs.ProductsAfterInsert
	AFTER INSERT
	ON catalogs.products
	FOR EACH ROW
BEGIN
INSERT INTO `logs`.ProductsLogs
SET
OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)) ,
OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)) ,
Operation = 0,
ProductId=NEW.id,
CatalogId=NEW.CatalogId,
Hidden=NEW.Hidden;



END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER catalogs.ProductsBeforeUpdate
	BEFORE UPDATE
	ON catalogs.products
	FOR EACH ROW
BEGIN
IF NEW.Hidden = 1 AND old.Hidden = 0 THEN
  DELETE
  FROM
    Farm.Core0
  WHERE
    ProductId = OLD.Id;
  DELETE
  FROM
    Farm.Synonym
  WHERE
    ProductId = OLD.Id;
END IF;
INSERT INTO `logs`.ProductsLogs
SET 
OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)) ,
OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)) ,
Operation = 1,
ProductId=OLD.Id,
CatalogId=NULLIF(NEW.CatalogId, OLD.CatalogId),
Hidden=NULLIF(NEW.Hidden, Hidden);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `properties`
--

DROP TABLE IF EXISTS `properties`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `properties` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `PropertyName` varchar(100) NOT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=37 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `propertyvalues`
--

DROP TABLE IF EXISTS `propertyvalues`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `propertyvalues` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `Value` varchar(100) NOT NULL,
  `PropertyId` int(10) unsigned NOT NULL,
  PRIMARY KEY (`Id`),
  KEY `FK_PropertyValues_PropertyId` (`PropertyId`) USING BTREE,
  KEY `Value_IDX` (`Value`),
  CONSTRAINT `FK_PropertyValues_PropertyId` FOREIGN KEY (`PropertyId`) REFERENCES `properties` (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=4570 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `protekcatalog_del070112`
--

DROP TABLE IF EXISTS `protekcatalog_del070112`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `protekcatalog_del070112` (
  `Id` int(10) unsigned NOT NULL,
  `Mnn` varchar(255) DEFAULT NULL,
  `Description` mediumtext,
  `Synonym` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`Id`),
  KEY `Synonym` (`Synonym`)
) ENGINE=InnoDB DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `temporarymnncatalog_del070112`
--

DROP TABLE IF EXISTS `temporarymnncatalog_del070112`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `temporarymnncatalog_del070112` (
  `id` int(10) unsigned NOT NULL DEFAULT '0',
  `Name` varchar(255) NOT NULL,
  `SiaMnn` varchar(255) DEFAULT NULL,
  `ProtekMnn` varchar(255) DEFAULT NULL,
  `MandatoryList` tinyint(3) unsigned NOT NULL DEFAULT '0',
  `VitallyImportant` tinyint(3) unsigned NOT NULL DEFAULT '0',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping events for database 'catalogs'
--

--
-- Dumping routines for database 'catalogs'
--
/*!50003 DROP FUNCTION IF EXISTS `GetFullForm` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50020 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 FUNCTION `GetFullForm`(ProductId int unsigned) RETURNS varchar(255) CHARSET cp1251
    READS SQL DATA
    DETERMINISTIC
BEGIN
  DECLARE result varchar(255);
  select
    concat(CatalogForms.Form, ' ',
     cast(GROUP_CONCAT(ifnull(PropertyValues.Value, '')
                        order by Properties.PropertyName, PropertyValues.Value
                        SEPARATOR ', '
                       ) as char)
    ) as FullForm
    into result 
  from
    (   
     catalogs.products,
     catalogs.catalog,
     catalogs.CatalogForms
     )
     left join catalogs.ProductProperties on ProductProperties.ProductId = Products.Id
     left join catalogs.PropertyValues on PropertyValues.Id = ProductProperties.PropertyValueId
     left join catalogs.Properties on Properties.Id = PropertyValues.PropertyId
   where
      products.Id = ProductId
   and catalog.Id = products.CatalogId
   and CatalogForms.Id = catalog.FormId;
     
  return result; 
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Current Database: `contacts`
--

/*!40000 DROP DATABASE IF EXISTS `contacts`*/;

CREATE DATABASE /*!32312 IF NOT EXISTS*/ `contacts` /*!40100 DEFAULT CHARACTER SET cp1251 */;

USE `contacts`;

--
-- Table structure for table `contact_group_owners`
--

DROP TABLE IF EXISTS `contact_group_owners`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `contact_group_owners` (
  `Id` int(11) unsigned NOT NULL AUTO_INCREMENT,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=14298 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `contact_groups`
--

DROP TABLE IF EXISTS `contact_groups`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `contact_groups` (
  `Id` int(10) unsigned NOT NULL DEFAULT '0',
  `Name` varchar(100) NOT NULL,
  `Type` tinyint(4) NOT NULL DEFAULT '0',
  `Public` tinyint(1) unsigned NOT NULL DEFAULT '1',
  `ContactGroupOwnerId` int(11) unsigned NOT NULL,
  `Specialized` tinyint(1) unsigned NOT NULL DEFAULT '0' COMMENT '0 - общая группа\r\n1 - специализированная',
  PRIMARY KEY (`Id`),
  KEY `FK_contact_groups_ContactGroupOwnerId` (`ContactGroupOwnerId`),
  CONSTRAINT `FK_contact_groups_ContactGroupOwnerId` FOREIGN KEY (`ContactGroupOwnerId`) REFERENCES `contact_group_owners` (`Id`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `FK_contact_groups_ContactOwnerId` FOREIGN KEY (`Id`) REFERENCES `contact_owners` (`Id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `contact_owners`
--

DROP TABLE IF EXISTS `contact_owners`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `contact_owners` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=453178 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `contacts`
--

DROP TABLE IF EXISTS `contacts`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `contacts` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `Type` int(11) NOT NULL,
  `Comment` varchar(45) DEFAULT NULL,
  `ContactText` varchar(45) NOT NULL,
  `ContactOwnerId` int(10) unsigned NOT NULL,
  PRIMARY KEY (`Id`),
  KEY `FK_contacts_ContactOwnerId` (`ContactOwnerId`),
  CONSTRAINT `FK_contacts_ContactOwnerId` FOREIGN KEY (`ContactOwnerId`) REFERENCES `contact_owners` (`Id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=505474 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `persons`
--

DROP TABLE IF EXISTS `persons`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `persons` (
  `Id` int(10) unsigned NOT NULL DEFAULT '0',
  `Name` varchar(255) NOT NULL DEFAULT '',
  `ContactGroupId` int(10) unsigned NOT NULL,
  PRIMARY KEY (`Id`),
  KEY `FK_persons_ContactGroupId` (`ContactGroupId`),
  CONSTRAINT `FK_persons_ContactGroupId` FOREIGN KEY (`ContactGroupId`) REFERENCES `contact_groups` (`Id`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `FK_persons_ContactOwnerId` FOREIGN KEY (`Id`) REFERENCES `contact_owners` (`Id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `regionaldeliverygroups`
--

DROP TABLE IF EXISTS `regionaldeliverygroups`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `regionaldeliverygroups` (
  `ContactGroupId` int(10) unsigned NOT NULL,
  `RegionId` bigint(20) unsigned NOT NULL,
  PRIMARY KEY (`ContactGroupId`,`RegionId`)
) ENGINE=InnoDB DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping events for database 'contacts'
--

--
-- Dumping routines for database 'contacts'
--

--
-- Current Database: `documents`
--

/*!40000 DROP DATABASE IF EXISTS `documents`*/;

CREATE DATABASE /*!32312 IF NOT EXISTS*/ `documents` /*!40100 DEFAULT CHARACTER SET cp1251 */;

USE `documents`;

--
-- Table structure for table `Attachments`
--

DROP TABLE IF EXISTS `Attachments`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `Attachments` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `MailId` int(10) unsigned NOT NULL,
  `FileName` varchar(255) NOT NULL,
  `Extension` varchar(255) NOT NULL,
  `Size` int(10) unsigned NOT NULL,
  PRIMARY KEY (`Id`),
  KEY `FK_Attachments_MailId` (`MailId`),
  CONSTRAINT `FK_Attachments_MailId` FOREIGN KEY (`MailId`) REFERENCES `Mails` (`Id`) ON DELETE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=11 DEFAULT CHARSET=cp1251;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `CertificateFiles`
--

DROP TABLE IF EXISTS `CertificateFiles`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `CertificateFiles` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `OriginFilename` varchar(255) DEFAULT NULL,
  `ExternalFileId` varchar(255) DEFAULT NULL,
  `CertificateSourceId` int(10) unsigned DEFAULT NULL,
  `Extension` varchar(255) NOT NULL,
  PRIMARY KEY (`Id`),
  KEY `FK_CertificateFiles_CertificateSourceId` (`CertificateSourceId`),
  KEY `IDX_CertificateFiles_ExternalFileId` (`ExternalFileId`),
  CONSTRAINT `FK_CertificateFiles_CertificateSourceId` FOREIGN KEY (`CertificateSourceId`) REFERENCES `CertificateSources` (`Id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=375044 DEFAULT CHARSET=cp1251;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER Documents.CertificateFileLogInsert AFTER INSERT ON Documents.CertificateFiles
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.CertificateFileLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 0,
		FileId = NEW.Id,
		OriginFilename = NEW.OriginFilename,
		ExternalFileId = NEW.ExternalFileId,
		CertificateSourceId = NEW.CertificateSourceId,
		Extension = NEW.Extension;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER Documents.CertificateFileLogUpdate AFTER UPDATE ON Documents.CertificateFiles
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.CertificateFileLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 1,
		FileId = OLD.Id,
		OriginFilename = NULLIF(NEW.OriginFilename, OLD.OriginFilename),
		ExternalFileId = NULLIF(NEW.ExternalFileId, OLD.ExternalFileId),
		CertificateSourceId = NULLIF(NEW.CertificateSourceId, OLD.CertificateSourceId),
		Extension = NULLIF(NEW.Extension, OLD.Extension);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER Documents.CertificateFileLogDelete AFTER DELETE ON Documents.CertificateFiles
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.CertificateFileLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 2,
		FileId = OLD.Id,
		OriginFilename = OLD.OriginFilename,
		ExternalFileId = OLD.ExternalFileId,
		CertificateSourceId = OLD.CertificateSourceId,
		Extension = OLD.Extension;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `CertificateSourceCatalogs`
--

DROP TABLE IF EXISTS `CertificateSourceCatalogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `CertificateSourceCatalogs` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `CertificateSourceId` int(10) unsigned NOT NULL,
  `CatalogId` int(10) unsigned DEFAULT NULL,
  `SerialNumber` varchar(50) NOT NULL,
  `SupplierCode` varchar(50) NOT NULL,
  `OriginFilePath` varchar(255) NOT NULL,
  `SupplierProducerCode` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`Id`),
  KEY `IDX_CertificateCatalog` (`SerialNumber`,`SupplierCode`),
  KEY `FK_CertificateSourceCatalogs_CertificateSourceId` (`CertificateSourceId`),
  KEY `FK_CertificateSourceCatalogs_CatalogId` (`CatalogId`),
  CONSTRAINT `FK_CertificateSourceCatalogs_CatalogId` FOREIGN KEY (`CatalogId`) REFERENCES `catalogs`.`catalog` (`Id`),
  CONSTRAINT `FK_CertificateSourceCatalogs_CertificateSourceId` FOREIGN KEY (`CertificateSourceId`) REFERENCES `CertificateSources` (`Id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=14768297 DEFAULT CHARSET=cp1251;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `CertificateSources`
--

DROP TABLE IF EXISTS `CertificateSources`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `CertificateSources` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `FtpSupplierId` int(10) unsigned DEFAULT NULL,
  `SourceClassName` varchar(255) NOT NULL,
  `FtpFileDate` datetime DEFAULT NULL COMMENT 'дата изменения файла, скаченного по ftp',
  `SearchInAssortmentPrice` tinyint(1) NOT NULL DEFAULT '0',
  PRIMARY KEY (`Id`),
  KEY `FK_CertificateSources_FtpSupplierId` (`FtpSupplierId`),
  CONSTRAINT `FK_CertificateSources_FtpSupplierId` FOREIGN KEY (`FtpSupplierId`) REFERENCES `future`.`Suppliers` (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=10 DEFAULT CHARSET=cp1251;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER Documents.CertificateSourceLogInsert AFTER INSERT ON Documents.CertificateSources
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.CertificateSourceLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 0,
		SourceId = NEW.Id,
		FtpSupplierId = NEW.FtpSupplierId,
		SourceClassName = NEW.SourceClassName;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER Documents.CertificateSourceLogUpdate AFTER UPDATE ON Documents.CertificateSources
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.CertificateSourceLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 1,
		SourceId = OLD.Id,
		FtpSupplierId = NULLIF(NEW.FtpSupplierId, OLD.FtpSupplierId),
		SourceClassName = NULLIF(NEW.SourceClassName, OLD.SourceClassName);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER Documents.CertificateSourceLogDelete AFTER DELETE ON Documents.CertificateSources
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.CertificateSourceLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 2,
		SourceId = OLD.Id,
		FtpSupplierId = OLD.FtpSupplierId,
		SourceClassName = OLD.SourceClassName;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `CertificateTasks`
--

DROP TABLE IF EXISTS `CertificateTasks`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `CertificateTasks` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `CertificateSourceId` int(10) unsigned DEFAULT NULL,
  `CatalogId` int(10) unsigned NOT NULL,
  `SerialNumber` varchar(50) NOT NULL,
  `DocumentBodyId` int(10) unsigned NOT NULL,
  PRIMARY KEY (`Id`),
  UNIQUE KEY `IDX_CertificateTask` (`CertificateSourceId`,`CatalogId`,`SerialNumber`),
  KEY `FK_CertificateTasks_CatalogId` (`CatalogId`),
  KEY `FK_CertificateTasks_DocumentBodyId` (`DocumentBodyId`),
  CONSTRAINT `FK_CertificateTasks_CatalogId` FOREIGN KEY (`CatalogId`) REFERENCES `catalogs`.`catalog` (`Id`),
  CONSTRAINT `FK_CertificateTasks_CertificateSourceId` FOREIGN KEY (`CertificateSourceId`) REFERENCES `CertificateSources` (`Id`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `FK_CertificateTasks_DocumentBodyId` FOREIGN KEY (`DocumentBodyId`) REFERENCES `DocumentBodies` (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=797105 DEFAULT CHARSET=cp1251;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER Documents.CertificateTaskLogInsert AFTER INSERT ON Documents.CertificateTasks
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.CertificateTaskLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 0,
		TaskId = NEW.Id,
		CertificateSourceId = NEW.CertificateSourceId,
		CatalogId = NEW.CatalogId,
		SerialNumber = NEW.SerialNumber,
		DocumentBodyId = NEW.DocumentBodyId;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER Documents.CertificateTaskLogUpdate AFTER UPDATE ON Documents.CertificateTasks
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.CertificateTaskLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 1,
		TaskId = OLD.Id,
		CertificateSourceId = NULLIF(NEW.CertificateSourceId, OLD.CertificateSourceId),
		CatalogId = NULLIF(NEW.CatalogId, OLD.CatalogId),
		SerialNumber = NULLIF(NEW.SerialNumber, OLD.SerialNumber),
		DocumentBodyId = NULLIF(NEW.DocumentBodyId, OLD.DocumentBodyId);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER Documents.CertificateTaskLogDelete AFTER DELETE ON Documents.CertificateTasks
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.CertificateTaskLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 2,
		TaskId = OLD.Id,
		CertificateSourceId = OLD.CertificateSourceId,
		CatalogId = OLD.CatalogId,
		SerialNumber = OLD.SerialNumber,
		DocumentBodyId = OLD.DocumentBodyId;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `Certificates`
--

DROP TABLE IF EXISTS `Certificates`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `Certificates` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `CatalogId` int(10) unsigned NOT NULL,
  `SerialNumber` varchar(50) NOT NULL,
  PRIMARY KEY (`Id`),
  UNIQUE KEY `IDX_Certificate` (`CatalogId`,`SerialNumber`),
  CONSTRAINT `FK_Certificates_CatalogId` FOREIGN KEY (`CatalogId`) REFERENCES `catalogs`.`catalog` (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=113430 DEFAULT CHARSET=cp1251;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER Documents.CertificateLogInsert AFTER INSERT ON Documents.Certificates
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.CertificateLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 0,
		CertificateId = NEW.Id,
		CatalogId = NEW.CatalogId,
		SerialNumber = NEW.SerialNumber;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER Documents.CertificateLogUpdate AFTER UPDATE ON Documents.Certificates
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.CertificateLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 1,
		CertificateId = OLD.Id,
		CatalogId = NULLIF(NEW.CatalogId, OLD.CatalogId),
		SerialNumber = NULLIF(NEW.SerialNumber, OLD.SerialNumber);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER Documents.CertificateLogDelete AFTER DELETE ON Documents.Certificates
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.CertificateLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 2,
		CertificateId = OLD.Id,
		CatalogId = OLD.CatalogId,
		SerialNumber = OLD.SerialNumber;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `DocumentBodies`
--

DROP TABLE IF EXISTS `DocumentBodies`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `DocumentBodies` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `DocumentId` int(10) unsigned NOT NULL,
  `Product` varchar(255) DEFAULT NULL,
  `Code` varchar(20) DEFAULT NULL,
  `Certificates` varchar(50) DEFAULT NULL,
  `CertificatesDate` varchar(20) DEFAULT NULL COMMENT 'Дата выдачи сертификата',
  `Period` varchar(20) DEFAULT NULL COMMENT 'Срок годности',
  `Producer` varchar(255) DEFAULT NULL,
  `Country` varchar(150) DEFAULT NULL COMMENT 'Страна',
  `ProducerCost` decimal(12,6) unsigned DEFAULT NULL COMMENT 'Цена производителя без НДС',
  `RegistryCost` decimal(12,6) DEFAULT NULL,
  `SupplierPriceMarkup` decimal(5,3) DEFAULT NULL COMMENT 'Торговая надбавка оптовика',
  `SupplierCostWithoutNDS` decimal(12,6) unsigned DEFAULT NULL COMMENT 'Цена поставщика без НДС',
  `SupplierCost` decimal(12,6) unsigned DEFAULT NULL COMMENT 'Цена поставщика c НДС или цена в отказе',
  `Quantity` int(11) unsigned DEFAULT NULL,
  `VitallyImportant` tinyint(1) unsigned DEFAULT NULL,
  `NDS` int(10) unsigned DEFAULT NULL,
  `SerialNumber` varchar(50) DEFAULT NULL COMMENT 'номер серии',
  `ProductId` int(10) unsigned DEFAULT NULL,
  `ProducerId` int(10) unsigned DEFAULT NULL,
  `Amount` decimal(12,6) unsigned DEFAULT NULL COMMENT 'Сумма с НДС',
  `NdsAmount` decimal(12,6) unsigned DEFAULT NULL COMMENT 'Сумма НДС',
  `Unit` varchar(20) DEFAULT NULL COMMENT 'Единица измерения',
  `ExciseTax` decimal(12,6) DEFAULT NULL COMMENT 'В том числе акциз',
  `BillOfEntryNumber` varchar(30) DEFAULT NULL COMMENT '№ Таможенной декларации',
  `EAN13` varchar(13) DEFAULT NULL COMMENT 'Код EAN-13',
  `CodeOKDP` varchar(20) DEFAULT NULL COMMENT 'код ОКДП',
  `CertificateId` int(10) unsigned DEFAULT NULL,
  `CertificateFilename` varchar(255) DEFAULT NULL COMMENT 'имя файла образа сертификата',
  `ProtocolFilemame` varchar(255) DEFAULT NULL COMMENT 'имя файла образа протокола',
  `PassportFilename` varchar(255) DEFAULT NULL COMMENT 'имя файла образа паспорта',
  PRIMARY KEY (`Id`),
  KEY `FK_DocumentBodies_DocumentId` (`DocumentId`),
  KEY `IDX_DocumentBodies_ProducerId` (`ProducerId`),
  KEY `FK_DocumentBodies_CertificateId` (`CertificateId`),
  KEY `IDX_DocumentBodies_SerialNumber` (`SerialNumber`),
  KEY `FK_DocumentBodies_ProductId` (`ProductId`),
  CONSTRAINT `FK_DocumentBodies_CertificateId` FOREIGN KEY (`CertificateId`) REFERENCES `Certificates` (`Id`),
  CONSTRAINT `FK_DocumentBodies_DocumentId` FOREIGN KEY (`DocumentId`) REFERENCES `documentheaders` (`Id`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `FK_DocumentBodies_ProducerId` FOREIGN KEY (`ProducerId`) REFERENCES `catalogs`.`producers` (`Id`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `FK_DocumentBodies_ProductId` FOREIGN KEY (`ProductId`) REFERENCES `catalogs`.`Products` (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=45082236 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `FileCertificates`
--

DROP TABLE IF EXISTS `FileCertificates`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `FileCertificates` (
  `CertificateId` int(10) unsigned NOT NULL,
  `CertificateFileId` int(10) unsigned NOT NULL,
  KEY `FK_FileCertificates_CertificateId` (`CertificateId`),
  KEY `FK_FileCertificates_CertificateFileId` (`CertificateFileId`),
  CONSTRAINT `FK_FileCertificates_CertificateFileId` FOREIGN KEY (`CertificateFileId`) REFERENCES `CertificateFiles` (`Id`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `FK_FileCertificates_CertificateId` FOREIGN KEY (`CertificateId`) REFERENCES `Certificates` (`Id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=cp1251;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER Documents.FileCertificateLogInsert AFTER INSERT ON Documents.FileCertificates
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.FileCertificateLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 0,
		CertificateId = NEW.CertificateId,
		CertificateFileId = NEW.CertificateFileId;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER Documents.FileCertificateLogUpdate AFTER UPDATE ON Documents.FileCertificates
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.FileCertificateLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 1,
		CertificateId = NULLIF(NEW.CertificateId, OLD.CertificateId),
		CertificateFileId = NULLIF(NEW.CertificateFileId, OLD.CertificateFileId);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER Documents.FileCertificateLogDelete AFTER DELETE ON Documents.FileCertificates
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.FileCertificateLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 2,
		CertificateId = OLD.CertificateId,
		CertificateFileId = OLD.CertificateFileId;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `InvoiceHeaders`
--

DROP TABLE IF EXISTS `InvoiceHeaders`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `InvoiceHeaders` (
  `Id` int(10) unsigned NOT NULL DEFAULT '0',
  `InvoiceNumber` varchar(20) DEFAULT NULL COMMENT 'Номер счет-фактуры',
  `InvoiceDate` datetime DEFAULT NULL COMMENT 'Дата счет-фактуры',
  `SellerName` varchar(255) DEFAULT NULL COMMENT 'Наименование продавца',
  `SellerAddress` varchar(255) DEFAULT NULL COMMENT 'Адрес продавца',
  `SellerINN` varchar(20) DEFAULT NULL COMMENT 'ИНН продавца',
  `SellerKPP` varchar(20) DEFAULT NULL COMMENT 'КПП продавца',
  `ShipperInfo` varchar(255) DEFAULT NULL COMMENT 'Грузоотправитель и его адрес',
  `ConsigneeInfo` varchar(255) DEFAULT NULL COMMENT 'Грузополучатель и его адрес',
  `PaymentDocumentInfo` varchar(255) DEFAULT NULL COMMENT 'Поле К платежно-расчетному документу N',
  `BuyerName` varchar(255) DEFAULT NULL COMMENT 'Наименование покупателя',
  `BuyerAddress` varchar(255) DEFAULT NULL COMMENT 'Адрес покупателя',
  `BuyerINN` varchar(20) DEFAULT NULL COMMENT 'ИНН покупателя',
  `BuyerKPP` varchar(20) DEFAULT NULL COMMENT 'КПП покупателя',
  `AmountWithoutNDS0` decimal(12,6) DEFAULT NULL COMMENT 'Стоимость товаров без налога для группы товаров, облагаемых ставкой 0% НДС',
  `AmountWithoutNDS10` decimal(12,6) DEFAULT NULL COMMENT 'Стоимость товаров без налога для группы товаров, облагаемых ставкой 10% НДС',
  `NDSAmount10` decimal(12,6) DEFAULT NULL COMMENT 'Сумма налога для группы товаров , облагаемых ставкой 10% НДС',
  `Amount10` decimal(12,6) DEFAULT NULL COMMENT 'Стоимость товаров для группы товаров , облагаемых ставкой 10% НДС всего с учётом налога',
  `AmountWithoutNDS18` decimal(12,6) DEFAULT NULL COMMENT 'Стоимость товаров без налога для группы товаров, облагаемых ставкой 18% НДС',
  `NDSAmount18` decimal(12,6) DEFAULT NULL COMMENT 'Сумма налога для группы товаров , облагаемых ставкой 18% НДС',
  `Amount18` decimal(12,6) DEFAULT NULL COMMENT 'Стоимость товаров для группы товаров , облагаемых ставкой 18% НДС всего с учётом налога',
  `AmountWithoutNDS` decimal(12,6) DEFAULT NULL COMMENT 'Общая стоимость товаров без налога (указывается в конце таблицы счёт-фактуры по строке «ИТОГО»)',
  `NDSAmount` decimal(12,6) DEFAULT NULL COMMENT 'Общая сумма налога (указывается в конце таблицы счёт-фактуры по строке «ИТОГО»)',
  `Amount` decimal(12,6) DEFAULT NULL COMMENT 'Общая стоимость товаров с налогом (указывается в конце таблицы счёт-фактуры по строке «ИТОГО»)',
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB DEFAULT CHARSET=cp1251;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `MailRecipients`
--

DROP TABLE IF EXISTS `MailRecipients`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `MailRecipients` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `MailId` int(10) unsigned NOT NULL,
  `Type` int(11) NOT NULL DEFAULT '0',
  `RegionId` bigint(20) unsigned DEFAULT NULL,
  `ClientId` int(10) unsigned DEFAULT NULL,
  `AddressId` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`Id`),
  KEY `FK_MailRecipients_MailId` (`MailId`),
  KEY `FK_MailRecipients_RegionId` (`RegionId`),
  KEY `FK_MailRecipients_ClientId` (`ClientId`),
  KEY `FK_MailRecipients_AddressId` (`AddressId`),
  CONSTRAINT `FK_MailRecipients_AddressId` FOREIGN KEY (`AddressId`) REFERENCES `future`.`Addresses` (`Id`) ON DELETE CASCADE,
  CONSTRAINT `FK_MailRecipients_ClientId` FOREIGN KEY (`ClientId`) REFERENCES `future`.`clients` (`Id`) ON DELETE CASCADE,
  CONSTRAINT `FK_MailRecipients_MailId` FOREIGN KEY (`MailId`) REFERENCES `Mails` (`Id`) ON DELETE CASCADE,
  CONSTRAINT `FK_MailRecipients_RegionId` FOREIGN KEY (`RegionId`) REFERENCES `farm`.`Regions` (`RegionCode`) ON DELETE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=20 DEFAULT CHARSET=cp1251;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `Mails`
--

DROP TABLE IF EXISTS `Mails`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `Mails` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `LogTime` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `SupplierId` int(10) unsigned NOT NULL,
  `SupplierEmail` varchar(255) NOT NULL,
  `IsVIPMail` tinyint(1) unsigned NOT NULL DEFAULT '0',
  `Subject` varchar(255) DEFAULT NULL,
  `Body` mediumtext,
  `Size` int(10) unsigned NOT NULL,
  PRIMARY KEY (`Id`),
  KEY `IDX_Mails_LogTime` (`LogTime`),
  KEY `IDX_Mails_Subject` (`Subject`),
  KEY `FK_Mails_SupplierId` (`SupplierId`),
  KEY `IDX_Mails_SupplierEmail` (`SupplierEmail`),
  CONSTRAINT `FK_Mails_SupplierId` FOREIGN KEY (`SupplierId`) REFERENCES `future`.`Suppliers` (`Id`) ON DELETE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=23 DEFAULT CHARSET=cp1251;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `ProtekDocs`
--

DROP TABLE IF EXISTS `ProtekDocs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `ProtekDocs` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `DocId` int(11) NOT NULL,
  `Line` int(10) unsigned NOT NULL,
  PRIMARY KEY (`Id`),
  KEY `FK_ProtekDocs_DocId` (`Line`),
  CONSTRAINT `FK_ProtekDocs_DocId` FOREIGN KEY (`Line`) REFERENCES `DocumentBodies` (`Id`) ON DELETE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=11487861 DEFAULT CHARSET=cp1251;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `SourceSuppliers`
--

DROP TABLE IF EXISTS `SourceSuppliers`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `SourceSuppliers` (
  `CertificateSourceId` int(10) unsigned NOT NULL,
  `SupplierId` int(10) unsigned NOT NULL,
  KEY `FK_SourceSuppliers_CertificateSourceId` (`CertificateSourceId`),
  KEY `FK_SourceSuppliers_SourceSupplierId` (`SupplierId`),
  CONSTRAINT `FK_SourceSuppliers_CertificateSourceId` FOREIGN KEY (`CertificateSourceId`) REFERENCES `CertificateSources` (`Id`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `FK_SourceSuppliers_SourceSupplierId` FOREIGN KEY (`SupplierId`) REFERENCES `future`.`Suppliers` (`Id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=cp1251;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER Documents.SourceSupplierLogInsert AFTER INSERT ON Documents.SourceSuppliers
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.SourceSupplierLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 0,
		CertificateSourceId = NEW.CertificateSourceId,
		SupplierId = NEW.SupplierId;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER Documents.SourceSupplierLogUpdate AFTER UPDATE ON Documents.SourceSuppliers
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.SourceSupplierLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 1,
		CertificateSourceId = NULLIF(NEW.CertificateSourceId, OLD.CertificateSourceId),
		SupplierId = NULLIF(NEW.SupplierId, OLD.SupplierId);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER Documents.SourceSupplierLogDelete AFTER DELETE ON Documents.SourceSuppliers
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.SourceSupplierLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 2,
		CertificateSourceId = OLD.CertificateSourceId,
		SupplierId = OLD.SupplierId;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `documentheaders`
--

DROP TABLE IF EXISTS `documentheaders`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `documentheaders` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `DownloadId` int(10) unsigned DEFAULT NULL,
  `WriteTime` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `DocumentDate` datetime DEFAULT NULL COMMENT 'Дата документа',
  `FirmCode` int(10) unsigned DEFAULT NULL,
  `ClientCode` int(10) unsigned DEFAULT NULL,
  `AddressId` int(10) unsigned DEFAULT NULL,
  `DocumentType` tinyint(3) unsigned DEFAULT NULL,
  `ProviderDocumentId` varchar(20) DEFAULT NULL,
  `OrderId` int(10) unsigned DEFAULT NULL,
  `Parser` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`Id`),
  KEY `FK_DocumentHeaders_AddressId` (`AddressId`),
  KEY `FK_DocumentHeaders_ClientCode` (`ClientCode`),
  KEY `FK_DocumentHeaders_OrderId` (`OrderId`),
  KEY `FK_DocumentHeaders_DownloadId` (`DownloadId`),
  KEY `WriteTime` (`WriteTime`),
  CONSTRAINT `FK_DocumentHeaders_AddressId` FOREIGN KEY (`AddressId`) REFERENCES `future`.`addresses` (`Id`) ON DELETE SET NULL,
  CONSTRAINT `FK_DocumentHeaders_ClientCode` FOREIGN KEY (`ClientCode`) REFERENCES `usersettings`.`retclientsset` (`ClientCode`) ON DELETE SET NULL ON UPDATE CASCADE,
  CONSTRAINT `FK_DocumentHeaders_DownloadId` FOREIGN KEY (`DownloadId`) REFERENCES `logs`.`document_logs` (`RowId`) ON DELETE SET NULL,
  CONSTRAINT `FK_DocumentHeaders_OrderId` FOREIGN KEY (`OrderId`) REFERENCES `orders`.`ordershead` (`RowID`) ON DELETE SET NULL
) ENGINE=InnoDB AUTO_INCREMENT=3852208 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `rejects`
--

DROP TABLE IF EXISTS `rejects`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `rejects` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `OrderLineId` int(10) unsigned NOT NULL,
  `OrderedQuantity` int(10) unsigned NOT NULL,
  `OrderedCost` decimal(9,2) unsigned NOT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=891203 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `waybill_source_types`
--

DROP TABLE IF EXISTS `waybill_source_types`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `waybill_source_types` (
  `ID` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `Type` varchar(5) DEFAULT NULL,
  `Comment` varchar(20) DEFAULT NULL,
  PRIMARY KEY (`ID`)
) ENGINE=InnoDB AUTO_INCREMENT=5 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `waybill_sources`
--

DROP TABLE IF EXISTS `waybill_sources`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `waybill_sources` (
  `FirmCode` int(10) unsigned NOT NULL DEFAULT '0',
  `EMailFrom` varchar(255) DEFAULT NULL,
  `SourceID` int(10) unsigned DEFAULT NULL COMMENT 'тип источника\r\n1 - по email\r\n4 - наш фтп\r\n5 - фтп поставщика',
  `ReaderClassName` varchar(255) DEFAULT NULL,
  `WaybillUrl` varchar(255) DEFAULT NULL COMMENT 'URL по которому нужно забирать накладные (пока используется только фтп)',
  `RejectUrl` varchar(255) DEFAULT NULL COMMENT 'URL по которому нужно забирать отказы (пока используется только фтп)',
  `UserName` varchar(255) DEFAULT NULL COMMENT 'Имя пользователя',
  `Password` varchar(255) DEFAULT NULL COMMENT 'Пароль',
  `DownloadInterval` int(10) unsigned DEFAULT NULL COMMENT 'Интервал в секундах, через который производится обращение к источнику (только для фтп)',
  PRIMARY KEY (`FirmCode`),
  KEY `FK_waybill_sources_SourceID` (`SourceID`)
) ENGINE=InnoDB DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER waybillSourcesLogInsert AFTER Insert ON documents.waybill_sources FOR EACH ROW
BEGIN
INSERT INTO `logs`.documentsourceslogs
SET LogTime = now() ,
OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)) ,
OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)) ,
Operation = 0,
FirmCode = NEW.FirmCode
,EMailFrom = NEW.EMailFrom
,SourceID = NEW.SourceID
,ReaderClassName = NEW.ReaderClassName
;END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER waybillSourcesLogUpdate AFTER Update ON documents.waybill_sources FOR EACH ROW
BEGIN
INSERT INTO `logs`.documentsourceslogs
SET LogTime = now() ,
OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)) ,
OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)) ,
Operation = 1,
FirmCode = OLD.FirmCode
,EMailFrom = NULLIF(NEW.EMailFrom, OLD.EMailFrom)
,SourceID = NULLIF(NEW.SourceID, OLD.SourceID)
,ReaderClassName = NULLIF(NEW.ReaderClassName, OLD.ReaderClassName)
;END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER waybillSourcesLogDelete AFTER Delete ON documents.waybill_sources FOR EACH ROW
BEGIN
INSERT INTO `logs`.documentsourceslogs
SET LogTime = now() ,
OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)) ,
OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)) ,
Operation = 2,
FirmCode = OLD.FirmCode
,EMailFrom = OLD.EMailFrom
,SourceID = OLD.SourceID
,ReaderClassName = OLD.ReaderClassName
;END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `waybillorders`
--

DROP TABLE IF EXISTS `waybillorders`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `waybillorders` (
  `DocumentLineId` int(10) unsigned NOT NULL COMMENT 'id позиции в DocumentBodies',
  `OrderLineId` int(10) unsigned NOT NULL COMMENT 'id позиции в OrdersList'
) ENGINE=InnoDB DEFAULT CHARSET=cp1251;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping events for database 'documents'
--

--
-- Dumping routines for database 'documents'
--

--
-- Current Database: `farm`
--

/*!40000 DROP DATABASE IF EXISTS `farm`*/;

CREATE DATABASE /*!32312 IF NOT EXISTS*/ `farm` /*!40100 DEFAULT CHARACTER SET cp1251 */;

USE `farm`;

--
-- Table structure for table `Regions`
--

DROP TABLE IF EXISTS `Regions`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `Regions` (
  `RegionCode` bigint(20) unsigned NOT NULL DEFAULT '0',
  `Region` varchar(30) DEFAULT NULL,
  `LongAliase` varchar(10) DEFAULT NULL,
  `ShortAliase` varchar(5) DEFAULT NULL,
  `DefaultRegionMask` bigint(20) unsigned DEFAULT NULL,
  `DefaultShowRegionMask` bigint(20) unsigned DEFAULT NULL,
  `Comment` varchar(255) DEFAULT NULL,
  `AccessTime` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `MoscowBias` int(11) NOT NULL DEFAULT '0' COMMENT 'Р РЋР СР ВµРЎвЂ°Р ВµР Р…Р С‘Р Вµ Р Р† РЎвЂЎР В°РЎРѓР В°РЎвЂ¦ Р С•РЎвЂљР Р…Р С•РЎРѓР С‘РЎвЂљР ВµР В»РЎРЉР Р…Р С• Р СљР С•РЎРѓР С”Р Р†РЎвЂ№',
  `CalculateOnProducerCost` tinyint(1) unsigned NOT NULL DEFAULT '0',
  `DrugsSearchRegion` tinyint(1) NOT NULL DEFAULT '0',
  `AddressPayment` decimal(19,5) NOT NULL DEFAULT '0.00000',
  `UserPayment` decimal(19,5) NOT NULL DEFAULT '0.00000',
  `SupplierUserPayment` decimal(19,5) NOT NULL DEFAULT '0.00000',
  PRIMARY KEY (`RegionCode`),
  KEY `Region_IDX` (`Region`)
) ENGINE=InnoDB DEFAULT CHARSET=cp1251 MIN_ROWS=10 MAX_ROWS=200 PACK_KEYS=1 CHECKSUM=1 DELAY_KEY_WRITE=1 ROW_FORMAT=COMPACT COMMENT='InnoDB free: 5991424 kB; InnoDB free: 5454848 kB';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `Synonym`
--

DROP TABLE IF EXISTS `Synonym`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `Synonym` (
  `SynonymCode` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `PriceCode` int(10) unsigned DEFAULT NULL,
  `Synonym` varchar(255) DEFAULT NULL,
  `ProductId` int(10) unsigned DEFAULT NULL,
  `Junk` tinyint(1) NOT NULL DEFAULT '0',
  `SupplierCode` varchar(20) DEFAULT NULL,
  PRIMARY KEY (`SynonymCode`) USING BTREE,
  UNIQUE KEY `Synonym_Price_Uniq` (`PriceCode`,`Synonym`),
  KEY `Synonym` (`Synonym`) USING BTREE,
  KEY `Product_Price_IDX` (`ProductId`,`PriceCode`) USING BTREE,
  KEY `SupplierCode` (`SupplierCode`),
  CONSTRAINT `FK_Synonym_1` FOREIGN KEY (`PriceCode`) REFERENCES `usersettings`.`pricesdata` (`PriceCode`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `FK_Synonym_2` FOREIGN KEY (`ProductId`) REFERENCES `catalogs`.`products` (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=11219691 DEFAULT CHARSET=cp1251 PACK_KEYS=0 ROW_FORMAT=COMPACT COMMENT='InnoDB free: 14124032 kB; (`FirmCode`) REFER `usersettings/p';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER farm.SynonymAfterInsert
	AFTER INSERT
	ON farm.Synonym
	FOR EACH ROW
BEGIN
  insert into farm.SynonymArchive(SynonymCode, PriceCode, Synonym, ProductId, Junk)
  values(NEW.SynonymCode, NEW.PriceCode, NEW.Synonym, NEW.ProductId, NEW.Junk);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `SynonymFirmCr`
--

DROP TABLE IF EXISTS `SynonymFirmCr`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `SynonymFirmCr` (
  `SynonymFirmCrCode` int(11) unsigned NOT NULL AUTO_INCREMENT,
  `PriceCode` int(10) unsigned DEFAULT NULL,
  `CodeFirmCr` int(11) unsigned DEFAULT NULL,
  `Synonym` varchar(255) DEFAULT NULL,
  `SupplierCode` varchar(20) DEFAULT NULL,
  PRIMARY KEY (`SynonymFirmCrCode`) USING BTREE,
  UNIQUE KEY `Producer_Synonym_Price` (`Synonym`,`CodeFirmCr`,`PriceCode`),
  KEY `PriceCode_Idx` (`PriceCode`) USING BTREE,
  KEY `CodeFirmCr_PriceCode_IDX` (`CodeFirmCr`,`PriceCode`) USING BTREE,
  KEY `SupplierCode` (`SupplierCode`),
  CONSTRAINT `FK_SynonymFirmCr_ProducerId` FOREIGN KEY (`CodeFirmCr`) REFERENCES `catalogs`.`producers` (`Id`) ON DELETE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=1320407 DEFAULT CHARSET=cp1251 MIN_ROWS=80000 MAX_ROWS=300000 PACK_KEYS=0 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER farm.SynonymfirmcrInsert
	AFTER INSERT
	ON farm.SynonymFirmCr
	FOR EACH ROW
BEGIN
  INSERT
  INTO `logs`.SynonymFirmCrLogs
  SET
    LogTime = NOW(), OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(), '@', 1)), OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(), '@', -1)), Operation = 0, SynonymFirmCrCode = NEW.SynonymFirmCrCode, PriceCode = NEW.PriceCode, CodeFirmCr = NEW.CodeFirmCr, Synonym = NEW.Synonym;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER farm.SynonymfirmcrUpdate
	AFTER UPDATE
	ON farm.SynonymFirmCr
	FOR EACH ROW
BEGIN
	INSERT
  INTO `logs`.SynonymFirmCrLogs
  SET
    LogTime = NOW(), OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(), '@', 1)), OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(), '@', -1)), Operation = 1, SynonymFirmCrCode = OLD.SynonymFirmCrCode, PriceCode = NULLIF(NEW.PriceCode, OLD.PriceCode), CodeFirmCr = NULLIF(NEW.CodeFirmCr, OLD.CodeFirmCr), Synonym = NULLIF(NEW.Synonym, OLD.Synonym);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER farm.SynonymfirmcrDelete
	AFTER DELETE
	ON farm.SynonymFirmCr
	FOR EACH ROW
BEGIN
	INSERT
  INTO `logs`.SynonymFirmCrLogs
  SET
    LogTime = NOW(), OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(), '@', 1)), OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(), '@', -1)), Operation = 2, SynonymFirmCrCode = OLD.SynonymFirmCrCode, PriceCode = OLD.PriceCode, CodeFirmCr = OLD.CodeFirmCr, Synonym = OLD.Synonym;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `automaticproducersynonyms`
--

DROP TABLE IF EXISTS `automaticproducersynonyms`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `automaticproducersynonyms` (
  `ProducerSynonymId` int(10) unsigned NOT NULL,
  PRIMARY KEY (`ProducerSynonymId`),
  CONSTRAINT `FK_ProducerSynonymId` FOREIGN KEY (`ProducerSynonymId`) REFERENCES `synonymfirmcr` (`SynonymFirmCrCode`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `blockedprice`
--

DROP TABLE IF EXISTS `blockedprice`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `blockedprice` (
  `PriceItemId` int(11) unsigned NOT NULL DEFAULT '0',
  `BlockBy` varchar(40) DEFAULT NULL,
  PRIMARY KEY (`PriceItemId`),
  KEY `BlockBy_IDX` (`BlockBy`),
  CONSTRAINT `FK_BlockedPrice_PriceItemId` FOREIGN KEY (`PriceItemId`) REFERENCES `usersettings`.`priceitems` (`Id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=cp1251 MAX_ROWS=100 PACK_KEYS=0 DELAY_KEY_WRITE=1 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `blockedproducersynonyms`
--

DROP TABLE IF EXISTS `blockedproducersynonyms`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `blockedproducersynonyms` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `ProducerId` int(10) unsigned NOT NULL,
  `PriceCode` int(10) unsigned NOT NULL,
  `Synonym` varchar(255) NOT NULL,
  `BlockedOn` datetime NOT NULL,
  PRIMARY KEY (`Id`),
  KEY `FK_ProducerId` (`ProducerId`),
  KEY `FK_PriceCode` (`PriceCode`),
  CONSTRAINT `FK_PriceCode` FOREIGN KEY (`PriceCode`) REFERENCES `usersettings`.`pricesdata` (`PriceCode`) ON DELETE CASCADE,
  CONSTRAINT `FK_ProducerId` FOREIGN KEY (`ProducerId`) REFERENCES `catalogs`.`producers` (`Id`) ON DELETE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=5886 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `buyingmatrix`
--

DROP TABLE IF EXISTS `buyingmatrix`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `buyingmatrix` (
  `Id` int(11) NOT NULL AUTO_INCREMENT,
  `PriceId` int(10) unsigned NOT NULL,
  `ProductId` int(10) unsigned NOT NULL,
  `ProducerId` int(10) unsigned DEFAULT NULL,
  `Code` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`Id`),
  UNIQUE KEY `FK_BuyingMatrix_Comb` (`PriceId`,`ProductId`,`ProducerId`) USING BTREE,
  KEY `FK_BuyingMatrix_ProductId` (`ProductId`),
  KEY `FK_BuyingMatrix_ProducerId` (`ProducerId`),
  CONSTRAINT `FK_BuyingMatrix_PriceId` FOREIGN KEY (`PriceId`) REFERENCES `usersettings`.`pricesdata` (`PriceCode`) ON DELETE CASCADE,
  CONSTRAINT `FK_BuyingMatrix_ProducerId` FOREIGN KEY (`ProducerId`) REFERENCES `catalogs`.`producers` (`Id`) ON DELETE SET NULL,
  CONSTRAINT `FK_BuyingMatrix_ProductId` FOREIGN KEY (`ProductId`) REFERENCES `catalogs`.`products` (`Id`) ON DELETE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=44505197 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `catalogcurrency`
--

DROP TABLE IF EXISTS `catalogcurrency`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `catalogcurrency` (
  `Currency` varchar(6) DEFAULT NULL,
  `Exchange` decimal(6,2) DEFAULT NULL,
  `RowID` int(10) unsigned NOT NULL AUTO_INCREMENT,
  PRIMARY KEY (`RowID`),
  KEY `Index_2` (`Currency`),
  KEY `Index_3` (`Exchange`)
) ENGINE=InnoDB AUTO_INCREMENT=5 DEFAULT CHARSET=cp1251 MIN_ROWS=2 MAX_ROWS=50 PACK_KEYS=0 DELAY_KEY_WRITE=1 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `catalogfirmcr`
--

DROP TABLE IF EXISTS `catalogfirmcr`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `catalogfirmcr` (
  `CodeFirmCr` int(11) unsigned NOT NULL AUTO_INCREMENT,
  `FirmCr` varchar(255) DEFAULT NULL,
  `Hidden` tinyint(1) unsigned NOT NULL DEFAULT '0',
  PRIMARY KEY (`CodeFirmCr`),
  UNIQUE KEY `FirmCr_Uniq` (`FirmCr`),
  KEY `FirmCr_IDX` (`FirmCr`,`CodeFirmCr`) USING BTREE
) ENGINE=InnoDB AUTO_INCREMENT=6901 DEFAULT CHARSET=cp1251 MIN_ROWS=5000 MAX_ROWS=20000 PACK_KEYS=0 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER farm.CatalogFirmCrInsert
	AFTER INSERT
	ON farm.catalogfirmcr
	FOR EACH ROW
BEGIN

    INSERT
    INTO `logs`.Catalogfirmcr
    SET LogTime = now(),
                OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
                OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),

                Operation = 0,
                CodeFirmCr = NEW.CodeFirmCr,
                FirmCr = NEW.FirmCr,
                Hidden = NEW.Hidden;

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER CatalogfirmcrUpdate AFTER UPDATE ON `catalogfirmcr` FOR EACH ROW BEGIN
	INSERT 
    INTO `logs`.Catalogfirmcr
    SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)), 
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)), 
		Operation = 1, 
		CodeFirmCr = NULLIF(NEW.CodeFirmCr, OLD.CodeFirmCr),
		FirmCr = NULLIF(NEW.FirmCr, OLD.FirmCr),
		Hidden = NULLIF(NEW.Hidden, OLD.Hidden);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER CatalogfirmcrDelete AFTER DELETE ON `catalogfirmcr` FOR EACH ROW BEGIN
	INSERT 
    INTO `logs`.Catalogfirmcr
    SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)), 
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)), 
		Operation = 2, 
		CodeFirmCr = OLD.CodeFirmCr,
		FirmCr = OLD.FirmCr,
		Hidden = OLD.Hidden;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `core0`
--

DROP TABLE IF EXISTS `core0`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `core0` (
  `Id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `PriceCode` int(10) unsigned DEFAULT NULL,
  `ProductId` int(10) unsigned DEFAULT NULL,
  `CodeFirmCr` int(10) unsigned DEFAULT NULL,
  `SynonymCode` int(10) unsigned DEFAULT NULL,
  `SynonymFirmCrCode` int(10) unsigned DEFAULT NULL,
  `Code` varchar(20) NOT NULL,
  `CodeCr` varchar(20) NOT NULL,
  `Unit` varchar(15) NOT NULL,
  `Volume` varchar(15) NOT NULL,
  `Quantity` varchar(15) NOT NULL,
  `Note` varchar(50) NOT NULL,
  `Period` varchar(20) NOT NULL,
  `Doc` varchar(20) NOT NULL,
  `Junk` tinyint(1) unsigned NOT NULL DEFAULT '0',
  `Await` tinyint(1) unsigned NOT NULL DEFAULT '0',
  `MinBoundCost` decimal(8,2) unsigned DEFAULT NULL,
  `VitallyImportant` tinyint(1) unsigned NOT NULL DEFAULT '0',
  `RequestRatio` smallint(5) unsigned DEFAULT NULL,
  `RegistryCost` decimal(8,2) unsigned DEFAULT NULL,
  `MaxBoundCost` decimal(8,2) unsigned DEFAULT NULL,
  `OrderCost` decimal(8,2) unsigned DEFAULT NULL,
  `MinOrderCount` int(10) unsigned DEFAULT NULL,
  `UpdateTime` timestamp NOT NULL DEFAULT '0000-00-00 00:00:00',
  `QuantityUpdate` timestamp NOT NULL DEFAULT '0000-00-00 00:00:00',
  `ProducerCost` decimal(12,6) unsigned DEFAULT NULL,
  `NDS` smallint(5) unsigned DEFAULT NULL,
  PRIMARY KEY (`Id`),
  KEY `SynonymCode` (`SynonymCode`),
  KEY `SynonymFirmCrCode` (`SynonymFirmCrCode`),
  KEY `PriceCode` (`PriceCode`),
  KEY `ProductId_PriceCode` (`ProductId`,`PriceCode`) USING BTREE,
  KEY `CodeFirmCr` (`CodeFirmCr`),
  KEY `Code` (`Code`),
  KEY `CodeCr` (`CodeCr`),
  CONSTRAINT `core0_ibfk_1` FOREIGN KEY (`SynonymCode`) REFERENCES `synonym` (`SynonymCode`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `core0_ibfk_2` FOREIGN KEY (`PriceCode`) REFERENCES `usersettings`.`pricesdata` (`PriceCode`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `core0_ibfk_3` FOREIGN KEY (`ProductId`) REFERENCES `catalogs`.`products` (`Id`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `core0_ibfk_4` FOREIGN KEY (`SynonymFirmCrCode`) REFERENCES `synonymfirmcr` (`SynonymFirmCrCode`) ON DELETE SET NULL ON UPDATE CASCADE,
  CONSTRAINT `FK_Core_ProducerId` FOREIGN KEY (`CodeFirmCr`) REFERENCES `catalogs`.`producers` (`Id`) ON DELETE SET NULL
) ENGINE=InnoDB AUTO_INCREMENT=6605781588 DEFAULT CHARSET=cp1251 PACK_KEYS=0 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `corecosts`
--

DROP TABLE IF EXISTS `corecosts`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `corecosts` (
  `Core_Id` bigint(11) unsigned NOT NULL DEFAULT '0',
  `PC_CostCode` int(10) unsigned NOT NULL DEFAULT '0',
  `Cost` decimal(12,6) unsigned DEFAULT NULL,
  PRIMARY KEY (`PC_CostCode`,`Core_Id`) USING BTREE,
  KEY `FK_CoreCosts_CoreId` (`Core_Id`),
  CONSTRAINT `FK_CoreCosts_CoreId` FOREIGN KEY (`Core_Id`) REFERENCES `core0` (`Id`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `FK_CoreCosts_CostCode` FOREIGN KEY (`PC_CostCode`) REFERENCES `usersettings`.`pricescosts` (`CostCode`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=cp1251 MIN_ROWS=2000000 MAX_ROWS=90000000 PACK_KEYS=0 ROW_FORMAT=COMPACT COMMENT='InnoDB free: 7168 kB; (`PC_CostCode`) REFER `usersettings/pr';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `costformrules`
--

DROP TABLE IF EXISTS `costformrules`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `costformrules` (
  `CostCode` int(11) unsigned NOT NULL,
  `FieldName` varchar(50) NOT NULL DEFAULT '',
  `TxtBegin` int(11) unsigned DEFAULT NULL,
  `TxtEnd` int(11) unsigned DEFAULT NULL,
  PRIMARY KEY (`CostCode`),
  CONSTRAINT `CostCode_FK` FOREIGN KEY (`CostCode`) REFERENCES `usersettings`.`pricescosts` (`CostCode`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=cp1251 MIN_ROWS=500 MAX_ROWS=10000 PACK_KEYS=1 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER farm.CostFormRulesLogInsert AFTER INSERT
ON farm.costformrules FOR EACH ROW BEGIN
INSERT INTO `logs`.cost_form_rules_logs
SET LogTime = now() ,
OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)) ,
OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)) ,
Operation = 0,
CostCode = NEW.CostCode
,FieldName = NEW.FieldName
,TxtBegin = NEW.TxtBegin
,TxtEnd = NEW.TxtEnd
;END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER farm.CostFormRulesLogUpdate AFTER UPDATE
ON farm.costformrules FOR EACH ROW BEGIN
INSERT INTO `logs`.cost_form_rules_logs
SET LogTime = now() ,
OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)) ,
OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)) ,
Operation = 1,
CostCode = IFNULL(NEW.CostCode, OLD.CostCode)
,FieldName = NULLIF(NEW.FieldName, OLD.FieldName)
,TxtBegin = NULLIF(NEW.TxtBegin, OLD.TxtBegin)
,TxtEnd = NULLIF(NEW.TxtEnd, OLD.TxtEnd)
;END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER farm.CostFormRulesLogDelete AFTER DELETE
ON farm.costformrules FOR EACH ROW BEGIN
INSERT INTO `logs`.cost_form_rules_logs
SET LogTime = now() ,
OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)) ,
OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)) ,
Operation = 2,
CostCode = OLD.CostCode
,FieldName = OLD.FieldName
,TxtBegin = OLD.TxtBegin
,TxtEnd = OLD.TxtEnd
;END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `excludes`
--

DROP TABLE IF EXISTS `excludes`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `excludes` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `OriginalSynonymId` int(10) unsigned DEFAULT NULL COMMENT '????????????? ???????? ?? ??????? Farm.Synonym, ??? ???????? ???? ??????? ?????? ??????????',
  `CatalogId` int(10) unsigned NOT NULL,
  `PriceCode` int(10) unsigned NOT NULL,
  `ProducerSynonym` varchar(255) NOT NULL,
  `DoNotShow` tinyint(1) NOT NULL DEFAULT '0',
  `CreatedOn` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `LastUsedOn` datetime NOT NULL,
  `Operator` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`Id`),
  KEY `FK_Excludes_PriceCode` (`PriceCode`),
  KEY `Index_4` (`CatalogId`),
  CONSTRAINT `FK_Excludes_PriceCode` FOREIGN KEY (`PriceCode`) REFERENCES `usersettings`.`pricesdata` (`PriceCode`) ON DELETE CASCADE,
  CONSTRAINT `FK_Excludes__CatalogId` FOREIGN KEY (`CatalogId`) REFERENCES `catalogs`.`catalog` (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=611900 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER farm.ExcludeLogInsert
	AFTER INSERT
	ON farm.excludes
	FOR EACH ROW
BEGIN
INSERT 
INTO `logs`.ExcludeLogs
SET LogTime = now(),
OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
Operation = 0,
ExcludeId = NEW.Id,
OriginalSynonymId = NEW.OriginalSynonymId,
CatalogId = NEW.CatalogId,
PriceCode = NEW.PriceCode,
ProducerSynonym = NEW.ProducerSynonym,
DoNotShow = NEW.DoNotShow,
CreatedOn = NEW.CreatedOn,
LastUsedOn = NEW.LastUsedOn;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER farm.ExcludeLogUpdate
	AFTER UPDATE
	ON farm.excludes
	FOR EACH ROW
BEGIN
	INSERT 
	INTO `logs`.ExcludeLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 1,
		ExcludeId = OLD.Id,
		OriginalSynonymId = NULLIF(NEW.OriginalSynonymId, OLD.OriginalSynonymId),
		CatalogId = NULLIF(NEW.CatalogId, OLD.CatalogId),
		PriceCode = NULLIF(NEW.PriceCode, OLD.PriceCode),
		ProducerSynonym = NULLIF(NEW.ProducerSynonym, OLD.ProducerSynonym),
		DoNotShow = NULLIF(NEW.DoNotShow, OLD.DoNotShow),
		CreatedOn = NULLIF(NEW.CreatedOn, OLD.CreatedOn),
		LastUsedOn = NULLIF(NEW.LastUsedOn, OLD.LastUsedOn);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER farm.ExcludeLogDelete
	AFTER DELETE
	ON farm.excludes
	FOR EACH ROW
BEGIN
	INSERT 
	INTO `logs`.ExcludeLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 2,
		ExcludeId = OLD.Id,
		OriginalSynonymId = OLD.OriginalSynonymId,
		CatalogId = OLD.CatalogId,
		PriceCode = OLD.PriceCode,
		ProducerSynonym = OLD.ProducerSynonym,
		DoNotShow = OLD.DoNotShow,
		CreatedOn = OLD.CreatedOn,
		LastUsedOn = OLD.LastUsedOn;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `forb`
--

DROP TABLE IF EXISTS `forb`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `forb` (
  `RowID` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `PriceItemId` int(11) unsigned DEFAULT NULL,
  `Forb` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`RowID`),
  KEY `Forb_IDX` (`Forb`),
  KEY `PriceItemId_IDX` (`PriceItemId`) USING BTREE,
  CONSTRAINT `FK_Forb_PriceItemId` FOREIGN KEY (`PriceItemId`) REFERENCES `usersettings`.`priceitems` (`Id`) ON DELETE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=550032850 DEFAULT CHARSET=cp1251 MIN_ROWS=20000 MAX_ROWS=500000 PACK_KEYS=1 CHECKSUM=1 DELAY_KEY_WRITE=1 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `forbidden`
--

DROP TABLE IF EXISTS `forbidden`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `forbidden` (
  `RowID` int(11) unsigned NOT NULL AUTO_INCREMENT,
  `PriceCode` int(10) unsigned DEFAULT NULL,
  `Forbidden` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`RowID`),
  KEY `Forb_IDX` (`Forbidden`),
  KEY `PriceCode_IDX` (`PriceCode`) USING BTREE,
  CONSTRAINT `FK_Forbidden_PriceCode` FOREIGN KEY (`PriceCode`) REFERENCES `usersettings`.`pricesdata` (`PriceCode`) ON DELETE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=1281568 DEFAULT CHARSET=cp1251 MIN_ROWS=64000 MAX_ROWS=500000 PACK_KEYS=1 CHECKSUM=1 DELAY_KEY_WRITE=1 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `formrules`
--

DROP TABLE IF EXISTS `formrules`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `formrules` (
  `Id` int(11) unsigned NOT NULL AUTO_INCREMENT,
  `PriceFormatId` int(11) unsigned DEFAULT NULL,
  `MaxOld` int(10) unsigned NOT NULL DEFAULT '7',
  `Delimiter` char(3) DEFAULT NULL,
  `ParentFormRules` int(11) unsigned DEFAULT NULL,
  `FormByCode` tinyint(1) unsigned NOT NULL DEFAULT '0',
  `NameMask` varchar(255) DEFAULT NULL,
  `ForbWords` varchar(255) DEFAULT NULL,
  `JunkPos` varchar(10) DEFAULT NULL,
  `AwaitPos` varchar(10) DEFAULT NULL,
  `StartLine` mediumint(8) unsigned DEFAULT NULL,
  `ListName` varchar(50) DEFAULT NULL,
  `TxtCodeBegin` int(11) unsigned DEFAULT NULL,
  `TxtCodeEnd` int(11) unsigned DEFAULT NULL,
  `TxtCodeCrBegin` int(11) unsigned DEFAULT NULL,
  `TxtCodeCrEnd` int(11) unsigned DEFAULT NULL,
  `TxtNameBegin` int(11) unsigned DEFAULT '1',
  `TxtNameEnd` int(11) unsigned DEFAULT '200',
  `TxtFirmCrBegin` int(11) unsigned DEFAULT NULL,
  `TxtFirmCrEnd` int(11) unsigned DEFAULT NULL,
  `TxtBaseCostBegin` int(10) unsigned DEFAULT NULL,
  `TxtBaseCostEnd` int(10) unsigned DEFAULT NULL,
  `TxtMinBoundCostBegin` int(10) unsigned DEFAULT NULL,
  `TxtMinBoundCostEnd` int(10) unsigned DEFAULT NULL,
  `TxtUnitBegin` int(10) unsigned DEFAULT NULL,
  `TxtUnitEnd` int(10) unsigned DEFAULT NULL,
  `TxtVolumeBegin` int(10) unsigned DEFAULT NULL,
  `TxtVolumeEnd` int(10) unsigned DEFAULT NULL,
  `TxtQuantityBegin` int(10) unsigned DEFAULT NULL,
  `TxtQuantityEnd` int(10) unsigned DEFAULT NULL,
  `TxtNoteBegin` int(10) unsigned DEFAULT NULL,
  `TxtNoteEnd` int(10) unsigned DEFAULT NULL,
  `TxtPeriodBegin` int(10) unsigned DEFAULT NULL,
  `TxtPeriodEnd` int(10) unsigned DEFAULT NULL,
  `TxtDocBegin` int(10) unsigned DEFAULT NULL,
  `TxtDocEnd` int(10) unsigned DEFAULT NULL,
  `TxtJunkBegin` int(10) unsigned DEFAULT NULL,
  `TxtJunkEnd` int(10) unsigned DEFAULT NULL,
  `TxtAwaitBegin` int(10) unsigned DEFAULT NULL,
  `TxtAwaitEnd` int(10) unsigned DEFAULT NULL,
  `FCode` varchar(20) DEFAULT NULL,
  `FCodeCr` varchar(20) DEFAULT NULL,
  `FName1` varchar(20) DEFAULT NULL,
  `FName2` varchar(20) DEFAULT NULL,
  `FName3` varchar(20) DEFAULT NULL,
  `FFirmCr` varchar(20) DEFAULT NULL,
  `FBaseCost` varchar(20) DEFAULT NULL,
  `FMinBoundCost` varchar(20) DEFAULT NULL,
  `FUnit` varchar(20) DEFAULT NULL,
  `FVolume` varchar(20) DEFAULT NULL,
  `FQuantity` varchar(20) DEFAULT NULL,
  `FNote` varchar(20) DEFAULT NULL,
  `FPeriod` varchar(20) DEFAULT NULL,
  `FDoc` varchar(20) DEFAULT NULL,
  `FJunk` varchar(20) DEFAULT NULL,
  `FAwait` varchar(20) DEFAULT NULL,
  `Memo` text,
  `TxtVitallyImportantBegin` int(11) unsigned DEFAULT NULL,
  `TxtVitallyImportantEnd` int(11) unsigned DEFAULT NULL,
  `FVitallyImportant` varchar(20) DEFAULT NULL,
  `VitallyImportantMask` varchar(10) DEFAULT NULL,
  `TxtRequestRatioBegin` int(11) unsigned DEFAULT NULL,
  `TxtRequestRatioEnd` int(11) unsigned DEFAULT NULL,
  `FRequestRatio` varchar(20) DEFAULT NULL,
  `TxtRegistryCostBegin` int(11) unsigned DEFAULT NULL,
  `TxtRegistryCostEnd` int(11) unsigned DEFAULT NULL,
  `FRegistryCost` varchar(20) DEFAULT NULL,
  `FMaxBoundCost` varchar(20) DEFAULT NULL,
  `TxtMaxBoundCostBegin` int(10) unsigned DEFAULT NULL,
  `TxtMaxBoundCostEnd` int(10) unsigned DEFAULT NULL,
  `FOrderCost` varchar(20) DEFAULT NULL,
  `TxtOrderCostBegin` int(10) unsigned DEFAULT NULL,
  `TxtOrderCostEnd` int(10) unsigned DEFAULT NULL,
  `FMinOrderCount` varchar(20) DEFAULT NULL,
  `TxtMinOrderCountBegin` int(10) unsigned DEFAULT NULL,
  `TxtMinOrderCountEnd` int(10) unsigned DEFAULT NULL,
  `FProducerCost` varchar(20) DEFAULT NULL COMMENT 'Цена производителя',
  `TxtProducerCostBegin` int(10) unsigned DEFAULT NULL,
  `TxtProducerCostEnd` int(10) unsigned DEFAULT NULL,
  `FNds` varchar(20) DEFAULT NULL COMMENT 'НДС',
  `TxtNdsBegin` int(10) unsigned DEFAULT NULL,
  `TxtNdsEnd` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`Id`),
  KEY `PriceFormatId_IDX` (`PriceFormatId`),
  KEY `ParentFormRules_IDX` (`ParentFormRules`),
  CONSTRAINT `ParentFormRules_FK` FOREIGN KEY (`ParentFormRules`) REFERENCES `formrules` (`Id`) ON DELETE SET NULL ON UPDATE CASCADE,
  CONSTRAINT `PriceFormatId_FK` FOREIGN KEY (`PriceFormatId`) REFERENCES `pricefmts` (`ID`) ON DELETE SET NULL ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=6314 DEFAULT CHARSET=cp1251 MIN_ROWS=500 MAX_ROWS=10000 PACK_KEYS=0 ROW_FORMAT=COMPACT COMMENT='InnoDB free: 14543872 kB; (`FirmCode`) REFER `usersettings/p';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER farm.FormRulesLogInsert
AFTER INSERT
ON farm.formrules
FOR EACH ROW
BEGIN
  INSERT
  INTO `logs`.form_rules_logs
  SET
    LogTime = NOW(), OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(), '@', 1)), OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(), '@', -1)), Operation = 0, FormRulesID = NEW.Id
    , PriceFormatId = NEW.PriceFormatId
    , MaxOld = NEW.MaxOld
    , Delimiter = NEW.Delimiter
    , ParentFormRules = NEW.ParentFormRules
    , FormByCode = NEW.FormByCode
    , NameMask = NEW.NameMask
    , ForbWords = NEW.ForbWords
    , JunkPos = NEW.JunkPos
    , AwaitPos = NEW.AwaitPos
    , StartLine = NEW.StartLine
    , ListName = NEW.ListName
    , TxtCodeBegin = NEW.TxtCodeBegin
    , TxtCodeEnd = NEW.TxtCodeEnd
    , TxtCodeCrBegin = NEW.TxtCodeCrBegin
    , TxtCodeCrEnd = NEW.TxtCodeCrEnd
    , TxtNameBegin = NEW.TxtNameBegin
    , TxtNameEnd = NEW.TxtNameEnd
    , TxtFirmCrBegin = NEW.TxtFirmCrBegin
    , TxtFirmCrEnd = NEW.TxtFirmCrEnd
    , TxtBaseCostBegin = NEW.TxtBaseCostBegin
    , TxtBaseCostEnd = NEW.TxtBaseCostEnd
    , TxtMinBoundCostBegin = NEW.TxtMinBoundCostBegin
    , TxtMinBoundCostEnd = NEW.TxtMinBoundCostEnd
    , TxtUnitBegin = NEW.TxtUnitBegin
    , TxtUnitEnd = NEW.TxtUnitEnd
    , TxtVolumeBegin = NEW.TxtVolumeBegin
    , TxtVolumeEnd = NEW.TxtVolumeEnd
    , TxtQuantityBegin = NEW.TxtQuantityBegin
    , TxtQuantityEnd = NEW.TxtQuantityEnd
    , TxtNoteBegin = NEW.TxtNoteBegin
    , TxtNoteEnd = NEW.TxtNoteEnd
    , TxtPeriodBegin = NEW.TxtPeriodBegin
    , TxtPeriodEnd = NEW.TxtPeriodEnd
    , TxtDocBegin = NEW.TxtDocBegin
    , TxtDocEnd = NEW.TxtDocEnd
    , TxtJunkBegin = NEW.TxtJunkBegin
    , TxtJunkEnd = NEW.TxtJunkEnd
    , TxtAwaitBegin = NEW.TxtAwaitBegin
    , TxtAwaitEnd = NEW.TxtAwaitEnd
    , FCode = NEW.FCode
    , FCodeCr = NEW.FCodeCr
    , FName1 = NEW.FName1
    , FName2 = NEW.FName2
    , FName3 = NEW.FName3
    , FFirmCr = NEW.FFirmCr
    , FBaseCost = NEW.FBaseCost
    , FMinBoundCost = NEW.FMinBoundCost
    , FUnit = NEW.FUnit
    , FVolume = NEW.FVolume
    , FQuantity = NEW.FQuantity
    , FNote = NEW.FNote
    , FPeriod = NEW.FPeriod
    , FDoc = NEW.FDoc
    , FJunk = NEW.FJunk
    , FAwait = NEW.FAwait
    , Memo = NEW.Memo
    , TxtVitallyImportantBegin = NEW.TxtVitallyImportantBegin
    , TxtVitallyImportantEnd = NEW.TxtVitallyImportantEnd
    , FVitallyImportant = NEW.FVitallyImportant
    , VitallyImportantMask = NEW.VitallyImportantMask
    , TxtRequestRatioBegin = NEW.TxtRequestRatioBegin
    , TxtRequestRatioEnd = NEW.TxtRequestRatioEnd
    , FRequestRatio = NEW.FRequestRatio
    , TxtRegistryCostBegin = NEW.TxtRegistryCostBegin
    , TxtRegistryCostEnd = NEW.TxtRegistryCostEnd
    , FRegistryCost = NEW.FRegistryCost
    , FMaxBoundCost = NEW.FMaxBoundCost
    , TxtMaxBoundCostBegin = NEW.TxtMaxBoundCostBegin
    , TxtMaxBoundCostEnd = NEW.TxtMaxBoundCostEnd
    , FOrderCost = NEW.FOrderCost
    , TxtOrderCostBegin = NEW.TxtOrderCostBegin
    , TxtOrderCostEnd = NEW.TxtOrderCostEnd
    , FMinOrderCount = NEW.FMinOrderCount
    , TxtMinOrderCountBegin = NEW.TxtMinOrderCountBegin
    , TxtMinOrderCountEnd = NEW.TxtMinOrderCountEnd
  ;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER farm.FormRulesLogUpdate
AFTER UPDATE
ON farm.formrules
FOR EACH ROW
BEGIN
  INSERT
  INTO `logs`.form_rules_logs
  SET
    LogTime = NOW(), OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(), '@', 1)), OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(), '@', -1)), Operation = 1, FormRulesID = OLD.Id
    , PriceFormatId = IFNULL(NEW.PriceFormatId, OLD.PriceFormatId)
    , MaxOld = NULLIF(NEW.MaxOld, OLD.MaxOld)
    , Delimiter = NULLIF(NEW.Delimiter, OLD.Delimiter)
    , ParentFormRules = IFNULL(NEW.ParentFormRules, OLD.ParentFormRules)
    , FormByCode = NULLIF(NEW.FormByCode, OLD.FormByCode)
    , NameMask = NULLIF(NEW.NameMask, OLD.NameMask)
    , ForbWords = NULLIF(NEW.ForbWords, OLD.ForbWords)
    , JunkPos = NULLIF(NEW.JunkPos, OLD.JunkPos)
    , AwaitPos = NULLIF(NEW.AwaitPos, OLD.AwaitPos)
    , StartLine = NULLIF(NEW.StartLine, OLD.StartLine)
    , ListName = NULLIF(NEW.ListName, OLD.ListName)
    , TxtCodeBegin = NULLIF(NEW.TxtCodeBegin, OLD.TxtCodeBegin)
    , TxtCodeEnd = NULLIF(NEW.TxtCodeEnd, OLD.TxtCodeEnd)
    , TxtCodeCrBegin = NULLIF(NEW.TxtCodeCrBegin, OLD.TxtCodeCrBegin)
    , TxtCodeCrEnd = NULLIF(NEW.TxtCodeCrEnd, OLD.TxtCodeCrEnd)
    , TxtNameBegin = NULLIF(NEW.TxtNameBegin, OLD.TxtNameBegin)
    , TxtNameEnd = NULLIF(NEW.TxtNameEnd, OLD.TxtNameEnd)
    , TxtFirmCrBegin = NULLIF(NEW.TxtFirmCrBegin, OLD.TxtFirmCrBegin)
    , TxtFirmCrEnd = NULLIF(NEW.TxtFirmCrEnd, OLD.TxtFirmCrEnd)
    , TxtBaseCostBegin = NULLIF(NEW.TxtBaseCostBegin, OLD.TxtBaseCostBegin)
    , TxtBaseCostEnd = NULLIF(NEW.TxtBaseCostEnd, OLD.TxtBaseCostEnd)
    , TxtMinBoundCostBegin = NULLIF(NEW.TxtMinBoundCostBegin, OLD.TxtMinBoundCostBegin)
    , TxtMinBoundCostEnd = NULLIF(NEW.TxtMinBoundCostEnd, OLD.TxtMinBoundCostEnd)
    , TxtUnitBegin = NULLIF(NEW.TxtUnitBegin, OLD.TxtUnitBegin)
    , TxtUnitEnd = NULLIF(NEW.TxtUnitEnd, OLD.TxtUnitEnd)
    , TxtVolumeBegin = NULLIF(NEW.TxtVolumeBegin, OLD.TxtVolumeBegin)
    , TxtVolumeEnd = NULLIF(NEW.TxtVolumeEnd, OLD.TxtVolumeEnd)
    , TxtQuantityBegin = NULLIF(NEW.TxtQuantityBegin, OLD.TxtQuantityBegin)
    , TxtQuantityEnd = NULLIF(NEW.TxtQuantityEnd, OLD.TxtQuantityEnd)
    , TxtNoteBegin = NULLIF(NEW.TxtNoteBegin, OLD.TxtNoteBegin)
    , TxtNoteEnd = NULLIF(NEW.TxtNoteEnd, OLD.TxtNoteEnd)
    , TxtPeriodBegin = NULLIF(NEW.TxtPeriodBegin, OLD.TxtPeriodBegin)
    , TxtPeriodEnd = NULLIF(NEW.TxtPeriodEnd, OLD.TxtPeriodEnd)
    , TxtDocBegin = NULLIF(NEW.TxtDocBegin, OLD.TxtDocBegin)
    , TxtDocEnd = NULLIF(NEW.TxtDocEnd, OLD.TxtDocEnd)
    , TxtJunkBegin = NULLIF(NEW.TxtJunkBegin, OLD.TxtJunkBegin)
    , TxtJunkEnd = NULLIF(NEW.TxtJunkEnd, OLD.TxtJunkEnd)
    , TxtAwaitBegin = NULLIF(NEW.TxtAwaitBegin, OLD.TxtAwaitBegin)
    , TxtAwaitEnd = NULLIF(NEW.TxtAwaitEnd, OLD.TxtAwaitEnd)
    , FCode = NULLIF(NEW.FCode, OLD.FCode)
    , FCodeCr = NULLIF(NEW.FCodeCr, OLD.FCodeCr)
    , FName1 = NULLIF(NEW.FName1, OLD.FName1)
    , FName2 = NULLIF(NEW.FName2, OLD.FName2)
    , FName3 = NULLIF(NEW.FName3, OLD.FName3)
    , FFirmCr = NULLIF(NEW.FFirmCr, OLD.FFirmCr)
    , FBaseCost = NULLIF(NEW.FBaseCost, OLD.FBaseCost)
    , FMinBoundCost = NULLIF(NEW.FMinBoundCost, OLD.FMinBoundCost)
    , FUnit = NULLIF(NEW.FUnit, OLD.FUnit)
    , FVolume = NULLIF(NEW.FVolume, OLD.FVolume)
    , FQuantity = NULLIF(NEW.FQuantity, OLD.FQuantity)
    , FNote = NULLIF(NEW.FNote, OLD.FNote)
    , FPeriod = NULLIF(NEW.FPeriod, OLD.FPeriod)
    , FDoc = NULLIF(NEW.FDoc, OLD.FDoc)
    , FJunk = NULLIF(NEW.FJunk, OLD.FJunk)
    , FAwait = NULLIF(NEW.FAwait, OLD.FAwait)
    , Memo = NULLIF(NEW.Memo, OLD.Memo)
    , TxtVitallyImportantBegin = NULLIF(NEW.TxtVitallyImportantBegin, OLD.TxtVitallyImportantBegin)
    , TxtVitallyImportantEnd = NULLIF(NEW.TxtVitallyImportantEnd, OLD.TxtVitallyImportantEnd)
    , FVitallyImportant = NULLIF(NEW.FVitallyImportant, OLD.FVitallyImportant)
    , VitallyImportantMask = NULLIF(NEW.VitallyImportantMask, OLD.VitallyImportantMask)
    , TxtRequestRatioBegin = NULLIF(NEW.TxtRequestRatioBegin, OLD.TxtRequestRatioBegin)
    , TxtRequestRatioEnd = NULLIF(NEW.TxtRequestRatioEnd, OLD.TxtRequestRatioEnd)
    , FRequestRatio = NULLIF(NEW.FRequestRatio, OLD.FRequestRatio)
    , TxtRegistryCostBegin = NULLIF(NEW.TxtRegistryCostBegin, OLD.TxtRegistryCostBegin)
    , TxtRegistryCostEnd = NULLIF(NEW.TxtRegistryCostEnd, OLD.TxtRegistryCostEnd)
    , FRegistryCost = NULLIF(NEW.FRegistryCost, OLD.FRegistryCost)
    , FMaxBoundCost = NULLIF(NEW.FMaxBoundCost, OLD.FMaxBoundCost)
    , TxtMaxBoundCostBegin = NULLIF(NEW.TxtMaxBoundCostBegin, OLD.TxtMaxBoundCostBegin)
    , TxtMaxBoundCostEnd = NULLIF(NEW.TxtMaxBoundCostEnd, OLD.TxtMaxBoundCostEnd)
    , FOrderCost = NULLIF(NEW.FOrderCost, OLD.FOrderCost)
    , TxtOrderCostBegin = NULLIF(NEW.TxtOrderCostBegin, OLD.TxtOrderCostBegin)
    , TxtOrderCostEnd = NULLIF(NEW.TxtOrderCostEnd, OLD.TxtOrderCostEnd)
    , FMinOrderCount = NULLIF(NEW.FMinOrderCount, OLD.FMinOrderCount)
    , TxtMinOrderCountBegin = NULLIF(NEW.TxtMinOrderCountBegin, OLD.TxtMinOrderCountBegin)
    , TxtMinOrderCountEnd = NULLIF(NEW.TxtMinOrderCountEnd, OLD.TxtMinOrderCountEnd)
  ;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER farm.FormRulesLogDelete
AFTER DELETE
ON farm.formrules
FOR EACH ROW
BEGIN
  INSERT
  INTO `logs`.form_rules_logs
  SET
    LogTime = NOW(), OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(), '@', 1)), OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(), '@', -1)), Operation = 2, FormRulesID = OLD.Id
    , PriceFormatId = OLD.PriceFormatId
    , MaxOld = OLD.MaxOld
    , Delimiter = OLD.Delimiter
    , ParentFormRules = OLD.ParentFormRules
    , FormByCode = OLD.FormByCode
    , NameMask = OLD.NameMask
    , ForbWords = OLD.ForbWords
    , JunkPos = OLD.JunkPos
    , AwaitPos = OLD.AwaitPos
    , StartLine = OLD.StartLine
    , ListName = OLD.ListName
    , TxtCodeBegin = OLD.TxtCodeBegin
    , TxtCodeEnd = OLD.TxtCodeEnd
    , TxtCodeCrBegin = OLD.TxtCodeCrBegin
    , TxtCodeCrEnd = OLD.TxtCodeCrEnd
    , TxtNameBegin = OLD.TxtNameBegin
    , TxtNameEnd = OLD.TxtNameEnd
    , TxtFirmCrBegin = OLD.TxtFirmCrBegin
    , TxtFirmCrEnd = OLD.TxtFirmCrEnd
    , TxtBaseCostBegin = OLD.TxtBaseCostBegin
    , TxtBaseCostEnd = OLD.TxtBaseCostEnd
    , TxtMinBoundCostBegin = OLD.TxtMinBoundCostBegin
    , TxtMinBoundCostEnd = OLD.TxtMinBoundCostEnd
    , TxtUnitBegin = OLD.TxtUnitBegin
    , TxtUnitEnd = OLD.TxtUnitEnd
    , TxtVolumeBegin = OLD.TxtVolumeBegin
    , TxtVolumeEnd = OLD.TxtVolumeEnd
    , TxtQuantityBegin = OLD.TxtQuantityBegin
    , TxtQuantityEnd = OLD.TxtQuantityEnd
    , TxtNoteBegin = OLD.TxtNoteBegin
    , TxtNoteEnd = OLD.TxtNoteEnd
    , TxtPeriodBegin = OLD.TxtPeriodBegin
    , TxtPeriodEnd = OLD.TxtPeriodEnd
    , TxtDocBegin = OLD.TxtDocBegin
    , TxtDocEnd = OLD.TxtDocEnd
    , TxtJunkBegin = OLD.TxtJunkBegin
    , TxtJunkEnd = OLD.TxtJunkEnd
    , TxtAwaitBegin = OLD.TxtAwaitBegin
    , TxtAwaitEnd = OLD.TxtAwaitEnd
    , FCode = OLD.FCode
    , FCodeCr = OLD.FCodeCr
    , FName1 = OLD.FName1
    , FName2 = OLD.FName2
    , FName3 = OLD.FName3
    , FFirmCr = OLD.FFirmCr
    , FBaseCost = OLD.FBaseCost
    , FMinBoundCost = OLD.FMinBoundCost
    , FUnit = OLD.FUnit
    , FVolume = OLD.FVolume
    , FQuantity = OLD.FQuantity
    , FNote = OLD.FNote
    , FPeriod = OLD.FPeriod
    , FDoc = OLD.FDoc
    , FJunk = OLD.FJunk
    , FAwait = OLD.FAwait
    , Memo = OLD.Memo
    , TxtVitallyImportantBegin = OLD.TxtVitallyImportantBegin
    , TxtVitallyImportantEnd = OLD.TxtVitallyImportantEnd
    , FVitallyImportant = OLD.FVitallyImportant
    , VitallyImportantMask = OLD.VitallyImportantMask
    , TxtRequestRatioBegin = OLD.TxtRequestRatioBegin
    , TxtRequestRatioEnd = OLD.TxtRequestRatioEnd
    , FRequestRatio = OLD.FRequestRatio
    , TxtRegistryCostBegin = OLD.TxtRegistryCostBegin
    , TxtRegistryCostEnd = OLD.TxtRegistryCostEnd
    , FRegistryCost = OLD.FRegistryCost
    , FMaxBoundCost = OLD.FMaxBoundCost
    , TxtMaxBoundCostBegin = OLD.TxtMaxBoundCostBegin
    , TxtMaxBoundCostEnd = OLD.TxtMaxBoundCostEnd
    , FOrderCost = OLD.FOrderCost
    , TxtOrderCostBegin = OLD.TxtOrderCostBegin
    , TxtOrderCostEnd = OLD.TxtOrderCostEnd
    , FMinOrderCount = OLD.FMinOrderCount
    , TxtMinOrderCountBegin = OLD.TxtMinOrderCountBegin
    , TxtMinOrderCountEnd = OLD.TxtMinOrderCountEnd
  ;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `pricefmts`
--

DROP TABLE IF EXISTS `pricefmts`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `pricefmts` (
  `ID` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `Format` char(20) NOT NULL DEFAULT '',
  `Comment` varchar(255) DEFAULT NULL,
  `FileExtention` varchar(255) NOT NULL,
  `ParserClassName` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`ID`)
) ENGINE=InnoDB AUTO_INCREMENT=16 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `sources`
--

DROP TABLE IF EXISTS `sources`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `sources` (
  `Id` int(11) unsigned NOT NULL AUTO_INCREMENT,
  `SourceTypeId` int(11) unsigned DEFAULT NULL,
  `PricePath` varchar(255) DEFAULT NULL,
  `EMailTo` varchar(255) DEFAULT NULL,
  `EMailFrom` varchar(255) DEFAULT NULL,
  `FTPDir` varchar(255) DEFAULT NULL,
  `FTPLogin` varchar(100) DEFAULT NULL,
  `FTPPassword` varchar(100) DEFAULT NULL,
  `FTPPassiveMode` tinyint(1) NOT NULL DEFAULT '0',
  `PriceMask` varchar(255) DEFAULT NULL,
  `ExtrMask` varchar(255) DEFAULT NULL,
  `ArchivePassword` varchar(100) DEFAULT NULL,
  `HTTPLogin` varchar(100) DEFAULT NULL,
  `HTTPPassword` varchar(100) DEFAULT NULL,
  `RequestInterval` int(10) unsigned DEFAULT NULL COMMENT 'Интервал в секундах, через который производится обращение к источнику',
  `LastSuccessfulCheck` datetime DEFAULT NULL,
  PRIMARY KEY (`Id`),
  KEY `SourceTypeId_IDX` (`SourceTypeId`),
  CONSTRAINT `SourceTypeId_FK` FOREIGN KEY (`SourceTypeId`) REFERENCES `sourcetypes` (`Id`) ON DELETE SET NULL ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=6314 DEFAULT CHARSET=cp1251 MIN_ROWS=600 MAX_ROWS=10000 PACK_KEYS=1 CHECKSUM=1 DELAY_KEY_WRITE=1 ROW_FORMAT=COMPACT COMMENT='InnoDB free: 10236928 kB; (`FirmCode`) REFER `farm/formrules';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER farm.sourcesLogInsert AFTER INSERT
ON farm.sources
FOR EACH ROW BEGIN
  INSERT
  INTO `logs`.sources_logs
  SET
    LogTime = now() ,
    OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)) ,
    OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)) ,
    Operation = 0,
    sourcesID = NEW.Id
    ,SourceTypeId = NEW.SourceTypeId
    ,PricePath = NEW.PricePath
    ,EMailTo = NEW.EMailTo
    ,EMailFrom = NEW.EMailFrom
    ,FTPDir = NEW.FTPDir
    ,FTPLogin = NEW.FTPLogin
    ,FTPPassword = NEW.FTPPassword
    ,FTPPassiveMode = NEW.FTPPassiveMode
    ,PriceMask = NEW.PriceMask
    ,ExtrMask = NEW.ExtrMask
    ,ArchivePassword = NEW.ArchivePassword
    ,HTTPLogin = NEW.HTTPLogin
    ,HTTPPassword = NEW.HTTPPassword
  ;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER farm.sourcesLogUpdate
	AFTER UPDATE
	ON farm.sources
	FOR EACH ROW
BEGIN

  IF NEW.PricePath != OLD.PricePath
  OR NEW.EMailTo != OLD.EMailTo
  OR NEW.EMailFrom != OLD.EMailFrom
  OR NEW.FTPDir != OLD.FTPDir
  OR NEW.FTPLogin != OLD.FTPLogin
  OR NEW.FTPPassword != OLD.FTPPassword
  OR NEW.FTPPassiveMode != OLD.FTPPassiveMode
  OR NEW.PriceMask != OLD.PriceMask
  OR NEW.ExtrMask != OLD.ExtrMask
  OR NEW.ArchivePassword != OLD.ArchivePassword
  OR NEW.HTTPLogin != OLD.HTTPLogin
  OR NEW.HTTPPassword != OLD.HTTPPassword THEN
  
    INSERT
    INTO `logs`.sources_logs
    SET
      LogTime = NOW(), OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(), '@', 1)), OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(), '@', -1)), Operation = 1, sourcesID = OLD.Id
      , SourceTypeId = IFNULL(NEW.SourceTypeId, OLD.SourceTypeId)
      , PricePath = NULLIF(NEW.PricePath, OLD.PricePath)
      , EMailTo = NULLIF(NEW.EMailTo, OLD.EMailTo)
      , EMailFrom = NULLIF(NEW.EMailFrom, OLD.EMailFrom)
      , FTPDir = NULLIF(NEW.FTPDir, OLD.FTPDir)
      , FTPLogin = NULLIF(NEW.FTPLogin, OLD.FTPLogin)
      , FTPPassword = NULLIF(NEW.FTPPassword, OLD.FTPPassword)
      , FTPPassiveMode = NULLIF(NEW.FTPPassiveMode, OLD.FTPPassiveMode)
      , PriceMask = NULLIF(NEW.PriceMask, OLD.PriceMask)
      , ExtrMask = NULLIF(NEW.ExtrMask, OLD.ExtrMask)
      , ArchivePassword = NULLIF(NEW.ArchivePassword, OLD.ArchivePassword)
      , HTTPLogin = NULLIF(NEW.HTTPLogin, OLD.HTTPLogin)
      , HTTPPassword = NULLIF(NEW.HTTPPassword, OLD.HTTPPassword)
    ;
  END IF;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER farm.sourcesLogDelete AFTER DELETE
ON farm.sources
FOR EACH ROW BEGIN
  INSERT INTO `logs`.sources_logs
  SET 
    LogTime = now() ,
    OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)) ,
    OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)) ,
    Operation = 2,
    sourcesID = OLD.Id
    ,SourceTypeId = OLD.SourceTypeId
    ,PricePath = OLD.PricePath
    ,EMailTo = OLD.EMailTo
    ,EMailFrom = OLD.EMailFrom
    ,FTPDir = OLD.FTPDir
    ,FTPLogin = OLD.FTPLogin
    ,FTPPassword = OLD.FTPPassword
    ,FTPPassiveMode = OLD.FTPPassiveMode
    ,PriceMask = OLD.PriceMask
    ,ExtrMask = OLD.ExtrMask
    ,ArchivePassword = OLD.ArchivePassword
    ,HTTPLogin = OLD.HTTPLogin
    ,HTTPPassword = OLD.HTTPPassword
  ;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `sourcetypes`
--

DROP TABLE IF EXISTS `sourcetypes`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `sourcetypes` (
  `Id` int(11) unsigned NOT NULL DEFAULT '0',
  `Type` varchar(5) DEFAULT NULL,
  `Comment` varchar(20) DEFAULT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `suspicioussynonyms`
--

DROP TABLE IF EXISTS `suspicioussynonyms`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `suspicioussynonyms` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `ProducerSynonymId` int(10) unsigned NOT NULL,
  PRIMARY KEY (`Id`),
  KEY `FK_ProducerSynonymLogId` (`ProducerSynonymId`),
  CONSTRAINT `FK_ProducerSynonymLogId` FOREIGN KEY (`ProducerSynonymId`) REFERENCES `synonymfirmcr` (`SynonymFirmCrCode`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `synonymarchive`
--

DROP TABLE IF EXISTS `synonymarchive`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `synonymarchive` (
  `SynonymCode` int(10) unsigned NOT NULL,
  `PriceCode` int(10) unsigned DEFAULT NULL,
  `Synonym` varchar(255) DEFAULT NULL,
  `ProductId` int(10) unsigned DEFAULT NULL,
  `Junk` tinyint(1) NOT NULL DEFAULT '0',
  PRIMARY KEY (`SynonymCode`) USING BTREE
) ENGINE=InnoDB DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `test`
--

DROP TABLE IF EXISTS `test`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `test` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `id2` int(11) NOT NULL,
  `name` varchar(100) DEFAULT NULL,
  `dt` datetime DEFAULT NULL,
  `tm` time DEFAULT NULL,
  `ts` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `OriginalId` int(11) DEFAULT NULL,
  PRIMARY KEY (`id`,`id2`)
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `unrecexp`
--

DROP TABLE IF EXISTS `unrecexp`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `unrecexp` (
  `RowID` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `PriceItemId` int(11) unsigned DEFAULT NULL,
  `Name1` varchar(255) DEFAULT NULL,
  `FirmCr` varchar(255) DEFAULT NULL,
  `Code` varchar(20) DEFAULT NULL,
  `CodeCr` varchar(20) DEFAULT NULL,
  `Unit` varchar(15) DEFAULT NULL,
  `Volume` varchar(15) DEFAULT NULL,
  `Quantity` varchar(15) DEFAULT NULL,
  `Note` varchar(50) DEFAULT NULL,
  `Period` varchar(20) DEFAULT NULL,
  `Doc` varchar(20) DEFAULT NULL,
  `Junk` tinyint(1) NOT NULL DEFAULT '0',
  `AddDate` datetime DEFAULT NULL,
  `Status` tinyint(4) unsigned DEFAULT NULL,
  `Already` tinyint(4) unsigned DEFAULT NULL,
  `HandMade` tinyint(1) NOT NULL DEFAULT '0',
  `PriorProductId` int(10) unsigned DEFAULT NULL,
  `PriorProducerId` int(10) unsigned DEFAULT NULL,
  `ProductSynonymId` int(10) unsigned DEFAULT NULL,
  `ProducerSynonymId` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`RowID`),
  KEY `PriceItemId_IDX` (`PriceItemId`) USING BTREE,
  KEY `FK_UnrecExp_ProductSynonymId` (`ProductSynonymId`),
  KEY `FK_UnrecExp_ProducerSynonymId` (`ProducerSynonymId`),
  CONSTRAINT `FK_UnrecExp_PriceItemId` FOREIGN KEY (`PriceItemId`) REFERENCES `usersettings`.`priceitems` (`Id`) ON DELETE CASCADE,
  CONSTRAINT `FK_UnrecExp_ProducerSynonymId` FOREIGN KEY (`ProducerSynonymId`) REFERENCES `synonymfirmcr` (`SynonymFirmCrCode`) ON DELETE SET NULL,
  CONSTRAINT `FK_UnrecExp_ProductSynonymId` FOREIGN KEY (`ProductSynonymId`) REFERENCES `synonym` (`SynonymCode`) ON DELETE SET NULL
) ENGINE=InnoDB AUTO_INCREMENT=793045113 DEFAULT CHARSET=cp1251 MIN_ROWS=20000 MAX_ROWS=300000 PACK_KEYS=0 CHECKSUM=1 DELAY_KEY_WRITE=1 ROW_FORMAT=COMPACT COMMENT='InnoDB free: 14863360 kB';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `usedsynonymfirmcrlogs`
--

DROP TABLE IF EXISTS `usedsynonymfirmcrlogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `usedsynonymfirmcrlogs` (
  `SynonymFirmCrCode` int(10) unsigned NOT NULL,
  `LastUsed` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`SynonymFirmCrCode`) USING BTREE,
  CONSTRAINT `SynonymFirmCrCode_FK` FOREIGN KEY (`SynonymFirmCrCode`) REFERENCES `synonymfirmcr` (`SynonymFirmCrCode`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `usedsynonymlogs`
--

DROP TABLE IF EXISTS `usedsynonymlogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `usedsynonymlogs` (
  `SynonymCode` int(10) unsigned NOT NULL,
  `LastUsed` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`SynonymCode`) USING BTREE,
  CONSTRAINT `SynonymCode_FK` FOREIGN KEY (`SynonymCode`) REFERENCES `synonym` (`SynonymCode`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `zero`
--

DROP TABLE IF EXISTS `zero`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `zero` (
  `RowID` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `PriceItemId` int(11) unsigned DEFAULT NULL,
  `Name` varchar(255) DEFAULT NULL,
  `FirmCr` varchar(100) DEFAULT NULL,
  `Code` varchar(20) DEFAULT NULL,
  `CodeCr` varchar(20) DEFAULT NULL,
  `Unit` varchar(15) DEFAULT NULL,
  `Volume` varchar(15) DEFAULT NULL,
  `Quantity` varchar(15) DEFAULT NULL,
  `Note` varchar(50) DEFAULT NULL,
  `Period` varchar(20) DEFAULT NULL,
  `Doc` varchar(20) DEFAULT NULL,
  PRIMARY KEY (`RowID`),
  KEY `PriceItemId_IDX` (`PriceItemId`) USING BTREE,
  CONSTRAINT `FK_Zero_PriceItemId` FOREIGN KEY (`PriceItemId`) REFERENCES `usersettings`.`priceitems` (`Id`) ON DELETE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=140855986 DEFAULT CHARSET=cp1251 MIN_ROWS=20000 MAX_ROWS=300000 PACK_KEYS=0 CHECKSUM=1 DELAY_KEY_WRITE=1 ROW_FORMAT=COMPACT COMMENT='InnoDB free: 7568384 kB';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping events for database 'farm'
--
/*!50106 SET @save_time_zone= @@TIME_ZONE */ ;
/*!50106 DROP EVENT IF EXISTS `ClearSynonym` */;
DELIMITER ;;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;;
/*!50003 SET character_set_client  = cp1251 */ ;;
/*!50003 SET character_set_results = cp1251 */ ;;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;;
/*!50003 SET sql_mode              = '' */ ;;
/*!50003 SET @saved_time_zone      = @@time_zone */ ;;
/*!50003 SET time_zone             = 'SYSTEM' */ ;;
/*!50106 CREATE*/ /*!50117 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50106 EVENT `ClearSynonym` ON SCHEDULE EVERY 1 DAY STARTS '2010-08-11 01:00:00' ON COMPLETION NOT PRESERVE ENABLE DO BEGIN
  CREATE TEMPORARY TABLE SynonymToDelete ENGINE = MEMORY
  SELECT
    U.synonymcode
  FROM
    UsedSynonymLogs U,
    SYNONYM S
  WHERE
    lastUsed < CURDATE() - INTERVAL 3 MONTH
    AND s.synonymcode = u.synonymcode
    AND s.pricecode NOT IN
    (SELECT
      pricecode
    FROM
      usersettings.PricesData P
    WHERE
      pricetype = 1

    UNION

    DISTINCT
    SELECT DISTINCT
      parentsynonym
    FROM
      usersettings.PricesData P
    WHERE
      pricetype = 1
      AND parentsynonym IS NOT NULL
    )

  UNION

  DISTINCT
  SELECT
    synonymcode
  FROM
    UsedSynonymLogs U
  WHERE
    lastUsed < CURDATE() - INTERVAL 1 YEAR;

  DELETE
  FROM
    s
  USING
    SYNONYM s,
    SynonymToDelete d
  WHERE
    s.synonymcode = d.synonymcode;
  DROP TEMPORARY TABLE SynonymToDelete;


  CREATE TEMPORARY TABLE SynonymCrToDelete ENGINE = MEMORY
  SELECT
    U.synonymfirmcrcode
  FROM
    UsedSynonymfirmcrLogs U,
    SYNONYMfirmcr S
  WHERE
    lastUsed < CURDATE() - INTERVAL 3 MONTH
    AND s.synonymfirmcrcode = u.synonymfirmcrcode
    AND s.pricecode NOT IN
    (SELECT
      pricecode
    FROM
      usersettings.PricesData P
    WHERE
      pricetype = 1

    UNION

    DISTINCT
    SELECT DISTINCT
      parentsynonym
    FROM
      usersettings.PricesData P
    WHERE
      pricetype = 1
      AND parentsynonym IS NOT NULL
    )

  UNION

  DISTINCT
  SELECT
    synonymfirmcrcode
  FROM
    UsedSynonymfirmcrLogs U
  WHERE
    lastUsed < CURDATE() - INTERVAL 1 YEAR;
  DELETE
  FROM
    s
  USING
    SYNONYMfirmcr s,
    SynonymCrToDelete d
  WHERE
    s.synonymfirmcrcode = d.synonymfirmcrcode;
  DROP TEMPORARY TABLE SynonymCrToDelete;

END */ ;;
/*!50003 SET time_zone             = @saved_time_zone */ ;;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;;
/*!50003 SET character_set_client  = @saved_cs_client */ ;;
/*!50003 SET character_set_results = @saved_cs_results */ ;;
/*!50003 SET collation_connection  = @saved_col_connection */ ;;
DELIMITER ;
/*!50106 SET TIME_ZONE= @save_time_zone */ ;

--
-- Dumping routines for database 'farm'
--

--
-- Current Database: `future`
--

/*!40000 DROP DATABASE IF EXISTS `future`*/;

CREATE DATABASE /*!32312 IF NOT EXISTS*/ `future` /*!40100 DEFAULT CHARACTER SET cp1251 */;

USE `future`;

--
-- Table structure for table `Addresses`
--

DROP TABLE IF EXISTS `Addresses`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `Addresses` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `LegacyId` int(10) unsigned DEFAULT NULL,
  `ClientId` int(10) unsigned NOT NULL,
  `LegalEntityId` int(10) unsigned NOT NULL,
  `Enabled` tinyint(3) unsigned NOT NULL DEFAULT '1' COMMENT '0 - Выкл.\r\n1 - Вкл.',
  `Address` varchar(100) NOT NULL,
  `ContactGroupId` int(10) unsigned DEFAULT NULL,
  `AccountingId` int(10) unsigned DEFAULT NULL,
  `PayerId` int(10) unsigned DEFAULT NULL,
  `Registrant` varchar(100) DEFAULT NULL,
  `RegistrationDate` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`Id`),
  KEY `FK_Addresses_ClientId` (`ClientId`),
  KEY `FK_Addresses_ContactGroupId` (`ContactGroupId`),
  KEY `AccountingId` (`AccountingId`),
  KEY `FK_Addresses_PayerId` (`PayerId`),
  CONSTRAINT `FK_Addresses_ClientId` FOREIGN KEY (`ClientId`) REFERENCES `clients` (`Id`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `FK_Addresses_ContactGroupId` FOREIGN KEY (`ContactGroupId`) REFERENCES `contacts`.`contact_groups` (`Id`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `FK_Addresses_PayerId` FOREIGN KEY (`PayerId`) REFERENCES `billing`.`payers` (`PayerID`)
) ENGINE=InnoDB AUTO_INCREMENT=15541 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER Future.AddressLogInsert AFTER INSERT ON Future.Addresses
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.AddressLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 0,
		AddressId = NEW.Id,
		LegacyId = NEW.LegacyId,
		ClientId = NEW.ClientId,
		LegalEntityId = NEW.LegalEntityId,
		Enabled = NEW.Enabled,
		Address = NEW.Address,
		ContactGroupId = NEW.ContactGroupId,
		AccountingId = NEW.AccountingId,
		PayerId = NEW.PayerId,
		Registrant = NEW.Registrant,
		RegistrationDate = NEW.RegistrationDate;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER Future.AddressLogUpdate AFTER UPDATE ON Future.Addresses
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.AddressLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 1,
		AddressId = OLD.Id,
		LegacyId = NULLIF(NEW.LegacyId, OLD.LegacyId),
		ClientId = NULLIF(NEW.ClientId, OLD.ClientId),
		LegalEntityId = NULLIF(NEW.LegalEntityId, OLD.LegalEntityId),
		Enabled = NULLIF(NEW.Enabled, OLD.Enabled),
		Address = NULLIF(NEW.Address, OLD.Address),
		ContactGroupId = NULLIF(NEW.ContactGroupId, OLD.ContactGroupId),
		AccountingId = NULLIF(NEW.AccountingId, OLD.AccountingId),
		PayerId = NULLIF(NEW.PayerId, OLD.PayerId),
		Registrant = NULLIF(NEW.Registrant, OLD.Registrant),
		RegistrationDate = NULLIF(NEW.RegistrationDate, OLD.RegistrationDate);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER Future.AddressLogDelete AFTER DELETE ON Future.Addresses
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.AddressLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 2,
		AddressId = OLD.Id,
		LegacyId = OLD.LegacyId,
		ClientId = OLD.ClientId,
		LegalEntityId = OLD.LegalEntityId,
		Enabled = OLD.Enabled,
		Address = OLD.Address,
		ContactGroupId = OLD.ContactGroupId,
		AccountingId = OLD.AccountingId,
		PayerId = OLD.PayerId,
		Registrant = OLD.Registrant,
		RegistrationDate = OLD.RegistrationDate;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `Clients`
--

DROP TABLE IF EXISTS `Clients`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `Clients` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `Status` tinyint(1) unsigned NOT NULL DEFAULT '1',
  `Segment` tinyint(1) unsigned NOT NULL DEFAULT '0',
  `FirmType` tinyint(1) unsigned NOT NULL DEFAULT '0',
  `PayerId` int(10) unsigned DEFAULT NULL,
  `RegionCode` bigint(20) unsigned NOT NULL,
  `MaskRegion` bigint(20) unsigned NOT NULL,
  `Name` varchar(255) NOT NULL,
  `FullName` varchar(255) NOT NULL,
  `Registrant` varchar(100) DEFAULT NULL,
  `RegistrationDate` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `ContactGroupOwnerId` int(10) unsigned DEFAULT NULL,
  `SwapFirmCode` tinyint(1) unsigned NOT NULL DEFAULT '0',
  PRIMARY KEY (`Id`),
  KEY `FK_Clients_PayerId` (`PayerId`)
) ENGINE=InnoDB AUTO_INCREMENT=12486 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER ClientLogInsert AFTER INSERT ON Future.Clients
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.ClientLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 0,
		ClientId = NEW.Id,
		Status = NEW.Status,
		Segment = NEW.Segment,
		FirmType = NEW.FirmType,
		PayerId = NEW.PayerId,
		RegionCode = NEW.RegionCode,
		MaskRegion = NEW.MaskRegion,
		Name = NEW.Name,
		FullName = NEW.FullName,
		Registrant = NEW.Registrant,
		RegistrationDate = NEW.RegistrationDate,
		ContactGroupOwnerId = NEW.ContactGroupOwnerId,
		SwapFirmCode = NEW.SwapFirmCode;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER ClientLogUpdate AFTER UPDATE ON Future.Clients
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.ClientLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 1,
		ClientId = OLD.Id,
		Status = NULLIF(NEW.Status, OLD.Status),
		Segment = NULLIF(NEW.Segment, OLD.Segment),
		FirmType = NULLIF(NEW.FirmType, OLD.FirmType),
		PayerId = NULLIF(NEW.PayerId, OLD.PayerId),
		RegionCode = NULLIF(NEW.RegionCode, OLD.RegionCode),
		MaskRegion = NULLIF(NEW.MaskRegion, OLD.MaskRegion),
		Name = NULLIF(NEW.Name, OLD.Name),
		FullName = NULLIF(NEW.FullName, OLD.FullName),
		Registrant = NULLIF(NEW.Registrant, OLD.Registrant),
		RegistrationDate = NULLIF(NEW.RegistrationDate, OLD.RegistrationDate),
		ContactGroupOwnerId = NULLIF(NEW.ContactGroupOwnerId, OLD.ContactGroupOwnerId),
		SwapFirmCode = NULLIF(NEW.SwapFirmCode, OLD.SwapFirmCode);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER ClientLogDelete AFTER DELETE ON Future.Clients
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.ClientLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 2,
		ClientId = OLD.Id,
		Status = OLD.Status,
		Segment = OLD.Segment,
		FirmType = OLD.FirmType,
		PayerId = OLD.PayerId,
		RegionCode = OLD.RegionCode,
		MaskRegion = OLD.MaskRegion,
		Name = OLD.Name,
		FullName = OLD.FullName,
		Registrant = OLD.Registrant,
		RegistrationDate = OLD.RegistrationDate,
		ContactGroupOwnerId = OLD.ContactGroupOwnerId,
		SwapFirmCode = OLD.SwapFirmCode;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `Suppliers`
--

DROP TABLE IF EXISTS `Suppliers`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `Suppliers` (
  `Id` int(10) unsigned NOT NULL,
  `Name` varchar(255) DEFAULT NULL,
  `FullName` varchar(255) DEFAULT NULL,
  `RegionMask` bigint(20) unsigned NOT NULL DEFAULT '0',
  `Disabled` tinyint(1) NOT NULL DEFAULT '0',
  `Registrant` varchar(255) DEFAULT NULL,
  `RegistrationDate` datetime DEFAULT NULL,
  `HomeRegion` bigint(20) unsigned DEFAULT NULL,
  `ContactGroupOwnerId` int(10) unsigned DEFAULT NULL,
  `Payer` int(10) unsigned DEFAULT NULL,
  `Segment` int(11) NOT NULL DEFAULT '0',
  `Account` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`Id`),
  KEY `FK_Suppliers_Payer` (`Payer`),
  CONSTRAINT `FK_Suppliers_Payer` FOREIGN KEY (`Payer`) REFERENCES `billing`.`payers` (`PayerID`)
) ENGINE=InnoDB DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER Future.SupplierLogInsert AFTER INSERT ON Future.Suppliers
FOR EACH ROW BEGIN
INSERT 
	INTO `logs`.SupplierLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 0,
		SupplierId = NEW.Id,
		Name = NEW.Name,
		FullName = NEW.FullName,
		RegionMask = NEW.RegionMask,
		Disabled = NEW.Disabled,
		Registrant = NEW.Registrant,
		RegistrationDate = NEW.RegistrationDate,
		HomeRegion = NEW.HomeRegion,
		ContactGroupOwnerId = NEW.ContactGroupOwnerId,
		Payer = NEW.Payer;

	insert into Usersettings.ClientsData(FirmCode, FirmSegment, FirmStatus, BillingCode, RegionCode, MaskRegion, FullName, ShortName, ContactGroupOwnerId)
	select NEW.Id, NEW.Segment, New.Disabled = 0, NEW.Payer, NEW.HomeRegion, NEW.RegionMask, NEW.FullName, NEW.Name, NEW.ContactGroupOwnerId;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER Future.SupplierLogUpdate AFTER UPDATE ON Future.Suppliers
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.SupplierLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 1,
		SupplierId = OLD.Id,
		Name = NULLIF(NEW.Name, OLD.Name),
		FullName = NULLIF(NEW.FullName, OLD.FullName),
		RegionMask = NULLIF(NEW.RegionMask, OLD.RegionMask),
		Disabled = NULLIF(NEW.Disabled, OLD.Disabled),
		Registrant = NULLIF(NEW.Registrant, OLD.Registrant),
		RegistrationDate = NULLIF(NEW.RegistrationDate, OLD.RegistrationDate),
		HomeRegion = NULLIF(NEW.HomeRegion, OLD.HomeRegion),
		ContactGroupOwnerId = NULLIF(NEW.ContactGroupOwnerId, OLD.ContactGroupOwnerId),
		Payer = NULLIF(NEW.Payer, OLD.Payer);

	if NEW.Disabled is not null then
		update Usersettings.ClientsData set FirmStatus = if(NEW.Disabled = 1, 0, 1) where FirmCode = NEW.Id;
	end if;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER Future.SupplierLogDelete AFTER DELETE ON Future.Suppliers
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.SupplierLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 2,
		SupplierId = OLD.Id,
		Name = OLD.Name,
		FullName = OLD.FullName,
		RegionMask = OLD.RegionMask,
		Disabled = OLD.Disabled,
		Registrant = OLD.Registrant,
		RegistrationDate = OLD.RegistrationDate,
		HomeRegion = OLD.HomeRegion,
		ContactGroupOwnerId = OLD.ContactGroupOwnerId,
		Payer = OLD.Payer;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `Users`
--

DROP TABLE IF EXISTS `Users`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `Users` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `ClientId` int(10) unsigned DEFAULT NULL,
  `Enabled` tinyint(3) unsigned NOT NULL DEFAULT '1' COMMENT '0 - Выкл.\r\n1 - Вкл.',
  `Login` varchar(20) NOT NULL,
  `Name` varchar(100) DEFAULT NULL,
  `SendRejects` tinyint(1) unsigned NOT NULL DEFAULT '1',
  `SendWaybills` tinyint(1) unsigned NOT NULL DEFAULT '1',
  `SubmitOrders` tinyint(1) unsigned NOT NULL DEFAULT '0',
  `EnableUpdate` tinyint(1) unsigned NOT NULL DEFAULT '0' COMMENT 'Автоматическое обновление версий\r\n0 - выключено\r\n1 - включено',
  `Auditor` tinyint(1) unsigned NOT NULL DEFAULT '0',
  `InheritPricesFrom` int(10) unsigned DEFAULT NULL,
  `Registrant` varchar(100) DEFAULT NULL,
  `ContactGroupId` int(10) unsigned DEFAULT NULL,
  `RegistrationDate` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `WorkRegionMask` bigint(20) unsigned NOT NULL DEFAULT '0',
  `OrderRegionMask` bigint(20) unsigned NOT NULL DEFAULT '0',
  `AccountingId` int(10) unsigned DEFAULT NULL,
  `PayerId` int(10) unsigned DEFAULT NULL,
  `SaveAFDataFiles` tinyint(1) unsigned NOT NULL DEFAULT '0' COMMENT 'Сохранять подготовленный данные в архив?',
  `TargetVersion` mediumint(8) unsigned DEFAULT '1325' COMMENT 'Номер версии, до которой программа может автообновляться; null - до максимально возможной.',
  `UseAdjustmentOrders` tinyint(1) unsigned NOT NULL DEFAULT '0' COMMENT 'Производить корректировку заказов по цене и количеству перед отправкой?',
  `PromoFileLimit` int(10) unsigned DEFAULT '512000' COMMENT 'размер файлов с промо-акциями, передаваемый за одно обновление',
  `RootService` int(10) unsigned DEFAULT NULL,
  `AllowDownloadUnconfirmedOrders` tinyint(1) unsigned NOT NULL DEFAULT '0' COMMENT 'Разрешено загружать неподтвержденные заказы с сервера',
  `ShowSupplierCost` tinyint(1) unsigned NOT NULL DEFAULT '1' COMMENT 'Показывать столбец Цена поставщика в AnalitF при включенном механизме отсрочки платежа',
  PRIMARY KEY (`Id`),
  KEY `FK_Users_ClientId` (`ClientId`),
  KEY `FK_Users_InheritPricesFrom` (`InheritPricesFrom`),
  KEY `FK_Users_ContactGroupId` (`ContactGroupId`),
  KEY `AccountingId` (`AccountingId`),
  KEY `FK_Users_PayerId` (`PayerId`),
  CONSTRAINT `FK_Users_ClientId` FOREIGN KEY (`ClientId`) REFERENCES `clients` (`Id`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `FK_Users_ContactGroupId` FOREIGN KEY (`ContactGroupId`) REFERENCES `contacts`.`contact_groups` (`Id`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `FK_Users_InheritPricesFrom` FOREIGN KEY (`InheritPricesFrom`) REFERENCES `users` (`Id`),
  CONSTRAINT `FK_Users_PayerId` FOREIGN KEY (`PayerId`) REFERENCES `billing`.`payers` (`PayerID`)
) ENGINE=InnoDB AUTO_INCREMENT=16456 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER Future.UserLogInsert AFTER INSERT ON Future.Users
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.UserLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 0,
		UserId = NEW.Id,
		ClientId = NEW.ClientId,
		Enabled = NEW.Enabled,
		Login = NEW.Login,
		Name = NEW.Name,
		SendRejects = NEW.SendRejects,
		SendWaybills = NEW.SendWaybills,
		SubmitOrders = NEW.SubmitOrders,
		EnableUpdate = NEW.EnableUpdate,
		Auditor = NEW.Auditor,
		InheritPricesFrom = NEW.InheritPricesFrom,
		Registrant = NEW.Registrant,
		ContactGroupId = NEW.ContactGroupId,
		RegistrationDate = NEW.RegistrationDate,
		WorkRegionMask = NEW.WorkRegionMask,
		OrderRegionMask = NEW.OrderRegionMask,
		AccountingId = NEW.AccountingId,
		PayerId = NEW.PayerId,
		SaveAFDataFiles = NEW.SaveAFDataFiles,
		TargetVersion = NEW.TargetVersion,
		UseAdjustmentOrders = NEW.UseAdjustmentOrders,
		PromoFileLimit = NEW.PromoFileLimit,
		RootService = NEW.RootService,
		AllowDownloadUnconfirmedOrders = NEW.AllowDownloadUnconfirmedOrders,
		ShowSupplierCost = NEW.ShowSupplierCost;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER Future.UserLogUpdate AFTER UPDATE ON Future.Users
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.UserLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 1,
		UserId = OLD.Id,
		ClientId = NULLIF(NEW.ClientId, OLD.ClientId),
		Enabled = NULLIF(NEW.Enabled, OLD.Enabled),
		Login = NULLIF(NEW.Login, OLD.Login),
		Name = NULLIF(NEW.Name, OLD.Name),
		SendRejects = NULLIF(NEW.SendRejects, OLD.SendRejects),
		SendWaybills = NULLIF(NEW.SendWaybills, OLD.SendWaybills),
		SubmitOrders = NULLIF(NEW.SubmitOrders, OLD.SubmitOrders),
		EnableUpdate = NULLIF(NEW.EnableUpdate, OLD.EnableUpdate),
		Auditor = NULLIF(NEW.Auditor, OLD.Auditor),
		InheritPricesFrom = NULLIF(NEW.InheritPricesFrom, OLD.InheritPricesFrom),
		Registrant = NULLIF(NEW.Registrant, OLD.Registrant),
		ContactGroupId = NULLIF(NEW.ContactGroupId, OLD.ContactGroupId),
		RegistrationDate = NULLIF(NEW.RegistrationDate, OLD.RegistrationDate),
		WorkRegionMask = NULLIF(NEW.WorkRegionMask, OLD.WorkRegionMask),
		OrderRegionMask = NULLIF(NEW.OrderRegionMask, OLD.OrderRegionMask),
		AccountingId = NULLIF(NEW.AccountingId, OLD.AccountingId),
		PayerId = NULLIF(NEW.PayerId, OLD.PayerId),
		SaveAFDataFiles = NULLIF(NEW.SaveAFDataFiles, OLD.SaveAFDataFiles),
		TargetVersion = NULLIF(NEW.TargetVersion, OLD.TargetVersion),
		UseAdjustmentOrders = NULLIF(NEW.UseAdjustmentOrders, OLD.UseAdjustmentOrders),
		PromoFileLimit = NULLIF(NEW.PromoFileLimit, OLD.PromoFileLimit),
		RootService = NULLIF(NEW.RootService, OLD.RootService),
		AllowDownloadUnconfirmedOrders = NULLIF(NEW.AllowDownloadUnconfirmedOrders, OLD.AllowDownloadUnconfirmedOrders),
		ShowSupplierCost = NULLIF(NEW.ShowSupplierCost, OLD.ShowSupplierCost);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER Future.UserLogDelete AFTER DELETE ON Future.Users
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.UserLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 2,
		UserId = OLD.Id,
		ClientId = OLD.ClientId,
		Enabled = OLD.Enabled,
		Login = OLD.Login,
		Name = OLD.Name,
		SendRejects = OLD.SendRejects,
		SendWaybills = OLD.SendWaybills,
		SubmitOrders = OLD.SubmitOrders,
		EnableUpdate = OLD.EnableUpdate,
		Auditor = OLD.Auditor,
		InheritPricesFrom = OLD.InheritPricesFrom,
		Registrant = OLD.Registrant,
		ContactGroupId = OLD.ContactGroupId,
		RegistrationDate = OLD.RegistrationDate,
		WorkRegionMask = OLD.WorkRegionMask,
		OrderRegionMask = OLD.OrderRegionMask,
		AccountingId = OLD.AccountingId,
		PayerId = OLD.PayerId,
		SaveAFDataFiles = OLD.SaveAFDataFiles,
		TargetVersion = OLD.TargetVersion,
		UseAdjustmentOrders = OLD.UseAdjustmentOrders,
		PromoFileLimit = OLD.PromoFileLimit,
		RootService = OLD.RootService,
		AllowDownloadUnconfirmedOrders = OLD.AllowDownloadUnconfirmedOrders,
		ShowSupplierCost = OLD.ShowSupplierCost;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `addressintersection`
--

DROP TABLE IF EXISTS `addressintersection`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `addressintersection` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `AddressId` int(10) unsigned NOT NULL,
  `IntersectionId` int(10) unsigned NOT NULL,
  `SupplierDeliveryId` varchar(200) DEFAULT NULL,
  `ControlMinReq` tinyint(1) unsigned NOT NULL DEFAULT '0' COMMENT 'Контролировать минимальный заказ\r\n0 - нет\r\n1 - да',
  `MinReq` int(10) unsigned DEFAULT NULL COMMENT 'Минимальная сумма заказа (в рублях)',
  PRIMARY KEY (`Id`),
  KEY `FK_AddressIntersection_AddressId` (`AddressId`),
  KEY `FK_AddressIntersection_IntersectionId` (`IntersectionId`),
  CONSTRAINT `FK_AddressIntersection_AddressId` FOREIGN KEY (`AddressId`) REFERENCES `addresses` (`Id`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `FK_AddressIntersection_IntersectionId` FOREIGN KEY (`IntersectionId`) REFERENCES `intersection` (`Id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=2749375 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER future.AddressintersectionLogInsert AFTER INSERT ON future.addressintersection
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.AddressintersectionLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 0,
		AddressintersectionId = NEW.Id,
		AddressId = NEW.AddressId,
		IntersectionId = NEW.IntersectionId,
		SupplierDeliveryId = NEW.SupplierDeliveryId,
		ControlMinReq = NEW.ControlMinReq,
		MinReq = NEW.MinReq;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER future.AddressintersectionLogUpdate AFTER UPDATE ON future.addressintersection
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.AddressintersectionLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 1,
		AddressintersectionId = OLD.Id,
		AddressId = NULLIF(NEW.AddressId, OLD.AddressId),
		IntersectionId = NULLIF(NEW.IntersectionId, OLD.IntersectionId),
		SupplierDeliveryId = NULLIF(NEW.SupplierDeliveryId, OLD.SupplierDeliveryId),
		ControlMinReq = NULLIF(NEW.ControlMinReq, OLD.ControlMinReq),
		MinReq = NULLIF(NEW.MinReq, OLD.MinReq);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER future.AddressintersectionLogDelete AFTER DELETE ON future.addressintersection
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.AddressintersectionLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 2,
		AddressintersectionId = OLD.Id,
		AddressId = OLD.AddressId,
		IntersectionId = OLD.IntersectionId,
		SupplierDeliveryId = OLD.SupplierDeliveryId,
		ControlMinReq = OLD.ControlMinReq,
		MinReq = OLD.MinReq;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `clienttoaddressmigrations`
--

DROP TABLE IF EXISTS `clienttoaddressmigrations`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `clienttoaddressmigrations` (
  `UserId` int(10) unsigned NOT NULL,
  `ClientCode` int(10) unsigned NOT NULL,
  `AddressId` int(10) unsigned NOT NULL,
  KEY `FK_ClientToAddressMigrations_UserId` (`UserId`),
  KEY `FK_ClientToAddressMigrations_AddressId` (`AddressId`),
  CONSTRAINT `FK_ClientToAddressMigrations_AddressId` FOREIGN KEY (`AddressId`) REFERENCES `addresses` (`Id`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `FK_ClientToAddressMigrations_UserId` FOREIGN KEY (`UserId`) REFERENCES `users` (`Id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `intersection`
--

DROP TABLE IF EXISTS `intersection`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `intersection` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `ClientId` int(10) unsigned NOT NULL,
  `RegionId` bigint(20) unsigned NOT NULL,
  `PriceId` int(10) unsigned NOT NULL,
  `LegalEntityId` int(10) unsigned NOT NULL DEFAULT '0',
  `CostId` int(10) unsigned DEFAULT NULL,
  `AvailableForClient` tinyint(1) unsigned NOT NULL DEFAULT '1',
  `AgencyEnabled` tinyint(1) unsigned NOT NULL DEFAULT '1' COMMENT 'Включен административно\r\n0 - выключен (тогда в клиентском интерфейсе этот прайс не будет показываться этому клиенту и этот поставщик не будет видеть этого клиента)\r\n1 - включен',
  `PriceMarkup` decimal(5,3) NOT NULL DEFAULT '0.000',
  `SupplierClientId` varchar(200) DEFAULT NULL,
  `SupplierPaymentId` varchar(200) DEFAULT NULL,
  `ControlMinReq` tinyint(1) unsigned NOT NULL DEFAULT '0',
  `MinReq` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`ClientId`,`RegionId`,`PriceId`,`LegalEntityId`) USING BTREE,
  UNIQUE KEY `Uniq` (`Id`),
  KEY `FK_Intersection_CostId` (`CostId`),
  KEY `FK_Intersection_LegalEntityId` (`LegalEntityId`),
  KEY `FK_Intersection_PriceId` (`PriceId`),
  KEY `FK_Intersection_RegionId` (`RegionId`),
  CONSTRAINT `FK_Intersection_ClientId` FOREIGN KEY (`ClientId`) REFERENCES `clients` (`Id`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `FK_Intersection_CostId` FOREIGN KEY (`CostId`) REFERENCES `usersettings`.`pricescosts` (`CostCode`) ON DELETE SET NULL ON UPDATE CASCADE,
  CONSTRAINT `FK_Intersection_LegalEntityId` FOREIGN KEY (`LegalEntityId`) REFERENCES `billing`.`legalentities` (`Id`),
  CONSTRAINT `FK_Intersection_PriceId` FOREIGN KEY (`PriceId`) REFERENCES `usersettings`.`pricesdata` (`PriceCode`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `FK_Intersection_RegionId` FOREIGN KEY (`RegionId`) REFERENCES `farm`.`regions` (`RegionCode`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=1744075 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER future.IntersectionAfterInsert
	AFTER INSERT
	ON future.Intersection
	FOR EACH ROW
BEGIN
  IF @Skip IS NULL OR @Skip <> 1 THEN

    INSERT
    INTO Future.AddressIntersection (IntersectionId, AddressId)
    SELECT
      NEW.Id, a.Id
    FROM
      Future.Clients c
      JOIN Future.Addresses a ON a.ClientId = c.Id
    WHERE
      c.Id = NEW.ClientId and a.LegalEntityId = NEW.LegalEntityId;

    INSERT
    INTO Future.UserPrices (UserId, PriceId, RegionId)
    SELECT
      u.Id, NEW.PriceId, NEW.RegionId
    FROM
      	Future.Clients c
      	join future.Users u ON u.ClientId = c.Id
		join Usersettings.RetClientsSet rcs on rcs.ClientCode = c.Id
      	left join Future.UserPrices up ON up.PriceId = NEW.PriceId
			AND up.RegionId = NEW.RegionId AND up.UserId = u.Id
    WHERE
      c.Id = NEW.ClientId AND up.UserId IS NULL and rcs.IgnoreNewPriceForUser = 0;

    INSERT
    INTO Usersettings.SupplierIntersection (SupplierId, ClientId)
    SELECT
      pd.FirmCode, NEW.ClientId
    FROM
      Usersettings.PricesData pd
      LEFT JOIN Usersettings.SupplierIntersection si ON si.SupplierId = pd.FirmCode AND si.ClientId = NEW.ClientId
    WHERE
      pd.PriceCode = NEW.PriceId AND si.Id IS NULL
    GROUP BY
      pd.FirmCode;

    insert into 
      usersettings.PriceIntersections (SupplierIntersectionId, PriceId)
    SELECT 
      si.Id, pd.PriceCode
    FROM 
      usersettings.PricesData pd 
      inner join usersettings.SupplierIntersection si on si.SupplierId = pd.FirmCode
      left join usersettings.PriceIntersections pi on pi.SupplierIntersectionId = si.Id and pi.PriceId = pd.PriceCode
    where
      pd.PriceCode = NEW.PriceId
      and si.ClientId = NEW.ClientId
      and pi.Id is null;

    insert into 
      usersettings.DelayOfPayments (PriceIntersectionId, DayOfWeek)
    SELECT 
      pi.Id, d.DayOfWeek
    FROM 
      (
      usersettings.PriceIntersections pi,
      usersettings.SupplierIntersection si,
    (
    select 'Monday' as DayOfWeek
    union
    select 'Tuesday' 
    union
    select 'Wednesday' 
    union
    select 'Thursday' 
    union
    select 'Friday' 
    union
    select 'Saturday' 
    union
    select 'Sunday' 
    ) d  
      )
      left join usersettings.DelayOfPayments dop on dop.PriceIntersectionId = pi.Id and dop.DayOfWeek = convert(d.DayOfWeek using cp1251)
    where
      pi.PriceId = NEW.PriceId
      and si.Id = pi.SupplierIntersectionId
      and si.ClientId = NEW.ClientId
      and dop.Id is null;

  END IF;

  INSERT
  INTO `logs`.IntersectionLogs
  SET
    LogTime = NOW(),
	OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(), '@', 1)),
	OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(), '@', -1)),
	Operation = 0,
	IntersectionId = NEW.Id,
	ClientId = NEW.ClientId,
	RegionId = NEW.RegionId,
	PriceId = NEW.PriceId,
	LegalEntityId = NEW.LegalEntityId,
	CostId = NEW.CostId,
	AvailableForClient = NEW.AvailableForClient,
	AgencyEnabled = NEW.AgencyEnabled,
	PriceMarkup = NEW.PriceMarkup,
	SupplierClientId = NEW.SupplierClientId,
	SupplierPaymentId = NEW.SupplierPaymentId;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER Future.IntersectionBeforeUpdate BEFORE UPDATE ON Future.Intersection FOR EACH ROW
BEGIN

	update Usersettings.AnalitFReplicationInfo ar
		join Usersettings.PricesData pd on pd.FirmCode = ar.FirmCode
		join Future.Users u on ar.UserId = u.Id
			join Future.Clients c on u.ClientId = c.Id
	set ar.ForceReplication = 1
	where c.Id = OLD.ClientId and pd.PriceCode = OLD.PriceId;

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER future.IntersectionLogUpdate
	AFTER UPDATE
	ON future.intersection
	FOR EACH ROW
BEGIN
  IF @INUser != 'ProcessingSVC' THEN
  INSERT INTO `logs`.IntersectionLogs
  SET
    LogTime = now(), OperatorName = ifnull(@INUser, substring_index(user(), '@', 1)), OperatorHost = ifnull(@INHost, substring_index(user(), '@', -1)), Operation = 1, IntersectionId = OLD.Id, ClientId = nullif(NEW.ClientId, OLD.ClientId), RegionId = nullif(NEW.RegionId, OLD.RegionId), PriceId = nullif(NEW.PriceId, OLD.PriceId), LegalEntityId = nullif(NEW.LegalEntityId, OLD.LegalEntityId), CostId = nullif(NEW.CostId, OLD.CostId), AvailableForClient = nullif(NEW.AvailableForClient, OLD.AvailableForClient), AgencyEnabled = nullif(NEW.AgencyEnabled, OLD.AgencyEnabled), PriceMarkup = nullif(NEW.PriceMarkup, OLD.PriceMarkup), SupplierClientId = nullif(NEW.SupplierClientId, OLD.SupplierClientId), SupplierPaymentId = nullif(NEW.SupplierPaymentId, OLD.SupplierPaymentId);
END IF;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER future.IntersectionLogDelete AFTER DELETE ON future.Intersection
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.IntersectionLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 2,
		IntersectionId = OLD.Id,
		ClientId = OLD.ClientId,
		RegionId = OLD.RegionId,
		PriceId = OLD.PriceId,
		LegalEntityId = OLD.LegalEntityId,
		CostId = OLD.CostId,
		AvailableForClient = OLD.AvailableForClient,
		AgencyEnabled = OLD.AgencyEnabled,
		PriceMarkup = OLD.PriceMarkup,
		SupplierClientId = OLD.SupplierClientId,
		SupplierPaymentId = OLD.SupplierPaymentId;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `orderswap`
--

DROP TABLE IF EXISTS `orderswap`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `orderswap` (
  `SupplierId` int(10) unsigned NOT NULL,
  `ClientId` int(10) unsigned NOT NULL,
  `SwapFirmCode` tinyint(1) NOT NULL DEFAULT '0',
  PRIMARY KEY (`SupplierId`,`ClientId`),
  KEY `FK_OrderSwap_ClientId` (`ClientId`),
  CONSTRAINT `FK_OrderSwap_ClientId` FOREIGN KEY (`ClientId`) REFERENCES `clients` (`Id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `services`
--

DROP TABLE IF EXISTS `services`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `services` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `Type` int(11) NOT NULL DEFAULT '0',
  `Name` varchar(255) DEFAULT NULL,
  `Disabled` tinyint(1) NOT NULL DEFAULT '0',
  `HomeRegion` bigint(20) unsigned DEFAULT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=12486 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `showusers`
--

DROP TABLE IF EXISTS `showusers`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `showusers` (
  `PrimaryUserId` int(10) unsigned NOT NULL,
  `ShowUserId` int(10) unsigned NOT NULL,
  PRIMARY KEY (`PrimaryUserId`,`ShowUserId`),
  KEY `FK_Users_ShowUserId` (`ShowUserId`),
  CONSTRAINT `FK_Users_PrimaryUserId` FOREIGN KEY (`PrimaryUserId`) REFERENCES `users` (`Id`) ON DELETE CASCADE,
  CONSTRAINT `FK_Users_ShowUserId` FOREIGN KEY (`ShowUserId`) REFERENCES `users` (`Id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER Future.ShowUserLogInsert AFTER INSERT ON Future.ShowUsers
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.ShowUserLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 0,
		PrimaryUserId = NEW.PrimaryUserId,
		ShowUserId = NEW.ShowUserId;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER Future.ShowUserLogUpdate AFTER UPDATE ON Future.ShowUsers
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.ShowUserLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 1,
		PrimaryUserId = NULLIF(NEW.PrimaryUserId, OLD.PrimaryUserId),
		ShowUserId = NULLIF(NEW.ShowUserId, OLD.ShowUserId);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER Future.ShowUserLogDelete AFTER DELETE ON Future.ShowUsers
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.ShowUserLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 2,
		PrimaryUserId = OLD.PrimaryUserId,
		ShowUserId = OLD.ShowUserId;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `useraddresses`
--

DROP TABLE IF EXISTS `useraddresses`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `useraddresses` (
  `UserId` int(10) unsigned NOT NULL,
  `AddressId` int(10) unsigned NOT NULL,
  PRIMARY KEY (`UserId`,`AddressId`),
  KEY `FK_UserAddresses_AddressId` (`AddressId`),
  CONSTRAINT `FK_UserAddresses_AddressId` FOREIGN KEY (`AddressId`) REFERENCES `addresses` (`Id`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `FK_UserAddresses_UserId` FOREIGN KEY (`UserId`) REFERENCES `users` (`Id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER UserAddressLogInsert AFTER INSERT ON Future.UserAddresses
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.UserAddressLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 0,
		UserId = NEW.UserId,
		AddressId = NEW.AddressId;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER UserAddressLogUpdate AFTER UPDATE ON Future.UserAddresses
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.UserAddressLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 1,
		UserId = NULLIF(NEW.UserId, OLD.UserId),
		AddressId = NULLIF(NEW.AddressId, OLD.AddressId);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER UserAddressLogDelete AFTER DELETE ON Future.UserAddresses
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.UserAddressLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 2,
		UserId = OLD.UserId,
		AddressId = OLD.AddressId;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `userprices`
--

DROP TABLE IF EXISTS `userprices`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `userprices` (
  `UserId` int(10) unsigned NOT NULL,
  `PriceId` int(10) unsigned NOT NULL,
  `RegionId` bigint(20) unsigned NOT NULL,
  PRIMARY KEY (`UserId`,`PriceId`,`RegionId`),
  KEY `FK_UserPrices_PriceId` (`PriceId`),
  KEY `FK_UserPrices_RegionId` (`RegionId`),
  CONSTRAINT `FK_UserPrices_PriceId` FOREIGN KEY (`PriceId`) REFERENCES `usersettings`.`pricesdata` (`PriceCode`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `FK_UserPrices_RegionId` FOREIGN KEY (`RegionId`) REFERENCES `farm`.`regions` (`RegionCode`) ON DELETE CASCADE,
  CONSTRAINT `FK_UserPrices_UserId` FOREIGN KEY (`UserId`) REFERENCES `users` (`Id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER `future`.`UserPricesBeforeInsert`
BEFORE INSERT ON `future`.`userprices`
FOR EACH ROW
BEGIN

	update 
		Usersettings.AnalitFReplicationInfo ar
		join Usersettings.PricesData pd on pd.FirmCode = ar.FirmCode
	set ForceReplication = 1
	where ar.UserId = NEW.UserId and pd.PriceCode = NEW.PriceId;

	update 
		future.Users u
		join Usersettings.AnalitFReplicationInfo ar on ar.UserId = u.Id
		join Usersettings.PricesData pd on pd.FirmCode = ar.FirmCode and pd.PriceCode = NEW.PriceId
	set ForceReplication = 1
	where 
		u.InheritPricesFrom = NEW.UserId;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER UserPriceLogInsert AFTER INSERT ON Future.UserPrices
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.UserPriceLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 0,
		UserId = NEW.UserId,
		PriceId = NEW.PriceId,
		RegionId = NEW.RegionId;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER UserPriceLogUpdate AFTER UPDATE ON Future.UserPrices
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.UserPriceLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 1,
		UserId = NULLIF(NEW.UserId, OLD.UserId),
		PriceId = NULLIF(NEW.PriceId, OLD.PriceId),
		RegionId = NULLIF(NEW.RegionId, OLD.RegionId);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER `future`.`UserPricesBeforeDelete`
BEFORE DELETE ON `future`.`userprices`
FOR EACH ROW
BEGIN

	update 
		Usersettings.AnalitFReplicationInfo ar
		join Usersettings.PricesData pd on pd.FirmCode = ar.FirmCode
	set ForceReplication = 1
	where ar.UserId = OLD.UserId and pd.PriceCode = OLD.PriceId;

	update 
		future.Users u
		join Usersettings.AnalitFReplicationInfo ar on ar.UserId = u.Id
		join Usersettings.PricesData pd on pd.FirmCode = ar.FirmCode and pd.PriceCode = OLD.PriceId
	set ForceReplication = 1
	where 
		u.InheritPricesFrom = OLD.UserId;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER UserPriceLogDelete AFTER DELETE ON Future.UserPrices
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.UserPriceLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 2,
		UserId = OLD.UserId,
		PriceId = OLD.PriceId,
		RegionId = OLD.RegionId;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Dumping events for database 'future'
--

--
-- Dumping routines for database 'future'
--
/*!50003 DROP PROCEDURE IF EXISTS `AFGetActivePrices` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50020 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 PROCEDURE `AFGetActivePrices`(IN UserIdParam INT UNSIGNED)
BEGIN

Declare TabelExsists Bool DEFAULT false;
Declare TablePricesExists Bool default false;
DECLARE CONTINUE HANDLER FOR 1146
begin
  if not TablePricesExists then
    Call Future.GetPrices(UserIdParam);
  else
    resignal;
  end if;
end;

if not TabelExsists then
DROP TEMPORARY TABLE IF EXISTS Usersettings.ActivePrices;
create temporary table
Usersettings.ActivePrices
(
 FirmCode int Unsigned,
 PriceCode int Unsigned,
 CostCode int Unsigned,
 PriceSynonymCode int Unsigned,
 RegionCode BigInt Unsigned,
 Fresh bool,
 Upcost decimal(7,5),
 MaxSynonymCode Int Unsigned,
 MaxSynonymFirmCrCode Int Unsigned,
 CostType bool,
 PriceDate DateTime,
 ShowPriceName bool,
 PriceName VarChar(50),
 PositionCount int Unsigned,
 MinReq mediumint Unsigned,
 FirmCategory tinyint unsigned,
 MainFirm bool,
 unique (PriceCode, RegionCode, CostCode),
 index  (CostCode, PriceCode),
 index  (PriceSynonymCode),
 index  (MaxSynonymCode),
 index  (PriceCode),
 index  (MaxSynonymFirmCrCode)
 )engine=MEMORY
 ;
set TabelExsists=true;
end if;

select null from Usersettings.Prices limit 0;
if not TablePricesExists then
  set TablePricesExists = true;
end if;

INSERT
INTO Usersettings.ActivePrices(
 FirmCode,
 PriceCode,
 CostCode,
 PriceSynonymCode,
 RegionCode,
 Fresh,
 Upcost,
 MaxSynonymCode,
 MaxSynonymFirmCrCode,
 CostType,
 PriceDate,
 ShowPriceName,
 PriceName,
 PositionCount,
 MinReq,
 FirmCategory,
 MainFirm)
SELECT P.FirmCode,
       P.PriceCode,
       P.CostCode,
       P.PriceSynonymCode,
       P.RegionCode,
       RI.ForceReplication !=0,
       P.Upcost,
       RI.MaxSynonymCode,
       RI.MaxSynonymFirmCrCode,
       P.CostType,
       P.PriceDate,
       P.ShowPriceName,
       P.PriceName,
       P.PositionCount,
       P.MinReq,
       P.FirmCategory,
       P.MainFirm
FROM 
  Usersettings.Prices P
  join Usersettings.CurrentReplicationInfo RI on RI.FirmCode = P.FirmCode
WHERE  p.Actual = 1
  and p.DisabledByClient = 0
  and RI.UserId = UserIdParam;

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `BaseGetPrices` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50020 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 PROCEDURE `BaseGetPrices`(IN UserIdParam INT UNSIGNED, IN AddressIdParam INT UNSIGNED)
BEGIN

set @currentDay = usersettings.CurrentDayOfWeek();
drop temporary table IF EXISTS Future.BasePrices;
create temporary table
Future.BasePrices
(
 FirmCode int Unsigned,
 PriceCode int Unsigned,
 CostCode int Unsigned,
 PriceSynonymCode int Unsigned,
 RegionCode BigInt Unsigned,
 DelayOfPayment decimal(5,3),
 DisabledByClient bool,
 Upcost decimal(7,5),
 Actual bool,
 CostType bool,
 PriceDate DateTime,
 ShowPriceName bool,
 PriceName VarChar(50),
 PositionCount int Unsigned,
 MinReq mediumint,
 ControlMinReq int Unsigned,
 AllowOrder bool,
 ShortName varchar(50),
 FirmCategory tinyint unsigned,
 MainFirm bool,
 Storage bool,
 VitallyImportantDelay decimal(5,3),
 OtherDelay decimal(5,3),
 index (PriceCode),
 index (RegionCode)
)engine = MEMORY;

INSERT
INTO    Future.BasePrices
SELECT  pd.firmcode,
        i.PriceId,
        pc.CostCode,
        ifnull(pd.ParentSynonym, pd.pricecode) PriceSynonymCode,
        i.RegionId,
        0 as DelayOfPayment,
        if(up.PriceId is null, 1, 0),
        round((1 + pd.UpCost / 100) * (1 + prd.UpCost / 100) * (1 + i.PriceMarkup / 100), 5),
        (to_seconds(now()) - to_seconds(pi.PriceDate)) < (f.maxold * 86400),
        pd.CostType,
        pi.PriceDate,
        r.ShowPriceName,
        pd.PriceName,
        pi.RowCount,
        if(ai.Id is not null, if (ai.MinReq > 0, ai.MinReq, prd.MinReq), prd.MinReq),
        if(ai.Id is not null, if (ai.ControlMinReq, 1, 0), 0),
        (r.OrderRegionMask & i.RegionId & u.OrderRegionMask) > 0,
        supplier.Name as ShortName,
        si.SupplierCategory,
        si.SupplierCategory >= r.BaseFirmCategory,
        Storage,
        dop.VitallyImportantDelay,
        dop.OtherDelay
FROM Future.Users u
  join Future.Intersection i on i.ClientId = u.ClientId and i.AgencyEnabled = 1
  join Future.Addresses adr on adr.Id = AddressIdParam
  join Future.Intersection IByAdr 
    on 
             IByAdr.ClientId = adr.ClientId 
       and IByAdr.RegionId = i.RegionId 
       and IByAdr.PriceId = I.PriceId 
       and IByAdr.LegalEntityId = Adr.LegalEntityId 
       and IByAdr.AgencyEnabled = 1 
       and IByAdr.AvailableForClient = 1
  JOIN Future.AddressIntersection ai ON ai.IntersectionId = IByAdr.Id AND ai.addressid = adr.Id
  JOIN Future.Clients drugstore ON drugstore.Id = i.ClientId
  JOIN usersettings.RetClientsSet r ON r.clientcode = drugstore.Id
  JOIN usersettings.PricesData pd ON pd.pricecode = i.PriceId
    join usersettings.SupplierIntersection si on si.SupplierId = pd.FirmCode and i.ClientId = si.ClientId
    join usersettings.PriceIntersections pinter on pinter.SupplierIntersectionId = si.Id and pinter.PriceId = pd.PriceCode
    join usersettings.DelayOfPayments dop on dop.PriceIntersectionId = pinter.Id and dop.DayOfWeek = @currentDay
  JOIN usersettings.PricesCosts pc on pc.PriceCode = i.PriceId and ((r.InvisibleOnFirm > 0 and pc.BaseCost = 1) or (r.InvisibleOnFirm = 0 and pc.CostCode = i.CostId))
    JOIN usersettings.PriceItems pi on pi.Id = pc.PriceItemId
    JOIN farm.FormRules f on f.Id = pi.FormRuleId
    JOIN Future.Suppliers supplier ON supplier.Id = pd.firmcode
    JOIN usersettings.PricesRegionalData prd ON prd.regioncode = i.RegionId AND prd.pricecode = pd.pricecode
    JOIN usersettings.RegionalData rd ON rd.RegionCode = i.RegionId AND rd.FirmCode = pd.firmcode
  left join future.UserPrices up on up.PriceId = i.PriceId and up.UserId = ifnull(u.InheritPricesFrom, u.Id) and up.RegionId = i.RegionId
WHERE   supplier.Disabled = 0
    and (supplier.RegionMask & i.RegionId) > 0
    AND (drugstore.maskregion & i.RegionId & u.WorkRegionMask) > 0
    AND (r.WorkRegionMask & i.RegionId) > 0
    AND pd.agencyenabled = 1
    AND pd.enabled = 1
    AND pd.pricetype <> 1
    AND prd.enabled = 1
    AND if(not r.ServiceClient, supplier.Id != 234, 1)
    and i.AvailableForClient = 1
    AND u.Id = UserIdParam
group by PriceId, RegionId;

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetActivePrices` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50020 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 PROCEDURE `GetActivePrices`(IN UserIdParam INT UNSIGNED)
BEGIN

Declare TabelExsists Bool DEFAULT false;
DECLARE CONTINUE HANDLER FOR 1146
begin
  Call Future.GetPrices(UserIdParam);
end;

if not TabelExsists then
DROP TEMPORARY TABLE IF EXISTS Usersettings.ActivePrices;
create temporary table
Usersettings.ActivePrices
(
 FirmCode int Unsigned,
 PriceCode int Unsigned,
 CostCode int Unsigned,
 PriceSynonymCode int Unsigned,
 RegionCode BigInt Unsigned,
 Fresh bool,
 DelayOfPayment decimal(5,3),
 Upcost decimal(7,5),
 MaxSynonymCode Int Unsigned,
 MaxSynonymFirmCrCode Int Unsigned,
 CostType bool,
 PriceDate DateTime,
 ShowPriceName bool,
 PriceName VarChar(50),
 PositionCount int Unsigned,
 MinReq mediumint Unsigned,
 FirmCategory tinyint unsigned,
 MainFirm bool,
 VitallyImportantDelay decimal(5,3),
 OtherDelay decimal(5,3),
 unique (PriceCode, RegionCode, CostCode),
 index  (CostCode, PriceCode),
 index  (PriceSynonymCode),
 index  (MaxSynonymCode),
 index  (PriceCode),
 index  (MaxSynonymFirmCrCode)
 )engine=MEMORY
 ;
set TabelExsists=true;
end if;

select null from Usersettings.Prices limit 0;

INSERT
INTO Usersettings.ActivePrices(
 FirmCode,
 PriceCode,
 CostCode,
 PriceSynonymCode,
 RegionCode,
 Fresh,
 DelayOfPayment,
 Upcost,
 MaxSynonymCode,
 MaxSynonymFirmCrCode,
 CostType,
 PriceDate,
 ShowPriceName,
 PriceName,
 PositionCount,
 MinReq,
 FirmCategory,
 MainFirm,
 VitallyImportantDelay,
 OtherDelay
)
SELECT P.FirmCode,
       P.PriceCode,
       P.CostCode,
       P.PriceSynonymCode,
       P.RegionCode,
       1,
       p.DelayOfPayment,
       P.Upcost,
       0,
       0,
       P.CostType,
       P.PriceDate,
       P.ShowPriceName,
       P.PriceName,
       P.PositionCount,
       P.MinReq,
       P.FirmCategory,
       P.MainFirm,
       P.VitallyImportantDelay,
       P.OtherDelay
FROM Usersettings.Prices P
WHERE p.DisabledByClient = 0
  and p.Actual = 1;

drop temporary table IF EXISTS Usersettings.Prices;

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetActivePricesForAddress` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50020 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 PROCEDURE `GetActivePricesForAddress`(IN UserIdParam INT UNSIGNED, IN AddressIdParam INT UNSIGNED)
BEGIN

Declare TabelExsists Bool DEFAULT false;
DECLARE CONTINUE HANDLER FOR 1146
begin
  Call Future.GetPricesForAddress(UserIdParam, AddressIdParam);
end;

if not TabelExsists then
DROP TEMPORARY TABLE IF EXISTS Usersettings.ActivePrices;
create temporary table
Usersettings.ActivePrices
(
 FirmCode int Unsigned,
 PriceCode int Unsigned,
 CostCode int Unsigned,
 PriceSynonymCode int Unsigned,
 RegionCode BigInt Unsigned,
 Fresh bool,
 DelayOfPayment decimal(5,3),
 Upcost decimal(7,5),
 MaxSynonymCode Int Unsigned,
 MaxSynonymFirmCrCode Int Unsigned,
 CostType bool,
 PriceDate DateTime,
 ShowPriceName bool,
 PriceName VarChar(50),
 PositionCount int Unsigned,
 MinReq mediumint Unsigned,
 FirmCategory tinyint unsigned,
 MainFirm bool,
 VitallyImportantDelay decimal(5,3),
 OtherDelay decimal(5,3),
 unique (PriceCode, RegionCode, CostCode),
 index  (CostCode, PriceCode),
 index  (PriceSynonymCode),
 index  (MaxSynonymCode),
 index  (PriceCode),
 index  (MaxSynonymFirmCrCode)
 )engine=MEMORY
 ;
set TabelExsists=true;
end if;

select null from Usersettings.Prices limit 0;

INSERT
INTO Usersettings.ActivePrices(
 FirmCode,
 PriceCode,
 CostCode,
 PriceSynonymCode,
 RegionCode,
 Fresh,
 DelayOfPayment,
 Upcost,
 MaxSynonymCode,
 MaxSynonymFirmCrCode,
 CostType,
 PriceDate,
 ShowPriceName,
 PriceName,
 PositionCount,
 MinReq,
 FirmCategory,
 MainFirm,
 VitallyImportantDelay,
 OtherDelay
)
SELECT P.FirmCode,
       P.PriceCode,
       P.CostCode,
       P.PriceSynonymCode,
       P.RegionCode,
       1,
       p.DelayOfPayment,
       P.Upcost,
       0,
       0,
       P.CostType,
       P.PriceDate,
       P.ShowPriceName,
       P.PriceName,
       P.PositionCount,
       P.MinReq,
       P.FirmCategory,
       P.MainFirm,
       P.VitallyImportantDelay,
       P.OtherDelay
FROM Usersettings.Prices P
WHERE p.DisabledByClient = 0
  and p.Actual = 1;

drop temporary table IF EXISTS Usersettings.Prices;

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetOffers` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50020 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 PROCEDURE `GetOffers`(IN UserIdParam INT UNSIGNED)
BEGIN

Declare TableExsists Bool DEFAULT false;
DECLARE CONTINUE HANDLER FOR 1146
if not TableExsists then
call Future.GetActivePrices(UserIdParam);
set TableExsists=true;
end if;
SELECT NULL FROM Usersettings.ActivePrices limit 0;

DROP TEMPORARY TABLE IF EXISTS Usersettings.Core, Usersettings.MinCosts;

CREATE TEMPORARY TABLE Usersettings.Core (
PriceCode INT unsigned,
RegionCode bigint unsigned,
ProductId INT unsigned,
Cost DECIMAL(8,2) unsigned,
CryptCost VARCHAR(32) NOT NULL,
id bigint unsigned,
INDEX (id),
INDEX (PriceCode),
INDEX (ProductId),
INDEX (ProductId, RegionCode, Cost),
INDEX (RegionCode, id)
)engine=MEMORY ;

CREATE TEMPORARY TABLE Usersettings.MinCosts (
MinCost DECIMAL(8,2) unsigned,
ProductId INT unsigned,
regionCode bigint unsigned,
PriceCode INT unsigned,
id bigint unsigned,
UNIQUE  MultiK(ProductId, RegionCode, MinCost),
INDEX (id)
)engine=MEMORY;

INSERT
INTO    Usersettings.Core
SELECT
        straight_join
        Prices.PriceCode,
        Prices.RegionCode,
        c.ProductId,
        if(if(round(cc.Cost * Prices.Upcost, 2) < MinBoundCost, MinBoundCost, round(cc.Cost * Prices.Upcost, 2)) > MaxBoundCost,
        MaxBoundCost, if(round(cc.Cost*Prices.UpCost,2) < MinBoundCost, MinBoundCost, round(cc.Cost * Prices.Upcost, 2))),
        '',
        c.id
FROM Usersettings.ActivePrices Prices
  JOIN farm.core0 c on c.PriceCode = Prices.PriceCode
    JOIN farm.CoreCosts cc on cc.Core_Id = c.Id and cc.PC_CostCode = Prices.CostCode;

Delete from Usersettings.Core where Cost < 0.01;

if (select FirmCodeOnly from Usersettings.retclientsset join future.Users on Users.ClientId = retclientsset.ClientCode where Users.Id = UserIdParam) is not null then

  update
    Future.Users
    inner join Usersettings.retclientsset on RetClientsSet.clientcode = Users.ClientId
    inner join Usersettings.pricesdata on pricesdata.FirmCode != RetClientsSet.FirmCodeOnly
    inner join Usersettings.core on Core.PriceCode = PricesData.PriceCode
  set
    core.cost = (1 + (rand() * if(rand() > 0.5, 2, - 2)/100)) * core.cost
  where
    Users.Id = UserIdParam;

end if;

INSERT INTO Usersettings.MinCosts(MinCost, ProductId, RegionCode)
SELECT
        min(Cost),
        ProductId,
        RegionCode
FROM Usersettings.Core
GROUP BY ProductId, RegionCode;

UPDATE Usersettings.MinCosts, Usersettings.Core
SET MinCosts.ID = Core.ID,
    MinCosts.PriceCode = Core.PriceCode
WHERE Core.ProductId = MinCosts.ProductId
      and Core.RegionCode = MinCosts.RegionCode
      and Core.Cost = MinCosts.MinCost;

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetOffersReports` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50020 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 PROCEDURE `GetOffersReports`(IN UserIdParam INT UNSIGNED, IN NoiseFirmCode INT UNSIGNED)
BEGIN

Declare TableExsists Bool DEFAULT false;
Declare FCO INT UNSIGNED DEFAULT 0;
DECLARE CONTINUE HANDLER FOR 1146
if not TableExsists then
call Future.GetActivePrices(UserIdParam);
set TableExsists=true;
end if;
SELECT NULL FROM Usersettings.ActivePrices limit 0;

DROP TEMPORARY TABLE IF EXISTS Usersettings.Core, Usersettings.MinCosts;

CREATE TEMPORARY TABLE Usersettings.Core (
PriceCode INT unsigned,
RegionCode bigint unsigned,
ProductId INT unsigned,
Cost DECIMAL(8,2) unsigned,
CryptCost VARCHAR(32) NOT NULL,
id bigint unsigned,
INDEX (id),
INDEX (PriceCode),
INDEX (ProductId),
INDEX (ProductId, RegionCode, Cost),
INDEX (RegionCode, id)
)engine=MEMORY ;

CREATE TEMPORARY TABLE Usersettings.MinCosts (
MinCost DECIMAL(8,2) unsigned,
ProductId INT unsigned,
regionCode bigint unsigned,
PriceCode INT unsigned,
id bigint unsigned,
UNIQUE  MultiK(ProductId, RegionCode, MinCost),
INDEX (id)
)engine=MEMORY;

INSERT
INTO    Usersettings.Core
SELECT
        straight_join
        Prices.PriceCode,
        Prices.RegionCode,
        c.ProductId,
        if(if(round(cc.Cost * Prices.Upcost, 2) < MinBoundCost, MinBoundCost, round(cc.Cost * Prices.Upcost, 2)) > MaxBoundCost,
        MaxBoundCost, if(round(cc.Cost*Prices.UpCost,2) < MinBoundCost, MinBoundCost, round(cc.Cost * Prices.Upcost, 2))),
        '',
        c.id
FROM Usersettings.ActivePrices Prices
  JOIN farm.core0 c on c.PriceCode = Prices.PriceCode
    JOIN farm.CoreCosts cc on cc.Core_Id = c.Id and cc.PC_CostCode = Prices.CostCode;

Delete from Usersettings.Core where Cost < 0.01;


if ((select FirmCodeOnly from Usersettings.retclientsset join future.Users on Users.ClientId = retclientsset.ClientCode where Users.Id = UserIdParam) is not null) or (NoiseFirmCode is not null) then

if (NoiseFirmCode is not null) then
Select NoiseFirmCode INTO FCO;
ELSE
   select retclientsset.FirmCodeOnly from Usersettings.retclientsset
    join future.Users on Users.ClientId = retclientsset.ClientCode
    where Users.Id = UserIdParam into FCO;
end if;

  update    
    Usersettings.core 
    inner join Usersettings.pricesdata on Core.PriceCode = PricesData.PriceCode and pricesdata.FirmCode != FCO    
  set
    core.cost = (1 + (rand() * if(rand() > 0.5, 2, - 2)/100)) * core.cost;
  
end if;

INSERT INTO Usersettings.MinCosts(MinCost, ProductId, RegionCode)
SELECT
        min(Cost),
        ProductId,
        RegionCode
FROM Usersettings.Core
GROUP BY ProductId, RegionCode;

UPDATE Usersettings.MinCosts, Usersettings.Core
SET MinCosts.ID = Core.ID,
    MinCosts.PriceCode = Core.PriceCode
WHERE Core.ProductId = MinCosts.ProductId
      and Core.RegionCode = MinCosts.RegionCode
      and Core.Cost = MinCosts.MinCost;

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetPrices` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50020 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 PROCEDURE `GetPrices`(IN UserIdParam INT UNSIGNED)
BEGIN

set @currentDay = usersettings.CurrentDayOfWeek();
drop temporary table IF EXISTS Usersettings.Prices;
create temporary table
Usersettings.Prices
(
 FirmCode int Unsigned,
 PriceCode int Unsigned,
 CostCode int Unsigned,
 PriceSynonymCode int Unsigned,
 RegionCode BigInt Unsigned,
 DelayOfPayment decimal(5,3),
 DisabledByClient bool,
 Upcost decimal(7,5),
 Actual bool,
 CostType bool,
 PriceDate DateTime,
 ShowPriceName bool,
 PriceName VarChar(50),
 PositionCount int Unsigned,
 MinReq mediumint Unsigned,
 ControlMinReq bool,
 AllowOrder bool,
 ShortName varchar(50),
 FirmCategory tinyint unsigned,
 MainFirm bool,
 Storage bool,
 VitallyImportantDelay decimal(5,3),
 OtherDelay decimal(5,3),
 index (PriceCode),
 index (RegionCode)
)engine = MEMORY;

INSERT
INTO    Usersettings.Prices
SELECT  pd.firmcode,
        i.PriceId,
        pc.CostCode,
        ifnull(pd.ParentSynonym, pd.pricecode) PriceSynonymCode,
        i.RegionId,
        0 as DelayOfPayment,
        if(up.PriceId is null, 1, 0),
        round((1 + pd.UpCost / 100) * (1 + prd.UpCost / 100) * (1 + i.PriceMarkup / 100), 5),
        (to_seconds(now()) - to_seconds(pi.PriceDate)) < (f.maxold * 86400),
        pd.CostType,
        pi.PriceDate,
        r.ShowPriceName,
        pd.PriceName,
        pi.RowCount,
        prd.MinReq,
        0,
        (r.OrderRegionMask & i.RegionId & u.OrderRegionMask) > 0,
        supplier.Name as ShortName,
        si.SupplierCategory,
        si.SupplierCategory >= r.BaseFirmCategory,
        Storage,
        dop.VitallyImportantDelay,
        dop.OtherDelay
FROM Future.Users u
  join Future.Intersection i on i.ClientId = u.ClientId and i.AgencyEnabled = 1
  JOIN Future.Clients drugstore ON drugstore.Id = i.ClientId
  JOIN usersettings.RetClientsSet r ON r.clientcode = drugstore.Id
  JOIN usersettings.PricesData pd ON pd.pricecode = i.PriceId
    join usersettings.SupplierIntersection si on si.SupplierId = pd.FirmCode and i.ClientId = si.ClientId
    join usersettings.PriceIntersections pinter on pinter.SupplierIntersectionId = si.Id and pinter.PriceId = pd.PriceCode
    join usersettings.DelayOfPayments dop on dop.PriceIntersectionId = pinter.Id and dop.DayOfWeek = @currentDay
  JOIN usersettings.PricesCosts pc on pc.PriceCode = i.PriceId and ((r.InvisibleOnFirm > 0 and pc.BaseCost = 1) or (r.InvisibleOnFirm = 0 and pc.CostCode = i.CostId))
    JOIN usersettings.PriceItems pi on pi.Id = pc.PriceItemId
    JOIN farm.FormRules f on f.Id = pi.FormRuleId
    JOIN Future.Suppliers supplier ON supplier.Id = pd.firmcode
    JOIN usersettings.PricesRegionalData prd ON prd.regioncode = i.RegionId AND prd.pricecode = pd.pricecode
    JOIN usersettings.RegionalData rd ON rd.RegionCode = i.RegionId AND rd.FirmCode = pd.firmcode
  left join future.UserPrices up on up.PriceId = i.PriceId and up.UserId = ifnull(u.InheritPricesFrom, u.Id) and up.RegionId = i.RegionId
WHERE   supplier.Disabled = 0
    and (supplier.RegionMask & i.RegionId) > 0
    AND (drugstore.maskregion & i.RegionId & u.WorkRegionMask) > 0
    AND (r.WorkRegionMask & i.RegionId) > 0
    AND pd.agencyenabled = 1
    AND pd.enabled = 1
    AND pd.pricetype <> 1
    AND prd.enabled = 1
    AND if(not r.ServiceClient, supplier.Id != 234, 1)
    and i.AvailableForClient = 1
    AND u.Id = UserIdParam
group by PriceId, RegionId;

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetPricesForAddress` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50020 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 PROCEDURE `GetPricesForAddress`(IN UserIdParam INT UNSIGNED, IN AddressIdParam INT UNSIGNED)
BEGIN

CALL Future.BaseGetPrices(UserIdParam, AddressIdParam);

drop temporary table IF EXISTS Usersettings.Prices;
create temporary table
Usersettings.Prices
(
 FirmCode int Unsigned,
 PriceCode int Unsigned,
 CostCode int Unsigned,
 PriceSynonymCode int Unsigned,
 RegionCode BigInt Unsigned,
 DelayOfPayment decimal(5,3),
 DisabledByClient bool,
 Upcost decimal(7,5),
 Actual bool,
 CostType bool,
 PriceDate DateTime,
 ShowPriceName bool,
 PriceName VarChar(50),
 PositionCount int Unsigned,
 MinReq mediumint Unsigned,
 ControlMinReq bool,
 AllowOrder bool,
 ShortName varchar(50),
 FirmCategory tinyint unsigned,
 MainFirm bool,
 Storage bool,
 VitallyImportantDelay decimal(5,3),
 OtherDelay decimal(5,3),
 index (PriceCode),
 index (RegionCode)
)engine = MEMORY;

INSERT
INTO    Usersettings.Prices(
  FirmCode,
  PriceCode,
  CostCode,
  PriceSynonymCode,
  RegionCode,
  DelayOfPayment,
  DisabledByClient,
  Upcost,
  Actual,
  CostType,
  PriceDate,
  ShowPriceName,
  PriceName,
  PositionCount,
  MinReq,
  ControlMinReq,
  AllowOrder,
  ShortName,
  FirmCategory,
  MainFirm,
  Storage,
  VitallyImportantDelay,
  OtherDelay
)
SELECT
  FirmCode,
  PriceCode,
  CostCode,
  PriceSynonymCode,
  RegionCode,
  DelayOfPayment,
  DisabledByClient,
  Upcost,
  Actual,
  CostType,
  PriceDate,
  ShowPriceName,
  PriceName,
  PositionCount,
  MinReq,
  if(ControlMinReq = 1, true, false),
  AllowOrder,
  ShortName,
  FirmCategory,
  MainFirm,
  Storage,
  VitallyImportantDelay,
  OtherDelay
FROM Future.BasePrices;

DROP TEMPORARY TABLE IF EXISTS Future.BasePrices;

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetPricesWithBaseCosts` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50020 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 PROCEDURE `GetPricesWithBaseCosts`()
BEGIN

drop temporary table IF EXISTS Usersettings.Prices;
create temporary table
Usersettings.Prices
(
 FirmCode int Unsigned,
 PriceCode int Unsigned,
 CostCode int Unsigned,
 PriceSynonymCode int Unsigned,
 RegionCode BigInt Unsigned,
 DelayOfPayment decimal(5,3),
 DisabledByClient bool,
 Upcost decimal(7,5),
 Actual bool,
 CostType bool,
 PriceDate DateTime,
 ShowPriceName bool,
 PriceName VarChar(50),
 PositionCount int Unsigned,
 MinReq mediumint Unsigned,
 ControlMinReq bool,
 AllowOrder bool,
 ShortName varchar(50),
 FirmCategory tinyint unsigned,
 MainFirm bool,
 Storage bool,
 VitallyImportantDelay decimal(5,3),
 OtherDelay decimal(5,3),
 index (PriceCode),
 index (RegionCode)
)engine = MEMORY;

INSERT
INTO    Usersettings.Prices
SELECT  
    pd.firmcode,
    pd.PriceCode as PriceId,
    pc.CostCode,
    ifnull(pd.ParentSynonym, pd.pricecode) PriceSynonymCode,
    prd.RegionCode as RegionId,
    0 as DelayOfPayment,       
    0,
    round((1 + pd.UpCost / 100) * (1 + prd.UpCost / 100), 5), 
    (to_seconds(now()) - to_seconds(pi.PriceDate)) < (f.maxold * 86400),
    pd.CostType,
    pi.PriceDate,
    1,
    pd.PriceName,
    pi.RowCount,
    prd.MinReq, 
    0,
    0,
    supplier.Name as ShortName,
    0,
    0,
    Storage, 
    0,
    0
FROM 
    usersettings.TmpPricesRegions TPR 
    JOIN usersettings.PricesData pd ON TPR.PriceCode = pd.PriceCode
    JOIN usersettings.PricesCosts pc on pc.PriceCode = pd.PriceCode and pc.BaseCost = 1
    JOIN usersettings.PriceItems pi on pi.Id = pc.PriceItemId
    JOIN farm.FormRules f on f.Id = pi.FormRuleId
    JOIN Future.Suppliers supplier ON supplier.Id = pd.firmcode
    JOIN usersettings.PricesRegionalData prd ON prd.pricecode = pd.pricecode AND prd.RegionCode = TPR.RegionCode
    JOIN usersettings.RegionalData rd ON  rd.RegionCode = prd.RegionCode and rd.FirmCode = pd.firmcode
WHERE  
    supplier.Disabled = 0
    and (supplier.RegionMask & prd.RegionCode) > 0
    AND pd.agencyenabled = 1
    AND pd.enabled = 1
    AND pd.pricetype <> 1
    AND prd.enabled = 1
group by PriceId, RegionId;

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetPricesWithoutMinReq` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50020 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 PROCEDURE `GetPricesWithoutMinReq`(IN UserIdParam INT UNSIGNED)
BEGIN

CALL Future.BaseGetPrices(UserIdParam, 0);

drop temporary table IF EXISTS Usersettings.Prices;
create temporary table
Usersettings.Prices
(
 FirmCode int Unsigned,
 PriceCode int Unsigned,
 CostCode int Unsigned,
 PriceSynonymCode int Unsigned,
 RegionCode BigInt Unsigned,
 DelayOfPayment decimal(5,3),
 DisabledByClient bool,
 Upcost decimal(7,5),
 Actual bool,
 CostType bool,
 PriceDate DateTime,
 ShowPriceName bool,
 PriceName VarChar(50),
 PositionCount int Unsigned,
 AllowOrder bool,
 ShortName varchar(50),
 FirmCategory tinyint unsigned,
 MainFirm bool,
 Storage bool,
 VitallyImportantDelay decimal(5,3),
 OtherDelay decimal(5,3),
 index (PriceCode),
 index (RegionCode)
)engine = MEMORY;

INSERT INTO Usersettings.Prices (
  FirmCode,
  PriceCode,
  CostCode,
  PriceSynonymCode,
  RegionCode,
  DelayOfPayment,
  DisabledByClient,
  Upcost,
  Actual,
  CostType,
  PriceDate,
  ShowPriceName,
  PriceName,
  PositionCount,
  AllowOrder,
  ShortName,
  FirmCategory,
  MainFirm,
  Storage,
  VitallyImportantDelay,
  OtherDelay
)
SELECT
  FirmCode,
  PriceCode,
  CostCode,
  PriceSynonymCode,
  RegionCode,
  DelayOfPayment,
  DisabledByClient,
  Upcost,
  Actual,
  CostType,
  PriceDate,
  ShowPriceName,
  PriceName,
  PositionCount,
  AllowOrder,
  ShortName,
  FirmCategory,
  MainFirm,
  Storage,
  VitallyImportantDelay,
  OtherDelay
FROM
  Future.BasePrices;

DROP TEMPORARY TABLE IF EXISTS Future.BasePrices;

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Current Database: `im`
--

/*!40000 DROP DATABASE IF EXISTS `im`*/;

CREATE DATABASE /*!32312 IF NOT EXISTS*/ `im` /*!40100 DEFAULT CHARACTER SET cp1251 */;

USE `im`;

--
-- Table structure for table `class`
--

DROP TABLE IF EXISTS `class`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `class` (
  `ID` int(10) unsigned DEFAULT NULL,
  `PARENT_CODE` int(10) unsigned DEFAULT NULL,
  `NAME` varchar(200) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `goods`
--

DROP TABLE IF EXISTS `goods`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `goods` (
  `ID` int(11) NOT NULL,
  `MODDATE` datetime NOT NULL,
  `DRUGFORM_CODE` int(11) NOT NULL,
  `GOODSNAME_CODE` int(11) NOT NULL,
  `DOSE_CODE` int(11) NOT NULL,
  `FASOVKA_CODE` int(11) NOT NULL,
  `PACKING_CODE` int(11) NOT NULL,
  `PRODUCER_CODE` int(11) NOT NULL,
  `RLS_CODE` int(11) NOT NULL,
  `REAL_GOODSNAME` int(11) NOT NULL,
  `ZHNIVLS` varchar(2) DEFAULT NULL,
  `BARCODE` varchar(13) DEFAULT NULL,
  `REGISTRATION_NUMBER` varchar(50) DEFAULT NULL,
  `REGISTRATION_DATE` varchar(20) DEFAULT NULL,
  `LIFETIME` varchar(70) DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `relations`
--

DROP TABLE IF EXISTS `relations`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `relations` (
  `MODDATE` datetime NOT NULL,
  `TO_CLASS` int(11) NOT NULL,
  `TO_GOODS` int(11) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping events for database 'im'
--

--
-- Dumping routines for database 'im'
--

--
-- Current Database: `internet`
--

/*!40000 DROP DATABASE IF EXISTS `internet`*/;

CREATE DATABASE /*!32312 IF NOT EXISTS*/ `internet` /*!40100 DEFAULT CHARACTER SET cp1251 */;

USE `internet`;

--
-- Table structure for table `AdditionalStatus`
--

DROP TABLE IF EXISTS `AdditionalStatus`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `AdditionalStatus` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `Name` varchar(45) NOT NULL,
  `ShortName` varchar(45) NOT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=6 DEFAULT CHARSET=cp1251;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `AgentTariffs`
--

DROP TABLE IF EXISTS `AgentTariffs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `AgentTariffs` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `ActionName` varchar(45) NOT NULL,
  `Sum` decimal(10,2) NOT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=10 DEFAULT CHARSET=cp1251;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `ApartmentHistory`
--

DROP TABLE IF EXISTS `ApartmentHistory`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `ApartmentHistory` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `Apartment` int(10) unsigned DEFAULT NULL,
  `ActionName` varchar(255) DEFAULT NULL,
  `Agent` int(10) unsigned DEFAULT NULL,
  `ActionDate` datetime NOT NULL,
  PRIMARY KEY (`Id`),
  KEY `FK_ApartmentHistory_1` (`Apartment`),
  KEY `FK_ApartmentHistory_2` (`Agent`),
  CONSTRAINT `FK_ApartmentHistory_1` FOREIGN KEY (`Apartment`) REFERENCES `Apartments` (`Id`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `FK_ApartmentHistory_2` FOREIGN KEY (`Agent`) REFERENCES `partners` (`Id`) ON DELETE SET NULL ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=2168 DEFAULT CHARSET=cp1251;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `ApartmentStatuses`
--

DROP TABLE IF EXISTS `ApartmentStatuses`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `ApartmentStatuses` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `Name` varchar(45) NOT NULL,
  `ActivateDate` int(10) unsigned DEFAULT NULL,
  `ShortName` varchar(45) NOT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=10 DEFAULT CHARSET=cp1251;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `Apartments`
--

DROP TABLE IF EXISTS `Apartments`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `Apartments` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `House` int(10) unsigned NOT NULL,
  `LastInternet` varchar(45) DEFAULT NULL,
  `LastTV` varchar(45) DEFAULT NULL,
  `PresentInternet` varchar(45) DEFAULT NULL,
  `PresentTV` varchar(45) DEFAULT NULL,
  `Comment` varchar(45) DEFAULT NULL,
  `Number` int(10) unsigned NOT NULL,
  `Status` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`Id`),
  KEY `EntranceKey` (`House`) USING BTREE,
  KEY `FK_Apartments_2` (`Status`),
  CONSTRAINT `FK_Apartments_1` FOREIGN KEY (`House`) REFERENCES `Houses` (`Id`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `FK_Apartments_2` FOREIGN KEY (`Status`) REFERENCES `ApartmentStatuses` (`Id`) ON DELETE SET NULL ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=3335 DEFAULT CHARSET=cp1251;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `BankPayments`
--

DROP TABLE IF EXISTS `BankPayments`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `BankPayments` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `PayedOn` datetime NOT NULL,
  `Sum` decimal(10,2) NOT NULL DEFAULT '0.00',
  `PayerId` int(10) unsigned DEFAULT NULL,
  `RecipientId` int(10) unsigned DEFAULT NULL,
  `RegistredOn` datetime DEFAULT NULL,
  `Comment` varchar(255) DEFAULT NULL,
  `DocumentNumber` varchar(255) DEFAULT NULL,
  `PayerInn` varchar(255) DEFAULT NULL,
  `PayerName` varchar(255) DEFAULT NULL,
  `PayerAccountCode` varchar(255) DEFAULT NULL,
  `PayerBankDescription` varchar(255) DEFAULT NULL,
  `PayerBankBic` varchar(255) DEFAULT NULL,
  `PayerBankAccountCode` varchar(255) DEFAULT NULL,
  `RecipientInn` varchar(255) DEFAULT NULL,
  `RecipientName` varchar(255) DEFAULT NULL,
  `RecipientAccountCode` varchar(255) DEFAULT NULL,
  `RecipientBankDescription` varchar(255) DEFAULT NULL,
  `RecipientBankBic` varchar(255) DEFAULT NULL,
  `RecipientBankAccountCode` varchar(255) DEFAULT NULL,
  `OperatorComment` varchar(255) DEFAULT NULL,
  `ForAd` tinyint(1) DEFAULT NULL,
  `AdSum` decimal(19,5) DEFAULT NULL,
  `Ad` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`Id`) USING BTREE,
  KEY `FK_BankPayments_1` (`PayerId`),
  CONSTRAINT `FK_BankPayments_1` FOREIGN KEY (`PayerId`) REFERENCES `lawyerperson` (`Id`) ON DELETE SET NULL ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=292 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `BypassHouses`
--

DROP TABLE IF EXISTS `BypassHouses`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `BypassHouses` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `House` int(10) unsigned DEFAULT NULL,
  `Agent` int(10) unsigned DEFAULT NULL,
  `BypassDate` datetime DEFAULT NULL,
  PRIMARY KEY (`Id`),
  KEY `FK_BypassHouses_1` (`Agent`),
  KEY `FK_BypassHouses_2` (`House`),
  CONSTRAINT `FK_BypassHouses_1` FOREIGN KEY (`Agent`) REFERENCES `partners` (`Id`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `FK_BypassHouses_2` FOREIGN KEY (`House`) REFERENCES `Houses` (`Id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=36 DEFAULT CHARSET=cp1251;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `ClientServices`
--

DROP TABLE IF EXISTS `ClientServices`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `ClientServices` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `Client` int(10) unsigned DEFAULT NULL,
  `Service` int(10) unsigned NOT NULL,
  `BeginWorkDate` datetime DEFAULT NULL,
  `EndWorkDate` datetime DEFAULT NULL,
  `Activated` tinyint(1) unsigned NOT NULL,
  `Activator` int(10) unsigned DEFAULT NULL,
  `Diactivated` tinyint(1) unsigned NOT NULL,
  PRIMARY KEY (`Id`),
  KEY `FK_ClientServices_1` (`Service`),
  KEY `FK_ClientServices_2` (`Activator`),
  KEY `FK_ClientServices_3` (`Client`),
  CONSTRAINT `FK_ClientServices_1` FOREIGN KEY (`Service`) REFERENCES `Services` (`Id`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `FK_ClientServices_2` FOREIGN KEY (`Activator`) REFERENCES `partners` (`Id`) ON DELETE SET NULL ON UPDATE CASCADE,
  CONSTRAINT `FK_ClientServices_3` FOREIGN KEY (`Client`) REFERENCES `Clients` (`Id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=877 DEFAULT CHARSET=cp1251;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER Internet.ClientServiceLogInsert AFTER INSERT ON Internet.ClientServices
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.ClientServiceInternetLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 0,
		ServiceId = NEW.Id,
		Client = NEW.Client,
		Service = NEW.Service,
		BeginWorkDate = NEW.BeginWorkDate,
		EndWorkDate = NEW.EndWorkDate,
		Activated = NEW.Activated,
		Activator = NEW.Activator,
		Diactivated = NEW.Diactivated;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER Internet.ClientServiceLogUpdate AFTER UPDATE ON Internet.ClientServices
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.ClientServiceInternetLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 1,
		ServiceId = OLD.Id,
		Client = NULLIF(NEW.Client, OLD.Client),
		Service = NULLIF(NEW.Service, OLD.Service),
		BeginWorkDate = NULLIF(NEW.BeginWorkDate, OLD.BeginWorkDate),
		EndWorkDate = NULLIF(NEW.EndWorkDate, OLD.EndWorkDate),
		Activated = NULLIF(NEW.Activated, OLD.Activated),
		Activator = NULLIF(NEW.Activator, OLD.Activator),
		Diactivated = NULLIF(NEW.Diactivated, OLD.Diactivated);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER Internet.ClientServiceLogDelete AFTER DELETE ON Internet.ClientServices
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.ClientServiceInternetLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 2,
		ServiceId = OLD.Id,
		Client = OLD.Client,
		Service = OLD.Service,
		BeginWorkDate = OLD.BeginWorkDate,
		EndWorkDate = OLD.EndWorkDate,
		Activated = OLD.Activated,
		Activator = OLD.Activator,
		Diactivated = OLD.Diactivated;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `ConnectGraph`
--

DROP TABLE IF EXISTS `ConnectGraph`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `ConnectGraph` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `IntervalId` int(10) unsigned NOT NULL,
  `Client` int(10) unsigned DEFAULT NULL,
  `Day` date DEFAULT NULL,
  `Brigad` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`Id`),
  KEY `FK_ConnectGraph_1` (`Client`),
  KEY `FK_ConnectGraph_2` (`Brigad`),
  CONSTRAINT `FK_ConnectGraph_1` FOREIGN KEY (`Client`) REFERENCES `clients` (`Id`) ON DELETE SET NULL ON UPDATE CASCADE,
  CONSTRAINT `FK_ConnectGraph_2` FOREIGN KEY (`Brigad`) REFERENCES `connectbrigads` (`Id`) ON DELETE SET NULL ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=2639 DEFAULT CHARSET=cp1251;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `Entrances`
--

DROP TABLE IF EXISTS `Entrances`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `Entrances` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `House` int(10) unsigned DEFAULT NULL,
  `Number` int(10) unsigned NOT NULL,
  `Strut` tinyint(1) unsigned NOT NULL,
  `Cable` tinyint(1) unsigned NOT NULL,
  `Switch` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`Id`),
  KEY `HouseKey` (`House`),
  KEY `FK_Entrances_2` (`Switch`),
  CONSTRAINT `FK_Entrances_2` FOREIGN KEY (`Switch`) REFERENCES `networkswitches` (`Id`) ON DELETE SET NULL ON UPDATE CASCADE,
  CONSTRAINT `HouseKey` FOREIGN KEY (`House`) REFERENCES `Houses` (`Id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=1702 DEFAULT CHARSET=cp1251;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `HouseAgents`
--

DROP TABLE IF EXISTS `HouseAgents`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `HouseAgents` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `DateOfBirth` datetime NOT NULL,
  `Telephone` varchar(15) NOT NULL,
  `Adress` varchar(45) NOT NULL,
  `PassportNumber` varchar(8) NOT NULL,
  `PassportSeries` varchar(6) NOT NULL,
  `PassportDate` datetime DEFAULT NULL,
  `WhoGivePassport` varchar(45) DEFAULT NULL,
  `RegistrationAdress` varchar(45) DEFAULT NULL,
  `Name` varchar(45) NOT NULL,
  `Surname` varchar(45) NOT NULL,
  `Patronymic` varchar(45) NOT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB DEFAULT CHARSET=cp1251;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `Houses`
--

DROP TABLE IF EXISTS `Houses`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `Houses` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `Street` varchar(45) NOT NULL,
  `Number` int(10) unsigned NOT NULL,
  `CaseHouse` varchar(5) DEFAULT NULL,
  `ApartmentCount` int(10) unsigned NOT NULL,
  `LastPassDate` datetime DEFAULT NULL,
  `PassCount` int(10) unsigned NOT NULL,
  `CompetitorCount` int(10) unsigned NOT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=390 DEFAULT CHARSET=cp1251;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `PaymentsForAgent`
--

DROP TABLE IF EXISTS `PaymentsForAgent`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `PaymentsForAgent` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `Agent` int(10) unsigned NOT NULL,
  `Sum` decimal(10,2) NOT NULL,
  `Comment` varchar(255) NOT NULL,
  `RegistrationDate` datetime NOT NULL,
  `Action` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`Id`),
  KEY `FK_PaymentsForAgent_1` (`Agent`),
  KEY `FK_PaymentsForAgent_2` (`Action`),
  CONSTRAINT `FK_PaymentsForAgent_1` FOREIGN KEY (`Agent`) REFERENCES `partners` (`Id`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `FK_PaymentsForAgent_2` FOREIGN KEY (`Action`) REFERENCES `AgentTariffs` (`Id`) ON DELETE SET NULL ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=5191 DEFAULT CHARSET=cp1251;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `PhysicalClients`
--

DROP TABLE IF EXISTS `PhysicalClients`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `PhysicalClients` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `Name` varchar(255) DEFAULT NULL,
  `Surname` varchar(255) DEFAULT NULL,
  `Patronymic` varchar(255) DEFAULT NULL,
  `City` varchar(255) DEFAULT NULL,
  `Street` varchar(255) DEFAULT NULL,
  `House` varchar(255) DEFAULT NULL,
  `CaseHouse` varchar(255) DEFAULT NULL,
  `Apartment` varchar(255) DEFAULT NULL,
  `Entrance` varchar(255) DEFAULT NULL,
  `Floor` varchar(255) DEFAULT NULL,
  `WhenceAbout` varchar(255) DEFAULT NULL,
  `PassportSeries` varchar(255) DEFAULT NULL,
  `PassportNumber` varchar(255) DEFAULT NULL,
  `PassportDate` datetime DEFAULT NULL,
  `WhoGivePassport` varchar(255) DEFAULT NULL,
  `RegistrationAdress` varchar(255) DEFAULT NULL,
  `Balance` decimal(10,2) NOT NULL,
  `Password` varchar(255) DEFAULT NULL,
  `Tariff` int(10) unsigned DEFAULT NULL,
  `AutoUnblocked` tinyint(1) unsigned NOT NULL,
  `ConnectSum` decimal(10,2) NOT NULL,
  `ConnectionPaid` tinyint(1) unsigned NOT NULL,
  `HouseObj` int(10) unsigned DEFAULT NULL,
  `DateOfBirth` datetime DEFAULT NULL,
  `Request` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`Id`),
  KEY `FK_physicalclients_1` (`HouseObj`),
  KEY `FK_physicalclients_2` (`Tariff`),
  KEY `FK_physicalclients_3` (`Request`),
  CONSTRAINT `FK_physicalclients_1` FOREIGN KEY (`HouseObj`) REFERENCES `Houses` (`Id`) ON DELETE SET NULL ON UPDATE CASCADE,
  CONSTRAINT `FK_physicalclients_2` FOREIGN KEY (`Tariff`) REFERENCES `Tariffs` (`Id`) ON DELETE SET NULL ON UPDATE CASCADE,
  CONSTRAINT `FK_physicalclients_3` FOREIGN KEY (`Request`) REFERENCES `requests` (`Id`) ON DELETE SET NULL ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=2817 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER Internet.PhysicalClientLogInsert AFTER INSERT ON Internet.PhysicalClients
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.PhysicalClientInternetLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 0,
		ClientId = NEW.Id,
		Name = NEW.Name,
		Surname = NEW.Surname,
		Patronymic = NEW.Patronymic,
		City = NEW.City,
		Street = NEW.Street,
		House = NEW.House,
		CaseHouse = NEW.CaseHouse,
		Apartment = NEW.Apartment,
		Entrance = NEW.Entrance,
		Floor = NEW.Floor,
		WhenceAbout = NEW.WhenceAbout,
		PassportSeries = NEW.PassportSeries,
		PassportNumber = NEW.PassportNumber,
		PassportDate = NEW.PassportDate,
		WhoGivePassport = NEW.WhoGivePassport,
		RegistrationAdress = NEW.RegistrationAdress,
		Balance = NEW.Balance,
		Password = NEW.Password,
		Tariff = NEW.Tariff,
		AutoUnblocked = NEW.AutoUnblocked,
		ConnectSum = NEW.ConnectSum,
		ConnectionPaid = NEW.ConnectionPaid,
		HouseObj = NEW.HouseObj,
		DateOfBirth = NEW.DateOfBirth,
		Request = NEW.Request;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER Internet.PhysicalClientLogUpdate AFTER UPDATE ON Internet.PhysicalClients
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.PhysicalClientInternetLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 1,
		ClientId = OLD.Id,
		Name = NULLIF(NEW.Name, OLD.Name),
		Surname = NULLIF(NEW.Surname, OLD.Surname),
		Patronymic = NULLIF(NEW.Patronymic, OLD.Patronymic),
		City = NULLIF(NEW.City, OLD.City),
		Street = NULLIF(NEW.Street, OLD.Street),
		House = NULLIF(NEW.House, OLD.House),
		CaseHouse = NULLIF(NEW.CaseHouse, OLD.CaseHouse),
		Apartment = NULLIF(NEW.Apartment, OLD.Apartment),
		Entrance = NULLIF(NEW.Entrance, OLD.Entrance),
		Floor = NULLIF(NEW.Floor, OLD.Floor),
		WhenceAbout = NULLIF(NEW.WhenceAbout, OLD.WhenceAbout),
		PassportSeries = NULLIF(NEW.PassportSeries, OLD.PassportSeries),
		PassportNumber = NULLIF(NEW.PassportNumber, OLD.PassportNumber),
		PassportDate = NULLIF(NEW.PassportDate, OLD.PassportDate),
		WhoGivePassport = NULLIF(NEW.WhoGivePassport, OLD.WhoGivePassport),
		RegistrationAdress = NULLIF(NEW.RegistrationAdress, OLD.RegistrationAdress),
		Balance = NULLIF(NEW.Balance, OLD.Balance),
		Password = NULLIF(NEW.Password, OLD.Password),
		Tariff = NULLIF(NEW.Tariff, OLD.Tariff),
		AutoUnblocked = NULLIF(NEW.AutoUnblocked, OLD.AutoUnblocked),
		ConnectSum = NULLIF(NEW.ConnectSum, OLD.ConnectSum),
		ConnectionPaid = NULLIF(NEW.ConnectionPaid, OLD.ConnectionPaid),
		HouseObj = NULLIF(NEW.HouseObj, OLD.HouseObj),
		DateOfBirth = NULLIF(NEW.DateOfBirth, OLD.DateOfBirth),
		Request = NULLIF(NEW.Request, OLD.Request);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER Internet.PhysicalClientLogDelete AFTER DELETE ON Internet.PhysicalClients
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.PhysicalClientInternetLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 2,
		ClientId = OLD.Id,
		Name = OLD.Name,
		Surname = OLD.Surname,
		Patronymic = OLD.Patronymic,
		City = OLD.City,
		Street = OLD.Street,
		House = OLD.House,
		CaseHouse = OLD.CaseHouse,
		Apartment = OLD.Apartment,
		Entrance = OLD.Entrance,
		Floor = OLD.Floor,
		WhenceAbout = OLD.WhenceAbout,
		PassportSeries = OLD.PassportSeries,
		PassportNumber = OLD.PassportNumber,
		PassportDate = OLD.PassportDate,
		WhoGivePassport = OLD.WhoGivePassport,
		RegistrationAdress = OLD.RegistrationAdress,
		Balance = OLD.Balance,
		Password = OLD.Password,
		Tariff = OLD.Tariff,
		AutoUnblocked = OLD.AutoUnblocked,
		ConnectSum = OLD.ConnectSum,
		ConnectionPaid = OLD.ConnectionPaid,
		HouseObj = OLD.HouseObj,
		DateOfBirth = OLD.DateOfBirth,
		Request = OLD.Request;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `RequestMessages`
--

DROP TABLE IF EXISTS `RequestMessages`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `RequestMessages` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `Comment` text NOT NULL,
  `Date` datetime NOT NULL,
  `Registrator` int(10) unsigned DEFAULT NULL,
  `Request` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`Id`),
  KEY `FK_RequestMessages_1` (`Registrator`),
  KEY `FK_RequestMessages_2` (`Request`),
  CONSTRAINT `FK_RequestMessages_1` FOREIGN KEY (`Registrator`) REFERENCES `Partners` (`Id`) ON DELETE SET NULL ON UPDATE CASCADE,
  CONSTRAINT `FK_RequestMessages_2` FOREIGN KEY (`Request`) REFERENCES `Requests` (`Id`) ON DELETE SET NULL ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=20 DEFAULT CHARSET=cp1251;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `Requests`
--

DROP TABLE IF EXISTS `Requests`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `Requests` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `ApplicantName` varchar(255) NOT NULL,
  `ApplicantPhoneNumber` varchar(255) NOT NULL,
  `ApplicantEmail` varchar(255) DEFAULT NULL,
  `SelfConnect` tinyint(1) NOT NULL,
  `Tariff` int(10) unsigned NOT NULL,
  `Label` int(10) unsigned DEFAULT NULL,
  `City` varchar(255) DEFAULT NULL,
  `Street` varchar(255) NOT NULL,
  `House` int(10) unsigned DEFAULT NULL,
  `CaseHouse` varchar(5) DEFAULT NULL,
  `Apartment` int(10) unsigned DEFAULT NULL,
  `Entrance` int(10) unsigned DEFAULT NULL,
  `Floor` int(10) unsigned DEFAULT NULL,
  `ActionDate` datetime DEFAULT NULL,
  `Operator` int(10) unsigned DEFAULT NULL,
  `Registrator` int(10) unsigned DEFAULT NULL,
  `RegDate` datetime DEFAULT NULL,
  `VirtualBonus` decimal(10,2) NOT NULL,
  `PaidBonus` tinyint(1) unsigned NOT NULL,
  `Archive` tinyint(1) unsigned NOT NULL,
  `Client` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`Id`),
  KEY `FK_requests_1` (`Registrator`),
  KEY `FK_Requests_6` (`Client`),
  CONSTRAINT `FK_requests_1` FOREIGN KEY (`Registrator`) REFERENCES `partners` (`Id`) ON DELETE SET NULL ON UPDATE CASCADE,
  CONSTRAINT `FK_Requests_6` FOREIGN KEY (`Client`) REFERENCES `Clients` (`Id`) ON DELETE SET NULL ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=2949 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `Services`
--

DROP TABLE IF EXISTS `Services`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `Services` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `Name` varchar(45) NOT NULL,
  `Price` decimal(10,0) NOT NULL,
  `BlockingAll` tinyint(1) unsigned NOT NULL,
  `HumanName` varchar(45) NOT NULL,
  `InterfaceControl` tinyint(1) DEFAULT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=cp1251;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `SiteContent`
--

DROP TABLE IF EXISTS `SiteContent`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `SiteContent` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `Content` longtext NOT NULL,
  `ViewName` varchar(45) NOT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=211 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `SmsMessages`
--

DROP TABLE IF EXISTS `SmsMessages`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `SmsMessages` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `CreateDate` datetime DEFAULT NULL,
  `SendToOperatorDate` datetime DEFAULT NULL,
  `ShouldBeSend` datetime DEFAULT NULL,
  `Text` varchar(255) DEFAULT NULL,
  `PhoneNumber` varchar(255) DEFAULT NULL,
  `IsSended` tinyint(1) DEFAULT NULL,
  `SMSID` varchar(255) DEFAULT NULL,
  `Client` int(10) unsigned DEFAULT NULL,
  `ServerRequest` int(11) DEFAULT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=41 DEFAULT CHARSET=cp1251;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `StaticIps`
--

DROP TABLE IF EXISTS `StaticIps`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `StaticIps` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `EndPoint` int(10) unsigned DEFAULT NULL,
  `Ip` varchar(45) NOT NULL,
  `Mask` int(10) unsigned DEFAULT NULL,
  `Client` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`Id`),
  KEY `FK_StaticIp_1` (`EndPoint`) USING BTREE,
  CONSTRAINT `FK_StaticIps_1` FOREIGN KEY (`EndPoint`) REFERENCES `ClientEndpoints` (`Id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=50 DEFAULT CHARSET=cp1251;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `StatusCorrelation`
--

DROP TABLE IF EXISTS `StatusCorrelation`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `StatusCorrelation` (
  `StatusId` int(10) unsigned NOT NULL,
  `AdditionalStatusId` int(10) unsigned NOT NULL,
  PRIMARY KEY (`StatusId`,`AdditionalStatusId`),
  KEY `FK_StatusCorrelation_2` (`AdditionalStatusId`),
  CONSTRAINT `FK_StatusCorrelation_1` FOREIGN KEY (`StatusId`) REFERENCES `Status` (`Id`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `FK_StatusCorrelation_2` FOREIGN KEY (`AdditionalStatusId`) REFERENCES `AdditionalStatus` (`Id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=cp1251;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `Tariffs`
--

DROP TABLE IF EXISTS `Tariffs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `Tariffs` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `Name` varchar(255) NOT NULL,
  `Description` varchar(255) NOT NULL,
  `Price` int(10) unsigned NOT NULL,
  `PackageId` int(10) unsigned NOT NULL,
  `Hidden` tinyint(1) DEFAULT '0',
  `FinalPriceInterval` int(11) NOT NULL DEFAULT '0',
  `FinalPrice` decimal(19,5) NOT NULL DEFAULT '0.00000',
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=15 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `UserWriteOffs`
--

DROP TABLE IF EXISTS `UserWriteOffs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `UserWriteOffs` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `Sum` decimal(10,2) NOT NULL,
  `Date` datetime NOT NULL,
  `Client` int(10) unsigned DEFAULT NULL,
  `BillingAccount` tinyint(1) unsigned NOT NULL,
  `Comment` varchar(255) NOT NULL,
  `Registrator` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`Id`),
  KEY `FK_UserWriteOff_1` (`Client`),
  KEY `FK_UserWriteOffs_2` (`Registrator`),
  CONSTRAINT `FK_UserWriteOffs_2` FOREIGN KEY (`Registrator`) REFERENCES `partners` (`Id`) ON DELETE SET NULL ON UPDATE CASCADE,
  CONSTRAINT `FK_UserWriteOff_1` FOREIGN KEY (`Client`) REFERENCES `Clients` (`Id`) ON DELETE SET NULL ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=159 DEFAULT CHARSET=cp1251;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `accesscategories`
--

DROP TABLE IF EXISTS `accesscategories`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `accesscategories` (
  `Id` int(11) NOT NULL AUTO_INCREMENT,
  `Name` varchar(255) DEFAULT NULL,
  `ReduceName` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=28 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `agents`
--

DROP TABLE IF EXISTS `agents`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `agents` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `Name` varchar(45) NOT NULL,
  `Partner` int(10) unsigned NOT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=50 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `appeals`
--

DROP TABLE IF EXISTS `appeals`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `appeals` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `Appeal` text NOT NULL,
  `Date` datetime NOT NULL,
  `Partner` int(10) unsigned DEFAULT NULL,
  `Client` int(10) unsigned DEFAULT NULL,
  `AppealType` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`Id`),
  KEY `Partner` (`Partner`),
  KEY `PhysicalClient` (`Client`) USING BTREE,
  CONSTRAINT `Clients` FOREIGN KEY (`Client`) REFERENCES `clients` (`Id`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `Partner` FOREIGN KEY (`Partner`) REFERENCES `partners` (`Id`) ON DELETE SET NULL ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=12545 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `categoriesaccessset`
--

DROP TABLE IF EXISTS `categoriesaccessset`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `categoriesaccessset` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `Categorie` int(10) unsigned DEFAULT NULL,
  `AccessCat` int(11) DEFAULT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=182 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `clientendpoints`
--

DROP TABLE IF EXISTS `clientendpoints`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `clientendpoints` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `Disabled` tinyint(1) DEFAULT NULL,
  `Ip` int(10) unsigned DEFAULT NULL,
  `Client` int(10) unsigned DEFAULT NULL,
  `Module` tinyint(3) unsigned DEFAULT NULL,
  `Port` tinyint(3) unsigned DEFAULT NULL,
  `Switch` int(10) unsigned DEFAULT NULL,
  `Monitoring` tinyint(1) DEFAULT NULL,
  `PackageId` int(11) DEFAULT NULL,
  `MaxLeaseCount` int(11) DEFAULT NULL,
  `Pool` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`Id`),
  KEY `Client` (`Client`),
  KEY `Switch` (`Switch`),
  KEY `Port` (`Port`),
  KEY `Module` (`Module`),
  CONSTRAINT `FKBBAEFD19941C3747` FOREIGN KEY (`Client`) REFERENCES `clients` (`Id`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `FKBBAEFD19F9F5E701` FOREIGN KEY (`Switch`) REFERENCES `networkswitches` (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=2765 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER Internet.ClientEndPointLogInsert AFTER INSERT ON Internet.ClientEndPoints
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.ClientEndPointInternetLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 0,
		PointId = NEW.Id,
		Disabled = NEW.Disabled,
		Ip = NEW.Ip,
		Client = NEW.Client,
		Module = NEW.Module,
		Port = NEW.Port,
		Switch = NEW.Switch,
		Monitoring = NEW.Monitoring,
		PackageId = NEW.PackageId,
		MaxLeaseCount = NEW.MaxLeaseCount,
		Pool = NEW.Pool;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER Internet.ClientEndPointLogUpdate AFTER UPDATE ON Internet.ClientEndPoints
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.ClientEndPointInternetLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 1,
		PointId = OLD.Id,
		Disabled = NULLIF(NEW.Disabled, OLD.Disabled),
		Ip = NULLIF(NEW.Ip, OLD.Ip),
		Client = NULLIF(NEW.Client, OLD.Client),
		Module = NULLIF(NEW.Module, OLD.Module),
		Port = NULLIF(NEW.Port, OLD.Port),
		Switch = NULLIF(NEW.Switch, OLD.Switch),
		Monitoring = NULLIF(NEW.Monitoring, OLD.Monitoring),
		PackageId = NULLIF(NEW.PackageId, OLD.PackageId),
		MaxLeaseCount = NULLIF(NEW.MaxLeaseCount, OLD.MaxLeaseCount),
		Pool = NULLIF(NEW.Pool, OLD.Pool);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER Internet.ClientEndPointLogDelete AFTER DELETE ON Internet.ClientEndPoints
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.ClientEndPointInternetLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 2,
		PointId = OLD.Id,
		Disabled = OLD.Disabled,
		Ip = OLD.Ip,
		Client = OLD.Client,
		Module = OLD.Module,
		Port = OLD.Port,
		Switch = OLD.Switch,
		Monitoring = OLD.Monitoring,
		PackageId = OLD.PackageId,
		MaxLeaseCount = OLD.MaxLeaseCount,
		Pool = OLD.Pool;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `clients`
--

DROP TABLE IF EXISTS `clients`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `clients` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `Disabled` tinyint(1) unsigned DEFAULT NULL,
  `Name` varchar(45) DEFAULT NULL,
  `Type` int(10) unsigned DEFAULT NULL,
  `PhysicalClient` int(10) unsigned DEFAULT NULL,
  `RatedPeriodDate` datetime DEFAULT NULL,
  `DebtDays` int(3) unsigned NOT NULL,
  `ShowBalanceWarningPage` tinyint(1) unsigned NOT NULL DEFAULT '0',
  `BeginWork` datetime DEFAULT NULL,
  `LawyerPerson` int(10) unsigned DEFAULT NULL,
  `RegDate` datetime DEFAULT NULL,
  `WhoRegistered` int(10) unsigned DEFAULT NULL,
  `WhoRegisteredName` varchar(45) DEFAULT NULL,
  `WhoConnected` int(10) unsigned DEFAULT NULL,
  `WhoConnectedName` varchar(45) DEFAULT NULL,
  `ConnectedDate` datetime DEFAULT NULL,
  `AutoUnblocked` tinyint(1) unsigned NOT NULL,
  `Status` int(10) unsigned DEFAULT NULL,
  `AdditionalStatus` int(10) unsigned DEFAULT NULL,
  `PostponedPayment` datetime DEFAULT NULL,
  `DebtWork` tinyint(1) unsigned NOT NULL,
  `PercentBalance` decimal(3,3) NOT NULL,
  `PaidDay` tinyint(1) unsigned NOT NULL,
  `FreeBlockDays` int(10) unsigned NOT NULL,
  `YearCycleDate` datetime DEFAULT NULL,
  PRIMARY KEY (`Id`),
  KEY `FK_Clients_1` (`PhysicalClient`) USING BTREE,
  KEY `Law` (`LawyerPerson`),
  KEY `Part` (`WhoRegistered`),
  KEY `Connect` (`WhoConnected`),
  KEY `Status` (`Status`),
  KEY `AdStat` (`AdditionalStatus`),
  CONSTRAINT `AdStat` FOREIGN KEY (`AdditionalStatus`) REFERENCES `AdditionalStatus` (`Id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=3479 DEFAULT CHARSET=cp1251 ROW_FORMAT=FIXED;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER Internet.ClientLogInsert AFTER INSERT ON Internet.Clients
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.ClientInternetLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 0,
		ClientId = NEW.Id,
		Disabled = NEW.Disabled,
		Name = NEW.Name,
		Type = NEW.Type,
		PhysicalClient = NEW.PhysicalClient,
		RatedPeriodDate = NEW.RatedPeriodDate,
		DebtDays = NEW.DebtDays,
		ShowBalanceWarningPage = NEW.ShowBalanceWarningPage,
		BeginWork = NEW.BeginWork,
		LawyerPerson = NEW.LawyerPerson,
		RegDate = NEW.RegDate,
		WhoRegistered = NEW.WhoRegistered,
		WhoRegisteredName = NEW.WhoRegisteredName,
		WhoConnected = NEW.WhoConnected,
		WhoConnectedName = NEW.WhoConnectedName,
		ConnectedDate = NEW.ConnectedDate,
		AutoUnblocked = NEW.AutoUnblocked,
		Status = NEW.Status,
		AdditionalStatus = NEW.AdditionalStatus,
		PostponedPayment = NEW.PostponedPayment,
		DebtWork = NEW.DebtWork,
		PercentBalance = NEW.PercentBalance;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER Internet.ClientLogUpdate AFTER UPDATE ON Internet.Clients
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.ClientInternetLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 1,
		ClientId = OLD.Id,
		Disabled = NULLIF(NEW.Disabled, OLD.Disabled),
		Name = NULLIF(NEW.Name, OLD.Name),
		Type = NULLIF(NEW.Type, OLD.Type),
		PhysicalClient = NULLIF(NEW.PhysicalClient, OLD.PhysicalClient),
		RatedPeriodDate = NULLIF(NEW.RatedPeriodDate, OLD.RatedPeriodDate),
		DebtDays = NULLIF(NEW.DebtDays, OLD.DebtDays),
		ShowBalanceWarningPage = NULLIF(NEW.ShowBalanceWarningPage, OLD.ShowBalanceWarningPage),
		BeginWork = NULLIF(NEW.BeginWork, OLD.BeginWork),
		LawyerPerson = NULLIF(NEW.LawyerPerson, OLD.LawyerPerson),
		RegDate = NULLIF(NEW.RegDate, OLD.RegDate),
		WhoRegistered = NULLIF(NEW.WhoRegistered, OLD.WhoRegistered),
		WhoRegisteredName = NULLIF(NEW.WhoRegisteredName, OLD.WhoRegisteredName),
		WhoConnected = NULLIF(NEW.WhoConnected, OLD.WhoConnected),
		WhoConnectedName = NULLIF(NEW.WhoConnectedName, OLD.WhoConnectedName),
		ConnectedDate = NULLIF(NEW.ConnectedDate, OLD.ConnectedDate),
		AutoUnblocked = NULLIF(NEW.AutoUnblocked, OLD.AutoUnblocked),
		Status = NULLIF(NEW.Status, OLD.Status),
		AdditionalStatus = NULLIF(NEW.AdditionalStatus, OLD.AdditionalStatus),
		PostponedPayment = NULLIF(NEW.PostponedPayment, OLD.PostponedPayment),
		DebtWork = NULLIF(NEW.DebtWork, OLD.DebtWork),
		PercentBalance = NULLIF(NEW.PercentBalance, OLD.PercentBalance);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER Internet.ClientLogDelete AFTER DELETE ON Internet.Clients
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.ClientInternetLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 2,
		ClientId = OLD.Id,
		Disabled = OLD.Disabled,
		Name = OLD.Name,
		Type = OLD.Type,
		PhysicalClient = OLD.PhysicalClient,
		RatedPeriodDate = OLD.RatedPeriodDate,
		DebtDays = OLD.DebtDays,
		ShowBalanceWarningPage = OLD.ShowBalanceWarningPage,
		BeginWork = OLD.BeginWork,
		LawyerPerson = OLD.LawyerPerson,
		RegDate = OLD.RegDate,
		WhoRegistered = OLD.WhoRegistered,
		WhoRegisteredName = OLD.WhoRegisteredName,
		WhoConnected = OLD.WhoConnected,
		WhoConnectedName = OLD.WhoConnectedName,
		ConnectedDate = OLD.ConnectedDate,
		AutoUnblocked = OLD.AutoUnblocked,
		Status = OLD.Status,
		AdditionalStatus = OLD.AdditionalStatus,
		PostponedPayment = OLD.PostponedPayment,
		DebtWork = OLD.DebtWork,
		PercentBalance = OLD.PercentBalance;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `connectbrigads`
--

DROP TABLE IF EXISTS `connectbrigads`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `connectbrigads` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `Name` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=24 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `contacts`
--

DROP TABLE IF EXISTS `contacts`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `contacts` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `Client` int(10) unsigned DEFAULT NULL,
  `Contact` varchar(45) NOT NULL,
  `Type` tinyint(3) unsigned NOT NULL,
  `Comment` varchar(45) DEFAULT NULL,
  `Date` datetime NOT NULL,
  `Registrator` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`Id`),
  KEY `ToClient` (`Client`),
  CONSTRAINT `ToClient` FOREIGN KEY (`Client`) REFERENCES `Clients` (`Id`) ON DELETE SET NULL ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=3025 DEFAULT CHARSET=cp1251;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `internetsettings`
--

DROP TABLE IF EXISTS `internetsettings`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `internetsettings` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `NextBillingDate` datetime DEFAULT NULL,
  `NextStaticIpDate` datetime DEFAULT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `ippools`
--

DROP TABLE IF EXISTS `ippools`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `ippools` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `Begin` varchar(255) DEFAULT NULL,
  `End` varchar(255) DEFAULT NULL,
  `LeaseTime` bigint(20) DEFAULT NULL,
  `IsGray` tinyint(1) DEFAULT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=8 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `labels`
--

DROP TABLE IF EXISTS `labels`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `labels` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `Name` varchar(255) DEFAULT NULL,
  `Color` varchar(255) DEFAULT NULL,
  `Deleted` tinyint(1) unsigned NOT NULL,
  `ShortComment` varchar(45) DEFAULT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=54 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `lawyerperson`
--

DROP TABLE IF EXISTS `lawyerperson`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `lawyerperson` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `Tariff` decimal(10,2) DEFAULT NULL,
  `Balance` decimal(10,2) NOT NULL,
  `FullName` varchar(255) DEFAULT NULL,
  `ShortName` varchar(45) DEFAULT NULL,
  `LawyerAdress` varchar(255) DEFAULT NULL,
  `ActualAdress` varchar(255) DEFAULT NULL,
  `INN` varchar(45) DEFAULT NULL,
  `Speed` int(10) unsigned DEFAULT NULL,
  `WhoRegistered` int(10) unsigned DEFAULT NULL,
  `WhoRegisteredName` varchar(45) DEFAULT NULL,
  `WhoConnected` int(10) unsigned DEFAULT NULL,
  `WhoConnectedName` varchar(45) DEFAULT NULL,
  `Status` int(10) unsigned DEFAULT NULL,
  `RegDate` datetime DEFAULT NULL,
  `ContactPerson` varchar(45) DEFAULT NULL,
  `MailingAddress` varchar(255) DEFAULT NULL,
  `Recipient` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`Id`),
  KEY `FK_LawyerPerson_2` (`WhoConnected`),
  KEY `FK_LawyerPerson_3` (`WhoRegistered`),
  KEY `FK_LawyerPerson_4` (`Status`),
  KEY `Spped` (`Speed`),
  CONSTRAINT `FK_LawyerPerson_2` FOREIGN KEY (`WhoConnected`) REFERENCES `connectbrigads` (`Id`) ON DELETE SET NULL ON UPDATE CASCADE,
  CONSTRAINT `FK_LawyerPerson_3` FOREIGN KEY (`WhoRegistered`) REFERENCES `partners` (`Id`) ON DELETE SET NULL ON UPDATE CASCADE,
  CONSTRAINT `FK_LawyerPerson_4` FOREIGN KEY (`Status`) REFERENCES `status` (`Id`) ON DELETE SET NULL ON UPDATE CASCADE,
  CONSTRAINT `Spped` FOREIGN KEY (`Speed`) REFERENCES `packagespeed` (`Id`) ON DELETE SET NULL ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=126 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER Internet.LawyerPersonLogInsert AFTER INSERT ON Internet.LawyerPerson
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.LawyerPersonInternetLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 0,
		PersonId = NEW.Id,
		Tariff = NEW.Tariff,
		Balance = NEW.Balance,
		FullName = NEW.FullName,
		ShortName = NEW.ShortName,
		LawyerAdress = NEW.LawyerAdress,
		ActualAdress = NEW.ActualAdress,
		INN = NEW.INN,
		Speed = NEW.Speed,
		WhoRegistered = NEW.WhoRegistered,
		WhoRegisteredName = NEW.WhoRegisteredName,
		WhoConnected = NEW.WhoConnected,
		WhoConnectedName = NEW.WhoConnectedName,
		Status = NEW.Status,
		RegDate = NEW.RegDate,
		ContactPerson = NEW.ContactPerson,
		MailingAddress = NEW.MailingAddress,
		Recipient = NEW.Recipient;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER Internet.LawyerPersonLogUpdate AFTER UPDATE ON Internet.LawyerPerson
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.LawyerPersonInternetLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 1,
		PersonId = OLD.Id,
		Tariff = NULLIF(NEW.Tariff, OLD.Tariff),
		Balance = NULLIF(NEW.Balance, OLD.Balance),
		FullName = NULLIF(NEW.FullName, OLD.FullName),
		ShortName = NULLIF(NEW.ShortName, OLD.ShortName),
		LawyerAdress = NULLIF(NEW.LawyerAdress, OLD.LawyerAdress),
		ActualAdress = NULLIF(NEW.ActualAdress, OLD.ActualAdress),
		INN = NULLIF(NEW.INN, OLD.INN),
		Speed = NULLIF(NEW.Speed, OLD.Speed),
		WhoRegistered = NULLIF(NEW.WhoRegistered, OLD.WhoRegistered),
		WhoRegisteredName = NULLIF(NEW.WhoRegisteredName, OLD.WhoRegisteredName),
		WhoConnected = NULLIF(NEW.WhoConnected, OLD.WhoConnected),
		WhoConnectedName = NULLIF(NEW.WhoConnectedName, OLD.WhoConnectedName),
		Status = NULLIF(NEW.Status, OLD.Status),
		RegDate = NULLIF(NEW.RegDate, OLD.RegDate),
		ContactPerson = NULLIF(NEW.ContactPerson, OLD.ContactPerson),
		MailingAddress = NULLIF(NEW.MailingAddress, OLD.MailingAddress),
		Recipient = NULLIF(NEW.Recipient, OLD.Recipient);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER Internet.LawyerPersonLogDelete AFTER DELETE ON Internet.LawyerPerson
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.LawyerPersonInternetLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 2,
		PersonId = OLD.Id,
		Tariff = OLD.Tariff,
		Balance = OLD.Balance,
		FullName = OLD.FullName,
		ShortName = OLD.ShortName,
		LawyerAdress = OLD.LawyerAdress,
		ActualAdress = OLD.ActualAdress,
		INN = OLD.INN,
		Speed = OLD.Speed,
		WhoRegistered = OLD.WhoRegistered,
		WhoRegisteredName = OLD.WhoRegisteredName,
		WhoConnected = OLD.WhoConnected,
		WhoConnectedName = OLD.WhoConnectedName,
		Status = OLD.Status,
		RegDate = OLD.RegDate,
		ContactPerson = OLD.ContactPerson,
		MailingAddress = OLD.MailingAddress,
		Recipient = OLD.Recipient;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `leases`
--

DROP TABLE IF EXISTS `leases`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `leases` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `LeasedTo` varchar(255) DEFAULT NULL,
  `Commited` tinyint(1) DEFAULT NULL,
  `LeaseBegin` datetime DEFAULT NULL,
  `LeaseEnd` datetime DEFAULT NULL,
  `Ip` int(10) unsigned NOT NULL DEFAULT '0',
  `Pool` int(10) unsigned DEFAULT NULL,
  `Module` tinyint(3) unsigned DEFAULT NULL,
  `Port` tinyint(3) unsigned DEFAULT NULL,
  `Switch` int(10) unsigned DEFAULT NULL,
  `Endpoint` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`Ip`) USING BTREE,
  UNIQUE KEY `Id` (`Id`),
  KEY `Pool` (`Pool`),
  KEY `Switch` (`Switch`),
  CONSTRAINT `FK599959EDC85A9AB2` FOREIGN KEY (`Pool`) REFERENCES `ippools` (`Id`),
  CONSTRAINT `FK599959EDF9F5E701` FOREIGN KEY (`Switch`) REFERENCES `networkswitches` (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=553562 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `menufield`
--

DROP TABLE IF EXISTS `menufield`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `menufield` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `Name` varchar(45) NOT NULL,
  `Link` varchar(255) NOT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=509 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `networkswitches`
--

DROP TABLE IF EXISTS `networkswitches`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `networkswitches` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `Mac` varchar(255) DEFAULT NULL,
  `IP` int(10) unsigned DEFAULT NULL,
  `Name` varchar(255) DEFAULT NULL,
  `Zone` int(10) unsigned DEFAULT NULL,
  `PortCount` int(10) unsigned DEFAULT NULL,
  `Comment` mediumtext,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=266 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `networkzones`
--

DROP TABLE IF EXISTS `networkzones`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `networkzones` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `Name` varchar(255) DEFAULT NULL,
  `IsGray` tinyint(1) DEFAULT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=5 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `packagespeed`
--

DROP TABLE IF EXISTS `packagespeed`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `packagespeed` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `PackageId` int(10) unsigned NOT NULL,
  `Speed` int(10) unsigned NOT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=42 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `partners`
--

DROP TABLE IF EXISTS `partners`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `partners` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `Name` varchar(255) DEFAULT NULL,
  `Email` varchar(255) DEFAULT NULL,
  `TelNum` varchar(255) DEFAULT NULL,
  `Adress` varchar(255) DEFAULT NULL,
  `RegDate` datetime DEFAULT NULL,
  `Login` varchar(255) DEFAULT NULL,
  `Categorie` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`Id`),
  KEY `FK_Partners_1` (`Categorie`),
  CONSTRAINT `FK_Partners_1` FOREIGN KEY (`Categorie`) REFERENCES `usercategories` (`Id`) ON DELETE SET NULL ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=98 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `paymentcards`
--

DROP TABLE IF EXISTS `paymentcards`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `paymentcards` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `Serial` varchar(255) DEFAULT NULL,
  `Pin` varchar(255) DEFAULT NULL,
  `Sum` decimal(19,5) DEFAULT NULL,
  `GenerateAt` datetime DEFAULT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=48000 DEFAULT CHARSET=cp1251;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `paymentforconnect`
--

DROP TABLE IF EXISTS `paymentforconnect`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `paymentforconnect` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `RegDate` datetime DEFAULT NULL,
  `Sum` varchar(255) DEFAULT NULL,
  `EndPoint` int(10) unsigned DEFAULT NULL,
  `Partner` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`Id`),
  KEY `FK_paymentforconnect_1` (`EndPoint`),
  KEY `FK_paymentforconnect_2` (`Partner`),
  CONSTRAINT `FK_paymentforconnect_1` FOREIGN KEY (`EndPoint`) REFERENCES `clientendpoints` (`Id`) ON DELETE SET NULL ON UPDATE CASCADE,
  CONSTRAINT `FK_paymentforconnect_2` FOREIGN KEY (`Partner`) REFERENCES `partners` (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=360 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `payments`
--

DROP TABLE IF EXISTS `payments`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `payments` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `RecievedOn` datetime DEFAULT NULL,
  `PaidOn` datetime DEFAULT NULL,
  `TransactionId` varchar(255) DEFAULT NULL,
  `Sum` decimal(19,5) DEFAULT NULL,
  `Client` int(10) unsigned DEFAULT NULL,
  `Agent` int(10) unsigned DEFAULT NULL,
  `BillingAccount` tinyint(1) unsigned NOT NULL,
  PRIMARY KEY (`Id`),
  KEY `FK_Payments_1` (`Agent`),
  KEY `FK_Payments_2` (`Client`)
) ENGINE=InnoDB AUTO_INCREMENT=16513 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER Internet.PaymentLogInsert AFTER INSERT ON Internet.Payments
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.PaymentInternetLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 0,
		PaymentId = NEW.Id,
		RecievedOn = NEW.RecievedOn,
		PaidOn = NEW.PaidOn,
		TransactionId = NEW.TransactionId,
		Sum = NEW.Sum,
		Client = NEW.Client,
		Agent = NEW.Agent,
		BillingAccount = NEW.BillingAccount;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER Internet.PaymentLogUpdate AFTER UPDATE ON Internet.Payments
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.PaymentInternetLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 1,
		PaymentId = OLD.Id,
		RecievedOn = NULLIF(NEW.RecievedOn, OLD.RecievedOn),
		PaidOn = NULLIF(NEW.PaidOn, OLD.PaidOn),
		TransactionId = NULLIF(NEW.TransactionId, OLD.TransactionId),
		Sum = NULLIF(NEW.Sum, OLD.Sum),
		Client = NULLIF(NEW.Client, OLD.Client),
		Agent = NULLIF(NEW.Agent, OLD.Agent),
		BillingAccount = NULLIF(NEW.BillingAccount, OLD.BillingAccount);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER Internet.PaymentLogDelete AFTER DELETE ON Internet.Payments
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.PaymentInternetLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 2,
		PaymentId = OLD.Id,
		RecievedOn = OLD.RecievedOn,
		PaidOn = OLD.PaidOn,
		TransactionId = OLD.TransactionId,
		Sum = OLD.Sum,
		Client = OLD.Client,
		Agent = OLD.Agent,
		BillingAccount = OLD.BillingAccount;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `requestsconnection`
--

DROP TABLE IF EXISTS `requestsconnection`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `requestsconnection` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `RegDate` datetime DEFAULT NULL,
  `CloseDemandDate` datetime DEFAULT NULL,
  `BrigadNumber` int(10) unsigned DEFAULT NULL,
  `ManagerID` int(10) unsigned DEFAULT NULL,
  `ClientID` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=26 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `sendedleases`
--

DROP TABLE IF EXISTS `sendedleases`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `sendedleases` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `LeaseId` int(10) unsigned NOT NULL,
  `LeasedTo` varchar(255) DEFAULT NULL,
  `LeaseBegin` datetime DEFAULT NULL,
  `LeaseEnd` datetime DEFAULT NULL,
  `Ip` int(10) unsigned DEFAULT NULL,
  `Pool` int(10) unsigned DEFAULT NULL,
  `Module` tinyint(3) unsigned DEFAULT NULL,
  `Port` tinyint(3) unsigned DEFAULT NULL,
  `Switch` int(10) unsigned DEFAULT NULL,
  `SendDate` datetime DEFAULT NULL,
  PRIMARY KEY (`Id`),
  KEY `Pool` (`Pool`),
  KEY `Switch` (`Switch`),
  CONSTRAINT `pool` FOREIGN KEY (`Pool`) REFERENCES `ippools` (`Id`),
  CONSTRAINT `switch` FOREIGN KEY (`Switch`) REFERENCES `networkswitches` (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=110 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `status`
--

DROP TABLE IF EXISTS `status`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `status` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `Name` varchar(100) NOT NULL,
  `Blocked` tinyint(1) unsigned NOT NULL,
  `Connected` tinyint(1) unsigned NOT NULL,
  `ShortName` varchar(45) NOT NULL,
  `ManualSet` tinyint(1) unsigned NOT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=10 DEFAULT CHARSET=cp1251 ROW_FORMAT=FIXED;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `streets`
--

DROP TABLE IF EXISTS `streets`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `streets` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `Name` varchar(255) NOT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=434 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `submenufield`
--

DROP TABLE IF EXISTS `submenufield`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `submenufield` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `MenuField` int(10) unsigned DEFAULT NULL,
  `Name` varchar(45) NOT NULL,
  `Link` varchar(255) NOT NULL,
  PRIMARY KEY (`Id`),
  KEY `FK_SubMenuField_1` (`MenuField`),
  CONSTRAINT `FK_SubMenuField_1` FOREIGN KEY (`MenuField`) REFERENCES `menufield` (`Id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=5 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `tracker`
--

DROP TABLE IF EXISTS `tracker`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `tracker` (
  `info_hash` char(20) CHARACTER SET cp1251 COLLATE cp1251_bin NOT NULL,
  `ip` char(8) CHARACTER SET cp1251 COLLATE cp1251_bin NOT NULL,
  `port` smallint(5) unsigned NOT NULL DEFAULT '0',
  `update_time` int(10) unsigned NOT NULL DEFAULT '0',
  PRIMARY KEY (`info_hash`,`ip`,`port`) USING BTREE
) ENGINE=InnoDB DEFAULT CHARSET=cp1251;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `usercategories`
--

DROP TABLE IF EXISTS `usercategories`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `usercategories` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `Comment` varchar(45) NOT NULL,
  `ReductionName` varchar(45) NOT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=6 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER internet.UsercategoryLogInsert AFTER INSERT ON internet.usercategories
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.UsercategoryLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 0,
		UsercategoryId = NEW.Id,
		Comment = NEW.Comment,
		ReductionName = NEW.ReductionName;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER internet.UsercategoryLogUpdate AFTER UPDATE ON internet.usercategories
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.UsercategoryLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 1,
		UsercategoryId = OLD.Id,
		Comment = NULLIF(NEW.Comment, OLD.Comment),
		ReductionName = NULLIF(NEW.ReductionName, OLD.ReductionName);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER internet.UsercategoryLogDelete AFTER DELETE ON internet.usercategories
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.UsercategoryLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 2,
		UsercategoryId = OLD.Id,
		Comment = OLD.Comment,
		ReductionName = OLD.ReductionName;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `writeoff`
--

DROP TABLE IF EXISTS `writeoff`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `writeoff` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `WriteOffSum` decimal(10,2) NOT NULL,
  `WriteOffDate` datetime NOT NULL,
  `Client` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`Id`),
  KEY `ClientRelation` (`Client`)
) ENGINE=InnoDB AUTO_INCREMENT=370034 DEFAULT CHARSET=cp1251 ROW_FORMAT=DYNAMIC;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER Internet.WriteOffLogInsert AFTER INSERT ON Internet.WriteOff
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.WriteOffInternetLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 0,
		OffId = NEW.Id,
		WriteOffSum = NEW.WriteOffSum,
		WriteOffDate = NEW.WriteOffDate,
		Client = NEW.Client;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER Internet.WriteOffLogUpdate AFTER UPDATE ON Internet.WriteOff
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.WriteOffInternetLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 1,
		OffId = OLD.Id,
		WriteOffSum = NULLIF(NEW.WriteOffSum, OLD.WriteOffSum),
		WriteOffDate = NULLIF(NEW.WriteOffDate, OLD.WriteOffDate),
		Client = NULLIF(NEW.Client, OLD.Client);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER Internet.WriteOffLogDelete AFTER DELETE ON Internet.WriteOff
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.WriteOffInternetLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 2,
		OffId = OLD.Id,
		WriteOffSum = OLD.WriteOffSum,
		WriteOffDate = OLD.WriteOffDate,
		Client = OLD.Client;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `zoneippools`
--

DROP TABLE IF EXISTS `zoneippools`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `zoneippools` (
  `Zone` int(10) unsigned NOT NULL,
  `Pool` int(10) unsigned NOT NULL,
  PRIMARY KEY (`Zone`,`Pool`)
) ENGINE=InnoDB DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping events for database 'internet'
--

--
-- Dumping routines for database 'internet'
--

--
-- Current Database: `logs`
--

/*!40000 DROP DATABASE IF EXISTS `logs`*/;

CREATE DATABASE /*!32312 IF NOT EXISTS*/ `logs` /*!40100 DEFAULT CHARACTER SET cp1251 */;

USE `logs`;

--
-- Table structure for table `AccountLogs`
--

DROP TABLE IF EXISTS `AccountLogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `AccountLogs` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `LogTime` datetime NOT NULL,
  `OperatorName` varchar(50) NOT NULL,
  `OperatorHost` varchar(50) NOT NULL,
  `Operation` tinyint(3) unsigned NOT NULL,
  `AccountingId` int(10) unsigned NOT NULL,
  `WriteTime` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `Type` tinyint(1) unsigned DEFAULT NULL,
  `AccountId` int(10) unsigned DEFAULT NULL,
  `Operator` varchar(255) DEFAULT NULL,
  `Payment` decimal(10,0) DEFAULT NULL,
  `BeAccounted` tinyint(1) DEFAULT NULL,
  `ReadyForAcounting` tinyint(1) DEFAULT NULL,
  `InvoiceGroup` int(11) DEFAULT NULL,
  `IsFree` tinyint(1) DEFAULT NULL,
  `ObjectId` int(10) unsigned DEFAULT NULL,
  `Description` varchar(255) DEFAULT NULL,
  `ReadyForAccounting` tinyint(1) DEFAULT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=196819 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `AddressLogs`
--

DROP TABLE IF EXISTS `AddressLogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `AddressLogs` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `LogTime` datetime NOT NULL,
  `OperatorName` varchar(50) NOT NULL,
  `OperatorHost` varchar(50) NOT NULL,
  `Operation` tinyint(3) unsigned NOT NULL,
  `AddressId` int(10) unsigned NOT NULL,
  `LegacyId` int(10) unsigned DEFAULT NULL,
  `ClientId` int(10) unsigned DEFAULT NULL,
  `Address` varchar(100) DEFAULT NULL,
  `ContactGroupId` int(10) unsigned DEFAULT NULL,
  `Enabled` tinyint(3) unsigned DEFAULT NULL,
  `Free` tinyint(3) unsigned DEFAULT NULL,
  `LegalEntityId` int(10) unsigned DEFAULT NULL,
  `BeAccounted` tinyint(1) unsigned DEFAULT NULL,
  `AccountingId` int(10) unsigned DEFAULT NULL,
  `PayerId` int(10) unsigned DEFAULT NULL,
  `Registrant` varchar(100) DEFAULT NULL,
  `RegistrationDate` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=49435 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `AnalitFScheduleLogs`
--

DROP TABLE IF EXISTS `AnalitFScheduleLogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `AnalitFScheduleLogs` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `LogTime` datetime NOT NULL,
  `OperatorName` varchar(50) NOT NULL,
  `OperatorHost` varchar(50) NOT NULL,
  `Operation` tinyint(3) unsigned NOT NULL,
  `ScheduleId` int(10) unsigned NOT NULL,
  `ClientId` int(10) unsigned DEFAULT NULL,
  `Enable` tinyint(1) unsigned DEFAULT NULL,
  `Hour` int(10) unsigned DEFAULT NULL,
  `Minute` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=619 DEFAULT CHARSET=cp1251;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `AnalitFUserActionLogs`
--

DROP TABLE IF EXISTS `AnalitFUserActionLogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `AnalitFUserActionLogs` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `LogTime` datetime NOT NULL,
  `UserId` int(10) unsigned NOT NULL,
  `UpdateId` int(10) unsigned NOT NULL,
  `UserActionId` int(10) unsigned NOT NULL,
  `Context` varchar(255) DEFAULT NULL COMMENT 'Контекст действия',
  PRIMARY KEY (`Id`),
  KEY `IDX_AnalitFUserActionLogs_LogTime` (`LogTime`) USING BTREE,
  KEY `IDX_AnalitFUserActionLogs_UserId` (`UserId`),
  KEY `IDX_AnalitFUserActionLogs_UserActionId` (`UserActionId`),
  KEY `IDX_AnalitFUserActionLogs_UpdateId` (`UpdateId`)
) ENGINE=InnoDB AUTO_INCREMENT=46955961 DEFAULT CHARSET=cp1251;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `AttachmentSendLogs`
--

DROP TABLE IF EXISTS `AttachmentSendLogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `AttachmentSendLogs` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `UserId` int(10) unsigned NOT NULL,
  `AttachmentId` int(10) unsigned NOT NULL,
  `UpdateId` int(10) unsigned DEFAULT NULL,
  `Committed` tinyint(1) unsigned NOT NULL DEFAULT '0',
  PRIMARY KEY (`Id`),
  KEY `FK_AttachmentSendLogs_UserId` (`UserId`),
  KEY `FK_AttachmentSendLogs_AttachmentId` (`AttachmentId`),
  KEY `FK_AttachmentSendLogs_UpdateId` (`UpdateId`),
  CONSTRAINT `FK_AttachmentSendLogs_AttachmentId` FOREIGN KEY (`AttachmentId`) REFERENCES `Documents`.`Attachments` (`Id`) ON DELETE CASCADE,
  CONSTRAINT `FK_AttachmentSendLogs_UpdateId` FOREIGN KEY (`UpdateId`) REFERENCES `analitfupdates` (`UpdateId`) ON DELETE CASCADE,
  CONSTRAINT `FK_AttachmentSendLogs_UserId` FOREIGN KEY (`UserId`) REFERENCES `future`.`users` (`Id`) ON DELETE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=25 DEFAULT CHARSET=cp1251;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `CertificateFileLogs`
--

DROP TABLE IF EXISTS `CertificateFileLogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `CertificateFileLogs` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `LogTime` datetime NOT NULL,
  `OperatorName` varchar(50) NOT NULL,
  `OperatorHost` varchar(50) NOT NULL,
  `Operation` tinyint(3) unsigned NOT NULL,
  `FileId` int(10) unsigned NOT NULL,
  `OriginFilename` varchar(255) DEFAULT NULL,
  `ExternalFileId` varchar(255) DEFAULT NULL,
  `CertificateSourceId` int(10) unsigned DEFAULT NULL,
  `Extension` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=258536 DEFAULT CHARSET=cp1251;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `CertificateLogs`
--

DROP TABLE IF EXISTS `CertificateLogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `CertificateLogs` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `LogTime` datetime NOT NULL,
  `OperatorName` varchar(50) NOT NULL,
  `OperatorHost` varchar(50) NOT NULL,
  `Operation` tinyint(3) unsigned NOT NULL,
  `CertificateId` int(10) unsigned NOT NULL,
  `CatalogId` int(10) unsigned DEFAULT NULL,
  `SerialNumber` varchar(50) DEFAULT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=72650 DEFAULT CHARSET=cp1251;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `CertificateRequestLogs`
--

DROP TABLE IF EXISTS `CertificateRequestLogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `CertificateRequestLogs` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `UpdateId` int(10) unsigned NOT NULL,
  `DocumentBodyId` int(10) unsigned NOT NULL,
  `CertificateId` int(10) unsigned DEFAULT NULL,
  `Filename` varchar(20) DEFAULT NULL,
  PRIMARY KEY (`Id`),
  KEY `FK_CertificateRequestLogs_UpdateId` (`UpdateId`),
  CONSTRAINT `FK_CertificateRequestLogs_UpdateId` FOREIGN KEY (`UpdateId`) REFERENCES `AnalitFUpdates` (`UpdateId`) ON DELETE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=774 DEFAULT CHARSET=cp1251;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `CertificateSourceLogs`
--

DROP TABLE IF EXISTS `CertificateSourceLogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `CertificateSourceLogs` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `LogTime` datetime NOT NULL,
  `OperatorName` varchar(50) NOT NULL,
  `OperatorHost` varchar(50) NOT NULL,
  `Operation` tinyint(3) unsigned NOT NULL,
  `SourceId` int(10) unsigned NOT NULL,
  `FtpSupplierId` int(10) unsigned DEFAULT NULL,
  `SourceClassName` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=118 DEFAULT CHARSET=cp1251;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `CertificateTaskLogs`
--

DROP TABLE IF EXISTS `CertificateTaskLogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `CertificateTaskLogs` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `LogTime` datetime NOT NULL,
  `OperatorName` varchar(50) NOT NULL,
  `OperatorHost` varchar(50) NOT NULL,
  `Operation` tinyint(3) unsigned NOT NULL,
  `TaskId` int(10) unsigned NOT NULL,
  `CertificateSourceId` int(10) unsigned DEFAULT NULL,
  `CatalogId` int(10) unsigned DEFAULT NULL,
  `SerialNumber` varchar(50) DEFAULT NULL,
  `DocumentBodyId` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=1197199 DEFAULT CHARSET=cp1251;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `ClientEndPointInternetLogs`
--

DROP TABLE IF EXISTS `ClientEndPointInternetLogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `ClientEndPointInternetLogs` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `LogTime` datetime NOT NULL,
  `OperatorName` varchar(50) NOT NULL,
  `OperatorHost` varchar(50) NOT NULL,
  `Operation` tinyint(3) unsigned NOT NULL,
  `PointId` int(10) unsigned NOT NULL,
  `Disabled` tinyint(1) DEFAULT NULL,
  `Ip` int(10) unsigned DEFAULT NULL,
  `Client` int(10) unsigned DEFAULT NULL,
  `Module` tinyint(3) unsigned DEFAULT NULL,
  `Port` tinyint(3) unsigned DEFAULT NULL,
  `Switch` int(10) unsigned DEFAULT NULL,
  `Monitoring` tinyint(1) DEFAULT NULL,
  `PackageId` int(11) DEFAULT NULL,
  `MaxLeaseCount` int(11) DEFAULT NULL,
  `Pool` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=2861 DEFAULT CHARSET=cp1251;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `ClientInternetLogs`
--

DROP TABLE IF EXISTS `ClientInternetLogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `ClientInternetLogs` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `LogTime` datetime NOT NULL,
  `OperatorName` varchar(50) NOT NULL,
  `OperatorHost` varchar(50) NOT NULL,
  `Operation` tinyint(3) unsigned NOT NULL,
  `ClientId` int(10) unsigned NOT NULL,
  `Disabled` tinyint(1) unsigned DEFAULT NULL,
  `Name` varchar(45) DEFAULT NULL,
  `Type` int(10) unsigned DEFAULT NULL,
  `PhysicalClient` int(10) unsigned DEFAULT NULL,
  `RatedPeriodDate` datetime DEFAULT NULL,
  `DebtDays` int(3) unsigned DEFAULT NULL,
  `ShowBalanceWarningPage` tinyint(1) unsigned DEFAULT NULL,
  `BeginWork` datetime DEFAULT NULL,
  `LawyerPerson` int(10) unsigned DEFAULT NULL,
  `RegDate` datetime DEFAULT NULL,
  `WhoRegistered` int(10) unsigned DEFAULT NULL,
  `WhoRegisteredName` varchar(45) DEFAULT NULL,
  `WhoConnected` int(10) unsigned DEFAULT NULL,
  `WhoConnectedName` varchar(45) DEFAULT NULL,
  `ConnectedDate` datetime DEFAULT NULL,
  `AutoUnblocked` tinyint(1) unsigned DEFAULT NULL,
  `Status` int(10) unsigned DEFAULT NULL,
  `AdditionalStatus` int(10) unsigned DEFAULT NULL,
  `PostponedPayment` datetime DEFAULT NULL,
  `DebtWork` tinyint(1) unsigned DEFAULT NULL,
  `PercentBalance` decimal(3,3) DEFAULT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=138979 DEFAULT CHARSET=cp1251;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `ClientServiceInternetLogs`
--

DROP TABLE IF EXISTS `ClientServiceInternetLogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `ClientServiceInternetLogs` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `LogTime` datetime NOT NULL,
  `OperatorName` varchar(50) NOT NULL,
  `OperatorHost` varchar(50) NOT NULL,
  `Operation` tinyint(3) unsigned NOT NULL,
  `ServiceId` int(10) unsigned NOT NULL,
  `Client` int(10) unsigned DEFAULT NULL,
  `Service` int(10) unsigned DEFAULT NULL,
  `BeginWorkDate` datetime DEFAULT NULL,
  `EndWorkDate` datetime DEFAULT NULL,
  `Activated` tinyint(1) unsigned DEFAULT NULL,
  `Activator` int(10) unsigned DEFAULT NULL,
  `Diactivated` tinyint(1) unsigned DEFAULT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=643 DEFAULT CHARSET=cp1251;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `DhcpLogs`
--

DROP TABLE IF EXISTS `DhcpLogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `DhcpLogs` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `LogTime` datetime DEFAULT NULL,
  `Mac` varchar(255) DEFAULT NULL,
  `PacketIndex` int(11) DEFAULT NULL,
  `Request` varchar(255) DEFAULT NULL,
  `Response` varchar(255) DEFAULT NULL,
  `ErrorMessage` varchar(255) DEFAULT NULL,
  `Ip` int(10) unsigned DEFAULT NULL,
  `ProcessedInSeconds` double DEFAULT NULL,
  `Host` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=8221740 DEFAULT CHARSET=cp1251;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `FileCertificateLogs`
--

DROP TABLE IF EXISTS `FileCertificateLogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `FileCertificateLogs` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `LogTime` datetime NOT NULL,
  `OperatorName` varchar(50) NOT NULL,
  `OperatorHost` varchar(50) NOT NULL,
  `Operation` tinyint(3) unsigned NOT NULL,
  `CertificateId` int(10) unsigned DEFAULT NULL,
  `CertificateFileId` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=672864 DEFAULT CHARSET=cp1251;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `GeneralReportLogs`
--

DROP TABLE IF EXISTS `GeneralReportLogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `GeneralReportLogs` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `LogTime` datetime NOT NULL,
  `OperatorName` varchar(50) NOT NULL,
  `OperatorHost` varchar(50) NOT NULL,
  `Operation` tinyint(3) unsigned NOT NULL,
  `GeneralReportCode` bigint(20) unsigned DEFAULT NULL,
  `FirmCode` int(11) unsigned DEFAULT NULL,
  `Allow` tinyint(1) DEFAULT NULL,
  `EMailSubject` varchar(255) DEFAULT NULL,
  `ReportFileName` varchar(255) DEFAULT NULL,
  `ReportArchName` varchar(255) DEFAULT NULL,
  `ContactGroupId` int(10) unsigned DEFAULT NULL,
  `Temporary` tinyint(1) DEFAULT NULL,
  `TemporaryCreationDate` datetime DEFAULT NULL,
  `Comment` varchar(255) DEFAULT NULL,
  `PayerID` int(10) unsigned DEFAULT NULL,
  `Format` enum('Excel','DBF') DEFAULT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=711 DEFAULT CHARSET=cp1251;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `JobLogs`
--

DROP TABLE IF EXISTS `JobLogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `JobLogs` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `Name` varchar(255) DEFAULT NULL,
  `ExecuteTime` bigint(20) NOT NULL DEFAULT '0',
  `LogTime` datetime NOT NULL DEFAULT '0000-00-00 00:00:00',
  `Message` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=137 DEFAULT CHARSET=cp1251;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `LawyerPersonInternetLogs`
--

DROP TABLE IF EXISTS `LawyerPersonInternetLogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `LawyerPersonInternetLogs` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `LogTime` datetime NOT NULL,
  `OperatorName` varchar(50) NOT NULL,
  `OperatorHost` varchar(50) NOT NULL,
  `Operation` tinyint(3) unsigned NOT NULL,
  `PersonId` int(10) unsigned NOT NULL,
  `Tariff` decimal(10,2) DEFAULT NULL,
  `Balance` decimal(10,2) DEFAULT NULL,
  `FullName` varchar(255) DEFAULT NULL,
  `ShortName` varchar(45) DEFAULT NULL,
  `LawyerAdress` varchar(255) DEFAULT NULL,
  `ActualAdress` varchar(255) DEFAULT NULL,
  `INN` varchar(45) DEFAULT NULL,
  `Email` varchar(45) DEFAULT NULL,
  `Telephone` varchar(45) DEFAULT NULL,
  `Speed` int(10) unsigned DEFAULT NULL,
  `WhoRegistered` int(10) unsigned DEFAULT NULL,
  `WhoRegisteredName` varchar(45) DEFAULT NULL,
  `WhoConnected` int(10) unsigned DEFAULT NULL,
  `WhoConnectedName` varchar(45) DEFAULT NULL,
  `Status` int(10) unsigned DEFAULT NULL,
  `RegDate` datetime DEFAULT NULL,
  `ContactPerson` varchar(45) DEFAULT NULL,
  `MailingAddress` varchar(255) DEFAULT NULL,
  `Recipient` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=23492 DEFAULT CHARSET=cp1251;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `MailSendLogs`
--

DROP TABLE IF EXISTS `MailSendLogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `MailSendLogs` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `UserId` int(10) unsigned NOT NULL,
  `MailId` int(10) unsigned NOT NULL,
  `UpdateId` int(10) unsigned DEFAULT NULL,
  `Committed` tinyint(1) unsigned NOT NULL DEFAULT '0',
  `RecipientId` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`Id`),
  KEY `FK_MailSendLogs_UserId` (`UserId`),
  KEY `FK_MailSendLogs_MailId` (`MailId`),
  KEY `FK_MailSendLogs_UpdateId` (`UpdateId`),
  KEY `FK_MailSendLogs_RecipientId` (`RecipientId`),
  CONSTRAINT `FK_MailSendLogs_MailId` FOREIGN KEY (`MailId`) REFERENCES `Documents`.`Mails` (`Id`) ON DELETE CASCADE,
  CONSTRAINT `FK_MailSendLogs_RecipientId` FOREIGN KEY (`RecipientId`) REFERENCES `documents`.`mailrecipients` (`Id`) ON DELETE SET NULL,
  CONSTRAINT `FK_MailSendLogs_UpdateId` FOREIGN KEY (`UpdateId`) REFERENCES `analitfupdates` (`UpdateId`) ON DELETE CASCADE,
  CONSTRAINT `FK_MailSendLogs_UserId` FOREIGN KEY (`UserId`) REFERENCES `future`.`users` (`Id`) ON DELETE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=2225 DEFAULT CHARSET=cp1251;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `PayerLogs`
--

DROP TABLE IF EXISTS `PayerLogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `PayerLogs` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `LogTime` datetime NOT NULL,
  `OperatorName` varchar(50) NOT NULL,
  `OperatorHost` varchar(50) NOT NULL,
  `Operation` tinyint(3) unsigned NOT NULL,
  `PayerID` int(10) unsigned DEFAULT NULL,
  `ShortName` varchar(100) DEFAULT NULL,
  `JuridicalName` varchar(255) DEFAULT NULL,
  `JuridicalAddress` varchar(255) DEFAULT NULL,
  `BeforeNamePrefix` varchar(100) DEFAULT NULL,
  `AfterNamePrefix` varchar(100) DEFAULT NULL,
  `INN` varchar(12) DEFAULT NULL,
  `KPP` varchar(9) DEFAULT NULL,
  `OKPO` varchar(8) DEFAULT NULL,
  `OKVED` varchar(20) DEFAULT NULL,
  `RS` varchar(20) DEFAULT NULL,
  `BankName` varchar(255) DEFAULT NULL,
  `KS` varchar(20) DEFAULT NULL,
  `BIK` varchar(9) DEFAULT NULL,
  `OGRN` varchar(13) DEFAULT NULL,
  `ActualAddressCountry` varchar(30) DEFAULT NULL,
  `ActualAddressIndex` varchar(8) DEFAULT NULL,
  `ActualAddressProvince` varchar(30) DEFAULT NULL,
  `ActualAddressTown` varchar(20) DEFAULT NULL,
  `ActualAddressStreet` varchar(30) DEFAULT NULL,
  `ActualAddressHouse` varchar(8) DEFAULT NULL,
  `ActualAddressOffice` varchar(6) DEFAULT NULL,
  `ReceiverAddress` varchar(255) DEFAULT NULL,
  `OldPayDate` date DEFAULT NULL,
  `OldTariff` decimal(10,2) unsigned DEFAULT NULL,
  `DetailInvoice` tinyint(1) unsigned DEFAULT NULL,
  `AutoInvoice` tinyint(1) unsigned DEFAULT NULL,
  `PayCycle` tinyint(1) unsigned DEFAULT NULL,
  `Balance` decimal(10,2) DEFAULT NULL,
  `DiscountPercent` int(10) unsigned DEFAULT NULL,
  `Comment` mediumtext,
  `ContactGroupOwnerId` int(10) unsigned DEFAULT NULL,
  `AutoLock` tinyint(1) DEFAULT NULL,
  `NotificationType` tinyint(1) unsigned DEFAULT NULL,
  `ActualAddressRegion` varchar(30) DEFAULT NULL,
  `HaveContract` tinyint(1) unsigned DEFAULT NULL,
  `SendRegisteredLetter` tinyint(1) unsigned DEFAULT NULL,
  `SendScannedDocuments` tinyint(1) unsigned DEFAULT NULL,
  `DiscountValue` int(10) unsigned DEFAULT NULL,
  `DiscountType` int(10) unsigned DEFAULT NULL,
  `ChangeServiceNameTo` varchar(255) DEFAULT NULL,
  `ShowDiscount` tinyint(1) unsigned DEFAULT NULL,
  `RecipientId` int(11) DEFAULT NULL,
  `EmailInvoice` tinyint(1) DEFAULT NULL,
  `PrintInvoice` tinyint(1) DEFAULT NULL,
  `SendPaymentNotification` tinyint(1) DEFAULT NULL,
  `BeginBalance` decimal(10,0) DEFAULT NULL,
  `BeginBalanceDate` datetime DEFAULT NULL,
  `DocumentsOnLastWorkingDay` tinyint(1) DEFAULT NULL,
  `DoNotGroupParts` tinyint(1) DEFAULT NULL,
  `Customer` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=90789 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `PaymentInternetLogs`
--

DROP TABLE IF EXISTS `PaymentInternetLogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `PaymentInternetLogs` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `LogTime` datetime NOT NULL,
  `OperatorName` varchar(50) NOT NULL,
  `OperatorHost` varchar(50) NOT NULL,
  `Operation` tinyint(3) unsigned NOT NULL,
  `PaymentId` int(10) unsigned NOT NULL,
  `RecievedOn` datetime DEFAULT NULL,
  `PaidOn` datetime DEFAULT NULL,
  `TransactionId` varchar(255) DEFAULT NULL,
  `Sum` decimal(19,5) DEFAULT NULL,
  `Client` int(10) unsigned DEFAULT NULL,
  `Agent` int(10) unsigned DEFAULT NULL,
  `BillingAccount` tinyint(1) unsigned DEFAULT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=27506 DEFAULT CHARSET=cp1251;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `PhysicalClientInternetLogs`
--

DROP TABLE IF EXISTS `PhysicalClientInternetLogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `PhysicalClientInternetLogs` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `LogTime` datetime NOT NULL,
  `OperatorName` varchar(50) NOT NULL,
  `OperatorHost` varchar(50) NOT NULL,
  `Operation` tinyint(3) unsigned NOT NULL,
  `ClientId` int(10) unsigned NOT NULL,
  `Name` varchar(255) DEFAULT NULL,
  `Surname` varchar(255) DEFAULT NULL,
  `Patronymic` varchar(255) DEFAULT NULL,
  `City` varchar(255) DEFAULT NULL,
  `Street` varchar(255) DEFAULT NULL,
  `House` varchar(255) DEFAULT NULL,
  `CaseHouse` varchar(255) DEFAULT NULL,
  `Apartment` varchar(255) DEFAULT NULL,
  `Entrance` varchar(255) DEFAULT NULL,
  `Floor` varchar(255) DEFAULT NULL,
  `PhoneNumber` varchar(255) DEFAULT NULL,
  `HomePhoneNumber` varchar(255) DEFAULT NULL,
  `WhenceAbout` varchar(255) DEFAULT NULL,
  `PassportSeries` varchar(255) DEFAULT NULL,
  `PassportNumber` varchar(255) DEFAULT NULL,
  `PassportDate` datetime DEFAULT NULL,
  `WhoGivePassport` varchar(255) DEFAULT NULL,
  `RegistrationAdress` varchar(255) DEFAULT NULL,
  `Balance` decimal(10,2) DEFAULT NULL,
  `Email` varchar(255) DEFAULT NULL,
  `Password` varchar(255) DEFAULT NULL,
  `Tariff` int(10) unsigned DEFAULT NULL,
  `AutoUnblocked` tinyint(1) unsigned DEFAULT NULL,
  `ConnectSum` decimal(10,2) DEFAULT NULL,
  `ConnectionPaid` tinyint(1) unsigned DEFAULT NULL,
  `HouseObj` int(10) unsigned DEFAULT NULL,
  `DateOfBirth` datetime DEFAULT NULL,
  `Request` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=303353 DEFAULT CHARSET=cp1251;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `RetClientsSetLogs`
--

DROP TABLE IF EXISTS `RetClientsSetLogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `RetClientsSetLogs` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `LogTime` datetime NOT NULL,
  `OperatorName` varchar(50) NOT NULL,
  `OperatorHost` varchar(50) NOT NULL,
  `Operation` tinyint(3) unsigned NOT NULL,
  `ClientCode` int(11) unsigned DEFAULT NULL,
  `InvisibleOnFirm` tinyint(1) unsigned DEFAULT NULL,
  `BaseFirmCategory` smallint(6) unsigned DEFAULT NULL,
  `RetUpCost` int(11) unsigned DEFAULT NULL,
  `OverCostPercent` int(11) unsigned DEFAULT NULL,
  `DifferenceCalculation` tinyint(1) unsigned DEFAULT NULL,
  `AlowRegister` tinyint(1) unsigned DEFAULT NULL,
  `AlowRejection` tinyint(1) unsigned DEFAULT NULL,
  `AlowDocuments` tinyint(1) unsigned DEFAULT NULL,
  `MultiUserLevel` smallint(6) unsigned DEFAULT NULL,
  `AdvertisingLevel` tinyint(1) unsigned DEFAULT NULL,
  `AlowWayBill` tinyint(1) unsigned DEFAULT NULL,
  `AllowDocuments` tinyint(1) DEFAULT NULL,
  `AlowChangeSegment` tinyint(1) unsigned DEFAULT NULL,
  `ShowPriceName` tinyint(1) unsigned DEFAULT NULL,
  `WorkRegionMask` bigint(20) unsigned DEFAULT NULL,
  `OrderRegionMask` bigint(20) unsigned DEFAULT NULL,
  `ShowMessageCount` int(10) unsigned DEFAULT NULL,
  `Message` text,
  `EnableUpdate` tinyint(1) unsigned DEFAULT NULL,
  `CheckCopyID` tinyint(1) unsigned DEFAULT NULL,
  `AlowCumulativeUpdate` tinyint(1) unsigned DEFAULT NULL,
  `CheckCumulativeUpdateStatus` tinyint(1) unsigned DEFAULT NULL,
  `ServiceClient` tinyint(1) unsigned DEFAULT NULL,
  `SubmitOrders` tinyint(1) unsigned DEFAULT NULL,
  `AllowSubmitOrders` tinyint(1) unsigned DEFAULT NULL,
  `BasecostPassword` varchar(16) DEFAULT NULL,
  `OrdersVisualizationMode` tinyint(1) unsigned DEFAULT NULL,
  `CalculateLeader` tinyint(1) unsigned DEFAULT NULL,
  `AllowPreparatInfo` tinyint(1) unsigned DEFAULT NULL,
  `AllowPreparatDesc` tinyint(1) unsigned DEFAULT NULL,
  `SmartOrderRuleId` int(10) unsigned DEFAULT NULL,
  `FirmCodeOnly` int(10) unsigned DEFAULT NULL,
  `MaxWeeklyOrdersSum` int(10) unsigned DEFAULT NULL,
  `CheckWeeklyOrdersSum` tinyint(1) unsigned DEFAULT NULL,
  `AllowDelayOfPayment` tinyint(1) unsigned DEFAULT NULL,
  `Spy` tinyint(1) unsigned DEFAULT NULL,
  `SpyAccount` tinyint(1) unsigned DEFAULT NULL,
  `ShowNewDefecture` tinyint(1) unsigned DEFAULT NULL,
  `MigrateToPrgDataService` tinyint(1) unsigned DEFAULT NULL,
  `ManualComparison` tinyint(1) unsigned DEFAULT NULL,
  `ParseWaybills` tinyint(1) unsigned DEFAULT NULL,
  `SendRetailMarkup` tinyint(1) unsigned DEFAULT NULL,
  `ShowAdvertising` tinyint(1) unsigned DEFAULT NULL,
  `IgnoreNewPrices` tinyint(1) unsigned DEFAULT NULL,
  `SendWaybillsFromClient` tinyint(1) unsigned DEFAULT NULL,
  `OnlyParseWaybills` tinyint(1) unsigned DEFAULT NULL,
  `UpdateToTestBuild` tinyint(1) unsigned DEFAULT NULL,
  `EnableSmartOrder` tinyint(1) unsigned DEFAULT NULL,
  `BuyingMatrixPriceId` int(10) unsigned DEFAULT NULL,
  `BuyingMatrixType` int(10) unsigned DEFAULT NULL,
  `WarningOnBuyingMatrix` tinyint(1) unsigned DEFAULT NULL,
  `EnableImpersonalPrice` tinyint(1) unsigned DEFAULT NULL,
  `IsConvertFormat` tinyint(1) unsigned DEFAULT NULL,
  `NetworkSupplierId` int(10) unsigned DEFAULT NULL,
  `NoiseCosts` tinyint(1) DEFAULT NULL,
  `NoiseCostExceptSupplierId` int(10) unsigned DEFAULT NULL,
  `NetworkPriceId` int(10) unsigned DEFAULT NULL,
  `AssortimentPriceId` int(10) unsigned DEFAULT NULL,
  `OfferMatrixPriceId` int(10) unsigned DEFAULT NULL,
  `OfferMatrixType` int(10) unsigned DEFAULT NULL,
  `IgnoreNewPriceForUser` tinyint(1) DEFAULT NULL,
  `AllowAnalitFSchedule` tinyint(1) unsigned DEFAULT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=195222 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `SourceSupplierLogs`
--

DROP TABLE IF EXISTS `SourceSupplierLogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `SourceSupplierLogs` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `LogTime` datetime NOT NULL,
  `OperatorName` varchar(50) NOT NULL,
  `OperatorHost` varchar(50) NOT NULL,
  `Operation` tinyint(3) unsigned NOT NULL,
  `CertificateSourceId` int(10) unsigned DEFAULT NULL,
  `SupplierId` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=58 DEFAULT CHARSET=cp1251;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `UnconfirmedOrdersSendLogs`
--

DROP TABLE IF EXISTS `UnconfirmedOrdersSendLogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `UnconfirmedOrdersSendLogs` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `UserId` int(10) unsigned NOT NULL,
  `OrderId` int(10) unsigned NOT NULL,
  `UpdateId` int(10) unsigned DEFAULT NULL,
  `Committed` tinyint(1) unsigned NOT NULL DEFAULT '0',
  PRIMARY KEY (`Id`),
  UNIQUE KEY `UnconfirmedOrdersSendId` (`UserId`,`OrderId`),
  KEY `IDX_UnconfirmedOrdersSendLogs_OrdreId` (`OrderId`),
  KEY `FK_UnconfirmedOrdersSendLogs_UpdateId` (`UpdateId`),
  CONSTRAINT `FK_UnconfirmedOrdersSendLogs_UpdateId` FOREIGN KEY (`UpdateId`) REFERENCES `analitfupdates` (`UpdateId`) ON DELETE CASCADE,
  CONSTRAINT `FK_UnconfirmedOrdersSendLogs_UserId` FOREIGN KEY (`UserId`) REFERENCES `future`.`users` (`Id`) ON DELETE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=7499 DEFAULT CHARSET=cp1251;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `UserLogs`
--

DROP TABLE IF EXISTS `UserLogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `UserLogs` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `LogTime` datetime NOT NULL,
  `OperatorName` varchar(50) NOT NULL,
  `OperatorHost` varchar(50) NOT NULL,
  `Operation` tinyint(3) unsigned NOT NULL,
  `UserId` int(10) unsigned NOT NULL,
  `ClientId` int(10) unsigned DEFAULT NULL,
  `Login` varchar(20) DEFAULT NULL,
  `Name` varchar(100) DEFAULT NULL,
  `SendRejects` tinyint(1) unsigned DEFAULT NULL,
  `SendWaybills` tinyint(1) unsigned DEFAULT NULL,
  `SubmitOrders` tinyint(1) unsigned DEFAULT NULL,
  `Auditor` tinyint(1) unsigned DEFAULT NULL,
  `InheritPricesFrom` int(10) unsigned DEFAULT NULL,
  `Registrant` varchar(100) DEFAULT NULL,
  `ContactGroupId` int(10) unsigned DEFAULT NULL,
  `RegistrationDate` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `WorkRegionMask` bigint(20) unsigned DEFAULT NULL,
  `OrderRegionMask` bigint(20) unsigned DEFAULT NULL,
  `Enabled` tinyint(3) unsigned DEFAULT NULL,
  `Free` tinyint(3) unsigned DEFAULT NULL,
  `EnableUpdate` tinyint(1) unsigned DEFAULT NULL,
  `AccountingId` int(10) unsigned DEFAULT NULL,
  `PayerId` int(10) unsigned DEFAULT NULL,
  `SaveAFDataFiles` tinyint(1) unsigned DEFAULT NULL,
  `TargetVersion` mediumint(8) unsigned DEFAULT NULL,
  `UseAdjustmentOrders` tinyint(1) unsigned DEFAULT NULL,
  `PromoFileLimit` int(10) unsigned DEFAULT NULL,
  `RootService` int(10) unsigned DEFAULT NULL,
  `AllowDownloadUnconfirmedOrders` tinyint(1) unsigned DEFAULT NULL,
  `ShowSupplierCost` tinyint(1) unsigned DEFAULT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=310216 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `UsercategoryLogs`
--

DROP TABLE IF EXISTS `UsercategoryLogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `UsercategoryLogs` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `LogTime` datetime NOT NULL,
  `OperatorName` varchar(50) NOT NULL,
  `OperatorHost` varchar(50) NOT NULL,
  `Operation` tinyint(3) unsigned NOT NULL,
  `UsercategoryId` int(10) unsigned NOT NULL,
  `Comment` varchar(45) DEFAULT NULL,
  `ReductionName` varchar(45) DEFAULT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=18 DEFAULT CHARSET=cp1251;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `WriteOffInternetLogs`
--

DROP TABLE IF EXISTS `WriteOffInternetLogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `WriteOffInternetLogs` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `LogTime` datetime NOT NULL,
  `OperatorName` varchar(50) NOT NULL,
  `OperatorHost` varchar(50) NOT NULL,
  `Operation` tinyint(3) unsigned NOT NULL,
  `OffId` int(10) unsigned NOT NULL,
  `WriteOffSum` decimal(10,2) DEFAULT NULL,
  `WriteOffDate` datetime DEFAULT NULL,
  `Client` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=358610 DEFAULT CHARSET=cp1251;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `addressintersectionlogs`
--

DROP TABLE IF EXISTS `addressintersectionlogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `addressintersectionlogs` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `LogTime` datetime NOT NULL,
  `OperatorName` varchar(50) NOT NULL,
  `OperatorHost` varchar(50) NOT NULL,
  `Operation` tinyint(3) unsigned NOT NULL,
  `AddressIntersectionId` int(10) unsigned NOT NULL,
  `AddressId` int(10) unsigned DEFAULT NULL,
  `IntersectionId` int(10) unsigned DEFAULT NULL,
  `SupplierDeliveryId` varchar(20) DEFAULT NULL,
  `ControlMinReq` tinyint(1) unsigned DEFAULT NULL,
  `MinReq` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=21840229 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `adminspermissionslogs`
--

DROP TABLE IF EXISTS `adminspermissionslogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `adminspermissionslogs` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `LogTime` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `OperatorName` varchar(50) NOT NULL,
  `OperatorHost` varchar(50) NOT NULL,
  `Operation` tinyint(3) unsigned NOT NULL,
  `AdminId` int(10) unsigned DEFAULT NULL,
  `PermissionId` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=5193 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `analitfupdates`
--

DROP TABLE IF EXISTS `analitfupdates`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `analitfupdates` (
  `UpdateId` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `RequestTime` datetime DEFAULT NULL,
  `UpdateType` int(10) unsigned DEFAULT NULL,
  `UserId` int(10) unsigned DEFAULT NULL,
  `AppVersion` mediumint(8) unsigned DEFAULT NULL,
  `ResultSize` int(10) unsigned DEFAULT NULL,
  `Commit` tinyint(1) unsigned NOT NULL DEFAULT '0',
  `Addition` varchar(255) DEFAULT NULL,
  `Log` mediumtext,
  `UserName` varchar(1) NOT NULL,
  `ClientHost` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`UpdateId`) USING BTREE,
  KEY `ReqTime` (`RequestTime`) USING BTREE,
  KEY `UserId` (`UserId`),
  KEY `UpdateType_UserId` (`UpdateType`,`UserId`)
) ENGINE=InnoDB AUTO_INCREMENT=10168012 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `assignedpermissionlogs`
--

DROP TABLE IF EXISTS `assignedpermissionlogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `assignedpermissionlogs` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `LogTime` datetime NOT NULL,
  `OperatorName` varchar(50) NOT NULL,
  `OperatorHost` varchar(50) NOT NULL,
  `Operation` tinyint(3) unsigned NOT NULL,
  `PermissionId` int(10) unsigned DEFAULT NULL,
  `UserId` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=148720 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `assortmentlogs`
--

DROP TABLE IF EXISTS `assortmentlogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `assortmentlogs` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `LogTime` datetime NOT NULL,
  `OperatorName` varchar(50) NOT NULL,
  `OperatorHost` varchar(50) NOT NULL,
  `Operation` tinyint(3) unsigned NOT NULL,
  `AssortmentId` int(10) unsigned NOT NULL,
  `CatalogId` int(10) unsigned DEFAULT NULL,
  `ProducerId` int(10) unsigned DEFAULT NULL,
  `Checked` tinyint(1) unsigned DEFAULT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=219295 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `authorizationdates`
--

DROP TABLE IF EXISTS `authorizationdates`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `authorizationdates` (
  `ClientCode` int(10) unsigned DEFAULT NULL,
  `UserId` int(10) unsigned NOT NULL DEFAULT '0',
  `CITime` datetime DEFAULT NULL,
  `AFTime` datetime DEFAULT NULL,
  `AOLTime` datetime DEFAULT NULL,
  `IOLTime` datetime DEFAULT NULL,
  PRIMARY KEY (`UserId`)
) ENGINE=InnoDB DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `callbackphonelogs`
--

DROP TABLE IF EXISTS `callbackphonelogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `callbackphonelogs` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `LogTime` datetime NOT NULL,
  `OperatorHost` varchar(50) NOT NULL,
  `OperatorName` varchar(50) NOT NULL,
  `Operation` tinyint(1) DEFAULT NULL,
  `CallbackPhoneId` int(10) unsigned DEFAULT NULL,
  `CallerPhone` varchar(10) DEFAULT NULL,
  `Enabled` tinyint(1) unsigned DEFAULT '0',
  `DueDate` date DEFAULT NULL,
  `CheckDate` tinyint(1) unsigned zerofill DEFAULT '0',
  `Comment` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=406 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `calllogs`
--

DROP TABLE IF EXISTS `calllogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `calllogs` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `LogTime` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `To` varchar(45) DEFAULT NULL,
  `From` varchar(45) DEFAULT NULL,
  `Duration` int(10) unsigned DEFAULT NULL,
  `Getway` varchar(255) DEFAULT NULL,
  `Result` varchar(50) DEFAULT NULL,
  `Id2` tinyint(1) unsigned DEFAULT NULL,
  `Direction` varchar(10) DEFAULT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=350389 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `catalogfirmcr`
--

DROP TABLE IF EXISTS `catalogfirmcr`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `catalogfirmcr` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `LogTime` datetime NOT NULL,
  `OperatorName` varchar(50) NOT NULL,
  `OperatorHost` varchar(50) NOT NULL,
  `Operation` tinyint(3) unsigned NOT NULL,
  `CodeFirmCr` int(11) unsigned DEFAULT NULL,
  `FirmCr` varchar(255) DEFAULT NULL,
  `Hidden` tinyint(1) unsigned DEFAULT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=88 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `catalogformslogs`
--

DROP TABLE IF EXISTS `catalogformslogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `catalogformslogs` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `LogTime` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `OperatorName` varchar(50) DEFAULT NULL,
  `OperatorHost` varchar(50) DEFAULT NULL,
  `Operation` tinyint(3) unsigned DEFAULT NULL,
  `FormId` int(10) unsigned DEFAULT NULL,
  `Form` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `cataloglogs`
--

DROP TABLE IF EXISTS `cataloglogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `cataloglogs` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `LogTime` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `OperatorName` varchar(50) DEFAULT NULL,
  `OperatorHost` varchar(50) DEFAULT NULL,
  `Operation` tinyint(3) unsigned DEFAULT NULL,
  `CatalogId` int(10) unsigned DEFAULT NULL,
  `FormId` int(10) unsigned DEFAULT NULL,
  `NameId` int(10) unsigned DEFAULT NULL,
  `VitallyImportant` tinyint(1) DEFAULT NULL,
  `NeedCold` tinyint(1) DEFAULT NULL,
  `Fragile` tinyint(1) DEFAULT NULL,
  `Hidden` tinyint(1) DEFAULT NULL,
  `MandatoryList` tinyint(1) unsigned DEFAULT NULL,
  `Pharmacie` tinyint(1) DEFAULT NULL,
  `Name` varchar(255) DEFAULT NULL,
  `UpdateTime` timestamp NOT NULL DEFAULT '0000-00-00 00:00:00',
  PRIMARY KEY (`Id`),
  KEY `CatalogId_Idx` (`CatalogId`)
) ENGINE=InnoDB AUTO_INCREMENT=2925315 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `catalognameslogs`
--

DROP TABLE IF EXISTS `catalognameslogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `catalognameslogs` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `LogTime` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `OperatorName` varchar(50) DEFAULT NULL,
  `OperatorHost` varchar(50) DEFAULT NULL,
  `Operation` tinyint(3) unsigned DEFAULT NULL,
  `NameId` int(10) unsigned DEFAULT NULL,
  `Form` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `clientcardsendlogs`
--

DROP TABLE IF EXISTS `clientcardsendlogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `clientcardsendlogs` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `LogTime` datetime NOT NULL,
  `UserName` varchar(45) NOT NULL,
  `SmtpId` int(10) unsigned NOT NULL,
  `SentTo` varchar(255) NOT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=70 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `clientlogs`
--

DROP TABLE IF EXISTS `clientlogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `clientlogs` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `LogTime` datetime NOT NULL,
  `OperatorName` varchar(50) NOT NULL,
  `OperatorHost` varchar(50) NOT NULL,
  `Operation` tinyint(3) unsigned NOT NULL,
  `ClientId` int(10) unsigned NOT NULL,
  `Status` tinyint(1) unsigned DEFAULT NULL,
  `Segment` tinyint(1) unsigned DEFAULT NULL,
  `FirmType` tinyint(1) unsigned DEFAULT NULL,
  `PayerId` int(10) unsigned DEFAULT NULL,
  `RegionCode` bigint(20) unsigned DEFAULT NULL,
  `MaskRegion` bigint(20) unsigned DEFAULT NULL,
  `Name` varchar(50) DEFAULT NULL,
  `FullName` varchar(40) DEFAULT NULL,
  `Registrant` varchar(100) DEFAULT NULL,
  `RegistrationDate` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `ContactGroupOwnerId` int(10) unsigned DEFAULT NULL,
  `SwapFirmCode` tinyint(1) unsigned DEFAULT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=10737 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `clients_data_logs`
--

DROP TABLE IF EXISTS `clients_data_logs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `clients_data_logs` (
  `ID` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `LogTime` datetime NOT NULL,
  `OperatorName` varchar(50) NOT NULL,
  `OperatorHost` varchar(50) NOT NULL,
  `Operation` tinyint(3) unsigned NOT NULL,
  `ClientsDataID` int(10) unsigned NOT NULL,
  `BillingStatus` tinyint(1) unsigned DEFAULT NULL,
  `FirmStatus` tinyint(1) unsigned DEFAULT NULL,
  `FirmSegment` tinyint(1) unsigned DEFAULT NULL,
  `FirmType` tinyint(1) unsigned DEFAULT NULL,
  `BillingCode` int(32) unsigned DEFAULT NULL,
  `RegionCode` bigint(20) unsigned DEFAULT NULL,
  `MaskRegion` bigint(20) unsigned DEFAULT NULL,
  `ShowRegionMask` bigint(20) DEFAULT NULL,
  `FullName` char(40) DEFAULT NULL,
  `ShortName` char(20) DEFAULT NULL,
  `Fax` char(20) DEFAULT NULL,
  `Adress` char(100) DEFAULT NULL,
  `BussStop` char(100) DEFAULT NULL,
  `BussInfo` char(100) DEFAULT NULL,
  `URL` char(35) DEFAULT NULL,
  `Registrant` char(100) DEFAULT NULL,
  PRIMARY KEY (`ID`),
  KEY `LogTime` (`LogTime`),
  KEY `Index_BillingCode` (`BillingCode`),
  KEY `FirmCode_IDX` (`ClientsDataID`),
  KEY `FK_clients_data_logs_1` (`ClientsDataID`)
) ENGINE=InnoDB AUTO_INCREMENT=96438 DEFAULT CHARSET=cp1251 MIN_ROWS=1000 MAX_ROWS=1000000 PACK_KEYS=0 CHECKSUM=1 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `clientsinfo`
--

DROP TABLE IF EXISTS `clientsinfo`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `clientsinfo` (
  `RowID` int(11) NOT NULL AUTO_INCREMENT,
  `UserName` varchar(100) NOT NULL DEFAULT '',
  `WriteTime` datetime NOT NULL DEFAULT '0000-00-00 00:00:00',
  `Message` text NOT NULL,
  `Administrator` int(10) unsigned DEFAULT NULL,
  `ServiceId` int(10) unsigned NOT NULL DEFAULT '0',
  `ObjectId` int(10) unsigned NOT NULL DEFAULT '0',
  `Type` int(11) NOT NULL DEFAULT '0',
  `Name` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`RowID`),
  KEY `FK_ClientsInfo_Administrator` (`Administrator`),
  CONSTRAINT `FK_ClientsInfo_Administrator` FOREIGN KEY (`Administrator`) REFERENCES `accessright`.`regionaladmins` (`RowID`) ON DELETE SET NULL
) ENGINE=InnoDB AUTO_INCREMENT=138672 DEFAULT CHARSET=cp1251 MIN_ROWS=5000 MAX_ROWS=1000000 PACK_KEYS=0 CHECKSUM=1 ROW_FORMAT=COMPACT COMMENT='InnoDB free: 2383872 kB';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `clone`
--

DROP TABLE IF EXISTS `clone`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `clone` (
  `RowID` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `LogTime` datetime NOT NULL DEFAULT '0000-00-00 00:00:00',
  `UserName` varchar(50) NOT NULL DEFAULT '',
  `FromClientCode` bigint(20) unsigned NOT NULL DEFAULT '0',
  `ToClientCode` bigint(20) unsigned NOT NULL DEFAULT '0',
  PRIMARY KEY (`RowID`)
) ENGINE=InnoDB DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `contactlogs`
--

DROP TABLE IF EXISTS `contactlogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `contactlogs` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `LogTime` datetime NOT NULL,
  `Host` varchar(15) NOT NULL,
  `UserName` varchar(50) NOT NULL,
  `OperationType` enum('Добавление','Удаление','Изменение') NOT NULL,
  `ContactGroupName` varchar(100) NOT NULL,
  `ContactText` varchar(45) NOT NULL,
  `ContactGroupOwnerId` int(10) unsigned NOT NULL,
  PRIMARY KEY (`Id`),
  KEY `FK_ContactLogs_ContactGroupOwnerId` (`ContactGroupOwnerId`),
  CONSTRAINT `FK_ContactLogs_ContactGroupOwnerId` FOREIGN KEY (`ContactGroupOwnerId`) REFERENCES `contacts`.`contact_group_owners` (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=14098 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `cost_form_rules_logs`
--

DROP TABLE IF EXISTS `cost_form_rules_logs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `cost_form_rules_logs` (
  `ID` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `LogTime` datetime NOT NULL,
  `OperatorName` varchar(50) NOT NULL,
  `OperatorHost` varchar(50) NOT NULL,
  `Operation` tinyint(3) unsigned NOT NULL,
  `CostCode` int(11) unsigned DEFAULT NULL,
  `FieldName` varchar(50) DEFAULT NULL,
  `TxtBegin` int(11) unsigned DEFAULT NULL,
  `TxtEnd` int(11) unsigned DEFAULT NULL,
  PRIMARY KEY (`ID`),
  KEY `LogTime` (`LogTime`)
) ENGINE=InnoDB AUTO_INCREMENT=22630 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `costdiapasonlogs`
--

DROP TABLE IF EXISTS `costdiapasonlogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `costdiapasonlogs` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `LogTime` datetime NOT NULL,
  `OperatorName` varchar(50) NOT NULL,
  `OperatorHost` varchar(50) NOT NULL,
  `Operation` tinyint(3) unsigned NOT NULL,
  `DiapasonId` int(10) unsigned NOT NULL,
  `Deviation` int(10) unsigned DEFAULT NULL,
  `MaxCost` decimal(9,2) DEFAULT NULL,
  `MinCost` decimal(9,2) DEFAULT NULL,
  `SmartOrderRuleId` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=35 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `costoptimizationlogs`
--

DROP TABLE IF EXISTS `costoptimizationlogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `costoptimizationlogs` (
  `Id` int(11) NOT NULL AUTO_INCREMENT,
  `LoggedOn` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `ClientId` int(10) unsigned DEFAULT NULL,
  `ProductId` int(11) NOT NULL,
  `ProducerId` int(11) NOT NULL,
  `SelfCost` decimal(11,2) DEFAULT NULL,
  `ConcurentCost` decimal(11,2) DEFAULT NULL,
  `AllCost` decimal(11,2) DEFAULT NULL,
  `ResultCost` decimal(11,2) DEFAULT NULL,
  `SupplierId` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`Id`),
  KEY `ResultCost` (`ResultCost`),
  KEY `ProductId` (`ProductId`),
  KEY `LoggedOn` (`LoggedOn`),
  KEY `ClientId` (`ClientId`)
) ENGINE=InnoDB DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `defaultlogs`
--

DROP TABLE IF EXISTS `defaultlogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `defaultlogs` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `LogTime` datetime NOT NULL,
  `OperatorName` varchar(50) NOT NULL,
  `OperatorHost` varchar(50) NOT NULL,
  `Operation` tinyint(3) unsigned NOT NULL,
  `AnalitFVersion` mediumint(8) unsigned DEFAULT NULL,
  `DefaultId` int(10) unsigned NOT NULL,
  `FormaterId` int(10) unsigned DEFAULT NULL,
  `SenderId` int(10) unsigned DEFAULT NULL,
  `EmailFooter` text,
  `Phones` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=60 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `descriptionlogs`
--

DROP TABLE IF EXISTS `descriptionlogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `descriptionlogs` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `LogTime` datetime NOT NULL,
  `OperatorName` varchar(50) NOT NULL,
  `OperatorHost` varchar(50) NOT NULL,
  `Operation` tinyint(3) unsigned NOT NULL,
  `DescriptionId` int(10) unsigned NOT NULL,
  `Name` varchar(255) DEFAULT NULL,
  `EnglishName` varchar(255) DEFAULT NULL,
  `Description` mediumtext,
  `Interaction` mediumtext,
  `SideEffect` mediumtext,
  `IndicationsForUse` mediumtext,
  `Dosing` mediumtext,
  `Warnings` mediumtext,
  `ProductForm` mediumtext,
  `PharmacologicalAction` mediumtext,
  `Storage` mediumtext,
  `Expiration` mediumtext,
  `Composition` mediumtext,
  `NeedCorrect` tinyint(1) unsigned DEFAULT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=62702 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `document_logs`
--

DROP TABLE IF EXISTS `document_logs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `document_logs` (
  `RowId` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `LogTime` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `DocumentType` tinyint(4) unsigned DEFAULT NULL,
  `UpdateId` int(10) unsigned DEFAULT NULL,
  `DocumentSize` int(10) unsigned DEFAULT NULL,
  `FirmCode` int(10) unsigned DEFAULT NULL,
  `ClientCode` int(10) unsigned DEFAULT NULL,
  `FileName` varchar(50) DEFAULT NULL,
  `MessageUID` int(11) DEFAULT NULL,
  `Addition` mediumtext,
  `AddressId` int(10) unsigned DEFAULT NULL,
  `SendUpdateId` int(10) unsigned DEFAULT NULL,
  `Ready` tinyint(1) DEFAULT '0',
  `IsFake` tinyint(1) unsigned NOT NULL DEFAULT '0' COMMENT 'Признак того, что документ ненастоящий и файла для него нет.',
  PRIMARY KEY (`RowId`),
  KEY `FirmCode` (`FirmCode`),
  KEY `LogTime` (`LogTime`),
  KEY `ClientCode` (`ClientCode`),
  KEY `FK_document_logs_UpdateId` (`UpdateId`),
  KEY `FK_document_logs_SendUpdateId` (`SendUpdateId`),
  CONSTRAINT `FK_document_logs_FirmCode` FOREIGN KEY (`FirmCode`) REFERENCES `usersettings`.`clientsdata` (`FirmCode`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `FK_document_logs_SendUpdateId` FOREIGN KEY (`SendUpdateId`) REFERENCES `analitfupdates` (`UpdateId`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `FK_document_logs_UpdateId` FOREIGN KEY (`UpdateId`) REFERENCES `analitfupdates` (`UpdateId`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=11501368 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT COMMENT='InnoDB free: 8222720 kB; InnoDB free: 10508288 kB; InnoDB fr';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `documentsendlogs`
--

DROP TABLE IF EXISTS `documentsendlogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `documentsendlogs` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `UserId` int(10) unsigned NOT NULL,
  `DocumentId` int(10) unsigned NOT NULL,
  `UpdateId` int(10) unsigned DEFAULT NULL,
  `Committed` tinyint(1) unsigned NOT NULL DEFAULT '0',
  PRIMARY KEY (`Id`),
  KEY `FK_DocumentSendLogs_UserId` (`UserId`),
  KEY `FK_DocumentSendLogs_DocumentId` (`DocumentId`),
  KEY `FK_DocumentSendLogs_UpdateId` (`UpdateId`),
  CONSTRAINT `FK_DocumentSendLogs_DocumentId` FOREIGN KEY (`DocumentId`) REFERENCES `document_logs` (`RowId`) ON DELETE CASCADE,
  CONSTRAINT `FK_DocumentSendLogs_UpdateId` FOREIGN KEY (`UpdateId`) REFERENCES `analitfupdates` (`UpdateId`) ON DELETE CASCADE,
  CONSTRAINT `FK_DocumentSendLogs_UserId` FOREIGN KEY (`UserId`) REFERENCES `future`.`users` (`Id`) ON DELETE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=10926676 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `documentsourceslogs`
--

DROP TABLE IF EXISTS `documentsourceslogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `documentsourceslogs` (
  `ID` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `LogTime` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `OperatorName` varchar(50) NOT NULL,
  `OperatorHost` varchar(50) NOT NULL,
  `Operation` tinyint(3) unsigned NOT NULL,
  `FirmCode` int(11) unsigned NOT NULL,
  `EMailFrom` varchar(255) DEFAULT NULL,
  `SourceID` int(10) unsigned DEFAULT NULL,
  `ReaderClassName` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`ID`),
  KEY `LogTime` (`LogTime`)
) ENGINE=InnoDB AUTO_INCREMENT=2547 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `downlogs`
--

DROP TABLE IF EXISTS `downlogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `downlogs` (
  `RowId` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `LogTime` datetime DEFAULT NULL,
  `PriceItemId` int(11) unsigned DEFAULT NULL,
  `Host` varchar(50) DEFAULT NULL,
  `Addition` mediumtext,
  `ShortErrorMessage` mediumtext,
  `SourceTypeId` int(11) unsigned DEFAULT NULL,
  `ResultCode` tinyint(4) unsigned DEFAULT NULL,
  `ArchFileName` varchar(255) DEFAULT NULL,
  `ExtrFileName` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`RowId`),
  KEY `LogTime` (`LogTime`),
  KEY `Host_IDX` (`Host`),
  KEY `ResultCode_IDX` (`ResultCode`,`LogTime`) USING BTREE,
  KEY `PriceItemId_IDX` (`PriceItemId`) USING BTREE,
  KEY `FK_downlogs_SourceTypeId` (`SourceTypeId`),
  CONSTRAINT `FK_downlogs_SourceTypeId` FOREIGN KEY (`SourceTypeId`) REFERENCES `farm`.`sourcetypes` (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=8959540 DEFAULT CHARSET=cp1251 PACK_KEYS=0 ROW_FORMAT=COMPACT COMMENT='InnoDB free: 13488128 kB; InnoDB free: 118681600 kB; InnoDB ';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `emailrejectlogs`
--

DROP TABLE IF EXISTS `emailrejectlogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `emailrejectlogs` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `LogTime` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `SmtpId` int(10) unsigned NOT NULL,
  `Comment` mediumtext NOT NULL,
  `From` varchar(255) NOT NULL,
  `Subject` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=392134 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `excludelogs`
--

DROP TABLE IF EXISTS `excludelogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `excludelogs` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `LogTime` datetime NOT NULL,
  `OperatorName` varchar(50) NOT NULL,
  `OperatorHost` varchar(50) NOT NULL,
  `Operation` tinyint(3) unsigned NOT NULL,
  `ExcludeId` int(10) unsigned NOT NULL,
  `OriginalSynonymId` int(10) unsigned DEFAULT NULL,
  `CatalogId` int(10) unsigned DEFAULT NULL,
  `PriceCode` int(10) unsigned DEFAULT NULL,
  `ProducerSynonym` varchar(255) DEFAULT NULL,
  `DoNotShow` tinyint(1) DEFAULT NULL,
  `CreatedOn` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `LastUsedOn` datetime DEFAULT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=1276508 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `forbiddenlogs`
--

DROP TABLE IF EXISTS `forbiddenlogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `forbiddenlogs` (
  `RowID` int(32) unsigned NOT NULL AUTO_INCREMENT,
  `LogTime` datetime NOT NULL DEFAULT '2003-01-01 00:00:00',
  `OperatorName` varchar(50) DEFAULT NULL,
  `OperatorHost` varchar(50) DEFAULT NULL,
  `Operation` tinyint(1) NOT NULL DEFAULT '0',
  `PriceCode` int(11) unsigned NOT NULL DEFAULT '0',
  `Forbidden` varchar(255) DEFAULT NULL,
  `ForbiddenRowID` int(10) unsigned DEFAULT NULL,
  `Cause` varchar(50) DEFAULT NULL,
  PRIMARY KEY (`RowID`),
  UNIQUE KEY `RowID` (`RowID`),
  KEY `LogTime` (`LogTime`),
  KEY `PriceCode` (`PriceCode`),
  KEY `Forbidden` (`Forbidden`)
) ENGINE=InnoDB AUTO_INCREMENT=1419698 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `form_rules_logs`
--

DROP TABLE IF EXISTS `form_rules_logs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `form_rules_logs` (
  `ID` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `LogTime` datetime NOT NULL,
  `OperatorName` varchar(50) NOT NULL,
  `OperatorHost` varchar(50) NOT NULL,
  `Operation` tinyint(3) unsigned NOT NULL,
  `FormRulesID` int(11) unsigned NOT NULL,
  `PriceFormatId` int(11) unsigned DEFAULT NULL,
  `MaxOld` decimal(2,0) DEFAULT NULL,
  `Delimiter` char(3) DEFAULT NULL,
  `ParentFormRules` int(11) unsigned DEFAULT NULL,
  `ParentSynonym` int(11) unsigned DEFAULT NULL,
  `FormByCode` tinyint(4) unsigned DEFAULT NULL,
  `NameMask` varchar(255) DEFAULT NULL,
  `ForbWords` varchar(255) DEFAULT NULL,
  `JunkPos` varchar(10) DEFAULT NULL,
  `AwaitPos` varchar(10) DEFAULT NULL,
  `StartLine` int(11) unsigned DEFAULT NULL,
  `ListName` varchar(50) DEFAULT NULL,
  `TxtCodeBegin` int(11) unsigned DEFAULT NULL,
  `TxtCodeEnd` int(11) unsigned DEFAULT NULL,
  `TxtCodeCrBegin` int(11) unsigned DEFAULT NULL,
  `TxtCodeCrEnd` int(11) unsigned DEFAULT NULL,
  `TxtNameBegin` int(11) unsigned DEFAULT NULL,
  `TxtNameEnd` int(11) unsigned DEFAULT NULL,
  `TxtFirmCrBegin` int(11) unsigned DEFAULT NULL,
  `TxtFirmCrEnd` int(11) unsigned DEFAULT NULL,
  `TxtBaseCostBegin` int(11) DEFAULT NULL,
  `TxtBaseCostEnd` int(11) DEFAULT NULL,
  `TxtMinBoundCostBegin` int(11) DEFAULT NULL,
  `TxtMinBoundCostEnd` int(11) DEFAULT NULL,
  `TxtUnitBegin` int(11) DEFAULT NULL,
  `TxtUnitEnd` int(11) DEFAULT NULL,
  `TxtVolumeBegin` int(11) DEFAULT NULL,
  `TxtVolumeEnd` int(11) DEFAULT NULL,
  `TxtQuantityBegin` int(11) DEFAULT NULL,
  `TxtQuantityEnd` int(11) DEFAULT NULL,
  `TxtNoteBegin` int(11) DEFAULT NULL,
  `TxtNoteEnd` int(11) DEFAULT NULL,
  `TxtPeriodBegin` int(11) DEFAULT NULL,
  `TxtPeriodEnd` int(11) DEFAULT NULL,
  `TxtDocBegin` int(11) DEFAULT NULL,
  `TxtDocEnd` int(11) DEFAULT NULL,
  `TxtJunkBegin` int(11) DEFAULT NULL,
  `TxtJunkEnd` int(11) DEFAULT NULL,
  `TxtAwaitBegin` int(11) DEFAULT NULL,
  `TxtAwaitEnd` int(11) DEFAULT NULL,
  `FCode` varchar(20) DEFAULT NULL,
  `FCodeCr` varchar(20) DEFAULT NULL,
  `FName1` varchar(20) DEFAULT NULL,
  `FName2` varchar(20) DEFAULT NULL,
  `FName3` varchar(20) DEFAULT NULL,
  `FFirmCr` varchar(20) DEFAULT NULL,
  `FBaseCost` varchar(20) DEFAULT NULL,
  `FMinBoundCost` varchar(20) DEFAULT NULL,
  `FUnit` varchar(20) DEFAULT NULL,
  `FVolume` varchar(20) DEFAULT NULL,
  `FQuantity` varchar(20) DEFAULT NULL,
  `FNote` varchar(20) DEFAULT NULL,
  `FPeriod` varchar(20) DEFAULT NULL,
  `FDoc` varchar(20) DEFAULT NULL,
  `FJunk` varchar(20) DEFAULT NULL,
  `FAwait` varchar(20) DEFAULT NULL,
  `Memo` text,
  `TxtVitallyImportantBegin` int(11) unsigned DEFAULT NULL,
  `TxtVitallyImportantEnd` int(11) unsigned DEFAULT NULL,
  `FVitallyImportant` varchar(20) DEFAULT NULL,
  `VitallyImportantMask` varchar(10) DEFAULT NULL,
  `TxtRequestRatioBegin` int(11) unsigned DEFAULT NULL,
  `TxtRequestRatioEnd` int(11) unsigned DEFAULT NULL,
  `FRequestRatio` varchar(20) DEFAULT NULL,
  `TxtRegistryCostBegin` int(11) unsigned DEFAULT NULL,
  `TxtRegistryCostEnd` int(11) unsigned DEFAULT NULL,
  `FRegistryCost` varchar(20) DEFAULT NULL,
  `FMaxBoundCost` varchar(20) DEFAULT NULL,
  `TxtMaxBoundCostBegin` int(10) unsigned DEFAULT NULL,
  `TxtMaxBoundCostEnd` int(10) unsigned DEFAULT NULL,
  `FOrderCost` varchar(20) DEFAULT NULL,
  `TxtOrderCostBegin` int(11) unsigned DEFAULT NULL,
  `TxtOrderCostEnd` int(11) unsigned DEFAULT NULL,
  `FMinOrderCount` varchar(20) DEFAULT NULL,
  `TxtMinOrderCountBegin` int(11) unsigned DEFAULT NULL,
  `TxtMinOrderCountEnd` int(11) unsigned DEFAULT NULL,
  PRIMARY KEY (`ID`),
  KEY `LogTime` (`LogTime`)
) ENGINE=InnoDB AUTO_INCREMENT=14527 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `formlogs`
--

DROP TABLE IF EXISTS `formlogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `formlogs` (
  `RowId` int(11) NOT NULL AUTO_INCREMENT,
  `LogTime` datetime DEFAULT NULL,
  `PriceItemId` int(11) unsigned DEFAULT NULL,
  `Host` varchar(50) DEFAULT NULL,
  `ResultID` tinyint(4) unsigned DEFAULT '0',
  `Form` int(10) unsigned DEFAULT NULL,
  `Unform` int(10) unsigned DEFAULT NULL,
  `Zero` int(10) unsigned DEFAULT NULL,
  `Forb` int(10) unsigned DEFAULT NULL,
  `TotalSecs` mediumint(8) unsigned DEFAULT '0',
  `Addition` mediumtext,
  `DownloadId` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`RowId`),
  KEY `LogTime` (`LogTime`),
  KEY `Host_IDX` (`Host`),
  KEY `PriceItemId_IDX` (`PriceItemId`) USING BTREE,
  KEY `ResultId_Idx` (`ResultID`,`LogTime`)
) ENGINE=InnoDB AUTO_INCREMENT=5365942 DEFAULT CHARSET=cp1251 PACK_KEYS=0 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `guestsessionslogs`
--

DROP TABLE IF EXISTS `guestsessionslogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `guestsessionslogs` (
  `Id` int(10) unsigned NOT NULL,
  `Ip` int(10) unsigned DEFAULT NULL,
  `HwId` varchar(255) DEFAULT NULL,
  `Module` tinyint(3) unsigned DEFAULT NULL,
  `Port` tinyint(3) unsigned DEFAULT NULL,
  `Switch` int(10) unsigned DEFAULT NULL,
  `Vlan` tinyint(3) unsigned DEFAULT NULL,
  `LeaseBegin` datetime DEFAULT NULL,
  `LeaseEnd` datetime DEFAULT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT COMMENT='Протоколирование выделеня ip адресов анонимам';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `handlerpropertielogs`
--

DROP TABLE IF EXISTS `handlerpropertielogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `handlerpropertielogs` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `LogTime` datetime NOT NULL,
  `OperatorName` varchar(50) NOT NULL,
  `OperatorHost` varchar(50) NOT NULL,
  `Operation` tinyint(3) unsigned NOT NULL,
  `PropertieId` int(10) unsigned NOT NULL,
  `Name` varchar(45) DEFAULT NULL,
  `Value` varchar(45) DEFAULT NULL,
  `OrderSendRuleId` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=725 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `iislogs`
--

DROP TABLE IF EXISTS `iislogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `iislogs` (
  `ClientHost` varchar(255) DEFAULT NULL,
  `username` varchar(255) DEFAULT NULL,
  `LogTime` datetime DEFAULT NULL,
  `service` varchar(255) DEFAULT NULL,
  `machine` varchar(255) DEFAULT NULL,
  `serverip` varchar(50) DEFAULT NULL,
  `processingtime` int(11) DEFAULT NULL,
  `bytesrecvd` int(11) DEFAULT NULL,
  `bytessent` int(11) DEFAULT NULL,
  `servicestatus` int(11) DEFAULT NULL,
  `win32status` int(11) DEFAULT NULL,
  `operation` varchar(255) DEFAULT NULL,
  `target` varchar(255) DEFAULT NULL,
  `parameters` varchar(255) DEFAULT NULL,
  KEY `LogTimeUserNameIDX` (`LogTime`,`username`)
) ENGINE=MyISAM DEFAULT CHARSET=cp1251;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `internetsessionslogs`
--

DROP TABLE IF EXISTS `internetsessionslogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `internetsessionslogs` (
  `Id` int(10) unsigned NOT NULL,
  `EndpointId` int(10) unsigned DEFAULT NULL,
  `IP` int(10) unsigned DEFAULT NULL,
  `HwId` varchar(255) DEFAULT NULL,
  `LeaseBegin` datetime DEFAULT NULL,
  `LeaseEnd` datetime DEFAULT NULL,
  PRIMARY KEY (`Id`),
  KEY `Endpoint_IDX` (`EndpointId`),
  KEY `IP_IDX` (`IP`),
  CONSTRAINT `FK_InternetSessionsLogs_1` FOREIGN KEY (`EndpointId`) REFERENCES `internet`.`clientendpoints` (`Id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT COMMENT='Протоколирование выделеня ip адресов клиентам';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `intersection_logs`
--

DROP TABLE IF EXISTS `intersection_logs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `intersection_logs` (
  `ID` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `LogTime` datetime NOT NULL,
  `OperatorName` varchar(50) NOT NULL,
  `OperatorHost` varchar(50) NOT NULL,
  `Operation` tinyint(3) unsigned NOT NULL,
  `IntersectionID` int(11) unsigned NOT NULL,
  `ClientCode` int(6) unsigned DEFAULT NULL,
  `RegionCode` bigint(20) unsigned DEFAULT NULL,
  `DisabledByAgency` tinyint(1) unsigned DEFAULT NULL,
  `DisabledByFirm` tinyint(1) unsigned DEFAULT NULL,
  `AlowDisabledByClient` tinyint(1) unsigned DEFAULT NULL,
  `DisabledByClient` tinyint(1) unsigned DEFAULT NULL,
  `InvisibleOnFirm` tinyint(1) unsigned DEFAULT NULL,
  `InvisibleOnClient` tinyint(1) unsigned DEFAULT NULL,
  `PriceCode` int(11) unsigned DEFAULT NULL,
  `CostCode` int(32) unsigned DEFAULT NULL,
  `FirmClientCode` char(200) DEFAULT NULL,
  `FirmClientCode2` char(20) DEFAULT NULL,
  `FirmClientCode3` char(20) DEFAULT NULL,
  `MinReq` int(32) unsigned DEFAULT NULL,
  `ControlMinReq` tinyint(1) DEFAULT NULL,
  `FirmCategory` int(1) unsigned DEFAULT NULL,
  `PublicCostCorr` decimal(6,3) DEFAULT NULL,
  `FirmCostCorr` decimal(6,3) DEFAULT NULL,
  `CostCorrByClient` tinyint(1) unsigned DEFAULT NULL,
  PRIMARY KEY (`ID`),
  KEY `LogTime` (`LogTime`)
) ENGINE=InnoDB AUTO_INCREMENT=5208032 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `intersectionlogs`
--

DROP TABLE IF EXISTS `intersectionlogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `intersectionlogs` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `LogTime` datetime NOT NULL,
  `OperatorName` varchar(50) NOT NULL,
  `OperatorHost` varchar(50) NOT NULL,
  `Operation` tinyint(3) unsigned NOT NULL,
  `IntersectionId` int(10) unsigned NOT NULL,
  `ClientId` int(10) unsigned DEFAULT NULL,
  `RegionId` bigint(20) unsigned DEFAULT NULL,
  `PriceId` int(10) unsigned DEFAULT NULL,
  `CostId` int(10) unsigned DEFAULT NULL,
  `AvailableForClient` tinyint(1) unsigned DEFAULT NULL,
  `PriceMarkup` decimal(5,3) DEFAULT NULL,
  `SupplierClientId` varchar(200) DEFAULT NULL,
  `SupplierPaymentId` varchar(20) DEFAULT NULL,
  `ControlMinReq` tinyint(1) unsigned DEFAULT NULL,
  `MinReq` int(10) unsigned DEFAULT NULL,
  `AgencyEnabled` tinyint(1) unsigned DEFAULT NULL,
  `LegalEntityId` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`IntersectionId`,`Id`) USING BTREE,
  UNIQUE KEY `Id_Idx` (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=108187917 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `legalentitylogs`
--

DROP TABLE IF EXISTS `legalentitylogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `legalentitylogs` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `LogTime` datetime NOT NULL,
  `OperatorName` varchar(50) NOT NULL,
  `OperatorHost` varchar(50) NOT NULL,
  `Operation` tinyint(3) unsigned NOT NULL,
  `EntityId` int(10) unsigned NOT NULL,
  `PayerId` int(10) unsigned DEFAULT NULL,
  `Name` varchar(100) DEFAULT NULL,
  `FullName` varchar(255) DEFAULT NULL,
  `Address` varchar(255) DEFAULT NULL,
  `ReceiverAddress` varchar(255) DEFAULT NULL,
  `INN` varchar(12) DEFAULT NULL,
  `KPP` varchar(9) DEFAULT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=7122 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `mnnlogs`
--

DROP TABLE IF EXISTS `mnnlogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `mnnlogs` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `LogTime` datetime NOT NULL,
  `OperatorName` varchar(50) NOT NULL,
  `OperatorHost` varchar(50) NOT NULL,
  `Operation` tinyint(3) unsigned NOT NULL,
  `MnnId` int(10) unsigned NOT NULL,
  `Mnn` varchar(255) DEFAULT NULL,
  `Description` mediumtext,
  `VitallyImportant` tinyint(1) unsigned DEFAULT NULL,
  `MandatoryList` tinyint(1) unsigned DEFAULT NULL,
  `RussianMnn` varchar(255) DEFAULT NULL,
  `UpdateTime` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=28272 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `onlineserviceslogs`
--

DROP TABLE IF EXISTS `onlineserviceslogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `onlineserviceslogs` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `ServiceName` varchar(45) NOT NULL,
  `LogTime` datetime NOT NULL,
  `Host` varchar(45) NOT NULL,
  `UserName` varchar(45) NOT NULL,
  `MethodName` varchar(45) NOT NULL,
  `RowCount` int(10) unsigned NOT NULL,
  `ProcessingTime` int(10) unsigned NOT NULL,
  `Arguments` mediumtext NOT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=8851787 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `orders`
--

DROP TABLE IF EXISTS `orders`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `orders` (
  `RowId` int(11) unsigned NOT NULL AUTO_INCREMENT,
  `TransportType` int(10) unsigned DEFAULT NULL,
  `ProcessHost` varchar(50) DEFAULT NULL,
  `UserName` varchar(50) DEFAULT NULL,
  `LogTime` datetime DEFAULT NULL,
  `ClientCode` int(10) unsigned DEFAULT NULL,
  `PriceCode` int(10) unsigned DEFAULT NULL,
  `OrderID` int(10) unsigned DEFAULT NULL,
  `ResultID` int(10) unsigned DEFAULT NULL,
  `ResultCode` int(10) unsigned DEFAULT NULL,
  `Addition` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`RowId`),
  KEY `OrderID_IDX` (`OrderID`,`RowId`) USING BTREE,
  KEY `LogTime_Idx` (`LogTime`,`RowId`)
) ENGINE=InnoDB AUTO_INCREMENT=37792403 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `ordersendrulelogs`
--

DROP TABLE IF EXISTS `ordersendrulelogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `ordersendrulelogs` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `LogTime` datetime NOT NULL,
  `OperatorName` varchar(50) NOT NULL,
  `OperatorHost` varchar(50) NOT NULL,
  `Operation` tinyint(3) unsigned NOT NULL,
  `RuleId` int(10) unsigned NOT NULL,
  `FirmCode` int(10) unsigned DEFAULT NULL,
  `RegionCode` bigint(20) unsigned DEFAULT NULL,
  `SenderId` int(10) unsigned DEFAULT NULL,
  `FormaterId` int(10) unsigned DEFAULT NULL,
  `SendDebugMessage` tinyint(1) unsigned DEFAULT NULL,
  `ErrorNotificationDelay` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=9425 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `ordersresend`
--

DROP TABLE IF EXISTS `ordersresend`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `ordersresend` (
  `RowID` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `LogTime` datetime NOT NULL DEFAULT '0000-00-00 00:00:00',
  `OperatorName` varchar(20) NOT NULL DEFAULT '0',
  `OperatorHost` varchar(50) NOT NULL DEFAULT '',
  `OrderID` bigint(20) unsigned NOT NULL DEFAULT '0',
  PRIMARY KEY (`RowID`),
  KEY `OrderID` (`OrderID`),
  KEY `LogTime` (`LogTime`),
  KEY `OperatorName` (`OperatorName`)
) ENGINE=InnoDB AUTO_INCREMENT=88311 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `orderssubmit`
--

DROP TABLE IF EXISTS `orderssubmit`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `orderssubmit` (
  `RowId` int(11) unsigned NOT NULL AUTO_INCREMENT,
  `ClientHost` varchar(50) DEFAULT '',
  `UserName` varchar(50) DEFAULT '',
  `LogTime` datetime DEFAULT '2000-01-01 00:00:00',
  `OrderID` int(10) unsigned zerofill NOT NULL DEFAULT '0000000000',
  `Submited` tinyint(1) unsigned DEFAULT NULL,
  `Deleted` tinyint(1) unsigned DEFAULT NULL,
  PRIMARY KEY (`RowId`)
) ENGINE=InnoDB AUTO_INCREMENT=197174 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `passwordchange`
--

DROP TABLE IF EXISTS `passwordchange`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `passwordchange` (
  `RowID` int(11) NOT NULL AUTO_INCREMENT,
  `ClientHost` varchar(20) NOT NULL DEFAULT '',
  `LogTime` datetime NOT NULL DEFAULT '0000-00-00 00:00:00',
  `UserName` varchar(30) NOT NULL DEFAULT '',
  `TargetUserName` varchar(30) NOT NULL DEFAULT '',
  `SmtpId` int(10) unsigned DEFAULT NULL,
  `SentTo` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`RowID`),
  KEY `UserName` (`UserName`),
  KEY `TargetUserName` (`TargetUserName`)
) ENGINE=InnoDB AUTO_INCREMENT=14741 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `paymentlogs`
--

DROP TABLE IF EXISTS `paymentlogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `paymentlogs` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `LogTime` datetime NOT NULL,
  `OperatorName` varchar(50) NOT NULL,
  `OperatorHost` varchar(50) NOT NULL,
  `Operation` tinyint(3) unsigned NOT NULL,
  `PaymentId` int(10) unsigned NOT NULL,
  `PayedOn` datetime DEFAULT NULL,
  `Sum` decimal(10,2) DEFAULT NULL,
  `PayerId` int(10) unsigned DEFAULT NULL,
  `PaymentType` tinyint(1) unsigned DEFAULT NULL,
  `Name` varchar(255) DEFAULT NULL,
  `Discount` int(10) unsigned DEFAULT NULL,
  `RecipientId` int(10) unsigned DEFAULT NULL,
  `RegistredOn` datetime DEFAULT NULL,
  `BankPaymentId` varchar(255) DEFAULT NULL,
  `Comment` varchar(255) DEFAULT NULL,
  `DocumentNumber` varchar(255) DEFAULT NULL,
  `PayerInn` varchar(255) DEFAULT NULL,
  `PayerName` varchar(255) DEFAULT NULL,
  `PayerAccountCode` varchar(255) DEFAULT NULL,
  `PayerBankDescription` varchar(255) DEFAULT NULL,
  `PayerBankBic` varchar(255) DEFAULT NULL,
  `PayerBankAccountCode` varchar(255) DEFAULT NULL,
  `RecipientInn` varchar(255) DEFAULT NULL,
  `RecipientName` varchar(255) DEFAULT NULL,
  `RecipientAccountCode` varchar(255) DEFAULT NULL,
  `RecipientBankDescription` varchar(255) DEFAULT NULL,
  `RecipientBankBic` varchar(255) DEFAULT NULL,
  `RecipientBankAccountCode` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=19812 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `prgdatalogs`
--

DROP TABLE IF EXISTS `prgdatalogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `prgdatalogs` (
  `MethodName` varchar(45) NOT NULL,
  `StartTime` datetime NOT NULL,
  `UserId` int(10) unsigned DEFAULT NULL,
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=5004363 DEFAULT CHARSET=cp1251 PACK_KEYS=0 ROW_FORMAT=DYNAMIC;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `prices_costs_logs`
--

DROP TABLE IF EXISTS `prices_costs_logs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `prices_costs_logs` (
  `ID` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `LogTime` datetime NOT NULL,
  `OperatorName` varchar(50) NOT NULL,
  `OperatorHost` varchar(50) NOT NULL,
  `Operation` tinyint(3) unsigned NOT NULL,
  `pricescostsID` int(11) unsigned NOT NULL,
  `PriceCode` int(11) unsigned DEFAULT NULL,
  `PriceItemId` int(11) unsigned DEFAULT NULL,
  `Enabled` tinyint(1) DEFAULT NULL,
  `AgencyEnabled` tinyint(1) DEFAULT NULL,
  `CostName` varchar(50) DEFAULT NULL,
  `BaseCost` tinyint(1) DEFAULT NULL,
  PRIMARY KEY (`ID`),
  KEY `LogTime` (`LogTime`)
) ENGINE=InnoDB AUTO_INCREMENT=55616 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `prices_data_logs`
--

DROP TABLE IF EXISTS `prices_data_logs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `prices_data_logs` (
  `ID` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `LogTime` datetime NOT NULL,
  `OperatorName` varchar(50) NOT NULL,
  `OperatorHost` varchar(50) NOT NULL,
  `Operation` tinyint(3) unsigned NOT NULL,
  `pricesdataID` int(11) unsigned NOT NULL,
  `FirmCode` int(11) unsigned DEFAULT NULL,
  `RegionMask` bigint(20) unsigned DEFAULT NULL,
  `AgencyEnabled` tinyint(1) unsigned DEFAULT NULL,
  `Enabled` tinyint(1) unsigned DEFAULT NULL,
  `ShowInWeb` tinyint(1) unsigned DEFAULT NULL,
  `AlowInt` tinyint(1) unsigned DEFAULT NULL,
  `PriceType` tinyint(1) unsigned DEFAULT NULL,
  `PriceName` varchar(50) DEFAULT NULL,
  `MinReq` int(11) unsigned DEFAULT NULL,
  `upcost` decimal(5,2) DEFAULT NULL,
  `priceinfo` text,
  `percentcorr` decimal(5,2) DEFAULT NULL,
  `OrderEmailSubject` varchar(100) DEFAULT NULL,
  `Protek` tinyint(1) DEFAULT NULL,
  `CostType` tinyint(1) unsigned DEFAULT NULL,
  `ParentSynonym` int(11) unsigned DEFAULT NULL,
  PRIMARY KEY (`ID`),
  KEY `LogTime` (`LogTime`)
) ENGINE=InnoDB AUTO_INCREMENT=145083 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `prices_regional_data_logs`
--

DROP TABLE IF EXISTS `prices_regional_data_logs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `prices_regional_data_logs` (
  `ID` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `LogTime` datetime NOT NULL,
  `OperatorName` varchar(50) NOT NULL,
  `OperatorHost` varchar(50) NOT NULL,
  `Operation` tinyint(3) unsigned NOT NULL,
  `pricesregionaldataID` int(11) unsigned NOT NULL,
  `PriceCode` int(11) unsigned DEFAULT NULL,
  `RegionCode` bigint(20) unsigned DEFAULT NULL,
  `UpCost` decimal(5,2) DEFAULT NULL,
  `minreq` int(11) unsigned DEFAULT NULL,
  `Enabled` tinyint(1) DEFAULT NULL,
  PRIMARY KEY (`ID`),
  KEY `LogTime` (`LogTime`)
) ENGINE=InnoDB AUTO_INCREMENT=27757 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `pricesretrans`
--

DROP TABLE IF EXISTS `pricesretrans`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `pricesretrans` (
  `RowID` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `LogTime` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `OperatorName` varchar(50) DEFAULT NULL,
  `OperatorHost` varchar(50) DEFAULT NULL,
  `PriceItemId` int(11) unsigned DEFAULT NULL,
  `RetransType` tinyint(3) unsigned NOT NULL DEFAULT '0' COMMENT '0 - переподложили из Base, 1 - перепровели из архива',
  PRIMARY KEY (`RowID`) USING BTREE,
  KEY `PriceItemId_IDX` (`PriceItemId`),
  KEY `LogTime_IDX` (`LogTime`,`PriceItemId`)
) ENGINE=InnoDB AUTO_INCREMENT=830741 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER logs.PricesRetransAfterInsert AFTER INSERT
ON logs.PricesRetrans FOR EACH ROW BEGIN
  update usersettings.PriceItems
  set
    LastRetrans = NEW.LogTime
  where
    Id = NEW.PriceItemId;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `producerequivalentlogs`
--

DROP TABLE IF EXISTS `producerequivalentlogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `producerequivalentlogs` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `LogTime` datetime NOT NULL,
  `OperatorName` varchar(50) NOT NULL,
  `OperatorHost` varchar(50) NOT NULL,
  `Operation` tinyint(3) unsigned NOT NULL,
  `ProducerequivalentId` int(10) unsigned NOT NULL,
  `Name` int(10) unsigned DEFAULT NULL,
  `ProducerId` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=2266 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `producerlogs`
--

DROP TABLE IF EXISTS `producerlogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `producerlogs` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `LogTime` datetime NOT NULL,
  `OperatorName` varchar(50) NOT NULL,
  `OperatorHost` varchar(50) NOT NULL,
  `Operation` tinyint(3) unsigned NOT NULL,
  `ProducerId` int(10) unsigned NOT NULL,
  `Name` varchar(255) DEFAULT NULL,
  `Checked` tinyint(1) DEFAULT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=21172 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `productslogs`
--

DROP TABLE IF EXISTS `productslogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `productslogs` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `LogTime` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `OperatorName` varchar(50) DEFAULT NULL,
  `OperatorHost` varchar(50) DEFAULT NULL,
  `Operation` tinyint(3) unsigned DEFAULT NULL,
  `ProductId` int(10) unsigned DEFAULT NULL,
  `CatalogId` int(10) unsigned DEFAULT NULL,
  `Hidden` tinyint(1) DEFAULT NULL,
  PRIMARY KEY (`Id`),
  KEY `ProductId` (`ProductId`)
) ENGINE=InnoDB AUTO_INCREMENT=884821 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `promotioncataloglogs`
--

DROP TABLE IF EXISTS `promotioncataloglogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `promotioncataloglogs` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `LogTime` datetime NOT NULL,
  `OperatorName` varchar(50) NOT NULL,
  `OperatorHost` varchar(50) NOT NULL,
  `Operation` tinyint(3) unsigned NOT NULL,
  `CatalogId` int(10) unsigned DEFAULT NULL,
  `PromotionId` int(10) unsigned DEFAULT NULL,
  `UpdateTime` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=30582 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `recordcalls`
--

DROP TABLE IF EXISTS `recordcalls`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `recordcalls` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `WriteTime` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `From` varchar(45) NOT NULL,
  `To` varchar(45) NOT NULL,
  `NameFrom` varchar(255) DEFAULT NULL COMMENT 'Имя. Кто звонил',
  `NameTo` varchar(255) DEFAULT NULL COMMENT 'Имя. Куда звонил',
  `CallType` int(10) unsigned DEFAULT NULL COMMENT 'Тип звонка\r\n1 - входящий\r\n2 - исходящий\r\n3 - отзвон\r\nNULL - не определено',
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=169013 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `regional_data_logs`
--

DROP TABLE IF EXISTS `regional_data_logs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `regional_data_logs` (
  `ID` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `LogTime` datetime NOT NULL,
  `OperatorName` varchar(50) NOT NULL,
  `OperatorHost` varchar(50) NOT NULL,
  `Operation` tinyint(3) unsigned NOT NULL,
  `RegionalDataID` int(11) unsigned NOT NULL,
  `RegionCode` bigint(20) unsigned DEFAULT NULL,
  `FirmCode` int(10) unsigned DEFAULT NULL,
  `Enabled` tinyint(1) unsigned DEFAULT NULL,
  `UpCost` decimal(3,2) DEFAULT NULL,
  `Storage` tinyint(1) unsigned DEFAULT NULL,
  `MinReq` int(11) unsigned DEFAULT NULL,
  `AdminMail` varchar(50) DEFAULT NULL,
  `TmpMail` varchar(50) DEFAULT NULL,
  `SupportPhone` varchar(20) DEFAULT NULL,
  `ContactInfo` text,
  `OperativeInfo` text,
  `ConfigOrderCode` int(11) unsigned DEFAULT NULL,
  PRIMARY KEY (`ID`),
  KEY `LogTime` (`LogTime`)
) ENGINE=InnoDB AUTO_INCREMENT=41609 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `reportslogs`
--

DROP TABLE IF EXISTS `reportslogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `reportslogs` (
  `RowId` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `LogTime` datetime DEFAULT NULL,
  `GeneralReportCode` int(10) unsigned NOT NULL DEFAULT '0',
  `SMTPID` int(10) unsigned NOT NULL DEFAULT '0',
  `MessageID` varchar(70) NOT NULL DEFAULT '',
  `EMail` varchar(45) DEFAULT NULL,
  PRIMARY KEY (`RowId`),
  KEY `LogTime` (`LogTime`),
  KEY `GeneralReportCode` (`GeneralReportCode`)
) ENGINE=InnoDB AUTO_INCREMENT=583167 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT COMMENT='InnoDB free: 1320960 kB; InnoDB free: 1307648 kB; InnoDB fre';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `reportsreslogs`
--

DROP TABLE IF EXISTS `reportsreslogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `reportsreslogs` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `GeneralReportCode` bigint(20) unsigned NOT NULL DEFAULT '0',
  `ReportCode` bigint(20) unsigned NOT NULL DEFAULT '0',
  `StartTime` datetime DEFAULT NULL,
  `StopTime` datetime DEFAULT NULL,
  `ErrorMessage` mediumtext,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=57929 DEFAULT CHARSET=cp1251;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `schemamigrations`
--

DROP TABLE IF EXISTS `schemamigrations`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `schemamigrations` (
  `Version` varchar(255) NOT NULL DEFAULT '',
  `MigratedOn` datetime DEFAULT NULL,
  PRIMARY KEY (`Version`)
) ENGINE=InnoDB DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `showuserlogs`
--

DROP TABLE IF EXISTS `showuserlogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `showuserlogs` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `LogTime` datetime NOT NULL,
  `OperatorName` varchar(50) NOT NULL,
  `OperatorHost` varchar(50) NOT NULL,
  `Operation` tinyint(3) unsigned NOT NULL,
  `PrimaryUserId` int(10) unsigned DEFAULT NULL,
  `ShowUserId` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=6152 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `smartorderlogs`
--

DROP TABLE IF EXISTS `smartorderlogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `smartorderlogs` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `SourceOrderLineId` int(10) unsigned DEFAULT NULL,
  `ResultOrderLineId` int(10) unsigned DEFAULT NULL,
  `Comment` mediumtext,
  `LogTime` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`Id`),
  KEY `FK_smart_order_logs_SourceOrderLineId` (`SourceOrderLineId`),
  KEY `FK_smart_order_logs_ResultOrderLineId` (`ResultOrderLineId`)
) ENGINE=InnoDB AUTO_INCREMENT=240 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `smartorderrulelogs`
--

DROP TABLE IF EXISTS `smartorderrulelogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `smartorderrulelogs` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `LogTime` datetime NOT NULL,
  `OperatorName` varchar(50) NOT NULL,
  `OperatorHost` varchar(50) NOT NULL,
  `Operation` tinyint(3) unsigned NOT NULL,
  `RuleId` int(10) unsigned NOT NULL,
  `OffersClientCode` int(10) unsigned DEFAULT NULL,
  `ParseAlgorithm` varchar(45) DEFAULT NULL,
  `CheckAverageCost` tinyint(1) unsigned DEFAULT NULL,
  `AverageCostBasedOnLineCount` int(10) unsigned DEFAULT NULL,
  `DoNotOrderIfNotOrderedEarly` tinyint(1) unsigned DEFAULT NULL,
  `CheckOrderCost` tinyint(1) unsigned DEFAULT NULL,
  `CheckRequestRatio` tinyint(1) DEFAULT NULL,
  `SearchInCategory` tinyint(1) unsigned DEFAULT NULL,
  `From5To4` float DEFAULT NULL,
  `From4To3` float DEFAULT NULL,
  `From3To2` float DEFAULT NULL,
  `From2To1` float DEFAULT NULL,
  `From1To0` float DEFAULT NULL,
  `CheckMinOrderCount` tinyint(1) unsigned DEFAULT NULL,
  `OverPercentAverageCost` int(10) unsigned DEFAULT NULL,
  `AssortimentPriceCode` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=12494 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `sources_logs`
--

DROP TABLE IF EXISTS `sources_logs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `sources_logs` (
  `ID` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `LogTime` datetime NOT NULL,
  `OperatorName` varchar(50) NOT NULL,
  `OperatorHost` varchar(50) NOT NULL,
  `Operation` tinyint(3) unsigned NOT NULL,
  `sourcesID` int(11) unsigned NOT NULL,
  `SourceTypeId` int(11) unsigned DEFAULT NULL,
  `PricePath` varchar(255) DEFAULT NULL,
  `EMailTo` varchar(255) DEFAULT NULL,
  `EMailFrom` varchar(255) DEFAULT NULL,
  `FTPDir` varchar(255) DEFAULT NULL,
  `FTPLogin` varchar(100) DEFAULT NULL,
  `FTPPassword` varchar(100) DEFAULT NULL,
  `FTPPassiveMode` tinyint(1) DEFAULT NULL,
  `PriceMask` varchar(255) DEFAULT NULL,
  `ExtrMask` varchar(255) DEFAULT NULL,
  `ArchivePassword` varchar(100) DEFAULT NULL,
  `HTTPLogin` varchar(100) DEFAULT NULL,
  `HTTPPassword` varchar(100) DEFAULT NULL,
  PRIMARY KEY (`ID`),
  KEY `LogTime` (`LogTime`)
) ENGINE=InnoDB AUTO_INCREMENT=66708967 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `spyinfo`
--

DROP TABLE IF EXISTS `spyinfo`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `spyinfo` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `UserId` int(10) unsigned NOT NULL,
  `LogTime` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `Login` varchar(255) DEFAULT NULL,
  `Password` varchar(255) DEFAULT NULL,
  `OriginalPassword` varchar(255) DEFAULT NULL,
  `SerialNumber` varchar(8) DEFAULT NULL,
  `MaxWriteTime` datetime DEFAULT NULL,
  `MaxWriteFileName` varchar(255) DEFAULT NULL,
  `OrderWriteTime` datetime DEFAULT NULL,
  `ClientTimeZoneBias` int(11) DEFAULT NULL,
  `DNSChangedState` tinyint(1) DEFAULT NULL,
  `RASEntry` varchar(30) DEFAULT NULL,
  `DefaultGateway` varchar(15) DEFAULT NULL,
  `IsDynamicDnsEnabled` tinyint(1) DEFAULT NULL,
  `ConnectionSettingId` varchar(255) DEFAULT NULL,
  `PrimaryDNS` varchar(15) DEFAULT NULL,
  `AlternateDNS` varchar(15) DEFAULT NULL,
  `RostaUIN` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`Id`),
  KEY `UserId` (`UserId`),
  KEY `LogTime` (`LogTime`)
) ENGINE=InnoDB AUTO_INCREMENT=327325 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `supplierlogs`
--

DROP TABLE IF EXISTS `supplierlogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `supplierlogs` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `LogTime` datetime NOT NULL,
  `OperatorName` varchar(50) NOT NULL,
  `OperatorHost` varchar(50) NOT NULL,
  `Operation` tinyint(3) unsigned NOT NULL,
  `SupplierId` int(10) unsigned NOT NULL,
  `Name` varchar(255) DEFAULT NULL,
  `FullName` varchar(255) DEFAULT NULL,
  `RegionMask` bigint(20) unsigned DEFAULT NULL,
  `Disabled` tinyint(1) DEFAULT NULL,
  `Registrant` varchar(255) DEFAULT NULL,
  `RegistrationDate` datetime DEFAULT NULL,
  `HomeRegion` bigint(20) unsigned DEFAULT NULL,
  `ContactGroupOwnerId` int(10) unsigned DEFAULT NULL,
  `Payer` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=3842 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `supplierpromotionlogs`
--

DROP TABLE IF EXISTS `supplierpromotionlogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `supplierpromotionlogs` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `LogTime` datetime NOT NULL,
  `OperatorName` varchar(50) NOT NULL,
  `OperatorHost` varchar(50) NOT NULL,
  `Operation` tinyint(3) unsigned NOT NULL,
  `PromotionId` int(10) unsigned NOT NULL,
  `UpdateTime` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `Enabled` tinyint(1) unsigned DEFAULT NULL,
  `SupplierId` int(10) unsigned DEFAULT NULL,
  `Annotation` varchar(255) DEFAULT NULL,
  `PromoFile` varchar(255) DEFAULT NULL,
  `AgencyDisabled` tinyint(1) unsigned DEFAULT NULL,
  `Name` varchar(255) DEFAULT NULL,
  `RegionMask` bigint(20) unsigned DEFAULT NULL,
  `Begin` datetime DEFAULT NULL,
  `End` datetime DEFAULT NULL,
  `Status` tinyint(1) unsigned DEFAULT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=1919 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `synonymfirmcrlogs`
--

DROP TABLE IF EXISTS `synonymfirmcrlogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `synonymfirmcrlogs` (
  `RowID` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `LogTime` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `OperatorName` varchar(50) DEFAULT NULL,
  `OperatorHost` varchar(50) DEFAULT NULL,
  `Operation` tinyint(1) DEFAULT NULL,
  `SynonymFirmCrCode` int(10) unsigned DEFAULT NULL,
  `PriceCode` int(10) unsigned DEFAULT NULL,
  `ChildPriceCode` int(10) unsigned DEFAULT NULL,
  `CodeFirmCr` int(10) unsigned DEFAULT NULL,
  `Synonym` varchar(255) DEFAULT NULL,
  `Cause` varchar(50) DEFAULT NULL,
  PRIMARY KEY (`RowID`) USING BTREE,
  KEY `SynonymFirmCrCode` (`SynonymFirmCrCode`),
  KEY `PriceCode` (`PriceCode`),
  KEY `codefirmcr` (`CodeFirmCr`),
  KEY `synonym` (`Synonym`),
  KEY `OperatorName_IDX` (`OperatorName`),
  KEY `LogTime_PriceCode` (`LogTime`,`PriceCode`) USING BTREE
) ENGINE=InnoDB AUTO_INCREMENT=3400114 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT COMMENT='InnoDB free: 2392064 kB';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `synonymlogs`
--

DROP TABLE IF EXISTS `synonymlogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `synonymlogs` (
  `RowID` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `LogTime` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `OperatorName` varchar(50) DEFAULT NULL,
  `OperatorHost` varchar(50) DEFAULT NULL,
  `Operation` tinyint(1) DEFAULT NULL,
  `SynonymCode` int(10) unsigned DEFAULT NULL,
  `PriceCode` int(10) unsigned DEFAULT NULL,
  `ChildPriceCode` int(10) unsigned DEFAULT NULL,
  `ProductId` int(10) unsigned DEFAULT NULL,
  `Synonym` varchar(255) DEFAULT NULL,
  `Junk` varchar(20) DEFAULT NULL,
  `Cause` varchar(50) DEFAULT NULL,
  PRIMARY KEY (`RowID`),
  KEY `SynonymCode` (`SynonymCode`),
  KEY `PriceCode` (`PriceCode`),
  KEY `SynT` (`Synonym`),
  KEY `OperatorName_IDX` (`OperatorName`),
  KEY `ProductId_Index` (`ProductId`) USING BTREE,
  KEY `LogTime_PriceCode` (`LogTime`,`PriceCode`) USING BTREE
) ENGINE=InnoDB AUTO_INCREMENT=6678275 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT COMMENT='InnoDB free: 2387968 kB';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `updatedownloadlogs`
--

DROP TABLE IF EXISTS `updatedownloadlogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `updatedownloadlogs` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `UpdateId` int(10) unsigned DEFAULT NULL,
  `LogTime` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `ClientHost` varchar(100) DEFAULT NULL,
  `FromByte` int(10) unsigned DEFAULT NULL,
  `SendBytes` int(10) unsigned DEFAULT NULL,
  `TotalBytes` int(10) unsigned DEFAULT NULL,
  `Addition` mediumtext,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=5520089 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `useraddresslogs`
--

DROP TABLE IF EXISTS `useraddresslogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `useraddresslogs` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `LogTime` datetime NOT NULL,
  `OperatorName` varchar(50) NOT NULL,
  `OperatorHost` varchar(50) NOT NULL,
  `Operation` tinyint(3) unsigned NOT NULL,
  `UserId` int(10) unsigned DEFAULT NULL,
  `AddressId` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=104286 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `userpricelogs`
--

DROP TABLE IF EXISTS `userpricelogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `userpricelogs` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `LogTime` datetime NOT NULL,
  `OperatorName` varchar(50) NOT NULL,
  `OperatorHost` varchar(50) NOT NULL,
  `Operation` tinyint(3) unsigned NOT NULL,
  `UserId` int(10) unsigned DEFAULT NULL,
  `PriceId` int(10) unsigned DEFAULT NULL,
  `RegionId` bigint(20) unsigned DEFAULT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=2961864 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `watchdog`
--

DROP TABLE IF EXISTS `watchdog`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `watchdog` (
  `ReplicationTime` datetime DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping events for database 'logs'
--
/*!50106 SET @save_time_zone= @@TIME_ZONE */ ;
/*!50106 DROP EVENT IF EXISTS `ClearStatistics` */;
DELIMITER ;;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;;
/*!50003 SET character_set_client  = utf8 */ ;;
/*!50003 SET character_set_results = utf8 */ ;;
/*!50003 SET collation_connection  = utf8_general_ci */ ;;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;;
/*!50003 SET sql_mode              = '' */ ;;
/*!50003 SET @saved_time_zone      = @@time_zone */ ;;
/*!50003 SET time_zone             = 'SYSTEM' */ ;;
/*!50106 CREATE*/ /*!50117 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50106 EVENT `ClearStatistics` ON SCHEDULE EVERY 1 DAY STARTS '2008-03-03 01:30:00' ON COMPLETION PRESERVE ENABLE DO CALL
logs.ClearStatistics() */ ;;
/*!50003 SET time_zone             = @saved_time_zone */ ;;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;;
/*!50003 SET character_set_client  = @saved_cs_client */ ;;
/*!50003 SET character_set_results = @saved_cs_results */ ;;
/*!50003 SET collation_connection  = @saved_col_connection */ ;;
/*!50106 DROP EVENT IF EXISTS `DeleteOldLocks` */;;
DELIMITER ;;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;;
/*!50003 SET character_set_client  = utf8 */ ;;
/*!50003 SET character_set_results = utf8 */ ;;
/*!50003 SET collation_connection  = utf8_general_ci */ ;;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;;
/*!50003 SET sql_mode              = '' */ ;;
/*!50003 SET @saved_time_zone      = @@time_zone */ ;;
/*!50003 SET time_zone             = 'SYSTEM' */ ;;
/*!50106 CREATE*/ /*!50117 DEFINER=`RPA`@`rpa.adc.analit.net`*/ /*!50106 EVENT `DeleteOldLocks` ON SCHEDULE EVERY 4 MINUTE STARTS '2011-11-28 15:30:00' ON COMPLETION PRESERVE ENABLE DO BEGIN
  DELETE
FROM
  Logs.PrgDataLogs
WHERE
  StartTime < now() - INTERVAL 20 MINUTE
  AND MethodName = 'FileHandler';
  DELETE
FROM
  Logs.PrgDataLogs
WHERE
  StartTime < now() - INTERVAL 5 MINUTE
  AND MethodName != 'FileHandler';
END */ ;;
/*!50003 SET time_zone             = @saved_time_zone */ ;;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;;
/*!50003 SET character_set_client  = @saved_cs_client */ ;;
/*!50003 SET character_set_results = @saved_cs_results */ ;;
/*!50003 SET collation_connection  = @saved_col_connection */ ;;
DELIMITER ;
/*!50106 SET TIME_ZONE= @save_time_zone */ ;

--
-- Dumping routines for database 'logs'
--
/*!50003 DROP PROCEDURE IF EXISTS `ClearLog` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50020 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 PROCEDURE `ClearLog`()
BEGIN
SELECT table_name FROM information_schema.`TABLES` T
where table_schema='logs'
and table_name in(
'CatalogFormsLogs',
'CatalogLogs',
'CatalogNamesLogs',
'ProductsLogs',
'ContactLogs',
'DocumentSourcesLogs',
'ForbiddenLogs',
'Intersection_Logs',
'IntersectionLogs',
'Prices_Costs_Logs',
'Prices_Data_Logs',
'Prices_Regional_Data_Logs',
'Regional_Data_Logs',
'RetClientsSetLogs',
'SynonymFirmCrlogs',
'Synonymlogs')

;


END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `ClearStatistics` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50020 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 PROCEDURE `ClearStatistics`()
BEGIN
   UPDATE
    AnalitFUpdates
  SET
    `Log` = NULL
  WHERE
    requesttime < CURDATE() - INTERVAL 1 MONTH;
  DELETE
  FROM
    AnalitFUpdates
  WHERE
    requesttime < CURDATE() - INTERVAL 4 MONTH;
  DELETE
  FROM
    CatalogFormsLogs
  WHERE
    logtime < CURDATE() - INTERVAL 1 YEAR;
  DELETE
  FROM
    CatalogLogs
  WHERE
    logtime < CURDATE() - INTERVAL 1 YEAR;
  DELETE
  FROM
    CatalogNamesLogs
  WHERE
    logtime < CURDATE() - INTERVAL 1 YEAR;
  DELETE
  FROM
    OnlineServicesLogs
  WHERE
    logtime < CURDATE() - INTERVAL 2 MONTH;
  DELETE
  FROM
    PricesRetrans
  WHERE
    logtime < CURDATE() - INTERVAL 2 MONTH;
    DELETE
  FROM
    ProductsLogs
  WHERE
    logtime < CURDATE() - INTERVAL 1 YEAR;
  DELETE
  FROM
    SmartOrderLogs
  WHERE
    logtime < CURDATE() - INTERVAL 2 MONTH;
  DELETE
  FROM
    UpdateDownloadLogs
  WHERE
    logtime < CURDATE() - INTERVAL 2 MONTH;
  DELETE
  FROM
    clientsinfo
  WHERE
    writetime < CURDATE() - INTERVAL 3 YEAR;
  DELETE
  FROM
    clone
  WHERE
    logtime < CURDATE() - INTERVAL 2 MONTH;
  DELETE
  FROM
    contactlogs
  WHERE
    logtime < CURDATE() - INTERVAL 1 YEAR;
  DELETE
  FROM
    document_logs
  WHERE
    logtime < CURDATE() - INTERVAL 3 MONTH;
  DELETE
  FROM
    documentsourceslogs
  WHERE
    logtime < CURDATE() - INTERVAL 1 YEAR;
  DELETE
  FROM
    downlogs
  WHERE
    logtime < CURDATE() - INTERVAL 2 MONTH;
  DELETE
  FROM
    forbiddenlogs
  WHERE
    logtime < CURDATE() - INTERVAL 1 YEAR;
  DELETE
  FROM
    formlogs
  WHERE
    logtime < CURDATE() - INTERVAL 2 MONTH;
  DELETE
  FROM
    IISLogs
  WHERE
    logtime < CURDATE() - INTERVAL 2 MONTH;
  DELETE
  FROM
    intersection_logs
  WHERE
    logtime < CURDATE() - INTERVAL 1 YEAR;

  DELETE
  FROM
    intersectionlogs
  WHERE
    logtime < CURDATE() - INTERVAL 1 YEAR;



  DELETE
  FROM
    orders
  WHERE
    logtime < CURDATE() - INTERVAL 3 MONTH;
  DELETE
  FROM
    ordersresend
  WHERE
    logtime < CURDATE() - INTERVAL 3 MONTH;
  DELETE
  FROM
    orderssubmit
  WHERE
    logtime < CURDATE() - INTERVAL 2 MONTH;
  DELETE
  FROM
    prices_costs_logs
  WHERE
    logtime < CURDATE() - INTERVAL 1 YEAR;
  DELETE
  FROM
    prices_data_logs
  WHERE
    logtime < CURDATE() - INTERVAL 1 YEAR;
  DELETE
  FROM
    prices_regional_data_logs
  WHERE
    logtime < CURDATE() - INTERVAL 1 YEAR;
  DELETE
  FROM
    regional_data_logs
  WHERE
    logtime < CURDATE() - INTERVAL 1 YEAR;
  DELETE
  FROM
    reportslogs
  WHERE
    logtime < CURDATE() - INTERVAL 2 MONTH;
  DELETE
  FROM
    RetClientsSetLogs
  WHERE
    logtime < CURDATE() - INTERVAL 1 YEAR;
  DELETE
  FROM
    sources_logs
  WHERE
    logtime < CURDATE() - INTERVAL 2 MONTH;
  DELETE
  FROM
    synonymfirmcrlogs
  WHERE
    logtime < CURDATE() - INTERVAL 1 YEAR;
  DELETE
  FROM
    synonymlogs
  WHERE
    logtime < CURDATE() - INTERVAL 1 YEAR;
  DELETE
  FROM
    DhcpLogs
  WHERE
    logtime < CURDATE() - INTERVAL 1 WEEK;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Current Database: `orders`
--

/*!40000 DROP DATABASE IF EXISTS `orders`*/;

CREATE DATABASE /*!32312 IF NOT EXISTS*/ `orders` /*!40100 DEFAULT CHARACTER SET cp1251 */;

USE `orders`;

--
-- Table structure for table `leaders`
--

DROP TABLE IF EXISTS `leaders`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `leaders` (
  `OrderListID` int(10) unsigned NOT NULL DEFAULT '0',
  `MinCost` decimal(9,2) unsigned DEFAULT NULL,
  `LeaderMinCost` decimal(9,2) unsigned DEFAULT NULL,
  `PriceCode` int(10) unsigned DEFAULT NULL,
  `LeaderPriceCode` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`OrderListID`),
  CONSTRAINT `O_L_OLId` FOREIGN KEY (`OrderListID`) REFERENCES `orderslist` (`RowID`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=cp1251 PACK_KEYS=0 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `orderedoffers`
--

DROP TABLE IF EXISTS `orderedoffers`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `orderedoffers` (
  `ID` int(10) unsigned NOT NULL,
  `Unit` varchar(15) DEFAULT NULL,
  `Volume` varchar(15) DEFAULT NULL,
  `Note` varchar(50) DEFAULT NULL,
  `Period` varchar(50) DEFAULT NULL,
  `Doc` varchar(20) DEFAULT NULL,
  `MinBoundCost` decimal(8,2) DEFAULT NULL,
  `VitallyImportant` tinyint(1) DEFAULT NULL,
  `RegistryCost` decimal(8,2) DEFAULT NULL,
  `MaxBoundCost` decimal(8,2) DEFAULT NULL,
  `CoreUpdateTime` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `CoreQuantityUpdate` timestamp NOT NULL DEFAULT '0000-00-00 00:00:00',
  `Quantity` varchar(15) DEFAULT NULL,
  `ProducerCost` decimal(12,6) unsigned DEFAULT NULL,
  `NDS` smallint(5) unsigned DEFAULT NULL,
  PRIMARY KEY (`ID`),
  CONSTRAINT `FK_OrderedOffers_1` FOREIGN KEY (`ID`) REFERENCES `orderslist` (`RowID`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=cp1251 PACK_KEYS=0 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `ordershead`
--

DROP TABLE IF EXISTS `ordershead`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `ordershead` (
  `RowID` int(10) unsigned NOT NULL AUTO_INCREMENT COMMENT 'Номер заказа',
  `WriteTime` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `ClientCode` int(10) unsigned DEFAULT NULL COMMENT 'Код заказчика',
  `AddressId` int(10) unsigned DEFAULT NULL,
  `UserId` int(10) unsigned DEFAULT NULL,
  `PriceCode` int(10) unsigned DEFAULT NULL COMMENT 'Код прай-листа',
  `RegionCode` bigint(20) unsigned DEFAULT NULL COMMENT 'Код региона заказа',
  `PriceDate` datetime DEFAULT NULL COMMENT 'Дата прайс-листа',
  `ClientAddition` mediumtext COMMENT 'Комментарий клиента',
  `RowCount` int(10) unsigned DEFAULT NULL COMMENT 'Колличество позиций в заказе',
  `Processed` tinyint(1) unsigned DEFAULT '0' COMMENT 'Р В Р’В Р Р†Р вЂљРІР‚СњР В Р’В Р вЂ™Р’В°Р В Р’В Р РЋРІР‚СњР В Р’В Р вЂ™Р’В°Р В Р’В Р вЂ™Р’В· Р В Р’В Р РЋРІР‚СћР В Р’В Р вЂ™Р’В±Р В Р Р‹Р В РІР‚С™Р В Р’В Р вЂ™Р’В°Р В Р’В Р вЂ™Р’В±Р В Р’В Р РЋРІР‚СћР В Р Р‹Р Р†Р вЂљРЎв„ўР В Р’В Р вЂ™Р’В°Р В Р’В Р В РІР‚В¦',
  `Submited` tinyint(1) unsigned DEFAULT '0' COMMENT 'Р В Р’В Р Р†Р вЂљРІР‚СњР В Р’В Р вЂ™Р’В°Р В Р’В Р РЋРІР‚СњР В Р’В Р вЂ™Р’В°Р В Р’В Р вЂ™Р’В· Р В Р’В Р РЋРІР‚вЂќР В Р’В Р РЋРІР‚СћР В Р’В Р СћРІР‚ВР В Р Р‹Р Р†Р вЂљРЎв„ўР В Р’В Р В РІР‚В Р В Р’В Р вЂ™Р’ВµР В Р Р‹Р В РІР‚С™Р В Р’В Р вЂ™Р’В¶Р В Р’В Р СћРІР',
  `Deleted` tinyint(1) unsigned DEFAULT '0' COMMENT 'Р В Р’В Р Р†Р вЂљРІР‚СњР В Р’В Р вЂ™Р’В°Р В Р’В Р РЋРІР‚СњР В Р’В Р вЂ™Р’В°Р В Р’В Р вЂ™Р’В· Р В Р’В Р РЋРІР‚СћР В Р Р‹Р Р†Р вЂљРЎв„ўР В Р’В Р РЋРІР‚СњР В Р’В Р вЂ™Р’В»Р В Р’В Р РЋРІР‚СћР В Р’В Р В РІР‚В¦Р В Р’В Р вЂ™Р’ВµР В Р’В Р В РІР‚В¦',
  `SubmitDate` datetime DEFAULT NULL COMMENT 'Дата подтверждения заказа',
  `ClientOrderId` int(10) unsigned DEFAULT NULL,
  `CalculateLeader` tinyint(1) unsigned NOT NULL,
  `DelayOfPayment` decimal(5,3) DEFAULT NULL,
  `VitallyImportantDelayOfPayment` decimal(5,3) DEFAULT NULL,
  PRIMARY KEY (`RowID`),
  KEY `ClientOrderId_IDX` (`ClientOrderId`),
  KEY `Client_Price_Region` (`ClientCode`,`PriceCode`,`RegionCode`),
  KEY `Price_Region` (`PriceCode`,`RegionCode`),
  KEY `Region` (`RegionCode`),
  KEY `Processed` (`Processed`),
  KEY `WriteTime` (`WriteTime`),
  KEY `CalculateLeader` (`CalculateLeader`),
  KEY `FK_OrdersHead_AddressId` (`AddressId`),
  KEY `FK_OrdersHead_UserId` (`UserId`),
  CONSTRAINT `FK_OrdersHead_AddressId` FOREIGN KEY (`AddressId`) REFERENCES `future`.`addresses` (`Id`) ON DELETE SET NULL,
  CONSTRAINT `FK_OrdersHead_UserId` FOREIGN KEY (`UserId`) REFERENCES `future`.`users` (`Id`) ON DELETE SET NULL,
  CONSTRAINT `O_OH_ClientCode` FOREIGN KEY (`ClientCode`) REFERENCES `usersettings`.`retclientsset` (`ClientCode`) ON DELETE SET NULL ON UPDATE CASCADE,
  CONSTRAINT `O_OH_PriceCode` FOREIGN KEY (`PriceCode`) REFERENCES `usersettings`.`pricesdata` (`PriceCode`) ON DELETE SET NULL ON UPDATE CASCADE,
  CONSTRAINT `O_OH_RegionCode` FOREIGN KEY (`RegionCode`) REFERENCES `farm`.`regions` (`RegionCode`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=25388097 DEFAULT CHARSET=cp1251 PACK_KEYS=0 DELAY_KEY_WRITE=1 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `orderslist`
--

DROP TABLE IF EXISTS `orderslist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `orderslist` (
  `RowID` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `OrderID` int(11) unsigned DEFAULT NULL,
  `CoreId` bigint(20) unsigned DEFAULT NULL,
  `ProductId` int(10) unsigned DEFAULT NULL,
  `CodeFirmCr` int(11) unsigned DEFAULT NULL,
  `SynonymCode` int(11) unsigned DEFAULT NULL,
  `SynonymFirmCrCode` int(11) unsigned DEFAULT NULL,
  `Code` varchar(20) DEFAULT NULL,
  `CodeCr` varchar(20) DEFAULT NULL,
  `Quantity` int(11) unsigned DEFAULT NULL,
  `Junk` tinyint(1) unsigned NOT NULL DEFAULT '0',
  `Await` tinyint(1) unsigned NOT NULL DEFAULT '0',
  `RequestRatio` smallint(5) unsigned DEFAULT NULL,
  `OrderCost` decimal(8,2) unsigned DEFAULT NULL,
  `MinOrderCount` int(10) unsigned DEFAULT NULL,
  `Cost` decimal(9,2) unsigned DEFAULT NULL,
  `SupplierPriceMarkup` decimal(5,3) DEFAULT NULL,
  `RetailMarkup` decimal(12,6) DEFAULT NULL,
  `RetailCost` decimal(9,2) unsigned DEFAULT NULL COMMENT 'Розничная цена, сформированная клиентом',
  `CostWithDelayOfPayment` decimal(9,2) unsigned DEFAULT NULL,
  PRIMARY KEY (`RowID`),
  KEY `SynonymFirmCrCode_IDX` (`SynonymFirmCrCode`) USING BTREE,
  KEY `OrderId_IDX` (`OrderID`) USING BTREE,
  KEY `CodeFirmCr_IDX` (`CodeFirmCr`) USING BTREE,
  KEY `SynonymCode_IDX` (`SynonymCode`) USING BTREE,
  KEY `Junk_IDX` (`Junk`) USING BTREE,
  KEY `ProductId_Idx` (`ProductId`) USING BTREE,
  KEY `CoreId_IDX` (`CoreId`),
  KEY `Id_ProductId_Junk` (`OrderID`,`ProductId`,`Junk`),
  KEY `SynonymCode` (`SynonymCode`),
  KEY `SynonymFirmCrCode` (`SynonymFirmCrCode`),
  CONSTRAINT `FR_OrderList_ProducerId` FOREIGN KEY (`CodeFirmCr`) REFERENCES `catalogs`.`producers` (`Id`) ON DELETE SET NULL ON UPDATE CASCADE,
  CONSTRAINT `O_OL_OrderId` FOREIGN KEY (`OrderID`) REFERENCES `ordershead` (`RowID`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `O_OL_ProductId` FOREIGN KEY (`ProductId`) REFERENCES `catalogs`.`products` (`Id`) ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=335882089 DEFAULT CHARSET=cp1251 PACK_KEYS=0 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping events for database 'orders'
--
/*!50106 SET @save_time_zone= @@TIME_ZONE */ ;
/*!50106 DROP EVENT IF EXISTS `copyToOldOrdersAndClear` */;
DELIMITER ;;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;;
/*!50003 SET character_set_client  = utf8 */ ;;
/*!50003 SET character_set_results = utf8 */ ;;
/*!50003 SET collation_connection  = utf8_general_ci */ ;;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;;
/*!50003 SET sql_mode              = '' */ ;;
/*!50003 SET @saved_time_zone      = @@time_zone */ ;;
/*!50003 SET time_zone             = 'SYSTEM' */ ;;
/*!50106 CREATE*/ /*!50117 DEFINER=`RPA`@`rpa.adc.analit.net`*/ /*!50106 EVENT `copyToOldOrdersAndClear` ON SCHEDULE EVERY 1 DAY STARTS '2010-08-11 00:01:00' ON COMPLETION PRESERVE ENABLE DO BEGIN

  DELETE
  FROM
    OrdersHead
  WHERE
    pricecode != 2647
    AND deleted = 1;

  DELETE
  FROM
    OrdersHead
  WHERE
    Deleted = 1;

  DELETE
  FROM
    OrdersHead
  WHERE
    WriteTime < curdate() - INTERVAL 1 WEEK
    AND Submited = 0;


  INSERT INTO OrdersOld.OrdersHead
    (
    RowID, WriteTime, ClientCode, AddressId, UserId, PriceCode, RegionCode, PriceDate, SubmitDate
    )
  SELECT Oh.RowID
       , Oh.WriteTime
       , Oh.ClientCode
       , Oh.AddressId
       , Oh.UserId
       , Oh.PriceCode
       , Oh.RegionCode
       , Oh.PriceDate
       , Oh.SubmitDate
  FROM
    future.Users U,
    usersettings.RetClientsSet R,
    OrdersHead Oh
  LEFT JOIN ordersold.OrdersHead Ooh
  USING (RowId)
  WHERE
    Oh.WriteTime < curdate()
    AND oh.`UserId` = U.`Id`
    AND U.`PayerId` != 921
    AND U.`ClientId` = R.`ClientCode`
    AND R.`ServiceClient` = 0
    AND R.`InvisibleOnFirm` = 0
    AND Oh.deleted = 0
    AND oh.Submited = 1
    AND Ooh.RowId IS NULL;


  INSERT INTO OrdersOld.OrdersList
    (
    OrderID, ProductId, CodeFirmCr, SynonymCode, SynonymFirmCrCode, Code, CodeCr, Quantity, Junk, RequestRatio, OrderCost, MinOrderCount, Cost
    )
  SELECT ol.OrderID
       , ol.ProductId
       , ol.CodeFirmCr
       , ol.SynonymCode
       , ol.SynonymFirmCrCode
       , max(ol.Code)
       , max(ol.CodeCr)
       , sum(ol.Quantity)
       , ol.Junk
       , ol.RequestRatio
       , ol.OrderCost
       , ol.MinOrderCount
       , (sum(ol.Cost*ol.Quantity)/sum(ol.Quantity))
  FROM
    future.Users U,
    usersettings.RetClientsSet R,
    OrdersHead Oh,
    OrdersList Ol
  LEFT JOIN ordersold.OrdersList Ool
  USING (OrderId)
  WHERE
    ool.orderid IS NULL
    AND oh.RowId = Ol.OrderId
    AND oh.`UserId` = U.`Id`
    AND U.`PayerId` != 921
    AND R.ClientCode = Oh.ClientCode
    AND R.`ServiceClient` = 0
    AND R.`InvisibleOnFirm` = 0
    AND Oh.deleted = 0
    AND oh.Submited = 1
    AND WriteTime < curdate()
  GROUP BY
    ol.orderid
  , ol.productid
  , ol.codefirmcr
  , ol.junk;


  DELETE
  FROM
    OrdersHead
  WHERE
    WriteTime < curdate() - INTERVAL 3 MONTH;



END */ ;;
/*!50003 SET time_zone             = @saved_time_zone */ ;;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;;
/*!50003 SET character_set_client  = @saved_cs_client */ ;;
/*!50003 SET character_set_results = @saved_cs_results */ ;;
/*!50003 SET collation_connection  = @saved_col_connection */ ;;
DELIMITER ;
/*!50106 SET TIME_ZONE= @save_time_zone */ ;

--
-- Dumping routines for database 'orders'
--
/*!50003 DROP PROCEDURE IF EXISTS `CalculateOrders` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50020 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 PROCEDURE `CalculateOrders`(IN StartDate Date, IN EndDate Date)
BEGIN
SELECT
    supps.Payer PayerId,
    supps.Name SupplierName,
    r.region,
    round(sum(if(free.ClientPayerId is null, cost * quantity, 0)), 2) OrdersSum
FROM (
    ordershead oh
    join usersettings.pricesdata pd on oh.pricecode = pd.pricecode
    join future.suppliers supps on pd.firmcode = supps.Id
    join farm.regions r on oh.regioncode = r.regioncode
    join orderslist ol on ol.orderid = oh.rowid
    join usersettings.retclientsset rcs on rcs.clientcode = oh.clientcode
    join Future.Users u on u.Id = oh.UserId
    join future.clients cl on cl.id = oh.clientcode
    )
    left join billing.FreeOrders free on free.ClientPayerId = cl.PayerId and free.SupplierPayerId = supps.Payer
where
    oh.writetime between StartDate and EndDate
    and supps.segment = 0
    and rcs.InvisibleOnFirm < 2
    and rcs.ServiceClient = 0
    and u.PayerId <> 921
    and oh.Deleted = 0
    and oh.Submited = 1
    and oh.RegionCode in (1, 2, 2048, 4, 8, 32, 64, 16384, 32768, 65536, 128, 16777216, 33554432, 16)
group by supps.id, r.regioncode
order by 2, 1;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Current Database: `ordersendrules`
--

/*!40000 DROP DATABASE IF EXISTS `ordersendrules`*/;

CREATE DATABASE /*!32312 IF NOT EXISTS*/ `ordersendrules` /*!40100 DEFAULT CHARACTER SET cp1251 */;

USE `ordersendrules`;

--
-- Table structure for table `cost_diapasons`
--

DROP TABLE IF EXISTS `cost_diapasons`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `cost_diapasons` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `Deviation` int(10) unsigned NOT NULL,
  `MaxCost` decimal(9,2) NOT NULL,
  `MinCost` decimal(9,2) NOT NULL,
  `SmartOrderRuleId` int(10) unsigned NOT NULL,
  PRIMARY KEY (`Id`),
  KEY `FK_cost_diapasons_SmartOrderRuleId` (`SmartOrderRuleId`),
  CONSTRAINT `FK_cost_diapasons_SmartOrderRuleId` FOREIGN KEY (`SmartOrderRuleId`) REFERENCES `smart_order_rules` (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=37 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER CostDiapasonInsert AFTER INSERT ON OrderSendRules.cost_diapasons
FOR EACH ROW BEGIN
	INSERT 
    INTO `logs`.CostDiapasonLogs
    SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)), 
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)), 
		Operation = 0, 
		DiapasonId = NEW.Id,
		Deviation = NEW.Deviation,
		MaxCost = NEW.MaxCost,
		MinCost = NEW.MinCost,
		SmartOrderRuleId = NEW.SmartOrderRuleId;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER CostDiapasonUpdate AFTER UPDATE ON OrderSendRules.cost_diapasons
FOR EACH ROW BEGIN
	INSERT 
    INTO `logs`.CostDiapasonLogs
    SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)), 
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)), 
		Operation = 1, 
		DiapasonId = OLD.Id,
		Deviation = NULLIF(NEW.Deviation, OLD.Deviation),
		MaxCost = NULLIF(NEW.MaxCost, OLD.MaxCost),
		MinCost = NULLIF(NEW.MinCost, OLD.MinCost),
		SmartOrderRuleId = NULLIF(NEW.SmartOrderRuleId, OLD.SmartOrderRuleId);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER CostDiapasonDelete AFTER DELETE ON OrderSendRules.cost_diapasons
FOR EACH ROW BEGIN
	INSERT 
    INTO `logs`.CostDiapasonLogs
    SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)), 
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)), 
		Operation = 2, 
		DiapasonId = OLD.Id,
		Deviation = OLD.Deviation,
		MaxCost = OLD.MaxCost,
		MinCost = OLD.MinCost,
		SmartOrderRuleId = OLD.SmartOrderRuleId;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `handler_properties`
--

DROP TABLE IF EXISTS `handler_properties`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `handler_properties` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `Name` varchar(45) NOT NULL,
  `Value` varchar(45) NOT NULL,
  `OrderSendRuleId` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`Id`),
  KEY `FK_handler_properties_OrderSendRuleId` (`OrderSendRuleId`),
  CONSTRAINT `FK_handler_properties_OrderSendRuleId` FOREIGN KEY (`OrderSendRuleId`) REFERENCES `order_send_rules` (`Id`) ON DELETE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=195 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER HandlerPropertieLogINSERT AFTER INSERT ON OrderSendRules.handler_properties
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.HandlerPropertieLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)), 
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)), 
		Operation = 0, 
		PropertieId = NEW.Id,
		Name = NEW.Name,
		Value = NEW.Value,
		OrderSendRuleId = NEW.OrderSendRuleId;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER HandlerPropertieLogUPDATE AFTER UPDATE ON OrderSendRules.handler_properties
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.HandlerPropertieLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)), 
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)), 
		Operation = 1, 
		PropertieId = OLD.Id,
		Name = NULLIF(NEW.Name, OLD.Name),
		Value = NULLIF(NEW.Value, OLD.Value),
		OrderSendRuleId = NULLIF(NEW.OrderSendRuleId, OLD.OrderSendRuleId);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER HandlerPropertieLogDELETE AFTER DELETE ON OrderSendRules.handler_properties
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.HandlerPropertieLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)), 
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)), 
		Operation = 2, 
		PropertieId = OLD.Id,
		Name = OLD.Name,
		Value = OLD.Value,
		OrderSendRuleId = OLD.OrderSendRuleId;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `order_handlers`
--

DROP TABLE IF EXISTS `order_handlers`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `order_handlers` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `ClassName` varchar(45) NOT NULL,
  `Type` tinyint(3) unsigned NOT NULL,
  PRIMARY KEY (`Id`),
  UNIQUE KEY `Index_ClassName` (`ClassName`)
) ENGINE=InnoDB AUTO_INCREMENT=872 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `order_send_rules`
--

DROP TABLE IF EXISTS `order_send_rules`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `order_send_rules` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `FirmCode` int(10) unsigned NOT NULL,
  `RegionCode` bigint(20) unsigned DEFAULT NULL,
  `SenderId` int(10) unsigned NOT NULL,
  `FormaterId` int(10) unsigned NOT NULL,
  `SendDebugMessage` tinyint(1) unsigned NOT NULL DEFAULT '0',
  `ErrorNotificationDelay` int(10) unsigned NOT NULL DEFAULT '60',
  PRIMARY KEY (`Id`),
  KEY `FK_order_sender_rules_FirmCode` (`FirmCode`),
  KEY `FK_order_sender_rules_RegionCode` (`RegionCode`),
  KEY `FK_order_sender_rules_SenderId` (`SenderId`),
  KEY `FK_order_sender_rules_FormaterId` (`FormaterId`),
  CONSTRAINT `FK_order_sender_rules_FirmCode` FOREIGN KEY (`FirmCode`) REFERENCES `usersettings`.`clientsdata` (`FirmCode`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `FK_order_sender_rules_FormaterId` FOREIGN KEY (`FormaterId`) REFERENCES `order_handlers` (`Id`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `FK_order_sender_rules_RegionCode` FOREIGN KEY (`RegionCode`) REFERENCES `farm`.`regions` (`RegionCode`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `FK_order_sender_rules_SenderId` FOREIGN KEY (`SenderId`) REFERENCES `order_handlers` (`Id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=1317 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER OrderSendRuleLogINSERT AFTER INSERT ON OrderSendRules.order_send_rules
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.OrderSendRuleLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)), 
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)), 
		Operation = 0, 
		RuleId = NEW.Id,
		FirmCode = NEW.FirmCode,
		RegionCode = NEW.RegionCode,
		SenderId = NEW.SenderId,
		FormaterId = NEW.FormaterId,
		SendDebugMessage = NEW.SendDebugMessage,
		ErrorNotificationDelay = NEW.ErrorNotificationDelay;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER OrderSendRuleLogUPDATE AFTER UPDATE ON OrderSendRules.order_send_rules
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.OrderSendRuleLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)), 
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)), 
		Operation = 1, 
		RuleId = OLD.Id,
		FirmCode = NULLIF(NEW.FirmCode, OLD.FirmCode),
		RegionCode = NULLIF(NEW.RegionCode, OLD.RegionCode),
		SenderId = NULLIF(NEW.SenderId, OLD.SenderId),
		FormaterId = NULLIF(NEW.FormaterId, OLD.FormaterId),
		SendDebugMessage = NULLIF(NEW.SendDebugMessage, OLD.SendDebugMessage),
		ErrorNotificationDelay = NULLIF(NEW.ErrorNotificationDelay, OLD.ErrorNotificationDelay);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER OrderSendRuleLogDELETE AFTER DELETE ON OrderSendRules.order_send_rules
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.OrderSendRuleLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)), 
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)), 
		Operation = 2, 
		RuleId = OLD.Id,
		FirmCode = OLD.FirmCode,
		RegionCode = OLD.RegionCode,
		SenderId = OLD.SenderId,
		FormaterId = OLD.FormaterId,
		SendDebugMessage = OLD.SendDebugMessage,
		ErrorNotificationDelay = OLD.ErrorNotificationDelay;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `smart_order_rules`
--

DROP TABLE IF EXISTS `smart_order_rules`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `smart_order_rules` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `OffersClientCode` int(10) unsigned DEFAULT NULL,
  `ParseAlgorithm` varchar(45) DEFAULT NULL,
  `CheckAverageCost` tinyint(1) unsigned NOT NULL DEFAULT '0',
  `AverageCostBasedOnLineCount` int(10) unsigned NOT NULL DEFAULT '5',
  `DoNotOrderIfNotOrderedEarly` tinyint(1) unsigned NOT NULL DEFAULT '0',
  `CheckOrderCost` tinyint(1) unsigned NOT NULL DEFAULT '1',
  `CheckRequestRatio` tinyint(1) NOT NULL DEFAULT '1',
  `SearchInCategory` tinyint(1) unsigned NOT NULL DEFAULT '0',
  `From5To4` float NOT NULL DEFAULT '0',
  `From4To3` float NOT NULL DEFAULT '0',
  `From3To2` float NOT NULL DEFAULT '0',
  `From2To1` float NOT NULL DEFAULT '0',
  `From1To0` float NOT NULL DEFAULT '0',
  `CheckMinOrderCount` tinyint(1) unsigned NOT NULL DEFAULT '1',
  `OverPercentAverageCost` int(10) unsigned NOT NULL,
  `AssortimentPriceCode` int(10) unsigned DEFAULT NULL,
  `UseOrderableOffers` tinyint(1) unsigned NOT NULL DEFAULT '0' COMMENT 'Использовать предложения клиента, а не OffersClientCode',
  `NotCheckMinOrder` tinyint(1) unsigned NOT NULL DEFAULT '0' COMMENT 'Не проверять минимальный заказ',
  PRIMARY KEY (`Id`),
  KEY `FK_smart_order_rules_OffersClientCode` (`OffersClientCode`),
  KEY `FK_smart_order_rules_AssortimentPriceCode` (`AssortimentPriceCode`),
  CONSTRAINT `FK_smart_order_rules_AssortimentPriceCode` FOREIGN KEY (`AssortimentPriceCode`) REFERENCES `usersettings`.`pricesdata` (`PriceCode`)
) ENGINE=InnoDB AUTO_INCREMENT=4700 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER ordersendrules.SmartOrderRuleInsert AFTER INSERT ON ordersendrules.smart_order_rules
FOR EACH ROW BEGIN
    INSERT 
    INTO `logs`.SmartOrderRuleLogs
    SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)), 
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)), 
		Operation = 0, 
		RuleId = NEW.Id,
		OffersClientCode = NEW.OffersClientCode,
		ParseAlgorithm = NEW.ParseAlgorithm,
		CheckAverageCost = NEW.CheckAverageCost,
		AverageCostBasedOnLineCount = NEW.AverageCostBasedOnLineCount,
		DoNotOrderIfNotOrderedEarly = NEW.DoNotOrderIfNotOrderedEarly,
		CheckOrderCost = NEW.CheckOrderCost,
		CheckRequestRatio = NEW.CheckRequestRatio,
		SearchInCategory = NEW.SearchInCategory,
		From5To4 = NEW.From5To4,
		From4To3 = NEW.From4To3,
		From3To2 = NEW.From3To2,
		From2To1 = NEW.From2To1,
		From1To0 = NEW.From1To0,
		CheckMinOrderCount = NEW.CheckMinOrderCount,
		OverPercentAverageCost = NEW.OverPercentAverageCost,
		AssortimentPriceCode = NEW.AssortimentPriceCode;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER ordersendrules.SmartOrderRuleUpdate AFTER UPDATE ON ordersendrules.smart_order_rules
FOR EACH ROW BEGIN
    INSERT 
    INTO `logs`.SmartOrderRuleLogs
    SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)), 
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)), 
		Operation = 1, 
		RuleId = OLD.Id,
		OffersClientCode = NULLIF(NEW.OffersClientCode, OLD.OffersClientCode),
		ParseAlgorithm = NULLIF(NEW.ParseAlgorithm, OLD.ParseAlgorithm),
		CheckAverageCost = NULLIF(NEW.CheckAverageCost, OLD.CheckAverageCost),
		AverageCostBasedOnLineCount = NULLIF(NEW.AverageCostBasedOnLineCount, OLD.AverageCostBasedOnLineCount),
		DoNotOrderIfNotOrderedEarly = NULLIF(NEW.DoNotOrderIfNotOrderedEarly, OLD.DoNotOrderIfNotOrderedEarly),
		CheckOrderCost = NULLIF(NEW.CheckOrderCost, OLD.CheckOrderCost),
		CheckRequestRatio = NULLIF(NEW.CheckRequestRatio, OLD.CheckRequestRatio),
		SearchInCategory = NULLIF(NEW.SearchInCategory, OLD.SearchInCategory),
		From5To4 = NULLIF(NEW.From5To4, OLD.From5To4),
		From4To3 = NULLIF(NEW.From4To3, OLD.From4To3),
		From3To2 = NULLIF(NEW.From3To2, OLD.From3To2),
		From2To1 = NULLIF(NEW.From2To1, OLD.From2To1),
		From1To0 = NULLIF(NEW.From1To0, OLD.From1To0),
		CheckMinOrderCount = NULLIF(NEW.CheckMinOrderCount, OLD.CheckMinOrderCount),
		OverPercentAverageCost = NULLIF(NEW.OverPercentAverageCost, OLD.OverPercentAverageCost),
		AssortimentPriceCode = NULLIF(NEW.AssortimentPriceCode, OLD.AssortimentPriceCode);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER ordersendrules.SmartOrderRuleDelete AFTER DELETE ON ordersendrules.smart_order_rules
FOR EACH ROW BEGIN
    INSERT 
    INTO `logs`.SmartOrderRuleLogs
    SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)), 
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)), 
		Operation = 2, 
		RuleId = OLD.Id,
		OffersClientCode = OLD.OffersClientCode,
		ParseAlgorithm = OLD.ParseAlgorithm,
		CheckAverageCost = OLD.CheckAverageCost,
		AverageCostBasedOnLineCount = OLD.AverageCostBasedOnLineCount,
		DoNotOrderIfNotOrderedEarly = OLD.DoNotOrderIfNotOrderedEarly,
		CheckOrderCost = OLD.CheckOrderCost,
		CheckRequestRatio = OLD.CheckRequestRatio,
		SearchInCategory = OLD.SearchInCategory,
		From5To4 = OLD.From5To4,
		From4To3 = OLD.From4To3,
		From3To2 = OLD.From3To2,
		From2To1 = OLD.From2To1,
		From1To0 = OLD.From1To0,
		CheckMinOrderCount = OLD.CheckMinOrderCount,
		OverPercentAverageCost = OLD.OverPercentAverageCost,
		AssortimentPriceCode = OLD.AssortimentPriceCode;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `specialhandlers`
--

DROP TABLE IF EXISTS `specialhandlers`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `specialhandlers` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `SupplierId` int(11) NOT NULL,
  `HandlerId` int(11) NOT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=562 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping events for database 'ordersendrules'
--

--
-- Dumping routines for database 'ordersendrules'
--
/*!50003 DROP PROCEDURE IF EXISTS `GetNonProcessedID` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50020 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 PROCEDURE `GetNonProcessedID`()
BEGIN
SELECT  oh.RowId
FROM    orders.ordershead oh
WHERE   oh.processed = 0
AND oh.submited = 1
AND oh.deleted = 0

;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetOrderHeader` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50020 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 PROCEDURE `GetOrderHeader`(IN idparam  integer unsigned)
BEGIN

SELECT   Writetime + interval reg.MoscowBias hour Writetime     ,
         oh.ClientCode                                          ,
         PriceDate + interval reg.MoscowBias hour PriceDate     ,
         clientAddition                           ClientComment ,
         RowCount                                               ,
         oh.PriceCode                                           ,
         if(count(ifu.LegalEntityId)>1, le.Name, cd.name) ClientShortName                           ,
         if(count(ifu.LegalEntityId)>1, le.FullName, cd.Fullname) ClientFullName  ,
         a.Address ClientAddress,
         (SELECT c.contactText
         FROM    contacts.contact_groups cg
          JOIN contacts.contacts c
                 ON      cg.Id          = c.ContactOwnerId
         WHERE   cd.ContactGroupOwnerId = cg.ContactGroupOwnerId
             AND cg.Type = 0
             AND c.Type = 1 
         limit 1
         ) AS ClientPhone,
         (SELECT p.Name
         FROM contacts.contact_groups cg
          join contacts.Persons p on p.ContactGroupId = cg.Id 
         WHERE cd.ContactGroupOwnerId = cg.ContactGroupOwnerId
             AND cg.Type = 2
         limit 1
         ) AS ClientContactName,
         if(ifnull(os.SwapFirmCode, 0), ai.SupplierDeliveryId, i.SupplierClientId) FirmClientCode,
         if(ifnull(os.SwapFirmCode, 0), i.SupplierClientId, ai.SupplierDeliveryId)  FirmClientCode2,
         i.SupplierPaymentId FirmClientCode3,
         0 PublicCostCorr ,
         MIN(i.PriceMarkup)   FirmCostCorr   ,
         (SELECT ROUND(SUM(ol.cost*ol.Quantity),2)
         FROM    orders.orderslist AS ol
         WHERE   ol.orderid= oh.RowId
         )  AS Summ,
         s.Name AS FirmShortName,
         cd.regionCode ClientRegionCode,
         pd.FirmCode,
         pd.pricename   PriceName,
         region         RegionName,
         cd.segment OrderSegment,
         rcs.ServiceClient OR rcs.InvisibleOnFirm = 2 AS ServiceClient,
         a.PayerId as BillingCode,
         pc.CostName,
         oh.RowId AS OrderId,
         oh.AddressId,
         oh.UserId,
  exists (
   select *
   from Usersettings.PricesData pd
    join Usersettings.CostOptimizationRules cor on cor.SupplierId = pd.FirmCode
     join Usersettings.CostOptimizationClients coc on coc.RuleId = cor.Id
   where coc.ClientId = oh.ClientCode and pd.PriceCode = oh.PriceCode
  ) as IsCostOptimizationEnabled
FROM     (Future.Clients AS cd ,
         Future.Suppliers AS s,
         usersettings.pricesdata AS pd ,
         usersettings.regionaldata AS rd ,
         farm.regions AS reg,
         usersettings.retclientsset AS rcs,
         orders.ordershead AS oh)
  join Future.Addresses a on a.Id = oh.AddressId 
  left join Future.Intersection i ON i.PriceId  = oh.PriceCode AND i.RegionId = oh.regionCode AND i.ClientId = oh.ClientCode and i.LegalEntityId = a.LegalEntityId
  left join Future.AddressIntersection ai on ai.AddressId = a.Id and ai.IntersectionId = i.Id
  join Billing.LegalEntities le on le.Id = a.LegalEntityId
  join Future.Intersection ifu on ifu.ClientId=oh.ClientCode and ifu.PriceId  = oh.PriceCode AND ifu.RegionId = oh.regionCode
  left join usersettings.pricescosts pc ON pc.costcode = i.CostId
  left join Future.OrderSwap os on os.ClientId = oh.ClientCode and os.SupplierId = s.Id
WHERE    cd.Id          = oh.ClientCode
     AND oh.PriceCode         = pd.PriceCode
     AND s.Id         = pd.FirmCode
     AND rd.regionCode        = oh.regionCode
     AND rd.firmCode          = pd.FirmCode
     AND reg.regioncode       = cd.regioncode
     AND cd.Id          = rcs.clientcode
     AND oh.rowid             = idparam
GROUP BY oh.RowId;

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetOrderRows` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50020 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 PROCEDURE `GetOrderRows`(IN IdParam INTEGER UNSIGNED)
BEGIN

SELECT  ol.Code,
        ol.CodeCr,
        if(st.Synonym is null, concat(cn.name,'  ', concat(cf.form, ' ', ifnull(group_concat(pv.`value` SEPARATOR ' '), ''))), st.synonym) as FullName,
        if(si.SynonymFirmcrCode is null, ifNull(pr.Name, '-'), si.synonym) as CrName,
        ol.ProductId as FullCode,
        ol.CodeFirmCr,
        ol.Quantity,
        ol.Cost,
        ol.Junk,
        ol.Await,
        ol.retailmarkup,
	ol.RetailCost,
        OrderedOffers.period as Period,
        OrderedOffers.Note,
        ol.Cost as basecost,
        ol.RowId,
        OrderedOffers.Unit,
        OrderedOffers.Doc,
        OrderedOffers.Quantity as RestQuantity,
        OrderedOffers.NDS,
	OrderedOffers.Volume,
	OrderedOffers.VitallyImportant
FROM orders.orderslist as ol
  JOIN Catalogs.Products as p on p.Id = ol.ProductId
  JOIN Catalogs.Catalog as ca on ca.Id = p.CatalogId
  JOIN Catalogs.catalognames cn on cn.id = ca.nameid
  JOIN Catalogs.catalogforms cf on cf.id = ca.formid
  LEFT JOIN Catalogs.productproperties pp on p.id = pp.productid
  LEFT JOIN Catalogs.propertyvalues pv on pv.id = pp.propertyvalueid
  LEFT JOIN farm.synonymArchive as st ON st.SynonymCode = ol.SynonymCode
  LEFT JOIN farm.synonymFirmCr as si ON si.SynonymFirmCrCode = ol.SynonymFirmCrCode
  LEFT JOIN Catalogs.Producers pr ON pr.Id = ol.CodefirmCr
  LEFT JOIN Orders.OrderedOffers as OrderedOffers on OrderedOffers.id = ol.rowid
WHERE ol.orderid = IdParam
GROUP BY ol.RowId, p.id, cf.id
ORDER BY FullName;

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetOrderSendConfig` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50020 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 PROCEDURE `GetOrderSendConfig`(IN idparam INTEGER UNSIGNED)
BEGIN
  DECLARE delivery varchar(1000);
SET delivery =(
    select ifnull(GROUP_CONCAT(ct.ContactText SEPARATOR ','), 'tech@analit.net')
      from orders.OrdersHead ord
            join usersettings.PricesData prd on prd.PriceCode = ord.PriceCode
            join usersettings.ClientsData supp on supp.FirmCode = prd.FirmCode
            join contacts.Contact_Groups cgr on cgr.ContactGroupOwnerId = supp.ContactGroupOwnerId
            join contacts.RegionalDeliveryGroups rdgr on rdgr.ContactGroupId = cgr.Id and rdgr.RegionId = ord.RegionCode
            join contacts.Contacts ct on ct.ContactOwnerId = cgr.Id
            left join usersettings.ClientsData oldCust on oldCust.FirmCode = ord.ClientCode
			left join future.Addresses a on a.Id = ord.AddressId
			left join future.Users u on u.Id = ord.UserId
      where ord.RowId = idparam
        and (oldCust.BillingCode <> 921 or oldCust.firmCode is null)
        and ((a.PayerId <> 921 or a.Id is null)
        	or (u.PayerId <> 921 or u.Id is null))
 );

IF (SELECT count(*) > 0
  FROM OrderSendRules.order_send_rules osr
    JOIN usersettings.pricesdata pd on pd.firmcode = osr.firmcode
      JOIN orders.ordershead oh on oh.pricecode = pd.pricecode and osr.RegionCode = oh.RegionCode
   WHERE oh.rowid = idparam) THEN


if (select AddressId from Orders.OrdersHead where rowid = idparam) is null then

   SELECT osr.id,
          delivery Destination,
          ohs.ClassName as SenderClassName,
          ohf.ClassName as FormaterClassName,
          ErrorNotificationDelay,
          SendDebugMessage
   FROM OrderSendRules.order_send_rules osr
      JOIN OrderSendRules.order_handlers ohs on ohs.Id = osr.SenderId
      JOIN OrderSendRules.order_handlers ohf on ohf.Id = osr.FormaterId
      JOIN usersettings.pricesdata pd on pd.firmcode = osr.firmcode
        JOIN orders.ordershead oh on oh.pricecode = pd.pricecode and osr.RegionCode = oh.RegionCode
          JOIN usersettings.regionaldata rd on rd.regioncode = oh.regioncode and rd.firmcode = pd.firmcode
            JOIN usersettings.clientsdata cd on cd.firmcode = pd.firmcode
              JOIN usersettings.clientsdata customer on customer.firmcode = oh.clientcode
   WHERE oh.rowid = idparam;

else

   SELECT osr.id,
          delivery Destination,
          ohs.ClassName as SenderClassName,
          ohf.ClassName as FormaterClassName,
          ErrorNotificationDelay,
          SendDebugMessage
   FROM OrderSendRules.order_send_rules osr
      JOIN OrderSendRules.order_handlers ohs on ohs.Id = osr.SenderId
      JOIN OrderSendRules.order_handlers ohf on ohf.Id = osr.FormaterId
      JOIN usersettings.pricesdata pd on pd.firmcode = osr.firmcode
        JOIN orders.ordershead oh on oh.pricecode = pd.pricecode and osr.RegionCode = oh.RegionCode
          JOIN usersettings.regionaldata rd on rd.regioncode = oh.regioncode and rd.firmcode = pd.firmcode
            JOIN usersettings.clientsdata cd on cd.firmcode = pd.firmcode
              JOIN Future.Clients customer on customer.Id = oh.clientcode
   WHERE oh.rowid = idparam;

end if;

ELSE

  if (select AddressId from Orders.OrdersHead where rowid = idparam) is null then

   SELECT osr.id,
          delivery Destination,
          ohs.ClassName as SenderClassName,
          ohf.ClassName as FormaterClassName,
          ErrorNotificationDelay,
          SendDebugMessage
    FROM OrderSendRules.order_send_rules osr
      JOIN OrderSendRules.order_handlers ohs on ohs.Id = osr.SenderId
      JOIN OrderSendRules.order_handlers ohf on ohf.Id = osr.FormaterId
      JOIN usersettings.pricesdata pd on pd.firmcode = osr.firmcode
        JOIN orders.ordershead oh on oh.pricecode = pd.pricecode
          JOIN usersettings.regionaldata rd on rd.regioncode = oh.regioncode and rd.firmcode = pd.firmcode
            JOIN usersettings.clientsdata cd on cd.firmcode = pd.firmcode
              JOIN usersettings.clientsdata customer on customer.firmcode = oh.clientcode
   WHERE osr.RegionCode is null
         AND oh.rowid =  idparam;

  else

   SELECT osr.id,
          delivery Destination,
          ohs.ClassName as SenderClassName,
          ohf.ClassName as FormaterClassName,
          ErrorNotificationDelay,
          SendDebugMessage
    FROM OrderSendRules.order_send_rules osr
      JOIN OrderSendRules.order_handlers ohs on ohs.Id = osr.SenderId
      JOIN OrderSendRules.order_handlers ohf on ohf.Id = osr.FormaterId
      JOIN usersettings.pricesdata pd on pd.firmcode = osr.firmcode
        JOIN orders.ordershead oh on oh.pricecode = pd.pricecode
          JOIN usersettings.regionaldata rd on rd.regioncode = oh.regioncode and rd.firmcode = pd.firmcode
            JOIN usersettings.clientsdata cd on cd.firmcode = pd.firmcode
              JOIN Future.Clients customer on customer.Id = oh.clientcode
   WHERE osr.RegionCode is null
         AND oh.rowid =  idparam;

  end if;

END IF;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Current Database: `redmine`
--

/*!40000 DROP DATABASE IF EXISTS `redmine`*/;

CREATE DATABASE /*!32312 IF NOT EXISTS*/ `redmine` /*!40100 DEFAULT CHARACTER SET cp1251 */;

USE `redmine`;

--
-- Table structure for table `attachments`
--

DROP TABLE IF EXISTS `attachments`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `attachments` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `container_id` int(11) NOT NULL DEFAULT '0',
  `container_type` varchar(30) NOT NULL DEFAULT '',
  `filename` varchar(255) NOT NULL DEFAULT '',
  `disk_filename` varchar(255) NOT NULL DEFAULT '',
  `filesize` int(11) NOT NULL DEFAULT '0',
  `content_type` varchar(255) DEFAULT '',
  `digest` varchar(40) NOT NULL DEFAULT '',
  `downloads` int(11) NOT NULL DEFAULT '0',
  `author_id` int(11) NOT NULL DEFAULT '0',
  `created_on` datetime DEFAULT NULL,
  `description` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `index_attachments_on_container_id_and_container_type` (`container_id`,`container_type`),
  KEY `index_attachments_on_author_id` (`author_id`),
  KEY `index_attachments_on_created_on` (`created_on`)
) ENGINE=InnoDB AUTO_INCREMENT=2965 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `auth_sources`
--

DROP TABLE IF EXISTS `auth_sources`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `auth_sources` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `type` varchar(30) NOT NULL DEFAULT '',
  `name` varchar(60) NOT NULL DEFAULT '',
  `host` varchar(60) DEFAULT NULL,
  `port` int(11) DEFAULT NULL,
  `account` varchar(255) DEFAULT NULL,
  `account_password` varchar(60) DEFAULT NULL,
  `base_dn` varchar(255) DEFAULT NULL,
  `attr_login` varchar(30) DEFAULT NULL,
  `attr_firstname` varchar(30) DEFAULT NULL,
  `attr_lastname` varchar(30) DEFAULT NULL,
  `attr_mail` varchar(30) DEFAULT NULL,
  `onthefly_register` tinyint(1) NOT NULL DEFAULT '0',
  `tls` tinyint(1) NOT NULL DEFAULT '0',
  PRIMARY KEY (`id`),
  KEY `index_auth_sources_on_id_and_type` (`id`,`type`)
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `boards`
--

DROP TABLE IF EXISTS `boards`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `boards` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `project_id` int(11) NOT NULL,
  `name` varchar(255) NOT NULL DEFAULT '',
  `description` varchar(255) DEFAULT NULL,
  `position` int(11) DEFAULT '1',
  `topics_count` int(11) NOT NULL DEFAULT '0',
  `messages_count` int(11) NOT NULL DEFAULT '0',
  `last_message_id` int(11) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `boards_project_id` (`project_id`),
  KEY `index_boards_on_last_message_id` (`last_message_id`)
) ENGINE=InnoDB DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `changes`
--

DROP TABLE IF EXISTS `changes`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `changes` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `changeset_id` int(11) NOT NULL,
  `action` varchar(1) NOT NULL DEFAULT '',
  `path` text NOT NULL,
  `from_path` text,
  `from_revision` varchar(255) DEFAULT NULL,
  `revision` varchar(255) DEFAULT NULL,
  `branch` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `changesets_changeset_id` (`changeset_id`)
) ENGINE=InnoDB AUTO_INCREMENT=168325 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `changesets`
--

DROP TABLE IF EXISTS `changesets`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `changesets` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `repository_id` int(11) NOT NULL,
  `revision` varchar(255) NOT NULL,
  `committer` varchar(255) DEFAULT NULL,
  `committed_on` datetime NOT NULL,
  `comments` text,
  `commit_date` date DEFAULT NULL,
  `scmid` varchar(255) DEFAULT NULL,
  `user_id` int(11) DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `changesets_repos_rev` (`repository_id`,`revision`),
  KEY `index_changesets_on_user_id` (`user_id`),
  KEY `index_changesets_on_repository_id` (`repository_id`),
  KEY `index_changesets_on_committed_on` (`committed_on`),
  KEY `changesets_repos_scmid` (`repository_id`,`scmid`)
) ENGINE=InnoDB AUTO_INCREMENT=30143 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `changesets_issues`
--

DROP TABLE IF EXISTS `changesets_issues`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `changesets_issues` (
  `changeset_id` int(11) NOT NULL,
  `issue_id` int(11) NOT NULL,
  UNIQUE KEY `changesets_issues_ids` (`changeset_id`,`issue_id`)
) ENGINE=InnoDB DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `comments`
--

DROP TABLE IF EXISTS `comments`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `comments` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `commented_type` varchar(30) NOT NULL DEFAULT '',
  `commented_id` int(11) NOT NULL DEFAULT '0',
  `author_id` int(11) NOT NULL DEFAULT '0',
  `comments` text,
  `created_on` datetime NOT NULL,
  `updated_on` datetime NOT NULL,
  PRIMARY KEY (`id`),
  KEY `index_comments_on_commented_id_and_commented_type` (`commented_id`,`commented_type`),
  KEY `index_comments_on_author_id` (`author_id`)
) ENGINE=InnoDB DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `custom_fields`
--

DROP TABLE IF EXISTS `custom_fields`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `custom_fields` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `type` varchar(30) NOT NULL DEFAULT '',
  `name` varchar(30) NOT NULL DEFAULT '',
  `field_format` varchar(30) NOT NULL DEFAULT '',
  `possible_values` text,
  `regexp` varchar(255) DEFAULT '',
  `min_length` int(11) NOT NULL DEFAULT '0',
  `max_length` int(11) NOT NULL DEFAULT '0',
  `is_required` tinyint(1) NOT NULL DEFAULT '0',
  `is_for_all` tinyint(1) NOT NULL DEFAULT '0',
  `is_filter` tinyint(1) NOT NULL DEFAULT '0',
  `position` int(11) DEFAULT '1',
  `searchable` tinyint(1) DEFAULT '0',
  `default_value` text,
  `editable` tinyint(1) DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `index_custom_fields_on_id_and_type` (`id`,`type`)
) ENGINE=InnoDB DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `custom_fields_projects`
--

DROP TABLE IF EXISTS `custom_fields_projects`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `custom_fields_projects` (
  `custom_field_id` int(11) NOT NULL DEFAULT '0',
  `project_id` int(11) NOT NULL DEFAULT '0',
  KEY `index_custom_fields_projects_on_custom_field_id_and_project_id` (`custom_field_id`,`project_id`)
) ENGINE=InnoDB DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `custom_fields_trackers`
--

DROP TABLE IF EXISTS `custom_fields_trackers`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `custom_fields_trackers` (
  `custom_field_id` int(11) NOT NULL DEFAULT '0',
  `tracker_id` int(11) NOT NULL DEFAULT '0',
  KEY `index_custom_fields_trackers_on_custom_field_id_and_tracker_id` (`custom_field_id`,`tracker_id`)
) ENGINE=InnoDB DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `custom_values`
--

DROP TABLE IF EXISTS `custom_values`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `custom_values` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `customized_type` varchar(30) NOT NULL DEFAULT '',
  `customized_id` int(11) NOT NULL DEFAULT '0',
  `custom_field_id` int(11) NOT NULL DEFAULT '0',
  `value` text,
  PRIMARY KEY (`id`),
  KEY `custom_values_customized` (`customized_type`,`customized_id`),
  KEY `index_custom_values_on_custom_field_id` (`custom_field_id`)
) ENGINE=InnoDB DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `documents`
--

DROP TABLE IF EXISTS `documents`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `documents` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `project_id` int(11) NOT NULL DEFAULT '0',
  `category_id` int(11) NOT NULL DEFAULT '0',
  `title` varchar(60) NOT NULL DEFAULT '',
  `description` text,
  `created_on` datetime DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `documents_project_id` (`project_id`),
  KEY `index_documents_on_category_id` (`category_id`),
  KEY `index_documents_on_created_on` (`created_on`)
) ENGINE=InnoDB DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `enabled_modules`
--

DROP TABLE IF EXISTS `enabled_modules`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `enabled_modules` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `project_id` int(11) DEFAULT NULL,
  `name` varchar(255) NOT NULL,
  PRIMARY KEY (`id`),
  KEY `enabled_modules_project_id` (`project_id`)
) ENGINE=InnoDB AUTO_INCREMENT=318 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `enumerations`
--

DROP TABLE IF EXISTS `enumerations`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `enumerations` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `name` varchar(30) NOT NULL DEFAULT '',
  `position` int(11) DEFAULT '1',
  `is_default` tinyint(1) NOT NULL DEFAULT '0',
  `type` varchar(255) DEFAULT NULL,
  `active` tinyint(1) NOT NULL DEFAULT '1',
  `project_id` int(11) DEFAULT NULL,
  `parent_id` int(11) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `index_enumerations_on_project_id` (`project_id`),
  KEY `index_enumerations_on_id_and_type` (`id`,`type`)
) ENGINE=InnoDB AUTO_INCREMENT=10 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `groups_users`
--

DROP TABLE IF EXISTS `groups_users`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `groups_users` (
  `group_id` int(11) NOT NULL,
  `user_id` int(11) NOT NULL,
  UNIQUE KEY `groups_users_ids` (`group_id`,`user_id`)
) ENGINE=InnoDB DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `issue_categories`
--

DROP TABLE IF EXISTS `issue_categories`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `issue_categories` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `project_id` int(11) NOT NULL DEFAULT '0',
  `name` varchar(255) NOT NULL,
  `assigned_to_id` int(11) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `issue_categories_project_id` (`project_id`),
  KEY `index_issue_categories_on_assigned_to_id` (`assigned_to_id`)
) ENGINE=InnoDB AUTO_INCREMENT=66 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `issue_relations`
--

DROP TABLE IF EXISTS `issue_relations`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `issue_relations` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `issue_from_id` int(11) NOT NULL,
  `issue_to_id` int(11) NOT NULL,
  `relation_type` varchar(255) NOT NULL DEFAULT '',
  `delay` int(11) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `index_issue_relations_on_issue_from_id` (`issue_from_id`),
  KEY `index_issue_relations_on_issue_to_id` (`issue_to_id`)
) ENGINE=InnoDB AUTO_INCREMENT=151 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `issue_statuses`
--

DROP TABLE IF EXISTS `issue_statuses`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `issue_statuses` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `name` varchar(30) NOT NULL DEFAULT '',
  `is_closed` tinyint(1) NOT NULL DEFAULT '0',
  `is_default` tinyint(1) NOT NULL DEFAULT '0',
  `position` int(11) DEFAULT '1',
  `default_done_ratio` int(11) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `index_issue_statuses_on_position` (`position`),
  KEY `index_issue_statuses_on_is_closed` (`is_closed`),
  KEY `index_issue_statuses_on_is_default` (`is_default`)
) ENGINE=InnoDB AUTO_INCREMENT=10 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `issues`
--

DROP TABLE IF EXISTS `issues`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `issues` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `tracker_id` int(11) NOT NULL DEFAULT '0',
  `project_id` int(11) NOT NULL DEFAULT '0',
  `subject` varchar(255) NOT NULL DEFAULT '',
  `description` text,
  `due_date` date DEFAULT NULL,
  `category_id` int(11) DEFAULT NULL,
  `status_id` int(11) NOT NULL DEFAULT '0',
  `assigned_to_id` int(11) DEFAULT NULL,
  `priority_id` int(11) NOT NULL DEFAULT '0',
  `fixed_version_id` int(11) DEFAULT NULL,
  `author_id` int(11) NOT NULL DEFAULT '0',
  `lock_version` int(11) NOT NULL DEFAULT '0',
  `created_on` datetime DEFAULT NULL,
  `updated_on` datetime DEFAULT NULL,
  `start_date` date DEFAULT NULL,
  `done_ratio` int(11) NOT NULL DEFAULT '0',
  `estimated_hours` float DEFAULT NULL,
  `parent_id` int(11) DEFAULT NULL,
  `root_id` int(11) DEFAULT NULL,
  `lft` int(11) DEFAULT NULL,
  `rgt` int(11) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `issues_project_id` (`project_id`),
  KEY `index_issues_on_status_id` (`status_id`),
  KEY `index_issues_on_category_id` (`category_id`),
  KEY `index_issues_on_assigned_to_id` (`assigned_to_id`),
  KEY `index_issues_on_fixed_version_id` (`fixed_version_id`),
  KEY `index_issues_on_tracker_id` (`tracker_id`),
  KEY `index_issues_on_priority_id` (`priority_id`),
  KEY `index_issues_on_author_id` (`author_id`),
  KEY `index_issues_on_created_on` (`created_on`),
  KEY `index_issues_on_root_id_and_lft_and_rgt` (`root_id`,`lft`,`rgt`)
) ENGINE=InnoDB AUTO_INCREMENT=7889 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `journal_details`
--

DROP TABLE IF EXISTS `journal_details`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `journal_details` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `journal_id` int(11) NOT NULL DEFAULT '0',
  `property` varchar(30) NOT NULL DEFAULT '',
  `prop_key` varchar(30) NOT NULL DEFAULT '',
  `old_value` varchar(255) DEFAULT NULL,
  `value` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `journal_details_journal_id` (`journal_id`)
) ENGINE=InnoDB AUTO_INCREMENT=28421 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `journals`
--

DROP TABLE IF EXISTS `journals`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `journals` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `journalized_id` int(11) NOT NULL DEFAULT '0',
  `journalized_type` varchar(30) NOT NULL DEFAULT '',
  `user_id` int(11) NOT NULL DEFAULT '0',
  `notes` text,
  `created_on` datetime NOT NULL,
  PRIMARY KEY (`id`),
  KEY `journals_journalized_id` (`journalized_id`,`journalized_type`),
  KEY `index_journals_on_user_id` (`user_id`),
  KEY `index_journals_on_journalized_id` (`journalized_id`),
  KEY `index_journals_on_created_on` (`created_on`)
) ENGINE=InnoDB AUTO_INCREMENT=25073 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `member_roles`
--

DROP TABLE IF EXISTS `member_roles`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `member_roles` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `member_id` int(11) NOT NULL,
  `role_id` int(11) NOT NULL,
  `inherited_from` int(11) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `index_member_roles_on_member_id` (`member_id`),
  KEY `index_member_roles_on_role_id` (`role_id`)
) ENGINE=InnoDB AUTO_INCREMENT=565 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `members`
--

DROP TABLE IF EXISTS `members`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `members` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `user_id` int(11) NOT NULL DEFAULT '0',
  `project_id` int(11) NOT NULL DEFAULT '0',
  `created_on` datetime DEFAULT NULL,
  `mail_notification` tinyint(1) NOT NULL DEFAULT '0',
  PRIMARY KEY (`id`),
  KEY `index_members_on_user_id` (`user_id`),
  KEY `index_members_on_project_id` (`project_id`)
) ENGINE=InnoDB AUTO_INCREMENT=573 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `messages`
--

DROP TABLE IF EXISTS `messages`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `messages` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `board_id` int(11) NOT NULL,
  `parent_id` int(11) DEFAULT NULL,
  `subject` varchar(255) NOT NULL DEFAULT '',
  `content` text,
  `author_id` int(11) DEFAULT NULL,
  `replies_count` int(11) NOT NULL DEFAULT '0',
  `last_reply_id` int(11) DEFAULT NULL,
  `created_on` datetime NOT NULL,
  `updated_on` datetime NOT NULL,
  `locked` tinyint(1) DEFAULT '0',
  `sticky` int(11) DEFAULT '0',
  PRIMARY KEY (`id`),
  KEY `messages_board_id` (`board_id`),
  KEY `messages_parent_id` (`parent_id`),
  KEY `index_messages_on_last_reply_id` (`last_reply_id`),
  KEY `index_messages_on_author_id` (`author_id`),
  KEY `index_messages_on_created_on` (`created_on`)
) ENGINE=InnoDB DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `news`
--

DROP TABLE IF EXISTS `news`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `news` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `project_id` int(11) DEFAULT NULL,
  `title` varchar(60) NOT NULL DEFAULT '',
  `summary` varchar(255) DEFAULT '',
  `description` text,
  `author_id` int(11) NOT NULL DEFAULT '0',
  `created_on` datetime DEFAULT NULL,
  `comments_count` int(11) NOT NULL DEFAULT '0',
  PRIMARY KEY (`id`),
  KEY `news_project_id` (`project_id`),
  KEY `index_news_on_author_id` (`author_id`),
  KEY `index_news_on_created_on` (`created_on`)
) ENGINE=InnoDB DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `open_id_authentication_associations`
--

DROP TABLE IF EXISTS `open_id_authentication_associations`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `open_id_authentication_associations` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `issued` int(11) DEFAULT NULL,
  `lifetime` int(11) DEFAULT NULL,
  `handle` varchar(255) DEFAULT NULL,
  `assoc_type` varchar(255) DEFAULT NULL,
  `server_url` blob,
  `secret` blob,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `open_id_authentication_nonces`
--

DROP TABLE IF EXISTS `open_id_authentication_nonces`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `open_id_authentication_nonces` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `timestamp` int(11) NOT NULL,
  `server_url` varchar(255) DEFAULT NULL,
  `salt` varchar(255) NOT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `plugin_schema_info`
--

DROP TABLE IF EXISTS `plugin_schema_info`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `plugin_schema_info` (
  `plugin_name` varchar(255) DEFAULT NULL,
  `version` int(11) DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `projects`
--

DROP TABLE IF EXISTS `projects`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `projects` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `name` varchar(255) NOT NULL,
  `description` text,
  `homepage` varchar(255) DEFAULT '',
  `is_public` tinyint(1) NOT NULL DEFAULT '1',
  `parent_id` int(11) DEFAULT NULL,
  `created_on` datetime DEFAULT NULL,
  `updated_on` datetime DEFAULT NULL,
  `identifier` varchar(20) DEFAULT NULL,
  `status` int(11) NOT NULL DEFAULT '1',
  `lft` int(11) DEFAULT NULL,
  `rgt` int(11) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `index_projects_on_lft` (`lft`),
  KEY `index_projects_on_rgt` (`rgt`)
) ENGINE=InnoDB AUTO_INCREMENT=42 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `projects_trackers`
--

DROP TABLE IF EXISTS `projects_trackers`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `projects_trackers` (
  `project_id` int(11) NOT NULL DEFAULT '0',
  `tracker_id` int(11) NOT NULL DEFAULT '0',
  UNIQUE KEY `projects_trackers_unique` (`project_id`,`tracker_id`),
  KEY `projects_trackers_project_id` (`project_id`)
) ENGINE=InnoDB DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `queries`
--

DROP TABLE IF EXISTS `queries`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `queries` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `project_id` int(11) DEFAULT NULL,
  `name` varchar(255) NOT NULL DEFAULT '',
  `filters` text,
  `user_id` int(11) NOT NULL DEFAULT '0',
  `is_public` tinyint(1) NOT NULL DEFAULT '0',
  `column_names` text,
  `sort_criteria` text,
  `group_by` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `index_queries_on_project_id` (`project_id`),
  KEY `index_queries_on_user_id` (`user_id`)
) ENGINE=InnoDB AUTO_INCREMENT=26 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `repositories`
--

DROP TABLE IF EXISTS `repositories`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `repositories` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `project_id` int(11) NOT NULL DEFAULT '0',
  `url` varchar(255) NOT NULL DEFAULT '',
  `login` varchar(60) DEFAULT '',
  `password` varchar(60) DEFAULT '',
  `root_url` varchar(255) DEFAULT '',
  `type` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `index_repositories_on_project_id` (`project_id`)
) ENGINE=InnoDB AUTO_INCREMENT=56 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `roles`
--

DROP TABLE IF EXISTS `roles`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `roles` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `name` varchar(30) NOT NULL DEFAULT '',
  `position` int(11) DEFAULT '1',
  `assignable` tinyint(1) DEFAULT '1',
  `builtin` int(11) NOT NULL DEFAULT '0',
  `permissions` text,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=7 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `schema_migrations`
--

DROP TABLE IF EXISTS `schema_migrations`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `schema_migrations` (
  `version` varchar(255) NOT NULL,
  UNIQUE KEY `unique_schema_migrations` (`version`)
) ENGINE=InnoDB DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `settings`
--

DROP TABLE IF EXISTS `settings`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `settings` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `name` varchar(255) NOT NULL DEFAULT '',
  `value` text,
  `updated_on` datetime DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `index_settings_on_name` (`name`)
) ENGINE=InnoDB AUTO_INCREMENT=46 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `time_entries`
--

DROP TABLE IF EXISTS `time_entries`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `time_entries` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `project_id` int(11) NOT NULL,
  `user_id` int(11) NOT NULL,
  `issue_id` int(11) DEFAULT NULL,
  `hours` float NOT NULL,
  `comments` varchar(255) DEFAULT NULL,
  `activity_id` int(11) NOT NULL,
  `spent_on` date NOT NULL,
  `tyear` int(11) NOT NULL,
  `tmonth` int(11) NOT NULL,
  `tweek` int(11) NOT NULL,
  `created_on` datetime NOT NULL,
  `updated_on` datetime NOT NULL,
  PRIMARY KEY (`id`),
  KEY `time_entries_project_id` (`project_id`),
  KEY `time_entries_issue_id` (`issue_id`),
  KEY `index_time_entries_on_activity_id` (`activity_id`),
  KEY `index_time_entries_on_user_id` (`user_id`),
  KEY `index_time_entries_on_created_on` (`created_on`)
) ENGINE=InnoDB AUTO_INCREMENT=396 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `tokens`
--

DROP TABLE IF EXISTS `tokens`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `tokens` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `user_id` int(11) NOT NULL DEFAULT '0',
  `action` varchar(30) NOT NULL DEFAULT '',
  `value` varchar(40) NOT NULL DEFAULT '',
  `created_on` datetime NOT NULL,
  PRIMARY KEY (`id`),
  KEY `index_tokens_on_user_id` (`user_id`)
) ENGINE=InnoDB AUTO_INCREMENT=348 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `trackers`
--

DROP TABLE IF EXISTS `trackers`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `trackers` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `name` varchar(30) NOT NULL DEFAULT '',
  `is_in_chlog` tinyint(1) NOT NULL DEFAULT '0',
  `position` int(11) DEFAULT '1',
  `is_in_roadmap` tinyint(1) NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=28 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `user_preferences`
--

DROP TABLE IF EXISTS `user_preferences`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `user_preferences` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `user_id` int(11) NOT NULL DEFAULT '0',
  `others` text,
  `hide_mail` tinyint(1) DEFAULT '0',
  `time_zone` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `index_user_preferences_on_user_id` (`user_id`)
) ENGINE=InnoDB AUTO_INCREMENT=74 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `users`
--

DROP TABLE IF EXISTS `users`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `users` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `login` varchar(30) NOT NULL DEFAULT '',
  `hashed_password` varchar(40) NOT NULL DEFAULT '',
  `firstname` varchar(30) NOT NULL DEFAULT '',
  `lastname` varchar(30) NOT NULL DEFAULT '',
  `mail` varchar(60) NOT NULL DEFAULT '',
  `mail_notification` tinyint(1) NOT NULL DEFAULT '1',
  `admin` tinyint(1) NOT NULL DEFAULT '0',
  `status` int(11) NOT NULL DEFAULT '1',
  `last_login_on` datetime DEFAULT NULL,
  `language` varchar(5) DEFAULT '',
  `auth_source_id` int(11) DEFAULT NULL,
  `created_on` datetime DEFAULT NULL,
  `updated_on` datetime DEFAULT NULL,
  `type` varchar(255) DEFAULT NULL,
  `identity_url` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `index_users_on_id_and_type` (`id`,`type`),
  KEY `index_users_on_auth_source_id` (`auth_source_id`)
) ENGINE=InnoDB AUTO_INCREMENT=114 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `versions`
--

DROP TABLE IF EXISTS `versions`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `versions` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `project_id` int(11) NOT NULL DEFAULT '0',
  `name` varchar(255) DEFAULT '',
  `description` varchar(255) DEFAULT '',
  `effective_date` date DEFAULT NULL,
  `created_on` datetime DEFAULT NULL,
  `updated_on` datetime DEFAULT NULL,
  `wiki_page_title` varchar(255) DEFAULT NULL,
  `status` varchar(255) DEFAULT 'open',
  `sharing` varchar(255) NOT NULL DEFAULT 'none',
  PRIMARY KEY (`id`),
  KEY `versions_project_id` (`project_id`),
  KEY `index_versions_on_sharing` (`sharing`)
) ENGINE=InnoDB AUTO_INCREMENT=276 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `watchers`
--

DROP TABLE IF EXISTS `watchers`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `watchers` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `watchable_type` varchar(255) NOT NULL DEFAULT '',
  `watchable_id` int(11) NOT NULL DEFAULT '0',
  `user_id` int(11) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `watchers_user_id_type` (`user_id`,`watchable_type`),
  KEY `index_watchers_on_user_id` (`user_id`),
  KEY `index_watchers_on_watchable_id_and_watchable_type` (`watchable_id`,`watchable_type`)
) ENGINE=InnoDB AUTO_INCREMENT=134 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `wiki_content_versions`
--

DROP TABLE IF EXISTS `wiki_content_versions`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `wiki_content_versions` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `wiki_content_id` int(11) NOT NULL,
  `page_id` int(11) NOT NULL,
  `author_id` int(11) DEFAULT NULL,
  `data` longblob,
  `compression` varchar(6) DEFAULT '',
  `comments` varchar(255) DEFAULT '',
  `updated_on` datetime NOT NULL,
  `version` int(11) NOT NULL,
  PRIMARY KEY (`id`),
  KEY `wiki_content_versions_wcid` (`wiki_content_id`),
  KEY `index_wiki_content_versions_on_updated_on` (`updated_on`)
) ENGINE=InnoDB AUTO_INCREMENT=517 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `wiki_contents`
--

DROP TABLE IF EXISTS `wiki_contents`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `wiki_contents` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `page_id` int(11) NOT NULL,
  `author_id` int(11) DEFAULT NULL,
  `text` longtext,
  `comments` varchar(255) DEFAULT '',
  `updated_on` datetime NOT NULL,
  `version` int(11) NOT NULL,
  PRIMARY KEY (`id`),
  KEY `wiki_contents_page_id` (`page_id`),
  KEY `index_wiki_contents_on_author_id` (`author_id`)
) ENGINE=InnoDB AUTO_INCREMENT=102 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `wiki_pages`
--

DROP TABLE IF EXISTS `wiki_pages`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `wiki_pages` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `wiki_id` int(11) NOT NULL,
  `title` varchar(255) NOT NULL,
  `created_on` datetime NOT NULL,
  `protected` tinyint(1) NOT NULL DEFAULT '0',
  `parent_id` int(11) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `wiki_pages_wiki_id_title` (`wiki_id`,`title`),
  KEY `index_wiki_pages_on_wiki_id` (`wiki_id`),
  KEY `index_wiki_pages_on_parent_id` (`parent_id`)
) ENGINE=InnoDB AUTO_INCREMENT=102 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `wiki_redirects`
--

DROP TABLE IF EXISTS `wiki_redirects`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `wiki_redirects` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `wiki_id` int(11) NOT NULL,
  `title` varchar(255) DEFAULT NULL,
  `redirects_to` varchar(255) DEFAULT NULL,
  `created_on` datetime NOT NULL,
  PRIMARY KEY (`id`),
  KEY `wiki_redirects_wiki_id_title` (`wiki_id`,`title`),
  KEY `index_wiki_redirects_on_wiki_id` (`wiki_id`)
) ENGINE=InnoDB DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `wikis`
--

DROP TABLE IF EXISTS `wikis`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `wikis` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `project_id` int(11) NOT NULL,
  `start_page` varchar(255) NOT NULL,
  `status` int(11) NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `wikis_project_id` (`project_id`)
) ENGINE=InnoDB AUTO_INCREMENT=24 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `workflows`
--

DROP TABLE IF EXISTS `workflows`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `workflows` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `tracker_id` int(11) NOT NULL DEFAULT '0',
  `old_status_id` int(11) NOT NULL DEFAULT '0',
  `new_status_id` int(11) NOT NULL DEFAULT '0',
  `role_id` int(11) NOT NULL DEFAULT '0',
  PRIMARY KEY (`id`),
  KEY `wkfs_role_tracker_old_status` (`role_id`,`tracker_id`,`old_status_id`),
  KEY `index_workflows_on_old_status_id` (`old_status_id`),
  KEY `index_workflows_on_role_id` (`role_id`),
  KEY `index_workflows_on_new_status_id` (`new_status_id`)
) ENGINE=InnoDB AUTO_INCREMENT=1542 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping events for database 'redmine'
--

--
-- Dumping routines for database 'redmine'
--

--
-- Current Database: `reports`
--

/*!40000 DROP DATABASE IF EXISTS `reports`*/;

CREATE DATABASE /*!32312 IF NOT EXISTS*/ `reports` /*!40100 DEFAULT CHARACTER SET cp1251 */;

USE `reports`;

--
-- Table structure for table `AverageCosts`
--

DROP TABLE IF EXISTS `AverageCosts`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `AverageCosts` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `Date` datetime NOT NULL,
  `SupplierId` int(10) unsigned NOT NULL,
  `RegionId` bigint(20) unsigned NOT NULL,
  `AssortmentId` int(10) unsigned NOT NULL,
  `Cost` decimal(19,5) NOT NULL,
  PRIMARY KEY (`Id`),
  KEY `Date` (`Date`,`SupplierId`,`RegionId`,`AssortmentId`)
) ENGINE=InnoDB AUTO_INCREMENT=181004359 DEFAULT CHARSET=cp1251;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `ClientRatings`
--

DROP TABLE IF EXISTS `ClientRatings`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `ClientRatings` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `Date` datetime NOT NULL,
  `ClientId` int(10) unsigned NOT NULL,
  `RegionId` bigint(20) unsigned NOT NULL,
  `Rating` decimal(19,5) NOT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=23399 DEFAULT CHARSET=cp1251;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `Jobs`
--

DROP TABLE IF EXISTS `Jobs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `Jobs` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `Name` varchar(255) DEFAULT NULL,
  `NextRun` datetime DEFAULT NULL,
  `LastRun` datetime DEFAULT NULL,
  `RunInterval` bigint(20) DEFAULT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=cp1251;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `enum_values`
--

DROP TABLE IF EXISTS `enum_values`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `enum_values` (
  `ID` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `PropertyEnumID` bigint(20) unsigned NOT NULL,
  `Value` int(11) NOT NULL,
  `DisplayValue` varchar(255) NOT NULL,
  PRIMARY KEY (`ID`),
  KEY `EnumID` (`PropertyEnumID`),
  CONSTRAINT `EnumID` FOREIGN KEY (`PropertyEnumID`) REFERENCES `property_enums` (`ID`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=27 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `general_reports`
--

DROP TABLE IF EXISTS `general_reports`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `general_reports` (
  `GeneralReportCode` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `FirmCode` int(11) unsigned DEFAULT NULL,
  `Allow` tinyint(1) NOT NULL DEFAULT '0',
  `EMailSubject` varchar(255) DEFAULT NULL,
  `ReportFileName` varchar(255) DEFAULT NULL,
  `ReportArchName` varchar(255) DEFAULT NULL,
  `ContactGroupId` int(10) unsigned DEFAULT NULL,
  `Temporary` tinyint(1) NOT NULL DEFAULT '0',
  `TemporaryCreationDate` datetime DEFAULT NULL,
  `Comment` varchar(255) DEFAULT NULL,
  `PayerID` int(10) unsigned DEFAULT NULL,
  `Format` enum('Excel','DBF') NOT NULL DEFAULT 'Excel',
  PRIMARY KEY (`GeneralReportCode`),
  KEY `FK_general_reports_ContactGroupOwnerId` (`ContactGroupId`) USING BTREE,
  KEY `general_reports_FK_PayerID` (`PayerID`),
  KEY `general_reports_FK_FirmCode` (`FirmCode`),
  CONSTRAINT `FK_general_reports_ContactGroupOwnerId` FOREIGN KEY (`ContactGroupId`) REFERENCES `contacts`.`contact_groups` (`Id`),
  CONSTRAINT `general_reports_FK_PayerID` FOREIGN KEY (`PayerID`) REFERENCES `billing`.`payers` (`PayerID`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=672 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER reports.GeneralReportLogInsert AFTER INSERT ON reports.general_reports
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.GeneralReportLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 0,
		GeneralReportCode = NEW.GeneralReportCode,
		FirmCode = NEW.FirmCode,
		Allow = NEW.Allow,
		EMailSubject = NEW.EMailSubject,
		ReportFileName = NEW.ReportFileName,
		ReportArchName = NEW.ReportArchName,
		ContactGroupId = NEW.ContactGroupId,
		Temporary = NEW.Temporary,
		TemporaryCreationDate = NEW.TemporaryCreationDate,
		Comment = NEW.Comment,
		PayerID = NEW.PayerID,
		Format = NEW.Format;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER reports.GeneralReportLogUpdate AFTER UPDATE ON reports.general_reports
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.GeneralReportLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 1,
		GeneralReportCode = OLD.GeneralReportCode,
		FirmCode = NULLIF(NEW.FirmCode, OLD.FirmCode),
		Allow = NULLIF(NEW.Allow, OLD.Allow),
		EMailSubject = NULLIF(NEW.EMailSubject, OLD.EMailSubject),
		ReportFileName = NULLIF(NEW.ReportFileName, OLD.ReportFileName),
		ReportArchName = NULLIF(NEW.ReportArchName, OLD.ReportArchName),
		ContactGroupId = NULLIF(NEW.ContactGroupId, OLD.ContactGroupId),
		Temporary = NULLIF(NEW.Temporary, OLD.Temporary),
		TemporaryCreationDate = NULLIF(NEW.TemporaryCreationDate, OLD.TemporaryCreationDate),
		Comment = NULLIF(NEW.Comment, OLD.Comment),
		PayerID = NULLIF(NEW.PayerID, OLD.PayerID),
		Format = NULLIF(NEW.Format, OLD.Format);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER reports.GeneralReportLogDelete AFTER DELETE ON reports.general_reports
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.GeneralReportLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 2,
		GeneralReportCode = OLD.GeneralReportCode,
		FirmCode = OLD.FirmCode,
		Allow = OLD.Allow,
		EMailSubject = OLD.EMailSubject,
		ReportFileName = OLD.ReportFileName,
		ReportArchName = OLD.ReportArchName,
		ContactGroupId = OLD.ContactGroupId,
		Temporary = OLD.Temporary,
		TemporaryCreationDate = OLD.TemporaryCreationDate,
		Comment = OLD.Comment,
		PayerID = OLD.PayerID,
		Format = OLD.Format;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `mailing_addresses`
--

DROP TABLE IF EXISTS `mailing_addresses`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `mailing_addresses` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `Mail` varchar(45) NOT NULL,
  `GeneralReport` bigint(20) unsigned DEFAULT NULL,
  PRIMARY KEY (`Id`),
  KEY `FK_Mailing_Addresses_1` (`GeneralReport`),
  CONSTRAINT `FK_Mailing_Addresses_1` FOREIGN KEY (`GeneralReport`) REFERENCES `general_reports` (`GeneralReportCode`) ON DELETE SET NULL ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=11 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `property_enums`
--

DROP TABLE IF EXISTS `property_enums`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `property_enums` (
  `ID` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `EnumName` varchar(255) NOT NULL,
  PRIMARY KEY (`ID`)
) ENGINE=InnoDB AUTO_INCREMENT=13 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `report_properties`
--

DROP TABLE IF EXISTS `report_properties`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `report_properties` (
  `ID` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `ReportCode` bigint(20) unsigned NOT NULL,
  `PropertyID` bigint(20) unsigned NOT NULL,
  `PropertyValue` varchar(255) NOT NULL,
  PRIMARY KEY (`ID`),
  KEY `ReportCode` (`ReportCode`),
  KEY `FK_RP_PropertyID` (`PropertyID`),
  CONSTRAINT `FK_RP_PropertyID` FOREIGN KEY (`PropertyID`) REFERENCES `report_type_properties` (`ID`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `ReportCode` FOREIGN KEY (`ReportCode`) REFERENCES `reports` (`ReportCode`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=27995 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `report_property_values`
--

DROP TABLE IF EXISTS `report_property_values`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `report_property_values` (
  `ID` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `ReportPropertyID` bigint(20) unsigned NOT NULL,
  `Value` varchar(255) NOT NULL,
  PRIMARY KEY (`ID`),
  KEY `FK_RPV_ReportPropertyID` (`ReportPropertyID`),
  CONSTRAINT `FK_RPV_ReportPropertyID` FOREIGN KEY (`ReportPropertyID`) REFERENCES `report_properties` (`ID`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=42543 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `report_type_properties`
--

DROP TABLE IF EXISTS `report_type_properties`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `report_type_properties` (
  `ID` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `ReportTypeCode` bigint(20) unsigned NOT NULL,
  `PropertyName` varchar(255) NOT NULL,
  `DisplayName` varchar(255) NOT NULL,
  `PropertyType` enum('BOOL','INT','ENUM','LIST','STRING','DATETIME','FILE') NOT NULL DEFAULT 'INT',
  `Optional` bit(1) NOT NULL DEFAULT b'1',
  `PropertyEnumID` bigint(20) unsigned DEFAULT NULL,
  `SelectStoredProcedure` varchar(255) DEFAULT NULL,
  `DefaultValue` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`ID`),
  KEY `ReportTypeCode` (`ReportTypeCode`),
  KEY `PropertyEnumID` (`PropertyEnumID`),
  CONSTRAINT `PropertyEnumID` FOREIGN KEY (`PropertyEnumID`) REFERENCES `property_enums` (`ID`) ON DELETE SET NULL ON UPDATE CASCADE,
  CONSTRAINT `report_type_properties_ibfk_1` FOREIGN KEY (`ReportTypeCode`) REFERENCES `reporttypes` (`ReportTypeCode`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=439 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER `AddNewProperty` AFTER INSERT ON `report_type_properties` FOR EACH ROW BEGIN
  if NEW.Optional = 0 then
    insert into report_properties (ReportCode, PropertyID, PropertyValue)
      select ReportCode, NEW.ID, NEW.DefaultValue
      FROM
        reports r
      where
        r.ReportTypeCode = NEW.ReportTypeCode;
  end if;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `reports`
--

DROP TABLE IF EXISTS `reports`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `reports` (
  `ReportCode` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `GeneralReportCode` bigint(20) unsigned NOT NULL DEFAULT '0',
  `ReportCaption` varchar(26) NOT NULL,
  `ReportTypeCode` bigint(20) unsigned NOT NULL DEFAULT '1',
  `Enabled` bit(1) NOT NULL DEFAULT b'1',
  PRIMARY KEY (`ReportCode`),
  KEY `ReportTypeCode` (`ReportTypeCode`),
  KEY `GeneralReportCode` (`GeneralReportCode`),
  CONSTRAINT `GeneralReportCode` FOREIGN KEY (`GeneralReportCode`) REFERENCES `general_reports` (`GeneralReportCode`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `ReportTypeCode` FOREIGN KEY (`ReportTypeCode`) REFERENCES `reporttypes` (`ReportTypeCode`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=2120 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER `AddNewReport` AFTER INSERT ON `reports` FOR EACH ROW BEGIN
  insert into report_properties (ReportCode, PropertyID, PropertyValue)
    select NEW.ReportCode, r.ID, r.DefaultValue
    FROM
      report_type_properties r
    where
          r.ReportTypeCode = NEW.ReportTypeCode
      and r.Optional = 0;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `reporttypes`
--

DROP TABLE IF EXISTS `reporttypes`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `reporttypes` (
  `ReportTypeCode` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `ReportTypeName` varchar(255) NOT NULL,
  `ReportTypeFilePrefix` varchar(255) NOT NULL,
  `AlternateSubject` varchar(255) NOT NULL,
  `ReportClassName` varchar(255) NOT NULL,
  PRIMARY KEY (`ReportTypeCode`)
) ENGINE=InnoDB AUTO_INCREMENT=25 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping events for database 'reports'
--

--
-- Dumping routines for database 'reports'
--
/*!50003 DROP PROCEDURE IF EXISTS `GetAllClientCode` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50020 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 PROCEDURE `GetAllClientCode`(in inFilter varchar(255), in inID bigint)
begin
  declare filterStr varchar(257);
  if (inID is not null) then
    select
      cl.Id as ID,
      convert(concat(cl.Id, '-', cl.Name) using cp1251) as DisplayValue
    from
       future.clients cl
    where
        cl.Id = inID
    order by cl.Name;
  else
    if ((inFilter is not null) and (length(inFilter) > 0)) then
      set filterStr = concat('%', inFilter, '%');
      select
        cl.Id as ID,
        convert(concat(cl.Id, '-', cl.Name) using cp1251) as DisplayValue
      from
        future.clients cl
      where
           cl.Name like filterStr        
      order by cl.Name;
    else
      select
        cl.Id as ID,
        convert(concat(cl.Id, '-', cl.Name) using cp1251) as DisplayValue
      from        
        future.clients cl
      order by cl.Name;
    end if;
  end if;
end */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetAllPriceCode` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50020 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 PROCEDURE `GetAllPriceCode`(in inFilter varchar(255), in inID bigint)
begin
  declare filterStr varchar(257);
  drop temporary table if exists tempGetPriceCode;
  create temporary table tempGetPriceCode
  engine=memory
  select
    pd.PriceCode as PriceCode,
    convert(concat(pd.PriceCode, ' - ', supps.Name, ' (', pd.PriceName, ') - ', rg.Region) using cp1251) as PriceName
  from
    usersettings.pricesdata pd
    inner join future.suppliers supps on supps.Id = pd.FirmCode
    inner join farm.regions rg on rg.RegionCode = supps.HomeRegion;
  if (inID is not null) then
    select
      tmp.PriceCode as ID,
      tmp.PriceName as DisplayValue
    from
      tempGetPriceCode tmp
    where
      tmp.PriceCode = inID
    order by tmp.PriceName;
  else
    if ((inFilter is not null) and (length(inFilter) > 0)) then
      set filterStr = concat('%', inFilter, '%');
      select
        tmp.PriceCode as ID,
        tmp.PriceName as DisplayValue
      from
        tempGetPriceCode tmp
      where
        tmp.PriceName like filterStr
      order by tmp.PriceName;
    else
      select
        tmp.PriceCode as ID,
        tmp.PriceName as DisplayValue
      from
        tempGetPriceCode tmp
      order by tmp.PriceName;
    end if;
  end if;
  drop table if exists tempGetPriceCode;
end */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetAllPriceCodeWithOrder` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50020 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 PROCEDURE `GetAllPriceCodeWithOrder`(in inFilter varchar(255), in inID bigint)
begin
  declare filterStr varchar(257);
  drop temporary table if exists tempGetPriceCode;
  create temporary table tempGetPriceCode
  engine=memory
  select
    supps.Id as SID,
    supps.Name as SName,		
    pd.PriceCode as PriceCode,
    convert(concat(pd.PriceCode, ' - ', supps.Name, ' (', pd.PriceName, ') - ', rg.Region) using cp1251) as PriceName
  from
    usersettings.pricesdata pd
    inner join future.suppliers supps on supps.Id = pd.FirmCode
    inner join farm.regions rg on rg.RegionCode = supps.HomeRegion;
  if (inID is not null) then
    select
      tmp.PriceCode as ID,
      tmp.PriceName as DisplayValue
    from
      tempGetPriceCode tmp
    where
      tmp.PriceCode = inID
      order by tmp.SName, tmp.SID;
  else
    if ((inFilter is not null) and (length(inFilter) > 0)) then
      set filterStr = concat('%', inFilter, '%');
      select
        tmp.PriceCode as ID,
        tmp.PriceName as DisplayValue
      from
        tempGetPriceCode tmp
      where
        tmp.PriceName like filterStr
        order by tmp.SName, tmp.SID;
    else
      select
        tmp.PriceCode as ID,
        tmp.PriceName as DisplayValue
      from
        tempGetPriceCode tmp
        order by tmp.SName, tmp.SID;
    end if;
  end if;
  drop table if exists tempGetPriceCode;
end */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetClientCode` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50020 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 PROCEDURE `GetClientCode`(in inFilter varchar(255), in inID bigint)
begin
  declare filterStr varchar(257);
  if (inID is not null) then
    select
        cl.Id as ID,
        convert(concat(cl.Id, '-', cl.Name) using cp1251) as DisplayValue
    from
        future.clients cl
    where
          cl.Id = inID      
      and cl.Status = 1
    order by cl.Name;
  else
    if ((inFilter is not null) and (length(inFilter) > 0)) then
      set filterStr = concat('%', inFilter, '%');
      select
        cl.Id as ID,
        convert(concat(cl.Id, '-', cl.Name) using cp1251) as DisplayValue
      from
        future.clients cl
      where
           cl.Name like filterStr        
        and cl.Status = 1
      order by cl.Name;
    else
      select
        cl.Id as ID,
        convert(concat(cl.Id, '-', cl.Name) using cp1251) as DisplayValue
      from
        future.clients cl
      where            
        cl.Status = 1
      order by cl.Name;
    end if;
  end if;
end */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetClientCodeWithNewUsers` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50020 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 PROCEDURE `GetClientCodeWithNewUsers`(in inFilter varchar(255), in inID bigint)
begin
  declare filterStr varchar(257);
  if (inID is not null) then
      select
      cl.Id,
      cl.Name ShortName,
      convert(concat(cl.ID, '-', cl.Name) using cp1251) as DisplayValue
    from
      future.Clients cl
    where
          cl.Id = inID
      and cl.Status = 1
    order by ShortName;
  else
    if ((inFilter is not null) and (length(inFilter) > 0)) then
      set filterStr = concat('%', inFilter, '%');     
       select
        cl.Id,
        cl.Name ShortName,
        convert(concat(cl.Id, '-', cl.Name) using cp1251) as DisplayValue
      from
        future.Clients cl
      where
           cl.Name like filterStr
        and cl.Status = 1
      order by ShortName;
    else
       select
        cl.Id,
        cl.Name ShortName,
        convert(concat(cl.Id, '-', cl.Name) using cp1251) as DisplayValue
      from
        future.Clients cl
      where
            cl.Status = 1
      order by ShortName;
    end if;
  end if;
end */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetClientWithMatrix` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50020 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 PROCEDURE `GetClientWithMatrix`(in inFilter varchar(255), in inID bigint)
begin
  declare filterStr varchar(257);
  if (inID is not null) then
      SELECT CL.Name as DisplayValue,
      R.ClientCode as ID
      FROM usersettings.RetClientsSet R, future.Clients CL
      where R.BuyingMatrixPriceId is not null and
      CL.ID = R.ClientCode and
      CL.ID = inID;
  else
    if ((inFilter is not null) and (length(inFilter) > 0)) then
      set filterStr = concat('%', inFilter, '%');
        SELECT CL.Name as DisplayValue,
        R.ClientCode as ID
        FROM usersettings.RetClientsSet R, future.Clients CL
        where R.BuyingMatrixPriceId is not null and
        CL.ID = R.ClientCode and
        CL.Name like filterStr;
    else
      SELECT CL.Name as DisplayValue,
      R.ClientCode as ID
      FROM usersettings.RetClientsSet R, future.Clients CL
      where R.BuyingMatrixPriceId is not null and
      CL.ID = R.ClientCode;
    end if;
  end if;
end */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetCostOptimizationClientCode` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50020 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 PROCEDURE `GetCostOptimizationClientCode`(in inFilter varchar(255), in inID bigint)
begin
  declare filterStr varchar(257);
  if (inID is not null) then
      select
      cl.ID,
      cl.Name ShortName,
      convert(concat(cl.Id, '-', cl.Name) using cp1251) as DisplayValue
    from
      future.Clients cl
      join usersettings.CostOptimizationClients co on co.ClientId = cl.ID
    where
          cl.Id = inID
      and cl.Status = 1
    order by ShortName;
  else
    if ((inFilter is not null) and (length(inFilter) > 0)) then
      set filterStr = concat('%', inFilter, '%');
        select
        cl.ID,
        cl.Name ShortName,
        convert(concat(cl.Id, '-', cl.Name) using cp1251) as DisplayValue
      from
        future.Clients cl
        join usersettings.CostOptimizationClients co on co.ClientId = cl.ID
      where
            cl.Name like filterStr
        and cl.Status = 1
      order by ShortName;
    else
        select
        cl.ID,
        cl.Name ShortName,
        convert(concat(cl.Id, '-', cl.Name) using cp1251) as DisplayValue
      from
        future.Clients cl
        join usersettings.CostOptimizationClients co on co.ClientId = cl.ID
      where
            cl.Status = 1
      order by ShortName;
    end if;
  end if;
end */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetCostOptimizationFirmCode` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50020 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 PROCEDURE `GetCostOptimizationFirmCode`(in inFilter varchar(255), in inID bigint)
begin
  declare filterStr varchar(257);
  if (inID is not null) then
    select
      supps.Id as ID,
      convert(concat(supps.Id, '-', supps.Name, ' - ', rg.Region) using cp1251) as DisplayValue
    from
      future.suppliers supps,  
      farm.regions rg,
      usersettings.CostOptimizationRules cor
    where
          supps.Id = inID      
      and rg.RegionCode = supps.HomeRegion
      and cor.SupplierId = supps.Id
    order by supps.Name;
  else
    if ((inFilter is not null) and (length(inFilter) > 0)) then
      set filterStr = concat('%', inFilter, '%');
      select
        supps.Id as ID,
        convert(concat(supps.Id, '-', supps.Name, ' - ', rg.Region) using cp1251) as DisplayValue
      from
        future.suppliers supps, 
        farm.regions rg,
        usersettings.CostOptimizationRules cor
      where
            supps.Name like filterStr        
        and rg.RegionCode = supps.HomeRegion
        and cor.SupplierId = supps.Id
      order by supps.Name;
    else
      select
        supps.Id as ID,
        convert(concat(supps.Id, '-', supps.Name, ' - ', rg.Region) using cp1251) as DisplayValue
      from
        future.suppliers supps, 
        farm.regions rg,
        usersettings.CostOptimizationRules cor
      where            
        rg.RegionCode = supps.HomeRegion
        and cor.SupplierId = supps.Id
      order by supps.Name;
    end if;
  end if;
end */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetFirmCode` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50020 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 PROCEDURE `GetFirmCode`(in inFilter varchar(255), in inID bigint)
begin
  declare filterStr varchar(257);
  if (inID is not null) then
    select
      supps.Id as ID,
      convert(concat(supps.Id, '-', supps.Name, ' - ', rg.Region) using cp1251) as DisplayValue
    from
      future.suppliers supps,
      farm.regions rg
    where
      supps.Id = inID
      and rg.RegionCode = supps.HomeRegion
    order by supps.Name;
  else
    if ((inFilter is not null) and (length(inFilter) > 0)) then
      set filterStr = concat('%', inFilter, '%');
      select
        supps.Id as ID,
        convert(concat(supps.Id, '-', supps.Name, ' - ', rg.Region) using cp1251) as DisplayValue
      from
        future.suppliers supps,
        farm.regions rg
      where
        supps.Name like filterStr        
        and rg.RegionCode = supps.HomeRegion
      order by supps.Name;
    else
      select
        supps.Id as ID,
        convert(concat(supps.Id, '-', supps.Name, ' - ', rg.Region) using cp1251) as DisplayValue
      from
        future.suppliers supps,
        farm.regions rg
      where        
        rg.RegionCode = supps.HomeRegion
      order by supps.Name;
    end if;
  end if;
end */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetFirmCr` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50020 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 PROCEDURE `GetFirmCr`(in inFilter varchar(255), in inID bigint)
begin
  declare filterStr varchar(257);
  if ((inFilter is not null) and (length(inFilter) > 0)) then
    set filterStr = concat('%', inFilter, '%');
    select
      p.Id as ID,
      p.Name as DisplayValue
    from
      catalogs.Producers p
    where
      p.Name like filterStr
    order by DisplayValue;
  else
    select
      p.Id as ID,
      p.Name as DisplayValue
    from
      catalogs.Producers p
    order by DisplayValue;
  end if;
end */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetFullCode` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50020 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 PROCEDURE `GetFullCode`(in inFilter varchar(255), in inID bigint)
begin
  declare filterStr varchar(257);
  if ((inFilter is not null) and (length(inFilter) > 0)) then
    set filterStr = concat('%', inFilter, '%');
    select
      c.Id as ID,
      concat(cn.Name, ' ', cf.Form) as DisplayValue
    from
      catalogs.catalog c,
      catalogs.catalognames cn,
      catalogs.catalogforms cf
    where
          c.Hidden = 0
      and cn.Id = c.NameId
      and cf.Id = c.FormId
      and concat(cn.Name, ' ', cf.Form) like filterStr
    order by 2;
  else
    select
      c.Id as ID,
      concat(cn.Name, ' ', cf.Form) as DisplayValue
    from
      catalogs.catalog c,
      catalogs.catalognames cn,
      catalogs.catalogforms cf
    where
      c.Hidden = 0
      and cn.Id = c.NameId
      and cf.Id = c.FormId
    order by 2;
  end if;
end */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetPayerCode` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50020 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 PROCEDURE `GetPayerCode`(in inFilter varchar(255), in inID bigint)
begin
  declare filterStr varchar(257);
  if (inID is not null) then
    select
      p.PayerId as ID,
      convert(concat(p.PayerId, '-', p.ShortName) using cp1251) as DisplayValue
    from
      billing.payers p
    where
          p.PayerId = inID
        and (exists(select * from future.Clients cl inner join billing.PayerClients pc on cl.Id = pc.ClientId where pc.PayerId = p.PayerId))
    order by p.ShortName;
  else
    if ((inFilter is not null) and (length(inFilter) > 0)) then
      set filterStr = concat('%', inFilter, '%');
      select
        p.PayerId as ID,
        convert(concat(p.PayerId, '-', p.ShortName) using cp1251) as DisplayValue
      from
        billing.payers p
      where
            p.ShortName like filterStr
        and (exists(select * from future.Clients cl inner join billing.PayerClients pc on cl.Id = pc.ClientId where pc.PayerId = p.PayerId))
      order by p.ShortName;
    else
      select
        p.PayerId as ID,
        convert(concat(p.PayerId, '-', p.ShortName) using cp1251) as DisplayValue
      from
        billing.payers p
      where
        (exists(select * from future.Clients cl inner join billing.PayerClients pc on cl.Id = pc.ClientId where pc.PayerId = p.PayerId))
      order by p.ShortName;
    end if;
  end if;
end */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetPriceCode` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50020 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 PROCEDURE `GetPriceCode`(in inFilter varchar(255), in inID bigint)
begin
  declare filterStr varchar(257);
  drop temporary table if exists tempGetPriceCode;
  create temporary table tempGetPriceCode
  engine=memory
  select
    pd.PriceCode as PriceCode,
    convert(concat(pd.PriceCode, ' - ', supps.Name, ' (', pd.PriceName, ') - ', rg.Region) using cp1251) as PriceName
  from
    usersettings.pricesdata pd
    inner join future.suppliers supps on supps.Id = pd.FirmCode
    inner join farm.regions rg on rg.RegionCode = supps.HomeRegion
  where
    supps.Disabled = 0
  and pd.AgencyEnabled = 1
  and pd.Enabled = 1;
  if (inID is not null) then
    select
      tmp.PriceCode as ID,
      tmp.PriceName as DisplayValue
    from
      tempGetPriceCode tmp
    where
      tmp.PriceCode = inID
    order by tmp.PriceName;
  else
    if ((inFilter is not null) and (length(inFilter) > 0)) then
      set filterStr = concat('%', inFilter, '%');
      select
        tmp.PriceCode as ID,
        tmp.PriceName as DisplayValue
      from
        tempGetPriceCode tmp
      where
        tmp.PriceName like filterStr
      order by tmp.PriceName;
    else
      select
        tmp.PriceCode as ID,
        tmp.PriceName as DisplayValue
      from
        tempGetPriceCode tmp
      order by tmp.PriceName;
    end if;
  end if;
  drop table if exists tempGetPriceCode;
end */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetPricesByRegionMask` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50020 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 PROCEDURE `GetPricesByRegionMask`(in inFilter varchar(255), in inID bigint)
BEGIN
declare filterStr varchar(512);
if(inFilter is null) then
    set filterStr = '0';
else
    set filterStr = inFilter;
end if;

SET @s = CONCAT(
"select T.PriceCode ID, T.PriceName DisplayValue
from
(
select
		distinct pd.PriceCode as PriceCode,
  		convert(concat(pd.PriceCode, ' - ', supps.Name, ' (', pd.PriceName, ') - ', rg.Region) using cp1251) as PriceName,
        convert(concat(supps.Name, ' (', pd.PriceName, ') - ', rg.Region) using cp1251) as PriceName2
	from usersettings.pricesdata pd
  		inner join future.suppliers supps on pd.FirmCode = supps.id
  		inner join usersettings.pricesregionaldata prd on prd.PriceCode = pd.PriceCode
  		inner join farm.Regions rg on supps.HomeRegion = rg.RegionCode
	where
  		supps.RegionMask & prd.RegionCode > 0
  		and pd.enabled = 1
		and pd.agencyenabled = 1
  		and prd.enabled = 1
  		and prd.RegionCode &", convert(concat(inID) using cp1251), "> 0

	union
	
	select
		pd.PriceCode as PriceCode,
  	convert(concat(pd.PriceCode, ' - ', supps.Name, ' (', pd.PriceName, ') - ', rg.Region) using cp1251) as PriceName,
    convert(concat(supps.Name, ' (', pd.PriceName, ') - ', rg.Region) using cp1251) as PriceName2
	from usersettings.pricesdata pd
		inner join future.suppliers supps on pd.FirmCode = supps.id
		inner join farm.Regions rg on supps.HomeRegion = rg.RegionCode
    where pd.PriceCode in (", filterStr, ")
)T
order by T.PriceName2;");

Prepare _sql From @s;
execute _sql;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetProductId` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50020 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 PROCEDURE `GetProductId`(in inFilter varchar(255), in inID bigint)
begin
  declare filterStr varchar(257);
  if ((inFilter is not null) and (length(inFilter) > 0)) then
    set filterStr = concat('%', inFilter, '%');
    select
      p.Id as ID,
      concat(cn.Name, ' ', catalogs.GetFullForm(p.Id)) as DisplayValue
    from
      catalogs.products p,
      catalogs.catalog c,
      catalogs.catalognames cn,
      catalogs.catalogforms cf
    where
          p.Hidden = 0
      and c.Id = p.CatalogId
      and c.Hidden = 0
      and cn.Id = c.NameId
      and cf.Id = c.FormId
      and concat(cn.Name, ' ', cf.Form) like filterStr
    order by 2;
  else
    select
      p.Id as ID,
      concat(cn.Name, ' ', catalogs.GetFullForm(p.Id)) as DisplayValue
    from
      catalogs.products p,
      catalogs.catalog c,
      catalogs.catalognames cn,
      catalogs.catalogforms cf
    where
          p.Hidden = 0
      and c.Id = p.CatalogId
      and c.Hidden = 0
      and cn.Id = c.NameId
      and cf.Id = c.FormId
    order by 2;
  end if;
end */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetRegion` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50020 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 PROCEDURE `GetRegion`(in inFilter varchar(255), in inID bigint)
begin
  declare filterStr varchar(257);
  if ((inFilter is not null) and (length(inFilter) > 0)) then
    set filterStr = concat('%', inFilter, '%');
    select
      r.RegionCode as ID,
      r.Region as DisplayValue
    from
      farm.regions r
    where
      r.Region like filterStr
    order by r.Region;
  else
    select
      r.RegionCode as ID,
      r.Region as DisplayValue
    from
      farm.regions r
    order by r.Region;
  end if;
end */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetRegionsForClient` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50020 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 PROCEDURE `GetRegionsForClient`(in inFilter varchar(255), in inID bigint)
BEGIN
    if(inID is not null) then
        select 
            r.RegionCode as ID,
            r.Region as DisplayValue
        from
            farm.Regions r
        where
            r.RegionCode & inID > 0
        order by r.Region;    
    else
        select
            r.RegionCode as ID,
            r.Region as DisplayValue
        from
            farm.regions r
        order by r.Region;
    end if;    
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetShortCode` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50020 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 PROCEDURE `GetShortCode`(in inFilter varchar(255), in inID bigint)
begin
  declare filterStr varchar(257);
  if ((inFilter is not null) and (length(inFilter) > 0)) then
    set filterStr = concat('%', inFilter, '%');
    select
      c.ID as ID,
      c.Name as DisplayValue
    from
      catalogs.catalognames c
    where
      c.Name like filterStr
    order by 2;
  else
    select
      c.ID as ID,
      c.Name as DisplayValue
    from
      catalogs.catalognames c
    order by 2;
  end if;
end */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Current Database: `telephony`
--

/*!40000 DROP DATABASE IF EXISTS `telephony`*/;

CREATE DATABASE /*!32312 IF NOT EXISTS*/ `telephony` /*!40100 DEFAULT CHARACTER SET cp1251 */;

USE `telephony`;

--
-- Table structure for table `callbackphones`
--

DROP TABLE IF EXISTS `callbackphones`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `callbackphones` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `CallerPhone` varchar(10) DEFAULT NULL,
  `Enabled` tinyint(1) unsigned DEFAULT '0',
  `DueDate` date DEFAULT NULL,
  `CheckDate` tinyint(1) unsigned zerofill DEFAULT '0',
  `Comment` varchar(255) DEFAULT NULL,
  `CallBackType` int(10) unsigned DEFAULT '0',
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=84 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER telephony.CallbackPhonesInsert
	AFTER Insert
	ON telephony.CallbackPhones
	FOR EACH ROW
BEGIN
        INSERT
        INTO    `logs`.CallbackPhoneLogs
                SET LogTime = now()
                ,
                OperatorName = IFNULL(
                        @INUser, 
                        SUBSTRING_INDEX(USER(),'@',1)
                ) 
                , 
                OperatorHost = IFNULL(
                        @INHost,
                        SUBSTRING_INDEX(USER(),'@',-1)
                ) 
                , 
                Operation = 0, 
                CallbackPhoneId = NEW.Id,
                CallerPhone = NEW.CallerPhone,
                Enabled = NEW.Enabled,
                DueDate = NEW.DueDate,
                CheckDate = NEW.CheckDate,
                `Comment` = NEW.`Comment`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER telephony.CallbackPhonesUpdate
	AFTER UPDATE
	ON telephony.CallbackPhones
	FOR EACH ROW
BEGIN
INSERT
INTO    `logs`.CallbackPhoneLogs 
        SET LogTime = now()
        ,
        OperatorName = IFNULL(
                @INUser, 
                SUBSTRING_INDEX(USER(),'@',1)
        ) 
        , 
        OperatorHost = IFNULL(
                @INHost, 
                SUBSTRING_INDEX(USER(),'@',-1)
        )
        , 
        Operation  = 1, 
        CallbackPhoneId = OLD.Id,
        CallerPhone = NULLIF(NEW.CallerPhone, OLD.CallerPhone),
        Enabled = NULLIF(NEW.Enabled, OLD.Enabled),
        DueDate = NULLIF(NEW.DueDate, OLD.DueDate),
        CheckDate = NULLIF(NEW.CheckDate, OLD.CheckDate),
        `Comment` = NULLIF(NEW.`Comment`, OLD.`Comment`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER telephony.CallbackPhonesDelete
	AFTER DELETE
	ON telephony.CallbackPhones
	FOR EACH ROW
BEGIN
        INSERT 
        INTO    `logs`.CallbackPhoneLogs
                SET LogTime = now()
                ,
                OperatorName = IFNULL(
                        @INUser,
                        SUBSTRING_INDEX(USER(),'@',1)
                ) 
                , 
                OperatorHost = IFNULL(
                        @INHost, 
                        SUBSTRING_INDEX(USER(),'@',-1)
                ) 
                , 
                Operation          = 2, 
                CallbackPhoneId = OLD.Id,
                CallerPhone = OLD.CallerPhone,
                Enabled = OLD.Enabled,
                DueDate = OLD.DueDate,
                CheckDate = OLD.CheckDate,
                `Comment` = OLD.`Comment`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `callbackrules`
--

DROP TABLE IF EXISTS `callbackrules`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `callbackrules` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `RegionCode` int(10) unsigned NOT NULL,
  `FileName` varchar(45) NOT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `norecordphones`
--

DROP TABLE IF EXISTS `norecordphones`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `norecordphones` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `To` varchar(10) DEFAULT NULL,
  `From` varchar(10) DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=66 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `unresolvedphone`
--

DROP TABLE IF EXISTS `unresolvedphone`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `unresolvedphone` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `Phone` varchar(10) NOT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=15721 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping events for database 'telephony'
--

--
-- Dumping routines for database 'telephony'
--

--
-- Current Database: `usersettings`
--

/*!40000 DROP DATABASE IF EXISTS `usersettings`*/;

CREATE DATABASE /*!32312 IF NOT EXISTS*/ `usersettings` /*!40100 DEFAULT CHARACTER SET cp1251 */;

USE `usersettings`;

--
-- Table structure for table `AnalitFSchedules`
--

DROP TABLE IF EXISTS `AnalitFSchedules`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `AnalitFSchedules` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `ClientId` int(10) unsigned NOT NULL,
  `Enable` tinyint(1) unsigned NOT NULL DEFAULT '0' COMMENT 'Включено ли данное расписание',
  `Hour` int(10) unsigned NOT NULL DEFAULT '0' COMMENT 'назначенный час расписания',
  `Minute` int(10) unsigned NOT NULL DEFAULT '0' COMMENT 'назначенная минута расписания',
  PRIMARY KEY (`Id`),
  KEY `FK_AnalitFSchedules_ClientId` (`ClientId`),
  CONSTRAINT `FK_AnalitFSchedules_ClientId` FOREIGN KEY (`ClientId`) REFERENCES `future`.`Clients` (`Id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=166 DEFAULT CHARSET=cp1251;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER UserSettings.AnalitFScheduleLogInsert AFTER INSERT ON UserSettings.AnalitFSchedules
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.AnalitFScheduleLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 0,
		ScheduleId = NEW.Id,
		ClientId = NEW.ClientId,
		Enable = NEW.Enable,
		Hour = NEW.Hour,
		Minute = NEW.Minute;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER UserSettings.AnalitFScheduleLogUpdate AFTER UPDATE ON UserSettings.AnalitFSchedules
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.AnalitFScheduleLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 1,
		ScheduleId = OLD.Id,
		ClientId = NULLIF(NEW.ClientId, OLD.ClientId),
		Enable = NULLIF(NEW.Enable, OLD.Enable),
		Hour = NULLIF(NEW.Hour, OLD.Hour),
		Minute = NULLIF(NEW.Minute, OLD.Minute);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER UserSettings.AnalitFScheduleLogDelete AFTER DELETE ON UserSettings.AnalitFSchedules
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.AnalitFScheduleLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 2,
		ScheduleId = OLD.Id,
		ClientId = OLD.ClientId,
		Enable = OLD.Enable,
		Hour = OLD.Hour,
		Minute = OLD.Minute;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `RetClientsSet`
--

DROP TABLE IF EXISTS `RetClientsSet`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `RetClientsSet` (
  `ClientCode` int(11) unsigned NOT NULL DEFAULT '0',
  `InvisibleOnFirm` tinyint(1) unsigned NOT NULL DEFAULT '0',
  `BaseFirmCategory` smallint(6) unsigned NOT NULL DEFAULT '0',
  `RetUpCost` int(11) unsigned NOT NULL DEFAULT '30',
  `OverCostPercent` int(11) unsigned NOT NULL DEFAULT '5',
  `DifferenceCalculation` tinyint(1) unsigned NOT NULL DEFAULT '1',
  `AlowRegister` tinyint(1) unsigned NOT NULL DEFAULT '1',
  `AlowRejection` tinyint(1) unsigned NOT NULL DEFAULT '1',
  `AlowDocuments` tinyint(1) unsigned NOT NULL DEFAULT '1',
  `MultiUserLevel` smallint(6) unsigned NOT NULL DEFAULT '1',
  `AdvertisingLevel` tinyint(1) unsigned NOT NULL DEFAULT '1',
  `AlowWayBill` tinyint(1) unsigned NOT NULL DEFAULT '1',
  `AllowDocuments` tinyint(1) DEFAULT '1',
  `AlowChangeSegment` tinyint(1) unsigned NOT NULL DEFAULT '0',
  `ShowPriceName` tinyint(1) unsigned NOT NULL DEFAULT '0',
  `WorkRegionMask` bigint(20) unsigned NOT NULL DEFAULT '18446744073709551615',
  `OrderRegionMask` bigint(20) unsigned NOT NULL DEFAULT '18446744073709551615',
  `EnableUpdate` tinyint(1) unsigned NOT NULL DEFAULT '0',
  `CheckCopyID` tinyint(1) unsigned NOT NULL DEFAULT '1',
  `AlowCumulativeUpdate` tinyint(1) unsigned NOT NULL DEFAULT '1',
  `CheckCumulativeUpdateStatus` tinyint(1) unsigned NOT NULL DEFAULT '1',
  `ServiceClient` tinyint(1) unsigned NOT NULL DEFAULT '0',
  `SubmitOrders` tinyint(1) unsigned NOT NULL DEFAULT '0',
  `AllowSubmitOrders` tinyint(1) unsigned NOT NULL DEFAULT '0',
  `BasecostPassword` varchar(16) NOT NULL DEFAULT '',
  `OrdersVisualizationMode` tinyint(1) unsigned NOT NULL DEFAULT '0',
  `CalculateLeader` tinyint(1) unsigned NOT NULL DEFAULT '0',
  `AllowPreparatInfo` tinyint(1) unsigned NOT NULL DEFAULT '0',
  `AllowPreparatDesc` tinyint(1) unsigned NOT NULL DEFAULT '0',
  `SmartOrderRuleId` int(10) unsigned DEFAULT NULL,
  `FirmCodeOnly` int(10) unsigned DEFAULT NULL,
  `MaxWeeklyOrdersSum` int(10) unsigned NOT NULL DEFAULT '0',
  `CheckWeeklyOrdersSum` tinyint(1) unsigned NOT NULL DEFAULT '0',
  `AllowDelayOfPayment` tinyint(1) unsigned NOT NULL DEFAULT '0',
  `Spy` tinyint(1) unsigned NOT NULL DEFAULT '0',
  `SpyAccount` tinyint(1) unsigned NOT NULL DEFAULT '0',
  `ShowNewDefecture` tinyint(1) unsigned NOT NULL DEFAULT '1',
  `MigrateToPrgDataService` tinyint(1) unsigned NOT NULL DEFAULT '0',
  `ManualComparison` tinyint(1) unsigned NOT NULL DEFAULT '0',
  `ParseWaybills` tinyint(1) unsigned NOT NULL DEFAULT '0',
  `SendRetailMarkup` tinyint(1) unsigned NOT NULL DEFAULT '0',
  `ShowAdvertising` tinyint(1) unsigned NOT NULL DEFAULT '1',
  `IgnoreNewPrices` tinyint(1) unsigned NOT NULL DEFAULT '0' COMMENT 'Не включать новых поставщиков/прайс-листы\r\n0 - новые прайс листы будут автоматически подключаться этой аптеке\r\n1 - новые прайс-листы НЕ будут автоматически подключаться',
  `SendWaybillsFromClient` tinyint(1) unsigned NOT NULL DEFAULT '0' COMMENT 'Разрешено ли с клиента отправлять накладные для разбора?',
  `OnlyParseWaybills` tinyint(1) unsigned DEFAULT '0',
  `UpdateToTestBuild` tinyint(1) NOT NULL DEFAULT '0',
  `EnableSmartOrder` tinyint(1) unsigned NOT NULL DEFAULT '0' COMMENT 'Доступен ли АвтоЗаказ клиенту в AnalitF?',
  `BuyingMatrixPriceId` int(10) unsigned DEFAULT NULL COMMENT 'ссылка на ассортиментный прайс-лист, из которого будет формироваться матрица закупок, если не установлен, то механизм не активирован',
  `BuyingMatrixType` int(10) unsigned NOT NULL DEFAULT '0' COMMENT 'тип матрицы закупок: 0 - белый список, 1 - черный список',
  `WarningOnBuyingMatrix` tinyint(1) unsigned NOT NULL DEFAULT '0' COMMENT 'выдавать предупреждение на препараты вне матрицы закупок',
  `EnableImpersonalPrice` tinyint(1) unsigned NOT NULL DEFAULT '0' COMMENT 'Доступен механизм Обезличенный прайс-лист',
  `NetworkSupplierId` int(10) unsigned DEFAULT NULL,
  `NoiseCosts` tinyint(1) NOT NULL DEFAULT '0',
  `NoiseCostExceptSupplierId` int(10) unsigned DEFAULT NULL,
  `NetworkPriceId` int(10) unsigned DEFAULT NULL,
  `IsConvertFormat` tinyint(1) unsigned NOT NULL DEFAULT '0' COMMENT 'Преобразование в формат dbf',
  `AssortimentPriceId` int(10) unsigned DEFAULT NULL COMMENT 'Ассортиментный прайс-лист',
  `OfferMatrixPriceId` int(10) unsigned DEFAULT NULL COMMENT 'ссылка на ассортиментный прайс-лист, из которого будет формироваться матрица предложений, если не установлен, то механизм не активирован',
  `OfferMatrixType` int(10) unsigned NOT NULL DEFAULT '0' COMMENT 'тип матрицы предложений: 0 - белый список, 1 - черный список',
  `IgnoreNewPriceForUser` tinyint(1) NOT NULL DEFAULT '0',
  `AllowAnalitFSchedule` tinyint(1) unsigned NOT NULL DEFAULT '0' COMMENT 'Разрешить функциональность расписания обновлений в AnalitF',
  `ShowCertificatesWithoutRefSupplier` tinyint(1) unsigned NOT NULL DEFAULT '0' COMMENT 'Отображать сертификаты без привязки к поставщику',
  PRIMARY KEY (`ClientCode`),
  KEY `FK_retclientsset_SmartOrderRuleId` (`SmartOrderRuleId`),
  KEY `FK_RetClientsSet_BuyingMatrixPriceId` (`BuyingMatrixPriceId`),
  KEY `FK_RetClientsSet_NetworkSupplierId` (`NetworkSupplierId`),
  KEY `FK_RetClientsSet_NetworkPriceId` (`NetworkPriceId`),
  KEY `FK_RetClientsSet_OfferMatrixPriceId` (`OfferMatrixPriceId`),
  CONSTRAINT `FK_RetClientsSet_BuyingMatrixPriceId` FOREIGN KEY (`BuyingMatrixPriceId`) REFERENCES `pricesdata` (`PriceCode`) ON DELETE SET NULL,
  CONSTRAINT `FK_RetClientsSet_NetworkPriceId` FOREIGN KEY (`NetworkPriceId`) REFERENCES `pricesdata` (`PriceCode`) ON DELETE SET NULL,
  CONSTRAINT `FK_RetClientsSet_NetworkSupplierId` FOREIGN KEY (`NetworkSupplierId`) REFERENCES `clientsdata` (`FirmCode`) ON DELETE SET NULL,
  CONSTRAINT `FK_RetClientsSet_OfferMatrixPriceId` FOREIGN KEY (`OfferMatrixPriceId`) REFERENCES `pricesdata` (`PriceCode`) ON DELETE SET NULL,
  CONSTRAINT `FK_retclientsset_SmartOrderRuleId` FOREIGN KEY (`SmartOrderRuleId`) REFERENCES `ordersendrules`.`smart_order_rules` (`Id`)
) ENGINE=InnoDB DEFAULT CHARSET=cp1251 MIN_ROWS=1000 MAX_ROWS=50000 PACK_KEYS=0 ROW_FORMAT=COMPACT COMMENT='InnoDB free: 8267776 kB; (`ClientCode`) REFER `usersettings/';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER UserSettings.RetClientsSetLogInsert AFTER INSERT ON UserSettings.RetClientsSet
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.RetClientsSetLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 0,
		ClientCode = NEW.ClientCode,
		InvisibleOnFirm = NEW.InvisibleOnFirm,
		BaseFirmCategory = NEW.BaseFirmCategory,
		RetUpCost = NEW.RetUpCost,
		OverCostPercent = NEW.OverCostPercent,
		DifferenceCalculation = NEW.DifferenceCalculation,
		AlowRegister = NEW.AlowRegister,
		AlowRejection = NEW.AlowRejection,
		AlowDocuments = NEW.AlowDocuments,
		MultiUserLevel = NEW.MultiUserLevel,
		AdvertisingLevel = NEW.AdvertisingLevel,
		AlowWayBill = NEW.AlowWayBill,
		AllowDocuments = NEW.AllowDocuments,
		AlowChangeSegment = NEW.AlowChangeSegment,
		ShowPriceName = NEW.ShowPriceName,
		WorkRegionMask = NEW.WorkRegionMask,
		OrderRegionMask = NEW.OrderRegionMask,
		EnableUpdate = NEW.EnableUpdate,
		CheckCopyID = NEW.CheckCopyID,
		AlowCumulativeUpdate = NEW.AlowCumulativeUpdate,
		CheckCumulativeUpdateStatus = NEW.CheckCumulativeUpdateStatus,
		ServiceClient = NEW.ServiceClient,
		SubmitOrders = NEW.SubmitOrders,
		AllowSubmitOrders = NEW.AllowSubmitOrders,
		BasecostPassword = NEW.BasecostPassword,
		OrdersVisualizationMode = NEW.OrdersVisualizationMode,
		CalculateLeader = NEW.CalculateLeader,
		AllowPreparatInfo = NEW.AllowPreparatInfo,
		AllowPreparatDesc = NEW.AllowPreparatDesc,
		SmartOrderRuleId = NEW.SmartOrderRuleId,
		FirmCodeOnly = NEW.FirmCodeOnly,
		MaxWeeklyOrdersSum = NEW.MaxWeeklyOrdersSum,
		CheckWeeklyOrdersSum = NEW.CheckWeeklyOrdersSum,
		AllowDelayOfPayment = NEW.AllowDelayOfPayment,
		Spy = NEW.Spy,
		SpyAccount = NEW.SpyAccount,
		ShowNewDefecture = NEW.ShowNewDefecture,
		MigrateToPrgDataService = NEW.MigrateToPrgDataService,
		ManualComparison = NEW.ManualComparison,
		ParseWaybills = NEW.ParseWaybills,
		SendRetailMarkup = NEW.SendRetailMarkup,
		ShowAdvertising = NEW.ShowAdvertising,
		IgnoreNewPrices = NEW.IgnoreNewPrices,
		SendWaybillsFromClient = NEW.SendWaybillsFromClient,
		OnlyParseWaybills = NEW.OnlyParseWaybills,
		UpdateToTestBuild = NEW.UpdateToTestBuild,
		EnableSmartOrder = NEW.EnableSmartOrder,
		BuyingMatrixPriceId = NEW.BuyingMatrixPriceId,
		BuyingMatrixType = NEW.BuyingMatrixType,
		WarningOnBuyingMatrix = NEW.WarningOnBuyingMatrix,
		EnableImpersonalPrice = NEW.EnableImpersonalPrice,
		NetworkSupplierId = NEW.NetworkSupplierId,
		NoiseCosts = NEW.NoiseCosts,
		NoiseCostExceptSupplierId = NEW.NoiseCostExceptSupplierId,
		NetworkPriceId = NEW.NetworkPriceId,
		IsConvertFormat = NEW.IsConvertFormat,
		AssortimentPriceId = NEW.AssortimentPriceId,
		OfferMatrixPriceId = NEW.OfferMatrixPriceId,
		OfferMatrixType = NEW.OfferMatrixType,
		IgnoreNewPriceForUser = NEW.IgnoreNewPriceForUser,
		AllowAnalitFSchedule = NEW.AllowAnalitFSchedule;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER UserSettings.RetClientsSetLogUpdate AFTER UPDATE ON UserSettings.RetClientsSet
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.RetClientsSetLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 1,
		ClientCode = OLD.ClientCode,
		InvisibleOnFirm = NULLIF(NEW.InvisibleOnFirm, OLD.InvisibleOnFirm),
		BaseFirmCategory = NULLIF(NEW.BaseFirmCategory, OLD.BaseFirmCategory),
		RetUpCost = NULLIF(NEW.RetUpCost, OLD.RetUpCost),
		OverCostPercent = NULLIF(NEW.OverCostPercent, OLD.OverCostPercent),
		DifferenceCalculation = NULLIF(NEW.DifferenceCalculation, OLD.DifferenceCalculation),
		AlowRegister = NULLIF(NEW.AlowRegister, OLD.AlowRegister),
		AlowRejection = NULLIF(NEW.AlowRejection, OLD.AlowRejection),
		AlowDocuments = NULLIF(NEW.AlowDocuments, OLD.AlowDocuments),
		MultiUserLevel = NULLIF(NEW.MultiUserLevel, OLD.MultiUserLevel),
		AdvertisingLevel = NULLIF(NEW.AdvertisingLevel, OLD.AdvertisingLevel),
		AlowWayBill = NULLIF(NEW.AlowWayBill, OLD.AlowWayBill),
		AllowDocuments = NULLIF(NEW.AllowDocuments, OLD.AllowDocuments),
		AlowChangeSegment = NULLIF(NEW.AlowChangeSegment, OLD.AlowChangeSegment),
		ShowPriceName = NULLIF(NEW.ShowPriceName, OLD.ShowPriceName),
		WorkRegionMask = NULLIF(NEW.WorkRegionMask, OLD.WorkRegionMask),
		OrderRegionMask = NULLIF(NEW.OrderRegionMask, OLD.OrderRegionMask),
		EnableUpdate = NULLIF(NEW.EnableUpdate, OLD.EnableUpdate),
		CheckCopyID = NULLIF(NEW.CheckCopyID, OLD.CheckCopyID),
		AlowCumulativeUpdate = NULLIF(NEW.AlowCumulativeUpdate, OLD.AlowCumulativeUpdate),
		CheckCumulativeUpdateStatus = NULLIF(NEW.CheckCumulativeUpdateStatus, OLD.CheckCumulativeUpdateStatus),
		ServiceClient = NULLIF(NEW.ServiceClient, OLD.ServiceClient),
		SubmitOrders = NULLIF(NEW.SubmitOrders, OLD.SubmitOrders),
		AllowSubmitOrders = NULLIF(NEW.AllowSubmitOrders, OLD.AllowSubmitOrders),
		BasecostPassword = NULLIF(NEW.BasecostPassword, OLD.BasecostPassword),
		OrdersVisualizationMode = NULLIF(NEW.OrdersVisualizationMode, OLD.OrdersVisualizationMode),
		CalculateLeader = NULLIF(NEW.CalculateLeader, OLD.CalculateLeader),
		AllowPreparatInfo = NULLIF(NEW.AllowPreparatInfo, OLD.AllowPreparatInfo),
		AllowPreparatDesc = NULLIF(NEW.AllowPreparatDesc, OLD.AllowPreparatDesc),
		SmartOrderRuleId = NULLIF(NEW.SmartOrderRuleId, OLD.SmartOrderRuleId),
		FirmCodeOnly = NULLIF(NEW.FirmCodeOnly, OLD.FirmCodeOnly),
		MaxWeeklyOrdersSum = NULLIF(NEW.MaxWeeklyOrdersSum, OLD.MaxWeeklyOrdersSum),
		CheckWeeklyOrdersSum = NULLIF(NEW.CheckWeeklyOrdersSum, OLD.CheckWeeklyOrdersSum),
		AllowDelayOfPayment = NULLIF(NEW.AllowDelayOfPayment, OLD.AllowDelayOfPayment),
		Spy = NULLIF(NEW.Spy, OLD.Spy),
		SpyAccount = NULLIF(NEW.SpyAccount, OLD.SpyAccount),
		ShowNewDefecture = NULLIF(NEW.ShowNewDefecture, OLD.ShowNewDefecture),
		MigrateToPrgDataService = NULLIF(NEW.MigrateToPrgDataService, OLD.MigrateToPrgDataService),
		ManualComparison = NULLIF(NEW.ManualComparison, OLD.ManualComparison),
		ParseWaybills = NULLIF(NEW.ParseWaybills, OLD.ParseWaybills),
		SendRetailMarkup = NULLIF(NEW.SendRetailMarkup, OLD.SendRetailMarkup),
		ShowAdvertising = NULLIF(NEW.ShowAdvertising, OLD.ShowAdvertising),
		IgnoreNewPrices = NULLIF(NEW.IgnoreNewPrices, OLD.IgnoreNewPrices),
		SendWaybillsFromClient = NULLIF(NEW.SendWaybillsFromClient, OLD.SendWaybillsFromClient),
		OnlyParseWaybills = NULLIF(NEW.OnlyParseWaybills, OLD.OnlyParseWaybills),
		UpdateToTestBuild = NULLIF(NEW.UpdateToTestBuild, OLD.UpdateToTestBuild),
		EnableSmartOrder = NULLIF(NEW.EnableSmartOrder, OLD.EnableSmartOrder),
		BuyingMatrixPriceId = NULLIF(NEW.BuyingMatrixPriceId, OLD.BuyingMatrixPriceId),
		BuyingMatrixType = NULLIF(NEW.BuyingMatrixType, OLD.BuyingMatrixType),
		WarningOnBuyingMatrix = NULLIF(NEW.WarningOnBuyingMatrix, OLD.WarningOnBuyingMatrix),
		EnableImpersonalPrice = NULLIF(NEW.EnableImpersonalPrice, OLD.EnableImpersonalPrice),
		NetworkSupplierId = NULLIF(NEW.NetworkSupplierId, OLD.NetworkSupplierId),
		NoiseCosts = NULLIF(NEW.NoiseCosts, OLD.NoiseCosts),
		NoiseCostExceptSupplierId = NULLIF(NEW.NoiseCostExceptSupplierId, OLD.NoiseCostExceptSupplierId),
		NetworkPriceId = NULLIF(NEW.NetworkPriceId, OLD.NetworkPriceId),
		IsConvertFormat = NULLIF(NEW.IsConvertFormat, OLD.IsConvertFormat),
		AssortimentPriceId = NULLIF(NEW.AssortimentPriceId, OLD.AssortimentPriceId),
		OfferMatrixPriceId = NULLIF(NEW.OfferMatrixPriceId, OLD.OfferMatrixPriceId),
		OfferMatrixType = NULLIF(NEW.OfferMatrixType, OLD.OfferMatrixType),
		IgnoreNewPriceForUser = NULLIF(NEW.IgnoreNewPriceForUser, OLD.IgnoreNewPriceForUser),
		AllowAnalitFSchedule = NULLIF(NEW.AllowAnalitFSchedule, OLD.AllowAnalitFSchedule);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER UserSettings.RetClientsSetLogDelete AFTER DELETE ON UserSettings.RetClientsSet
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.RetClientsSetLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 2,
		ClientCode = OLD.ClientCode,
		InvisibleOnFirm = OLD.InvisibleOnFirm,
		BaseFirmCategory = OLD.BaseFirmCategory,
		RetUpCost = OLD.RetUpCost,
		OverCostPercent = OLD.OverCostPercent,
		DifferenceCalculation = OLD.DifferenceCalculation,
		AlowRegister = OLD.AlowRegister,
		AlowRejection = OLD.AlowRejection,
		AlowDocuments = OLD.AlowDocuments,
		MultiUserLevel = OLD.MultiUserLevel,
		AdvertisingLevel = OLD.AdvertisingLevel,
		AlowWayBill = OLD.AlowWayBill,
		AllowDocuments = OLD.AllowDocuments,
		AlowChangeSegment = OLD.AlowChangeSegment,
		ShowPriceName = OLD.ShowPriceName,
		WorkRegionMask = OLD.WorkRegionMask,
		OrderRegionMask = OLD.OrderRegionMask,
		EnableUpdate = OLD.EnableUpdate,
		CheckCopyID = OLD.CheckCopyID,
		AlowCumulativeUpdate = OLD.AlowCumulativeUpdate,
		CheckCumulativeUpdateStatus = OLD.CheckCumulativeUpdateStatus,
		ServiceClient = OLD.ServiceClient,
		SubmitOrders = OLD.SubmitOrders,
		AllowSubmitOrders = OLD.AllowSubmitOrders,
		BasecostPassword = OLD.BasecostPassword,
		OrdersVisualizationMode = OLD.OrdersVisualizationMode,
		CalculateLeader = OLD.CalculateLeader,
		AllowPreparatInfo = OLD.AllowPreparatInfo,
		AllowPreparatDesc = OLD.AllowPreparatDesc,
		SmartOrderRuleId = OLD.SmartOrderRuleId,
		FirmCodeOnly = OLD.FirmCodeOnly,
		MaxWeeklyOrdersSum = OLD.MaxWeeklyOrdersSum,
		CheckWeeklyOrdersSum = OLD.CheckWeeklyOrdersSum,
		AllowDelayOfPayment = OLD.AllowDelayOfPayment,
		Spy = OLD.Spy,
		SpyAccount = OLD.SpyAccount,
		ShowNewDefecture = OLD.ShowNewDefecture,
		MigrateToPrgDataService = OLD.MigrateToPrgDataService,
		ManualComparison = OLD.ManualComparison,
		ParseWaybills = OLD.ParseWaybills,
		SendRetailMarkup = OLD.SendRetailMarkup,
		ShowAdvertising = OLD.ShowAdvertising,
		IgnoreNewPrices = OLD.IgnoreNewPrices,
		SendWaybillsFromClient = OLD.SendWaybillsFromClient,
		OnlyParseWaybills = OLD.OnlyParseWaybills,
		UpdateToTestBuild = OLD.UpdateToTestBuild,
		EnableSmartOrder = OLD.EnableSmartOrder,
		BuyingMatrixPriceId = OLD.BuyingMatrixPriceId,
		BuyingMatrixType = OLD.BuyingMatrixType,
		WarningOnBuyingMatrix = OLD.WarningOnBuyingMatrix,
		EnableImpersonalPrice = OLD.EnableImpersonalPrice,
		NetworkSupplierId = OLD.NetworkSupplierId,
		NoiseCosts = OLD.NoiseCosts,
		NoiseCostExceptSupplierId = OLD.NoiseCostExceptSupplierId,
		NetworkPriceId = OLD.NetworkPriceId,
		IsConvertFormat = OLD.IsConvertFormat,
		AssortimentPriceId = OLD.AssortimentPriceId,
		OfferMatrixPriceId = OLD.OfferMatrixPriceId,
		OfferMatrixType = OLD.OfferMatrixType,
		IgnoreNewPriceForUser = OLD.IgnoreNewPriceForUser,
		AllowAnalitFSchedule = OLD.AllowAnalitFSchedule;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `UserActions`
--

DROP TABLE IF EXISTS `UserActions`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `UserActions` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `Name` varchar(255) NOT NULL COMMENT 'Наименование действия',
  `Identifier` varchar(255) NOT NULL COMMENT 'Идентификатор действия для AnalitF.dpr',
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=20 DEFAULT CHARSET=cp1251;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `analitfdocumentsprocessing`
--

DROP TABLE IF EXISTS `analitfdocumentsprocessing`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `analitfdocumentsprocessing` (
  `UpdateId` int(10) unsigned DEFAULT NULL,
  `DocumentId` int(10) unsigned DEFAULT NULL,
  `Committed` tinyint(1) unsigned DEFAULT NULL,
  KEY `DocumentId_IDX` (`DocumentId`),
  KEY `UpdateId_IDX` (`UpdateId`),
  CONSTRAINT `FK_AnalitFDocumentsProcessing_1` FOREIGN KEY (`UpdateId`) REFERENCES `logs`.`analitfupdates` (`UpdateId`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `FK_AnalitFDocumentsProcessing_2` FOREIGN KEY (`DocumentId`) REFERENCES `logs`.`document_logs` (`RowId`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `analitfreplicationinfo`
--

DROP TABLE IF EXISTS `analitfreplicationinfo`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `analitfreplicationinfo` (
  `UserId` int(10) unsigned NOT NULL DEFAULT '0',
  `FirmCode` int(10) unsigned NOT NULL DEFAULT '0',
  `MaxSynonymFirmCrCode` bigint(20) unsigned NOT NULL DEFAULT '0',
  `UncMaxSynonymFirmCrCode` bigint(10) unsigned NOT NULL DEFAULT '0',
  `MaxSynonymCode` bigint(10) unsigned NOT NULL DEFAULT '0',
  `UncMaxSynonymCode` bigint(10) unsigned NOT NULL DEFAULT '0',
  `ForceReplication` tinyint(1) unsigned DEFAULT '1',
  `ForceReplicationUpdate` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `PromotionDate` datetime DEFAULT NULL,
  PRIMARY KEY (`UserId`,`FirmCode`),
  KEY `FK_AnalitFReplicationInfo_2` (`FirmCode`),
  CONSTRAINT `FK_AnalitFReplicationInfo_2` FOREIGN KEY (`FirmCode`) REFERENCES `clientsdata` (`FirmCode`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `analitfversionrules`
--

DROP TABLE IF EXISTS `analitfversionrules`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `analitfversionrules` (
  `Id` int(11) NOT NULL AUTO_INCREMENT,
  `SourceVersion` mediumint(8) unsigned NOT NULL,
  `DestinationVersion` mediumint(8) unsigned NOT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=539 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `assignedpermissions`
--

DROP TABLE IF EXISTS `assignedpermissions`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `assignedpermissions` (
  `PermissionId` int(10) unsigned NOT NULL,
  `UserId` int(10) unsigned NOT NULL,
  PRIMARY KEY (`PermissionId`,`UserId`),
  KEY `FK_AssignedPermissions_UserId` (`UserId`),
  CONSTRAINT `FK_AssignedPermissions_PermissionId` FOREIGN KEY (`PermissionId`) REFERENCES `userpermissions` (`Id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER AssignedPermissionLogInsert AFTER INSERT ON Usersettings.AssignedPermissions
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.AssignedPermissionLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 0,
		PermissionId = NEW.PermissionId,
		UserId = NEW.UserId;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER AssignedPermissionLogUpdate AFTER UPDATE ON Usersettings.AssignedPermissions
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.AssignedPermissionLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 1,
		PermissionId = NULLIF(NEW.PermissionId, OLD.PermissionId),
		UserId = NULLIF(NEW.UserId, OLD.UserId);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER AssignedPermissionLogDelete AFTER DELETE ON Usersettings.AssignedPermissions
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.AssignedPermissionLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 2,
		PermissionId = OLD.PermissionId,
		UserId = OLD.UserId;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `banners`
--

DROP TABLE IF EXISTS `banners`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `banners` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `Href` varchar(255) DEFAULT NULL,
  `Image` varchar(255) DEFAULT NULL,
  `Active` tinyint(1) DEFAULT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `clientsdata`
--

DROP TABLE IF EXISTS `clientsdata`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `clientsdata` (
  `FirmCode` int(11) unsigned NOT NULL AUTO_INCREMENT,
  `BillingStatus` tinyint(1) unsigned NOT NULL DEFAULT '0',
  `FirmStatus` tinyint(1) unsigned NOT NULL DEFAULT '0',
  `FirmSegment` tinyint(1) unsigned NOT NULL DEFAULT '0',
  `FirmType` tinyint(1) unsigned NOT NULL DEFAULT '0',
  `BillingCode` int(10) unsigned DEFAULT NULL,
  `RegionCode` bigint(20) unsigned DEFAULT NULL,
  `MaskRegion` bigint(20) unsigned DEFAULT NULL,
  `ShowRegionMask` bigint(20) unsigned DEFAULT NULL,
  `FullName` varchar(40) DEFAULT NULL,
  `ShortName` varchar(50) DEFAULT NULL,
  `Fax` varchar(20) DEFAULT NULL,
  `Adress` varchar(100) DEFAULT NULL,
  `Registrant` varchar(100) DEFAULT NULL,
  `RegistrationDate` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `ContactGroupOwnerId` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`FirmCode`),
  KEY `BillingCode_IDX` (`BillingCode`) USING BTREE,
  KEY `RegionCode_IDX` (`RegionCode`) USING BTREE,
  KEY `FirmType_IDX` (`FirmType`) USING BTREE,
  KEY `FirmStatus_IDX` (`FirmStatus`) USING BTREE,
  KEY `FirmSegment_IDX` (`FirmSegment`) USING BTREE,
  KEY `FullName_IDX` (`FullName`) USING BTREE,
  KEY `ShortName_IDX` (`ShortName`) USING BTREE,
  KEY `Registrant_IDX` (`Registrant`) USING BTREE,
  KEY `BillingStatus_IDX` (`BillingStatus`) USING BTREE,
  KEY `FK_clientsdata_ContactGroupOwnerId` (`ContactGroupOwnerId`) USING BTREE,
  KEY `Registration_Date` (`RegistrationDate`) USING BTREE,
  CONSTRAINT `clientsdata_ibfk_1` FOREIGN KEY (`RegionCode`) REFERENCES `farm`.`regions` (`RegionCode`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `clientsdata_ibfk_2` FOREIGN KEY (`BillingCode`) REFERENCES `billing`.`payers` (`PayerID`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `FK_clientsdata_ContactGroupOwnerId` FOREIGN KEY (`ContactGroupOwnerId`) REFERENCES `contacts`.`contact_group_owners` (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=12485 DEFAULT CHARSET=cp1251 MIN_ROWS=1800 MAX_ROWS=100000 PACK_KEYS=0 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER ClientsdataLogInsert AFTER insert ON `ClientsData` FOR EACH ROW BEGIN
        INSERT
        INTO    `logs`.clients_data_logs 
                SET LogTime = now()
                ,
                OperatorName = IFNULL(
                        @INUser, 
                        SUBSTRING_INDEX(USER(),'@',1)
                ) 
                , 
                OperatorHost = IFNULL(
                        @INHost,
                        SUBSTRING_INDEX(USER(),'@',-1)
                ) 
                , 
                Operation          = 0, 
                clientsdataID      = NEW.FirmCode ,
                BillingStatus      = NEW.BillingStatus ,
                FirmStatus         = NEW.FirmStatus ,
                FirmSegment        = NEW.FirmSegment ,
                FirmType           = NEW.FirmType ,
                BillingCode        = NEW.BillingCode ,
                RegionCode         = NEW.RegionCode ,
                MaskRegion         = NEW.MaskRegion ,
                FullName           = NEW.FullName ,
                ShortName          = NEW.ShortName ,
                Fax                = NEW.Fax,
                Adress             = NEW.Adress,
                Registrant         = NEW.Registrant;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER ClientsdataLogUpdate AFTER update ON `ClientsData` FOR EACH ROW BEGIN
INSERT
INTO    `logs`.clients_data_logs 
        SET LogTime = now()
        ,
        OperatorName = IFNULL(
                @INUser, 
                SUBSTRING_INDEX(USER(),'@',1)
        ) 
        , 
        OperatorHost = IFNULL(
                @INHost, 
                SUBSTRING_INDEX(USER(),'@',-1)
        )
        ,
        Operation  = 1, 
        clientsdataID = OLD.FirmCode ,
        BillingStatus = NULLIF(
                NEW.BillingStatus,
                OLD.BillingStatus
        ) 
        ,
        FirmStatus = NULLIF(
                NEW.FirmStatus,
                OLD.FirmStatus
        ) 
        ,
        FirmSegment = NULLIF(
                NEW.FirmSegment,
                OLD.FirmSegment
        ) 
        ,
        FirmType = NULLIF(
                NEW.FirmType,
                OLD.FirmType
        ) 
        ,
        BillingCode = NULLIF(
                NEW.BillingCode,
                OLD.BillingCode
        ) 
        ,
        RegionCode = NULLIF(
                NEW.RegionCode,
                OLD.RegionCode
        ) 
        ,
        MaskRegion = NULLIF(
                NEW.MaskRegion,
                OLD.MaskRegion
        ) 
        ,
        FullName = NULLIF(
                NEW.FullName,
                OLD.FullName
        ) 
        ,
        ShortName = NULLIF(
                NEW.ShortName,
                OLD.ShortName
        ) 
        ,
        Fax = NULLIF(
                NEW.Fax,
                OLD.Fax
        ) 
        ,
     
        Adress = NULLIF(
                NEW.Adress,
                OLD.Adress
        ),
        Registrant = NULLIF(
                NEW.Registrant,
                OLD.Registrant
        ) 
        ;
if NEW.FirmStatus <> OLD.FirmStatus and NEW.FirmStatus=1 and OLD.FirmType=0 then

UPDATE AnalitFReplicationInfo
SET    ForceReplication=1
WHERE  FirmCode=NEW.FirmCode;

end if;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER ClientsdataLogDelete AFTER delete ON `ClientsData` FOR EACH ROW BEGIN
        INSERT
        INTO    `logs`.clients_data_logs
                SET LogTime = now()
                ,
                OperatorName = IFNULL(
                        @INUser,
                        SUBSTRING_INDEX(USER(),'@',1)
                )
                ,
                OperatorHost = IFNULL(
                        @INHost,
                        SUBSTRING_INDEX(USER(),'@',-1)
                )
                ,
                Operation          = 2,
                clientsdataID      = OLD.FirmCode ,
                BillingStatus      = OLD.BillingStatus ,
                FirmStatus         = OLD.FirmStatus ,
                FirmSegment        = OLD.FirmSegment ,
                FirmType           = OLD.FirmType ,
                BillingCode        = OLD.BillingCode ,
                RegionCode         = OLD.RegionCode ,
                MaskRegion         = OLD.MaskRegion ,
                FullName           = OLD.FullName ,
                ShortName          = OLD.ShortName ,
                Fax                = OLD.Fax ,
                Adress             = OLD.Adress ,
                Registrant         = OLD.Registrant;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `costoptimizationclients`
--

DROP TABLE IF EXISTS `costoptimizationclients`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `costoptimizationclients` (
  `RuleId` int(10) unsigned NOT NULL,
  `ClientId` int(10) unsigned NOT NULL,
  PRIMARY KEY (`RuleId`,`ClientId`),
  CONSTRAINT `FK_CostOptimizationClients_RuleId` FOREIGN KEY (`RuleId`) REFERENCES `costoptimizationrules` (`Id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `costoptimizationconcurrents`
--

DROP TABLE IF EXISTS `costoptimizationconcurrents`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `costoptimizationconcurrents` (
  `RuleId` int(10) unsigned NOT NULL,
  `SupplierId` int(10) unsigned NOT NULL,
  PRIMARY KEY (`RuleId`,`SupplierId`),
  KEY `FK_CostOptimizationConcurrents_SupplierId` (`SupplierId`),
  CONSTRAINT `FK_CostOptimizationConcurrents_RuleId` FOREIGN KEY (`RuleId`) REFERENCES `costoptimizationrules` (`Id`) ON DELETE CASCADE,
  CONSTRAINT `FK_CostOptimizationConcurrents_SupplierId` FOREIGN KEY (`SupplierId`) REFERENCES `clientsdata` (`FirmCode`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `costoptimizationrules`
--

DROP TABLE IF EXISTS `costoptimizationrules`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `costoptimizationrules` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `SupplierId` int(10) unsigned NOT NULL,
  PRIMARY KEY (`Id`),
  KEY `FK_CostOptimizationRules_SupplierId` (`SupplierId`),
  CONSTRAINT `FK_CostOptimizationRules_SupplierId` FOREIGN KEY (`SupplierId`) REFERENCES `clientsdata` (`FirmCode`) ON DELETE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=7 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `defaults`
--

DROP TABLE IF EXISTS `defaults`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `defaults` (
  `AnalitFVersion` mediumint(8) unsigned NOT NULL,
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `FormaterId` int(10) unsigned NOT NULL,
  `SenderId` int(10) unsigned NOT NULL,
  `EmailFooter` text,
  `Phones` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`Id`),
  KEY `FK_FormaterId` (`FormaterId`),
  KEY `FK_SenderId` (`SenderId`),
  CONSTRAINT `FK_FormaterId` FOREIGN KEY (`FormaterId`) REFERENCES `ordersendrules`.`order_handlers` (`Id`),
  CONSTRAINT `FK_SenderId` FOREIGN KEY (`SenderId`) REFERENCES `ordersendrules`.`order_handlers` (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER Usersettings.DefaultLogInsert AFTER INSERT ON Usersettings.Defaults
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.DefaultLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 0,
		AnalitFVersion = NEW.AnalitFVersion,
		DefaultId = NEW.Id,
		FormaterId = NEW.FormaterId,
		SenderId = NEW.SenderId,
		EmailFooter = NEW.EmailFooter,
		Phones = NEW.Phones;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER Usersettings.DefaultLogUpdate AFTER UPDATE ON Usersettings.Defaults
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.DefaultLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 1,
		AnalitFVersion = NULLIF(NEW.AnalitFVersion, OLD.AnalitFVersion),
		DefaultId = OLD.Id,
		FormaterId = NULLIF(NEW.FormaterId, OLD.FormaterId),
		SenderId = NULLIF(NEW.SenderId, OLD.SenderId),
		EmailFooter = NULLIF(NEW.EmailFooter, OLD.EmailFooter),
		Phones = NULLIF(NEW.Phones, OLD.Phones);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER Usersettings.DefaultLogDelete AFTER DELETE ON Usersettings.Defaults
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.DefaultLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 2,
		AnalitFVersion = OLD.AnalitFVersion,
		DefaultId = OLD.Id,
		FormaterId = OLD.FormaterId,
		SenderId = OLD.SenderId,
		EmailFooter = OLD.EmailFooter,
		Phones = OLD.Phones;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `delayofpayments`
--

DROP TABLE IF EXISTS `delayofpayments`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `delayofpayments` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `PriceIntersectionId` int(10) unsigned NOT NULL,
  `VitallyImportantDelay` decimal(5,3) NOT NULL DEFAULT '0.000' COMMENT 'Значение отсрочки платежа для ЖНВЛС',
  `OtherDelay` decimal(5,3) NOT NULL DEFAULT '0.000' COMMENT 'Значение отсрочки платежа для прочего ассортимента',
  `DayOfWeek` enum('Monday','Tuesday','Wednesday','Thursday','Friday','Saturday','Sunday') NOT NULL,
  PRIMARY KEY (`Id`),
  UNIQUE KEY `DelayOfPaymentId` (`PriceIntersectionId`,`DayOfWeek`),
  CONSTRAINT `FK_DelayOfPayments_PriceIntersectionId` FOREIGN KEY (`PriceIntersectionId`) REFERENCES `priceintersections` (`Id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=16342774 DEFAULT CHARSET=cp1251;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `includeregulation`
--

DROP TABLE IF EXISTS `includeregulation`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `includeregulation` (
  `ID` int(11) unsigned NOT NULL AUTO_INCREMENT,
  `PrimaryClientCode` int(11) unsigned DEFAULT '0',
  `IncludeClientCode` int(11) unsigned DEFAULT '0',
  `Addition` varchar(100) DEFAULT '',
  `IncludeType` tinyint(1) unsigned NOT NULL DEFAULT '0',
  PRIMARY KEY (`ID`),
  KEY `IncludeType_IDX` (`IncludeType`),
  KEY `PrimaryClientCode_IDX` (`PrimaryClientCode`),
  KEY `IncludeClientCode_IDX` (`IncludeClientCode`),
  CONSTRAINT `includeregulation_ibfk_1` FOREIGN KEY (`PrimaryClientCode`) REFERENCES `clientsdata` (`FirmCode`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `includeregulation_ibfk_2` FOREIGN KEY (`IncludeClientCode`) REFERENCES `clientsdata` (`FirmCode`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=5826 DEFAULT CHARSET=cp1251 MIN_ROWS=300 MAX_ROWS=10000 PACK_KEYS=1 CHECKSUM=1 DELAY_KEY_WRITE=1 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `inscribe`
--

DROP TABLE IF EXISTS `inscribe`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `inscribe` (
  `ClientCode` int(10) unsigned NOT NULL DEFAULT '0',
  `FE` tinyint(1) unsigned NOT NULL DEFAULT '0',
  `IMS` tinyint(1) unsigned NOT NULL DEFAULT '0',
  `DSM` tinyint(1) unsigned NOT NULL DEFAULT '0',
  `RMBS` tinyint(1) unsigned NOT NULL DEFAULT '0',
  `IMSCode` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`ClientCode`)
) ENGINE=InnoDB DEFAULT CHARSET=cp1251 PACK_KEYS=1 CHECKSUM=1 DELAY_KEY_WRITE=1 ROW_FORMAT=COMPACT COMMENT='InnoDB free: 14693376 kB; (`ClientCode`) REFER `usersettings';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `intersection`
--

DROP TABLE IF EXISTS `intersection`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `intersection` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `ClientCode` int(10) unsigned NOT NULL DEFAULT '0',
  `RegionCode` bigint(20) unsigned NOT NULL DEFAULT '0',
  `DisabledByAgency` tinyint(1) unsigned NOT NULL DEFAULT '0',
  `DisabledByFirm` tinyint(1) unsigned NOT NULL DEFAULT '0',
  `AlowDisabledByClient` tinyint(1) unsigned NOT NULL DEFAULT '1',
  `DisabledByClient` tinyint(1) unsigned NOT NULL DEFAULT '0',
  `InvisibleOnFirm` tinyint(1) unsigned NOT NULL DEFAULT '0',
  `InvisibleOnClient` tinyint(1) unsigned NOT NULL DEFAULT '0',
  `PriceCode` int(11) unsigned NOT NULL DEFAULT '0',
  `CostCode` int(10) unsigned DEFAULT NULL,
  `FirmClientCode` varchar(200) NOT NULL COMMENT 'Код клиента',
  `FirmClientCode2` varchar(200) NOT NULL,
  `FirmClientCode3` varchar(200) NOT NULL,
  `MinReq` int(10) unsigned DEFAULT NULL,
  `ControlMinReq` tinyint(1) NOT NULL DEFAULT '0',
  `FirmCategory` int(1) unsigned NOT NULL DEFAULT '0',
  `PublicCostCorr` decimal(5,3) NOT NULL DEFAULT '0.000',
  `FirmCostCorr` decimal(5,3) NOT NULL DEFAULT '0.000',
  `CostCorrByClient` tinyint(1) unsigned NOT NULL DEFAULT '0',
  PRIMARY KEY (`ClientCode`,`RegionCode`,`PriceCode`),
  UNIQUE KEY `ID_Uniq` (`Id`),
  KEY `DisabledByAgency_IDX` (`DisabledByAgency`),
  KEY `DisabledByClient_IDX` (`DisabledByClient`),
  KEY `InvisibleOnFirm_IDX` (`InvisibleOnFirm`),
  KEY `InvisibleOnClient_IDX` (`InvisibleOnClient`),
  KEY `RegionCode_IDX` (`RegionCode`),
  KEY `ClientCode_IDX` (`ClientCode`),
  KEY `PriceCode_IDX` (`PriceCode`),
  KEY `CostCode_IDX` (`CostCode`),
  CONSTRAINT `intersection_ibfk_1` FOREIGN KEY (`CostCode`) REFERENCES `pricescosts` (`CostCode`) ON DELETE SET NULL ON UPDATE CASCADE,
  CONSTRAINT `intersection_ibfk_2` FOREIGN KEY (`PriceCode`) REFERENCES `pricesdata` (`PriceCode`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `intersection_ibfk_3` FOREIGN KEY (`RegionCode`) REFERENCES `farm`.`regions` (`RegionCode`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `intersection_ibfk_4` FOREIGN KEY (`ClientCode`) REFERENCES `retclientsset` (`ClientCode`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=2247650 DEFAULT CHARSET=cp1251 MIN_ROWS=168000 MAX_ROWS=1000000 PACK_KEYS=1 CHECKSUM=1 DELAY_KEY_WRITE=1 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER usersettings.IntersectionBeforeInsert
	BEFORE INSERT
	ON usersettings.Intersection
	FOR EACH ROW
BEGIN

  if exists (select FirmCode from clientsdata where firmcode=new.clientcode and billingcode in (2401,2821,2527,100,106)) then
    set new.disabledbyclient=1;
    set new.invisibleonclient=1;
  end if;

  if exists (select FirmCode from clientsdata where firmcode=new.clientcode and billingcode in (2520,2497)) then
    set new.disabledbyclient=1;
  end if;

 if exists (select FirmCode from clientsdata where firmcode=new.clientcode and billingcode in (2381)) and new.RegionCode=8192 then
    set new.disabledbyclient=1;
    set new.invisibleonclient=1;
  end if;

  if exists (SELECT FirmCode FROM ClientsData where BillingCode not in (2502,1546,2345,100,2501,2411,2622,2805,2381,2401,2471,2823,2472,2821,2527)
            and  FirmCode = new.clientcode) 
     and new.PriceCode=2355 
  then
    set new.invisibleonclient=1;
  end if;

  if not exists (select Id from PricesData pd join SupplierIntersection sint ON
                  sint.ClientId = new.ClientCode AND sint.SupplierId = pd.FirmCode
                 where pd.PriceCode = new.PriceCode) and exists(select FirmCode from PricesData where PriceCode = new.PriceCode) 
  then
    insert into SupplierIntersection (ClientId, SupplierId)
      values (new.ClientCode, (select FirmCode from PricesData where PriceCode = new.PriceCode));
  end if;

end */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER usersettings.IntersectionLogInsert
	AFTER INSERT
	ON usersettings.Intersection
	FOR EACH ROW
BEGIN
        INSERT
        INTO    `logs`.intersection_logs
                SET LogTime = now()
                ,
                OperatorName = IFNULL(
                        @INUser,
                        SUBSTRING_INDEX(USER(),'@',1)
                )
                ,
                OperatorHost = IFNULL(
                        @INHost,
                        SUBSTRING_INDEX(USER(),'@',-1)
                )
                ,
                Operation               = 0,
                IntersectionID          = NEW.Id ,
                ClientCode              = NEW.ClientCode ,
                RegionCode              = NEW.RegionCode ,
                DisabledByAgency        = NEW.DisabledByAgency ,
                AlowDisabledByClient    = NEW.AlowDisabledByClient ,
                DisabledByClient        = NEW.DisabledByClient ,
                InvisibleOnFirm         = NEW.InvisibleOnFirm ,
                InvisibleOnClient       = NEW.InvisibleOnClient ,
                PriceCode               = NEW.PriceCode ,
                CostCode                = NEW.CostCode ,
                MinReq                  = NEW.MinReq ,
                PublicCostCorr          = NEW.PublicCostCorr ,
                FirmCostCorr            = NEW.FirmCostCorr ,
                CostCorrByClient        = NEW.CostCorrByClient ;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER usersettings.IntersectionLogUpdate
	AFTER UPDATE
	ON usersettings.Intersection
	FOR EACH ROW
BEGIN
if (NEW.ClientCode <> OLD.ClientCode) or
(NEW.RegionCode <> OLD.RegionCode) or
(NEW.DisabledByAgency <> OLD.DisabledByAgency) or
(NEW.AlowDisabledByClient <> OLD.AlowDisabledByClient) or
(NEW.DisabledByClient <> OLD.DisabledByClient) or
(NEW.InvisibleOnFirm <> OLD.InvisibleOnFirm) or
(NEW.InvisibleOnClient <> OLD.InvisibleOnClient) or
(NEW.PriceCode <> OLD.PriceCode) or
(NEW.CostCode <> OLD.CostCode) or
(NEW.FirmClientCode <> OLD.FirmClientCode) or
(NEW.FirmClientCode2 <> OLD.FirmClientCode2) or
(NEW.FirmClientCode3 <> OLD.FirmClientCode3) or
(NEW.MinReq <> OLD.MinReq) or
(NEW.ControlMinReq <> OLD.ControlMinReq) or
(NEW.FirmCategory <> OLD.FirmCategory) or
(NEW.PublicCostCorr <> OLD.PublicCostCorr) or
(NEW.FirmCostCorr <> OLD.FirmCostCorr) or
(NEW.CostCorrByClient <> OLD.CostCorrByClient)
then
INSERT
        INTO    `logs`.intersection_logs
                SET LogTime = now()
                ,
                OperatorName = IFNULL(
                        @INUser,
                        SUBSTRING_INDEX(USER(),'@',1)
                ) 
                , 
                OperatorHost = IFNULL(
                        @INHost,
                        SUBSTRING_INDEX(USER(),'@',-1)
                )
                , 
                Operation      = 1, 
                IntersectionID = OLD.Id ,
                ClientCode     = IFNULL(
                         NEW.ClientCode,
                        OLD.ClientCode
                ) 
                ,
                RegionCode = IFNULL(
                        NEW.RegionCode,
                        OLD.RegionCode
                ) 
                ,
                DisabledByAgency = NULLIF(
                        NEW.DisabledByAgency,
                        OLD.DisabledByAgency
                ) 
                ,
                AlowDisabledByClient = NULLIF(
                        NEW.AlowDisabledByClient,
                        OLD.AlowDisabledByClient
                ) 
                ,
                DisabledByClient = NULLIF(
                        NEW.DisabledByClient,
                        OLD.DisabledByClient
                )
                ,
                InvisibleOnFirm = NULLIF(
                        NEW.InvisibleOnFirm,
                        OLD.InvisibleOnFirm
                )
                ,
                InvisibleOnClient = NULLIF(
                        NEW.InvisibleOnClient,
                        OLD.InvisibleOnClient
                )
                ,
                PriceCode = IFNULL(
                        NEW.PriceCode,
                        OLD.PriceCode
                )
                ,
                CostCode = NULLIF(
                        NEW.CostCode,
                        OLD.CostCode
                )
                ,
                FirmClientCode = NULLIF(
                        NEW.FirmClientCode,
                        OLD.FirmClientCode
                )
                ,
                FirmClientCode2 = NULLIF(
                        NEW.FirmClientCode2,
                        OLD.FirmClientCode2
                )
                ,
                FirmClientCode3 = NULLIF(
                        NEW.FirmClientCode3,
                        OLD.FirmClientCode3
                )
                ,
                MinReq = NULLIF(
                        NEW.MinReq,
                        OLD.MinReq
                )
                ,
                ControlMinReq = NULLIF(
                        NEW.ControlMinReq,
                        OLD.ControlMinReq
                )
                ,
                FirmCategory = NULLIF(
                        NEW.FirmCategory,
                        OLD.FirmCategory
                )
                ,
                PublicCostCorr = NULLIF(
                        NEW.PublicCostCorr,
                        OLD.PublicCostCorr
                )
                ,
                FirmCostCorr = NULLIF(
                        NEW.FirmCostCorr,
                        OLD.FirmCostCorr
                )
                ,
                CostCorrByClient = NULLIF(
                        NEW.CostCorrByClient,
                        OLD.CostCorrByClient
                );
 end if;


IF NEW.CostCode!=OLD.CostCode 
OR NEW.InvisibleOnClient!=OLD.InvisibleOnClient 
OR NEW.DisabledByAgency!=OLD.DisabledByAgency 
OR NEW.DisabledByClient!=OLD.DisabledByClient 
OR NEW.MinReq!=OLD.MinReq 
OR NEW.ControlMinReq!=OLD.ControlMinReq 
OR NEW.PublicCostCorr!=OLD.PublicCostCorr 
OR NEW.FirmCostCorr!=OLD.FirmCostCorr 
THEN
CALL SetAFReplicationParamenter(OLD.ClientCode, OLD.PriceCode);

END IF;

 END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER UserSettings.IntersectionLogDelete AFTER Delete ON UserSettings.Intersection FOR EACH ROW
BEGIN
INSERT INTO `logs`.intersection_logs
SET LogTime = now() ,
OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)) ,
OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)) ,
Operation = 2,
IntersectionID = OLD.Id
,ClientCode = OLD.ClientCode
,RegionCode = OLD.RegionCode
,DisabledByAgency = OLD.DisabledByAgency
,DisabledByFirm = OLD.DisabledByFirm
,AlowDisabledByClient = OLD.AlowDisabledByClient
,DisabledByClient = OLD.DisabledByClient
,InvisibleOnFirm = OLD.InvisibleOnFirm
,InvisibleOnClient = OLD.InvisibleOnClient
,PriceCode = OLD.PriceCode
,CostCode = OLD.CostCode
,FirmClientCode = OLD.FirmClientCode
,FirmClientCode2 = OLD.FirmClientCode2
,FirmClientCode3 = OLD.FirmClientCode3
,MinReq = OLD.MinReq
,ControlMinReq = OLD.ControlMinReq
,FirmCategory = OLD.FirmCategory
,PublicCostCorr = OLD.PublicCostCorr
,FirmCostCorr = OLD.FirmCostCorr
,CostCorrByClient = OLD.CostCorrByClient;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `offermatrixsuppliers`
--

DROP TABLE IF EXISTS `offermatrixsuppliers`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `offermatrixsuppliers` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `ClientId` int(10) unsigned NOT NULL,
  `SupplierId` int(10) unsigned NOT NULL,
  PRIMARY KEY (`Id`),
  KEY `FK_OfferMatrixSuppliers_ClientId` (`ClientId`),
  KEY `FK_OfferMatrixSuppliers_SupplierId` (`SupplierId`),
  CONSTRAINT `FK_OfferMatrixSuppliers_ClientId` FOREIGN KEY (`ClientId`) REFERENCES `future`.`clients` (`Id`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `FK_OfferMatrixSuppliers_SupplierId` FOREIGN KEY (`SupplierId`) REFERENCES `future`.`suppliers` (`Id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=162 DEFAULT CHARSET=cp1251;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `osuseraccessright`
--

DROP TABLE IF EXISTS `osuseraccessright`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `osuseraccessright` (
  `RowId` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `ClientCode` int(11) unsigned NOT NULL DEFAULT '0',
  `VendorAlowClients` bit(1) NOT NULL DEFAULT b'1',
  `OSUserName` varchar(20) NOT NULL DEFAULT '',
  `RegionMask` bigint(20) unsigned NOT NULL DEFAULT '18446744073709551615',
  `AlowContactInfo` bit(1) NOT NULL DEFAULT b'1',
  `VendorAllowContactInfo` bit(1) NOT NULL DEFAULT b'1',
  `VendorAllowPricesProcess` bit(1) NOT NULL DEFAULT b'1',
  `VendorAllowChangePassword` bit(1) NOT NULL DEFAULT b'1',
  `VendorAllowOrdersManage` bit(1) NOT NULL DEFAULT b'1',
  `VendorAllowReports` bit(1) NOT NULL DEFAULT b'1',
  `VendorAllowConManage` bit(1) NOT NULL DEFAULT b'1',
  `VendorAllowClients` bit(1) NOT NULL DEFAULT b'1',
  `VendorAllowPricesSet` bit(1) NOT NULL DEFAULT b'1',
  `VendorAllowPricesSources` bit(1) NOT NULL DEFAULT b'1',
  `VendorAllowDocumentSettings` bit(1) NOT NULL DEFAULT b'1',
  `VendorAllowDocumentLogs` bit(1) NOT NULL DEFAULT b'1',
  `VendorAllowSourceOrders` bit(1) NOT NULL DEFAULT b'1' COMMENT '1 - Разрешить доступ к пункту "Доставка заказов" в кл. интерфейсе\r\n0 - Запретить доступ к пункту "Доставка заказов" в кл. интерфейсе',
  `VendorAllowPromotions` tinyint(1) unsigned NOT NULL DEFAULT '0',
  PRIMARY KEY (`RowId`),
  UNIQUE KEY `UserName_UNIQ` (`OSUserName`),
  KEY `ClientCode_IDX` (`ClientCode`),
  CONSTRAINT `osuseraccessright_ibfk_1` FOREIGN KEY (`ClientCode`) REFERENCES `clientsdata` (`FirmCode`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=13350 DEFAULT CHARSET=cp1251 MIN_ROWS=1600 MAX_ROWS=10000 PACK_KEYS=0 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `priceintersections`
--

DROP TABLE IF EXISTS `priceintersections`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `priceintersections` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `SupplierIntersectionId` int(10) unsigned NOT NULL,
  `PriceId` int(10) unsigned NOT NULL,
  `UseWeeklyDelays` tinyint(1) unsigned NOT NULL DEFAULT '0' COMMENT 'Использовать отсрочки платежа, установленные для каждого дня недели',
  PRIMARY KEY (`Id`),
  KEY `FK_PriceIntersections_SupplierIntersectionId` (`SupplierIntersectionId`),
  KEY `FK_PriceIntersections_PriceId` (`PriceId`),
  CONSTRAINT `FK_PriceIntersections_PriceId` FOREIGN KEY (`PriceId`) REFERENCES `pricesdata` (`PriceCode`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `FK_PriceIntersections_SupplierIntersectionId` FOREIGN KEY (`SupplierIntersectionId`) REFERENCES `supplierintersection` (`Id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=2447010 DEFAULT CHARSET=cp1251;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `priceitems`
--

DROP TABLE IF EXISTS `priceitems`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `priceitems` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `FormRuleId` int(10) unsigned NOT NULL,
  `SourceId` int(10) unsigned NOT NULL,
  `RowCount` int(10) unsigned NOT NULL DEFAULT '0' COMMENT 'Количество позиций в \r\nформализованном прайс-листе',
  `UnformCount` int(10) unsigned DEFAULT NULL COMMENT 'Количество \r\nнеформализованных позиций в прайсе.',
  `PriceDate` datetime NOT NULL DEFAULT '2000-01-01 00:00:00',
  `LastDownload` datetime DEFAULT NULL,
  `LastFormalization` datetime DEFAULT NULL,
  `LastRetrans` datetime DEFAULT NULL COMMENT 'Дата последнего перепроведения \r\nпрайс-листа обработкой.',
  `LastSynonymsCreation` datetime DEFAULT NULL COMMENT 'Дата последнего \r\nсоздания синонимов наименований или производителей обработкой.',
  `WaitingDownloadInterval` int(11) unsigned NOT NULL DEFAULT '1' COMMENT 'интервал (в часах), во время которого должен прийти свежий прайс-лист',
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB AUTO_INCREMENT=2464 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `pricescosts`
--

DROP TABLE IF EXISTS `pricescosts`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `pricescosts` (
  `CostCode` int(11) unsigned NOT NULL AUTO_INCREMENT,
  `PriceCode` int(10) unsigned DEFAULT NULL,
  `PriceItemId` int(11) unsigned DEFAULT NULL,
  `Enabled` tinyint(1) unsigned NOT NULL DEFAULT '0',
  `AgencyEnabled` tinyint(1) unsigned NOT NULL DEFAULT '0',
  `CostName` varchar(50) NOT NULL DEFAULT 'Базовая',
  `BaseCost` tinyint(1) unsigned NOT NULL DEFAULT '0',
  PRIMARY KEY (`CostCode`),
  KEY `PriceCode_IDX` (`PriceCode`),
  KEY `Enabled_IDX` (`Enabled`),
  KEY `AgencyEnabled_IDX` (`AgencyEnabled`),
  CONSTRAINT `PriceCode_FK` FOREIGN KEY (`PriceCode`) REFERENCES `pricesdata` (`PriceCode`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=14729 DEFAULT CHARSET=cp1251 MIN_ROWS=1500 MAX_ROWS=10000 PACK_KEYS=1 CHECKSUM=1 DELAY_KEY_WRITE=1 ROW_FORMAT=COMPACT COMMENT='InnoDB free: 14620672 kB; (`PriceCode`) REFER `usersettings/';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER usersettings.pricescostsLogInsert AFTER INSERT
ON usersettings.pricescosts FOR EACH ROW BEGIN
INSERT INTO `logs`.prices_costs_logs
SET LogTime = now() ,
OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)) ,
OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)) ,
Operation = 0,
pricescostsID = NEW.CostCode
,PriceCode = NEW.PriceCode
,PriceItemId = NEW.PriceItemId
,Enabled = NEW.Enabled
,AgencyEnabled = NEW.AgencyEnabled
,CostName = NEW.CostName
,BaseCost = NEW.BaseCost
;END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER usersettings.pricescostsLogUpdate AFTER UPDATE
ON usersettings.pricescosts FOR EACH ROW BEGIN
INSERT INTO `logs`.prices_costs_logs
SET LogTime = now() ,
OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)) ,
OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)) ,
Operation = 1,
pricescostsID = OLD.CostCode
,PriceCode = IFNULL(NEW.PriceCode, OLD.PriceCode)
,PriceItemId = IFNULL(NEW.PriceItemId, OLD.PriceItemId)
,Enabled = NULLIF(NEW.Enabled, OLD.Enabled)
,AgencyEnabled = NULLIF(NEW.AgencyEnabled, OLD.AgencyEnabled)
,CostName = NULLIF(NEW.CostName, OLD.CostName)
,BaseCost = NULLIF(NEW.BaseCost, OLD.BaseCost)
;END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER usersettings.pricescostsLogDelete AFTER DELETE
ON usersettings.pricescosts FOR EACH ROW BEGIN
INSERT INTO `logs`.prices_costs_logs
SET LogTime = now() ,
OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)) ,
OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)) ,
Operation = 2,
pricescostsID = OLD.CostCode
,PriceCode = OLD.PriceCode
,PriceItemId = OLD.PriceItemId
,Enabled = OLD.Enabled
,AgencyEnabled = OLD.AgencyEnabled
,CostName = OLD.CostName
,BaseCost = OLD.BaseCost
;END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `pricesdata`
--

DROP TABLE IF EXISTS `pricesdata`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `pricesdata` (
  `PriceCode` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `FirmCode` int(11) unsigned NOT NULL DEFAULT '0',
  `RegionMask` bigint(20) unsigned NOT NULL DEFAULT '0',
  `AgencyEnabled` tinyint(1) unsigned NOT NULL DEFAULT '1',
  `Enabled` tinyint(1) unsigned NOT NULL DEFAULT '0',
  `AlowInt` tinyint(1) unsigned DEFAULT '0',
  `PriceType` tinyint(1) unsigned NOT NULL DEFAULT '0',
  `PriceName` varchar(50) NOT NULL DEFAULT 'Базовый',
  `MinReq` int(11) unsigned NOT NULL DEFAULT '0',
  `UpCost` decimal(5,2) NOT NULL DEFAULT '0.00',
  `PriceInfo` text,
  `CostType` tinyint(1) unsigned DEFAULT NULL COMMENT 'Тип цен в\r\nпрайсе: 0 - мультиколоночные цены, 1 - многофайловые цены',
  `ParentSynonym` int(11) unsigned DEFAULT NULL,
  `BuyingMatrix` tinyint(1) NOT NULL DEFAULT '0',
  PRIMARY KEY (`PriceCode`) USING BTREE,
  KEY `FirmCode_IDX` (`FirmCode`),
  KEY `PricesData_ParentSynonym_IDX` (`ParentSynonym`),
  CONSTRAINT `pricesdata_ibfk_1` FOREIGN KEY (`FirmCode`) REFERENCES `clientsdata` (`FirmCode`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `PricesData_ParentSynonym_FK` FOREIGN KEY (`ParentSynonym`) REFERENCES `pricesdata` (`PriceCode`) ON DELETE SET NULL ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=5735 DEFAULT CHARSET=cp1251 MIN_ROWS=2000 MAX_ROWS=10000 PACK_KEYS=0 ROW_FORMAT=DYNAMIC COMMENT='InnoDB free: 2146304 kB; (`FirmCode`) REFER `usersettings/cl';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER usersettings.pricesdataLogInsert AFTER INSERT
ON usersettings.pricesdata FOR EACH ROW BEGIN
INSERT INTO `logs`.prices_data_logs
SET LogTime = now() ,
OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)) ,
OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)) ,
Operation = 0,
pricesdataID = NEW.PriceCode
,FirmCode = NEW.FirmCode
,RegionMask = NEW.RegionMask
,AgencyEnabled = NEW.AgencyEnabled
,Enabled = NEW.Enabled
,AlowInt = NEW.AlowInt
,PriceType = NEW.PriceType
,PriceName = NEW.PriceName
,MinReq = NEW.MinReq
,upcost = NEW.upcost
,priceinfo = NEW.priceinfo
,CostType = NEW.CostType
,ParentSynonym = NEW.ParentSynonym
;END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER usersettings.pricesdataLogUpdate AFTER UPDATE
ON usersettings.pricesdata FOR EACH ROW BEGIN
INSERT INTO `logs`.prices_data_logs
SET LogTime = now() ,
OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)) ,
OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)) ,
Operation = 1,
pricesdataID = OLD.PriceCode
,FirmCode = IFNULL(NEW.FirmCode, OLD.FirmCode)
,RegionMask = NULLIF(NEW.RegionMask, OLD.RegionMask)
,AgencyEnabled = NULLIF(NEW.AgencyEnabled, OLD.AgencyEnabled)
,Enabled = NULLIF(NEW.Enabled, OLD.Enabled)
,AlowInt = NULLIF(NEW.AlowInt, OLD.AlowInt)
,PriceType = NULLIF(NEW.PriceType, OLD.PriceType)
,PriceName = NULLIF(NEW.PriceName, OLD.PriceName)
,MinReq = NULLIF(NEW.MinReq, OLD.MinReq)
,upcost = NULLIF(NEW.upcost, OLD.upcost)
,priceinfo = NULLIF(NEW.priceinfo, OLD.priceinfo)
,CostType = NULLIF(NEW.CostType, OLD.CostType)
,ParentSynonym = NULLIF(NEW.ParentSynonym, OLD.ParentSynonym)
;END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER usersettings.pricesdataLogDelete AFTER DELETE
ON usersettings.pricesdata FOR EACH ROW BEGIN
INSERT INTO `logs`.prices_data_logs
SET LogTime = now() ,
OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)) ,
OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)) ,
Operation = 2,
pricesdataID = OLD.PriceCode
,FirmCode = OLD.FirmCode
,RegionMask = OLD.RegionMask
,AgencyEnabled = OLD.AgencyEnabled
,Enabled = OLD.Enabled
,AlowInt = OLD.AlowInt
,PriceType = OLD.PriceType
,PriceName = OLD.PriceName
,MinReq = OLD.MinReq
,upcost = OLD.upcost
,priceinfo = OLD.priceinfo
,CostType = OLD.CostType
,ParentSynonym = OLD.ParentSynonym
;END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `pricesregionaldata`
--

DROP TABLE IF EXISTS `pricesregionaldata`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `pricesregionaldata` (
  `RowID` int(11) unsigned NOT NULL AUTO_INCREMENT,
  `PriceCode` int(11) unsigned NOT NULL DEFAULT '0',
  `RegionCode` bigint(20) unsigned NOT NULL DEFAULT '0',
  `UpCost` decimal(5,2) NOT NULL DEFAULT '0.00',
  `MinReq` int(10) unsigned NOT NULL DEFAULT '0',
  `Enabled` bit(1) NOT NULL DEFAULT b'0',
  PRIMARY KEY (`PriceCode`,`RegionCode`),
  UNIQUE KEY `RowID_UNIQ` (`RowID`),
  KEY `RegionCode_IDX` (`RegionCode`),
  KEY `Enabled_IDX` (`Enabled`,`RowID`),
  CONSTRAINT `pricesregionaldata_ibfk_1` FOREIGN KEY (`PriceCode`) REFERENCES `pricesdata` (`PriceCode`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `pricesregionaldata_ibfk_2` FOREIGN KEY (`RegionCode`) REFERENCES `farm`.`regions` (`RegionCode`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=20232 DEFAULT CHARSET=cp1251 MIN_ROWS=4000 MAX_ROWS=15000 PACK_KEYS=1 CHECKSUM=1 DELAY_KEY_WRITE=1 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER `pricesregionaldataLogInsert` AFTER INSERT ON `pricesregionaldata` FOR EACH ROW BEGIN
INSERT INTO `logs`.prices_regional_data_logs
SET LogTime = now() ,
OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)) ,
OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)) ,
Operation = 0,
pricesregionaldataID = NEW.RowID
,PriceCode = NEW.PriceCode
,RegionCode = NEW.RegionCode
,UpCost = NEW.UpCost
,minreq = NEW.minreq
,Enabled = NEW.Enabled
;END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER `pricesregionaldataLogUpdate` AFTER UPDATE ON `pricesregionaldata` FOR EACH ROW BEGIN
INSERT INTO `logs`.prices_regional_data_logs
SET LogTime = now() ,
OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)) ,
OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)) ,
Operation = 1,
pricesregionaldataID = OLD.RowID
,PriceCode = IFNULL(NEW.PriceCode, OLD.PriceCode)
,RegionCode = IFNULL(NEW.RegionCode, OLD.RegionCode)
,UpCost = NULLIF(NEW.UpCost, OLD.UpCost)
,minreq = NULLIF(NEW.minreq, OLD.minreq)
,Enabled = NULLIF(NEW.Enabled, OLD.Enabled)
;END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER `pricesregionaldataLogDelete` AFTER DELETE ON `pricesregionaldata` FOR EACH ROW BEGIN
INSERT INTO `logs`.prices_regional_data_logs
SET LogTime = now() ,
OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)) ,
OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)) ,
Operation = 2,
pricesregionaldataID = OLD.RowID
,PriceCode = OLD.PriceCode
,RegionCode = OLD.RegionCode
,UpCost = OLD.UpCost
,minreq = OLD.minreq
,Enabled = OLD.Enabled
;END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `promotioncatalogs`
--

DROP TABLE IF EXISTS `promotioncatalogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `promotioncatalogs` (
  `CatalogId` int(10) unsigned NOT NULL,
  `PromotionId` int(10) unsigned NOT NULL,
  `UpdateTime` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`CatalogId`,`PromotionId`),
  KEY `FK_PromotionCatalogs_PromotionId` (`PromotionId`),
  CONSTRAINT `FK_PromotionCatalogs_CatalogId` FOREIGN KEY (`CatalogId`) REFERENCES `catalogs`.`catalog` (`Id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER UserSettings.PromotionCatalogLogInsert AFTER INSERT ON UserSettings.PromotionCatalogs
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.PromotionCatalogLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 0,
		CatalogId = NEW.CatalogId,
		PromotionId = NEW.PromotionId,
		UpdateTime = NEW.UpdateTime;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER UserSettings.PromotionCatalogLogUpdate AFTER UPDATE ON UserSettings.PromotionCatalogs
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.PromotionCatalogLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 1,
		CatalogId = NULLIF(NEW.CatalogId, OLD.CatalogId),
		PromotionId = NULLIF(NEW.PromotionId, OLD.PromotionId),
		UpdateTime = NULLIF(NEW.UpdateTime, OLD.UpdateTime);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER UserSettings.PromotionCatalogLogDelete AFTER DELETE ON UserSettings.PromotionCatalogs
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.PromotionCatalogLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 2,
		CatalogId = OLD.CatalogId,
		PromotionId = OLD.PromotionId,
		UpdateTime = OLD.UpdateTime;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `regionaldata`
--

DROP TABLE IF EXISTS `regionaldata`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `regionaldata` (
  `RowId` int(11) unsigned NOT NULL AUTO_INCREMENT,
  `RegionCode` bigint(20) unsigned NOT NULL DEFAULT '0',
  `FirmCode` int(10) unsigned NOT NULL DEFAULT '0',
  `Enabled` bit(1) DEFAULT b'1',
  `UpCost` decimal(3,2) DEFAULT NULL,
  `Storage` bit(1) NOT NULL DEFAULT b'0',
  `MinReq` int(11) NOT NULL DEFAULT '0',
  `SupportPhone` varchar(20) NOT NULL DEFAULT '',
  `ContactInfo` text NOT NULL,
  `OperativeInfo` text NOT NULL,
  `ConfigOrderCode` int(11) unsigned NOT NULL DEFAULT '0',
  `AdminMail` varchar(255) DEFAULT NULL,
  `TmpMail` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`RegionCode`,`FirmCode`),
  UNIQUE KEY `RowID_UNIQ` (`RowId`),
  KEY `FirmCode_IDX` (`FirmCode`),
  KEY `Enabled_IDX` (`Enabled`,`RowId`),
  CONSTRAINT `regionaldata_ibfk_1` FOREIGN KEY (`RegionCode`) REFERENCES `farm`.`regions` (`RegionCode`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `regionaldata_ibfk_2` FOREIGN KEY (`FirmCode`) REFERENCES `clientsdata` (`FirmCode`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=9988 DEFAULT CHARSET=cp1251 MIN_ROWS=5000 MAX_ROWS=15000 PACK_KEYS=1 CHECKSUM=1 DELAY_KEY_WRITE=1 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER usersettings.RegionalDataLogInsert AFTER INSERT ON usersettings.RegionalData FOR EACH ROW
BEGIN
INSERT INTO logs.regional_data_logs
SET LogTime = now() ,
OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)) ,
OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)) ,
Operation = 0,
RegionalDataID = NEW.RowId,
RegionCode = NEW.RegionCode,
FirmCode = NEW.FirmCode,
Enabled = NEW.Enabled,
UpCost = NEW.UpCost,
Storage = NEW.Storage,
MinReq = NEW.MinReq,
SupportPhone = NEW.SupportPhone,
ContactInfo = NEW.ContactInfo,
OperativeInfo = NEW.OperativeInfo,
ConfigOrderCode = NEW.ConfigOrderCode;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER usersettings.RegionalDataLogUpdate AFTER UPDATE ON usersettings.RegionalData FOR EACH ROW
BEGIN
INSERT INTO `logs`.regional_data_logs
SET LogTime = now() ,
OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)) ,
OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)) ,
Operation = 1,
RegionalDataID = OLD.RowId,
RegionCode = IFNULL(NEW.RegionCode, OLD.RegionCode),
FirmCode = IFNULL(NEW.FirmCode, OLD.FirmCode),
Enabled = NULLIF(NEW.Enabled, OLD.Enabled),
UpCost = NULLIF(NEW.UpCost, OLD.UpCost),
Storage = NULLIF(NEW.Storage, OLD.Storage),
MinReq = NULLIF(NEW.MinReq, OLD.MinReq),
SupportPhone = NULLIF(NEW.SupportPhone, OLD.SupportPhone),
ContactInfo = NULLIF(NEW.ContactInfo, OLD.ContactInfo),
OperativeInfo = NULLIF(NEW.OperativeInfo, OLD.OperativeInfo),
ConfigOrderCode = NULLIF(NEW.ConfigOrderCode, OLD.ConfigOrderCode);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER usersettings.RegionalDataLogDelete AFTER DELETE ON usersettings.RegionalData FOR EACH ROW
BEGIN
INSERT INTO `logs`.regional_data_logs
SET LogTime = now() ,
OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)) ,
OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)) ,
Operation = 2,
RegionalDataID = OLD.RowId,
RegionCode = OLD.RegionCode,
FirmCode = OLD.FirmCode,
Enabled = OLD.Enabled,
UpCost = OLD.UpCost,
Storage = OLD.Storage,
MinReq = OLD.MinReq,
SupportPhone = OLD.SupportPhone,
ContactInfo = OLD.ContactInfo,
OperativeInfo = OLD.OperativeInfo,
ConfigOrderCode = OLD.ConfigOrderCode;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `ret_save_grids`
--

DROP TABLE IF EXISTS `ret_save_grids`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `ret_save_grids` (
  `ClientCode` int(10) unsigned NOT NULL,
  `SaveGridID` bigint(20) unsigned NOT NULL,
  PRIMARY KEY (`SaveGridID`,`ClientCode`),
  KEY `FK_ret_save_grids_ClientCode` (`ClientCode`),
  CONSTRAINT `FK_ret_save_grids_SaveGridId` FOREIGN KEY (`SaveGridID`) REFERENCES `save_grids` (`ID`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=cp1251 PACK_KEYS=1 CHECKSUM=1 DELAY_KEY_WRITE=1 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `save_grids`
--

DROP TABLE IF EXISTS `save_grids`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `save_grids` (
  `ID` bigint(20) unsigned NOT NULL,
  `DisplayName` varchar(255) NOT NULL,
  `AssignDefaultValue` tinyint(1) unsigned NOT NULL DEFAULT '0',
  PRIMARY KEY (`ID`)
) ENGINE=InnoDB DEFAULT CHARSET=cp1251 PACK_KEYS=1 CHECKSUM=1 DELAY_KEY_WRITE=1 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `showregulation`
--

DROP TABLE IF EXISTS `showregulation`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `showregulation` (
  `PrimaryClientCode` int(11) unsigned NOT NULL DEFAULT '0',
  `ShowClientCode` int(11) unsigned DEFAULT '0',
  `Addition` varchar(100) NOT NULL DEFAULT '',
  `ID` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `IncludeType` tinyint(1) unsigned NOT NULL,
  PRIMARY KEY (`ID`),
  KEY `PrimaryClientCode_IDX` (`PrimaryClientCode`),
  KEY `ShowClientCode_IDX` (`ShowClientCode`),
  KEY `IncludeType_IDX` (`IncludeType`)
) ENGINE=InnoDB AUTO_INCREMENT=6514 DEFAULT CHARSET=cp1251 PACK_KEYS=1 CHECKSUM=1 DELAY_KEY_WRITE=1 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `supplierintersection`
--

DROP TABLE IF EXISTS `supplierintersection`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `supplierintersection` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `ClientId` int(10) NOT NULL,
  `SupplierId` int(10) NOT NULL,
  `DelayOfPayment` decimal(5,3) NOT NULL DEFAULT '0.000',
  `SupplierCategory` int(1) unsigned NOT NULL DEFAULT '0',
  PRIMARY KEY (`Id`),
  UNIQUE KEY `ClientId` (`ClientId`,`SupplierId`)
) ENGINE=InnoDB AUTO_INCREMENT=787604 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER Usersettings.SupplierIntersectionBeforeUpdate BEFORE UPDATE ON Usersettings.SupplierIntersection FOR EACH ROW
BEGIN

	update Usersettings.AnalitFReplicationInfo ar
		join Future.Users u on ar.UserId = u.Id
			join Future.Clients c on u.ClientId = c.Id
	set ar.ForceReplication = 1
	where c.Id = OLD.ClientId and ar.FirmCode = OLD.SupplierId;

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `supplierpromotions`
--

DROP TABLE IF EXISTS `supplierpromotions`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `supplierpromotions` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `UpdateTime` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `Enabled` tinyint(1) unsigned NOT NULL DEFAULT '0',
  `SupplierId` int(10) unsigned NOT NULL,
  `Annotation` mediumtext NOT NULL,
  `PromoFile` varchar(255) DEFAULT NULL,
  `AgencyDisabled` tinyint(1) unsigned NOT NULL DEFAULT '0',
  `Name` varchar(255) NOT NULL COMMENT 'Наименование акции',
  `RegionMask` bigint(20) unsigned NOT NULL COMMENT 'Регионы работы акции',
  `Begin` datetime DEFAULT NULL COMMENT 'Дата начала акции',
  `End` datetime DEFAULT NULL COMMENT 'Дата окончания акции',
  `Status` tinyint(1) unsigned NOT NULL DEFAULT '0',
  PRIMARY KEY (`Id`),
  KEY `FK_SupplierPromotions_SupplierId` (`SupplierId`),
  CONSTRAINT `FK_SupplierPromotions_SupplierId` FOREIGN KEY (`SupplierId`) REFERENCES `clientsdata` (`FirmCode`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=259 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER UserSettings.SupplierPromotionLogInsert AFTER INSERT ON UserSettings.SupplierPromotions
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.SupplierPromotionLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 0,
		PromotionId = NEW.Id,
		UpdateTime = NEW.UpdateTime,
		Enabled = NEW.Enabled,
		SupplierId = NEW.SupplierId,
		Annotation = NEW.Annotation,
		PromoFile = NEW.PromoFile,
		AgencyDisabled = NEW.AgencyDisabled,
		Name = NEW.Name,
		RegionMask = NEW.RegionMask,
		Begin = NEW.Begin,
		End = NEW.End,
		Status = NEW.Status;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER UserSettings.SupplierPromotionLogUpdate AFTER UPDATE ON UserSettings.SupplierPromotions
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.SupplierPromotionLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 1,
		PromotionId = OLD.Id,
		UpdateTime = NULLIF(NEW.UpdateTime, OLD.UpdateTime),
		Enabled = NULLIF(NEW.Enabled, OLD.Enabled),
		SupplierId = NULLIF(NEW.SupplierId, OLD.SupplierId),
		Annotation = NULLIF(NEW.Annotation, OLD.Annotation),
		PromoFile = NULLIF(NEW.PromoFile, OLD.PromoFile),
		AgencyDisabled = NULLIF(NEW.AgencyDisabled, OLD.AgencyDisabled),
		Name = NULLIF(NEW.Name, OLD.Name),
		RegionMask = NULLIF(NEW.RegionMask, OLD.RegionMask),
		Begin = NULLIF(NEW.Begin, OLD.Begin),
		End = NULLIF(NEW.End, OLD.End),
		Status = NULLIF(NEW.Status, OLD.Status);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 TRIGGER UserSettings.SupplierPromotionLogDelete AFTER DELETE ON UserSettings.SupplierPromotions
FOR EACH ROW BEGIN
	INSERT 
	INTO `logs`.SupplierPromotionLogs
	SET LogTime = now(),
		OperatorName = IFNULL(@INUser, SUBSTRING_INDEX(USER(),'@',1)),
		OperatorHost = IFNULL(@INHost, SUBSTRING_INDEX(USER(),'@',-1)),
		Operation = 2,
		PromotionId = OLD.Id,
		UpdateTime = OLD.UpdateTime,
		Enabled = OLD.Enabled,
		SupplierId = OLD.SupplierId,
		Annotation = OLD.Annotation,
		PromoFile = OLD.PromoFile,
		AgencyDisabled = OLD.AgencyDisabled,
		Name = OLD.Name,
		RegionMask = OLD.RegionMask,
		Begin = OLD.Begin,
		End = OLD.End,
		Status = OLD.Status;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `userpermissions`
--

DROP TABLE IF EXISTS `userpermissions`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `userpermissions` (
  `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `Name` varchar(255) DEFAULT NULL,
  `Shortcut` varchar(50) DEFAULT NULL,
  `AvailableFor` tinyint(1) unsigned NOT NULL DEFAULT '2',
  `Type` smallint(5) unsigned NOT NULL DEFAULT '0',
  `AssignDefaultValue` tinyint(1) unsigned NOT NULL DEFAULT '0',
  `SecurityMask` bigint(20) DEFAULT NULL,
  PRIMARY KEY (`Id`),
  KEY `Shortcut_IDX` (`Shortcut`)
) ENGINE=InnoDB AUTO_INCREMENT=52 DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `userupdateinfo`
--

DROP TABLE IF EXISTS `userupdateinfo`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `userupdateinfo` (
  `UserId` int(10) unsigned NOT NULL DEFAULT '0',
  `UpdateDate` datetime DEFAULT NULL,
  `ReclameDate` datetime DEFAULT NULL,
  `UncommitedUpdateDate` datetime DEFAULT NULL,
  `AFCopyId` varchar(8) NOT NULL DEFAULT '',
  `AOLCopyId` int(10) unsigned DEFAULT NULL,
  `AFAppVersion` mediumint(8) unsigned DEFAULT '0',
  `AOLAppVersion` varchar(12) DEFAULT NULL,
  `Message` mediumtext,
  `MessageShowCount` tinyint(3) unsigned DEFAULT '0',
  `SaveAFDataFiles` tinyint(1) unsigned DEFAULT '0',
  `TargetVersion` mediumint(8) unsigned DEFAULT NULL COMMENT 'Номер версии, до которой программа может автообновляться; null - до максимально возможной.',
  PRIMARY KEY (`UserId`)
) ENGINE=InnoDB DEFAULT CHARSET=cp1251 ROW_FORMAT=COMPACT;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping events for database 'usersettings'
--

--
-- Dumping routines for database 'usersettings'
--
/*!50003 DROP FUNCTION IF EXISTS `AnalitF_Replace` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50020 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 FUNCTION `AnalitF_Replace`(InputString varchar(255), PasswordString varchar(16)) RETURNS varchar(255) CHARSET cp1251
begin
  declare CurrIndex integer;
  declare CurrChar varchar(1);
  
  set InputString = aes_encrypt(InputString, PasswordString);
  set InputString = replace(InputString, char(37), '%25');
  set CurrIndex = 1;
  repeat
    set CurrChar = char(CurrIndex);
    set InputString = replace(InputString, CurrChar, concat('%', hex(CurrChar)));
    set CurrIndex = CurrIndex + 1;
  until (CurrIndex > 31)
  end repeat;
  set CurrIndex = 128;
  repeat
    set CurrChar = char(CurrIndex);
    set InputString = replace(InputString, CurrChar, concat('%', hex(CurrChar)));
    set CurrIndex = CurrIndex + 1;
  until (CurrIndex > 190)
  end repeat;
  set InputString = replace(InputString, char(0), '%00');
  return InputString;
  
end */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `AnalitF_StringChaos` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50020 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 FUNCTION `AnalitF_StringChaos`(InputString varchar(255)) RETURNS varchar(255) CHARSET cp1251
BEGIN
  return  concat(char(round((rand()*110)+32,0)), left(InputString, 1), char(round((rand()*110)+32,0)), right(InputString, length(InputString)-1));
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `CurrentDayOfWeek` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50020 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 FUNCTION `CurrentDayOfWeek`() RETURNS varchar(10) CHARSET cp1251
    READS SQL DATA
BEGIN
  SET @dayWeek = dayofweek(curdate());
  SET @result =
              CASE @dayWeek
              WHEN 1 THEN
                'Sunday'
              WHEN 2 THEN
                'Monday'
              WHEN 3 THEN
                'Tuesday'
              WHEN 4 THEN
                'Wednesday'
              WHEN 5 THEN
                'Thursday'
              WHEN 6 THEN
                'Friday'
              ELSE
                'Saturday'
              END;
  RETURN @result;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `ExtractCostFieldName` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50020 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 FUNCTION `ExtractCostFieldName`(PriceFmt VarCHAR(20), Delimeter VarCHAR(3), FieldName VARCHAR(50), TxtBegin INTEGER, TxtEnd INTEGER) RETURNS varchar(255) CHARSET cp1251
BEGIN
  return 
    if( ((PriceFmt = 'FixedWIN' or PriceFmt = 'FixedDOS') and (Delimeter is null)), concat(TxtBegin, '-', TxtEnd),
      if(PriceFmt = 'DBF', FieldName,
        if(left(FieldName,1)='F', concat('№', right(Fieldname, length(FieldName)-1)), Fieldname) )
  );
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `ExtractCostPriceFile` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50020 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 FUNCTION `ExtractCostPriceFile`(PriceMask varchar(255), ExtrMask varchar(255)) RETURNS varchar(255) CHARSET cp1251
BEGIN
  return if(
  ((right(PriceMask,3) = 'zip') or
   (right(PriceMask,3) = 'rar') or
   (right(PriceMask,3) = '.gz') or
   (right(PriceMask,3) = 'arj') or
   (right(PriceMask,3) = 'exe')),ExtrMask,PriceMask);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `GeneratePassword` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50020 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 FUNCTION `GeneratePassword`() RETURNS char(16) CHARSET cp1251
BEGIN
   Declare ResultStr char(16);
   Declare IntCount, ChCode int(16);
Set ResultStr='';
SET IntCount = 0;
repeat
  repeat
    Set ChCode=round((rand()*73),0)+49;
  until not ((ChCode>90 and ChCode<97) or (ChCode>57 and ChCode<65))
  end repeat;
  Set ResultStr=concat(ResultStr, char(ChCode));
  SET IntCount = IntCount + 1;
Until IntCount=16
end repeat;
return ResultStr;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `GetClientUpdateTime` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50020 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 FUNCTION `GetClientUpdateTime`(inClientCode INTEGER) RETURNS datetime
    READS SQL DATA
BEGIN
  DECLARE ClientUpdateTime Datetime;
  DECLARE varPrimaryClientCode Integer;
  DECLARE varIncludeType tinyint(1);

  select
    PrimaryClientCode,
    includetype
  into
    varPrimaryClientCode,
    varIncludeType 
  from
    usersettings.ClientsData
    left join usersettings.includeregulation on includeregulation.IncludeClientCode = ClientsData.FirmCode
  where
    ClientsData.FirmCode = inClientCode 
  limit 1;

  if ((varPrimaryClientCode is not null) and (varIncludeType in (0, 3))) 
  then
    select max(UserUpdateInfo.UpdateDate)
    into ClientUpdateTime
    from
      Usersettings.OSUserAccessRight,
      Usersettings.UserUpdateInfo
    where
        OSUserAccessRight.ClientCode = varPrimaryClientCode
    and UserUpdateInfo.UserId = OSUserAccessRight.RowId;

    return ClientUpdateTime;
  else
    select max(UserUpdateInfo.UpdateDate)
    into ClientUpdateTime
    from
      Usersettings.OSUserAccessRight,
      Usersettings.UserUpdateInfo
    where
        OSUserAccessRight.ClientCode = inClientCode
    and UserUpdateInfo.UserId = OSUserAccessRight.RowId;

    return ClientUpdateTime;
  end if;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `MakeCost` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50020 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 FUNCTION `MakeCost`(selfCost decimal(11, 2), opponentCost decimal(11, 2)) RETURNS decimal(11,2)
    NO SQL
BEGIN

declare distance decimal(11, 2);

if opponentCost is null then
  return selfCost;
end if;

set distance = ((selfCost - opponentCost) * 100) / opponentCost;

if distance > 0 and distance < 2 then
  return opponentCost - selfCost * (floor(1 + rand() * 9) / 1000);
end if;

if distance > -3 and distance < 0 then
  return selfCost;
end if;

if distance > -23 and distance < -3 then
  return 0.5 * (opponentCost + selfCost * 0.97);
end if;

return selfCost;

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `StringChaos` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50020 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 FUNCTION `StringChaos`(InputString varchar(255)) RETURNS varchar(255) CHARSET cp1251
BEGIN
Declare Res VarChar(255);
Set Res=left(InputString, 30+round((rand()*20),0));
if round(rand(),0) then
Set Res=replace(Res, '.', ' ');
else
Set Res=replace(Res, ' ', '.');
end if;
 return  Res;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `StringToAnalitF` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50020 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 FUNCTION `StringToAnalitF`(InString varchar(255)) RETURNS varchar(255) CHARSET cp1251
BEGIN
Return replace(replace(replace(InString, char(159), '_'), char(161), '_'), char(0), '_');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `AFGetActivePricesByUserId` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50020 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 PROCEDURE `AFGetActivePricesByUserId`(IN UserIdParam INT UNSIGNED)
BEGIN

Declare TabelExsists Bool DEFAULT false;
Declare ClientCodeParam INT UNSIGNED;

Declare TablePricesExists Bool default false;
DECLARE CONTINUE HANDLER FOR 1146
begin
  if not TablePricesExists then
    SELECT ClientCode
    INTO   ClientCodeParam
    FROM   OsUserAccessRight
    WHERE  RowId=UserIdParam;
    Call GetPrices2(ClientCodeParam);
  else
    resignal;
  end if;
end;

if not TabelExsists then
DROP TEMPORARY TABLE IF EXISTS  ActivePrices;
create temporary table
ActivePrices
(

 FirmCode int Unsigned,
 PriceCode int Unsigned,
 CostCode int Unsigned,
 PriceSynonymCode int Unsigned,
 RegionCode BigInt Unsigned,
 Fresh bool,
 Upcost decimal(7,5),
 PublicUpCost decimal(7,5),
 MaxSynonymCode Int Unsigned,
 MaxSynonymFirmCrCode Int Unsigned,
 CostType bool,
 PriceDate DateTime,
 ShowPriceName bool,
 PriceName VarChar(50),
 PositionCount int Unsigned,
 MinReq mediumint Unsigned,
 CostCorrByClient bool,
 FirmCategory tinyint unsigned,
 MainFirm bool,
 unique (PriceCode, RegionCode, CostCode),
 index  (CostCode, PriceCode),
 index  (PriceSynonymCode),
 index  (MaxSynonymCode),
 index  (PriceCode),
 index  (MaxSynonymFirmCrCode)
 )engine=MEMORY
 ;
set TabelExsists=true;
end if;

select null from Prices limit 0;
if not TablePricesExists then
  set TablePricesExists = true;
end if;

INSERT
INTO    ActivePrices
        (
 FirmCode,
 PriceCode,
 CostCode,
 PriceSynonymCode,
 RegionCode,
 Fresh,
 Upcost,
 PublicUpCost,
 MaxSynonymCode,
 MaxSynonymFirmCrCode,
 CostType,
 PriceDate,
 ShowPriceName,
 PriceName,
 PositionCount,
 MinReq,
 CostCorrByClient,
 FirmCategory,
 MainFirm
        ) 
SELECT P.FirmCode            ,
       P.PriceCode           ,
       P.CostCode            ,
       P.PriceSynonymCode    ,
       P.RegionCode          ,
       RI.ForceReplication !=0,
       P.Upcost              ,
       P.PublicUpCost        ,
       RI.MaxSynonymCode      ,
       RI.MaxSynonymFirmCrCode,
       P.CostType            ,
       P.PriceDate           ,
       P.ShowPriceName       ,
       P.PriceName           ,
       P.PositionCount       ,
       P.MinReq              ,
       P.CostCorrByClient    ,
       P.FirmCategory        ,
       P.MainFirm
FROM   Prices P,
       Usersettings.CurrentReplicationInfo RI
WHERE  p.DisabledByClient=0
   AND p.Actual          =1
   AND RI.UserId        =UserIdParam
   AND RI.FirmCode      =P.FirmCode;

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `DeleteCost` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50020 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 PROCEDURE `DeleteCost`(IN inCostCode INT UNSIGNED)
BEGIN
  declare costType tinyint(1);
  declare baseCost, sourceId, ruleId, itemId int unsigned;

  select pd.CostType, base.CostCode, f.Id as RuleId, s.Id as SourceId, pi.Id as ItemId
  into
    costType, baseCost, ruleId, sourceId, itemId
  from usersettings.PricesCosts pc
        join usersettings.PricesData pd on pd.PriceCode = pc.PriceCode
        join usersettings.pricescosts base on base.PriceCode = pc.PriceCode
                join usersettings.PriceItems pi on pi.Id = pc.PriceItemId
                        join Farm.FormRules f on f.Id = pi.FormRuleId
                        join Farm.sources s on s.Id = pi.SourceId
  where pc.CostCode = inCostCode and base.BaseCost = 1;

  if (inCostCode <> basecost) then
    update usersettings.intersection
    set CostCode = baseCost
    where CostCode = inCostCode;

    update Future.Intersection
    set CostId = baseCost
    where CostId = inCostCode;

    if (costType = 1) then

      delete from Farm.FormRules
      where Id = ruleId;

      delete from Farm.sources
      where Id = sourceId;

      delete from usersettings.PriceItems
      where Id = itemId;

      delete Farm.Core0
      from Farm.Core0
        join Farm.CoreCosts on Farm.Core0.Id = Farm.CoreCosts.Core_Id
      where Farm.CoreCosts.PC_CostCode = inCostCode;
    end if;

    delete from Farm.CoreCosts
    where PC_CostCode = inCostCode;

    delete from Farm.CostFormRules
    where CostCode = inCostCode;

    delete from usersettings.pricescosts where costcode = inCostCode;
  end if;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetActivePrices` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50020 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 PROCEDURE `GetActivePrices`(IN ClientCodeParam INT UNSIGNED)
BEGIN
Declare TabelExsists Bool DEFAULT false;
DECLARE CONTINUE HANDLER FOR 1146
begin
Call GetPrices(ClientCodeParam);
end;
if not TabelExsists then
DROP TEMPORARY TABLE IF EXISTS  ActivePrices;
create temporary table
ActivePrices
(
 
 FirmCode int Unsigned,
 PriceCode int Unsigned,
 CostCode int Unsigned,
 PriceSynonymCode int Unsigned,
 RegionCode BigInt Unsigned,
 Fresh bool,
 DelayOfPayment decimal(5,3),
 Upcost decimal(7,5),
 PublicUpCost decimal(7,5),
 MaxSynonymCode Int Unsigned,
 MaxSynonymFirmCrCode Int Unsigned,
 CostType bool,
 PriceDate DateTime,
 ShowPriceName bool,
 PriceName VarChar(50),
 PositionCount int Unsigned,
 MinReq smallint Unsigned,
 CostCorrByClient bool,
 FirmCategory tinyint unsigned,
 MainFirm bool
 
 
 
 
 
 
 )engine=MEMORY
 ;
set TabelExsists=true;
end if;
select null from Prices limit 0;
INSERT
INTO    ActivePrices 
        (
 FirmCode,
 PriceCode,
 CostCode,
 PriceSynonymCode,
 RegionCode,
 Fresh,
 DelayOfPayment,
 Upcost,
 PublicUpCost,
 MaxSynonymCode,
 MaxSynonymFirmCrCode,
 
 CostType,
 PriceDate,
 ShowPriceName,
 PriceName,
 PositionCount,
 MinReq,
 CostCorrByClient,
 FirmCategory,
 MainFirm
        ) 
SELECT  FirmCode,
        PriceCode, 
        CostCode,
        PriceSynonymCode,
        RegionCode,
        Fresh,
        DelayOfPayment,
        Upcost,
        PublicUpCost,
        MaxSynonymCode,
        MaxSynonymFirmCrCode,
        CostType,
        PriceDate,
        ShowPriceName,
        PriceName,
        PositionCount,
        MinReq,
        CostCorrByClient,
        FirmCategory,
        MainFirm
FROM    Prices 
WHERE   AlowInt =0
    AND DisabledByClient=0
    AND Actual=1;
drop temporary table IF EXISTS Prices;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetActivePrices2` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50020 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 PROCEDURE `GetActivePrices2`(IN ClientCodeParam INT UNSIGNED)
BEGIN
Declare TabelExsists Bool DEFAULT false;
DECLARE CONTINUE HANDLER FOR 1146
begin
Call GetPrices2(ClientCodeParam);
end;
if not TabelExsists then
DROP TEMPORARY TABLE IF EXISTS  ActivePrices;
create temporary table
ActivePrices
(
 FirmCode int Unsigned,
 PriceCode int Unsigned,
 CostCode int Unsigned,
 PriceSynonymCode int Unsigned,
 RegionCode BigInt Unsigned,
 DelayOfPayment decimal(5,3),
 Upcost decimal(7,5),
 PublicUpCost decimal(7,5),
 CostType bool,
 PriceDate DateTime,
 ShowPriceName bool,
 PriceName VarChar(50),
 PositionCount int Unsigned,
 MinReq smallint Unsigned,
 CostCorrByClient bool,
 FirmCategory tinyint unsigned,
 MainFirm bool,
 unique (PriceCode, RegionCode, CostCode),
 index  (CostCode, PriceCode),
 index  (PriceSynonymCode),
 index  (PriceCode)
 )engine=MEMORY
 ;
set TabelExsists=true;
end if;
select null from Prices limit 0;
INSERT
INTO    ActivePrices
        (
 FirmCode,
 PriceCode,
 CostCode,
 PriceSynonymCode,
 RegionCode,
 DelayOfPayment,
 Upcost,
 PublicUpCost,
 CostType,
 PriceDate,
 ShowPriceName,
 PriceName,
 PositionCount,
 MinReq,
 CostCorrByClient,
 FirmCategory,
 MainFirm
        ) 
SELECT  FirmCode,
        PriceCode, 
        CostCode,
        PriceSynonymCode,
        RegionCode,
        DelayOfPayment,
        Upcost,
        PublicUpCost,
        CostType,
        PriceDate,
        ShowPriceName,
        PriceName,
        PositionCount,
        MinReq,
        CostCorrByClient,
        FirmCategory,
        MainFirm
FROM    Prices 
WHERE DisabledByClient=0
  and Actual = 1;
drop temporary table IF EXISTS Prices;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetOffers` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50020 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 PROCEDURE `GetOffers`(IN ClientCodeParam INT UNSIGNED, IN FreshOnly BOOLEAN)
BEGIN
Declare SClientCode int unsigned;
Declare ClientRegionCode bigint unsigned;
Declare TableExsists Bool DEFAULT false;
DECLARE CONTINUE HANDLER FOR 1146
if not TableExsists then
call GetActivePrices(ClientCodeParam);
set TableExsists=true;
end if;
SELECT NULL FROM ActivePrices limit 0;
DROP TEMPORARY TABLE IF EXISTS Core, MinCosts;
CREATE TEMPORARY TABLE Core (
PriceCode INT unsigned,
RegionCode bigint unsigned,
ProductId INT unsigned,
Cost DECIMAL(8,2) unsigned,
CryptCost VARCHAR(32) NOT NULL,
id bigint unsigned,
INDEX (id),
INDEX (PriceCode),
INDEX (ProductId),
INDEX (ProductId, RegionCode, Cost),
INDEX (RegionCode, id)
)engine=MEMORY ;
CREATE TEMPORARY TABLE MinCosts (
MinCost DECIMAL(8,2) unsigned,
ProductId INT unsigned,
RegionCode INT unsigned,
PriceCode INT unsigned,
id bigint unsigned,
UNIQUE  MultiK(ProductId, RegionCode, MinCost),
INDEX (id)
)engine=MEMORY;
INSERT
INTO    Core
SELECT
        straight_join
        Prices.PriceCode,
        Prices.regioncode,
        c.ProductId,
        if(if(round(cc.Cost*Prices.UpCost,2)<MinBoundCost, MinBoundCost, round(cc.Cost*Prices.UpCost,2))>MaxBoundCost,
        MaxBoundCost, if(round(cc.Cost*Prices.UpCost,2)<MinBoundCost, MinBoundCost, round(cc.Cost*Prices.UpCost,2))),
        '',
        c.id
FROM ActivePrices Prices
  JOIN farm.core0 c on c.PriceCode = Prices.PriceCode
    JOIN farm.CoreCosts cc on cc.Core_Id = c.Id and cc.PC_CostCode = Prices.CostCode;
Delete from Core where Cost<0.01;


if (select FirmCodeOnly from retclientsset where clientcode=ClientCodeParam) is not null then
  update
    retclientsset
    inner join pricesdata on pricesdata.FirmCode != RetClientsSet.FirmCodeOnly
    inner join core on core.PriceCode = pricesdata.PriceCode
  set
    core.cost=(1+(rand()*if(rand()>0.5,2, -2)/100))*core.cost
  where
    RetClientsSet.clientcode=ClientCodeParam;
end if;

INSERT
INTO    MinCosts
SELECT  
        min(Cost),
        ProductId,
        RegionCode,
        null,
        null
FROM    Core
GROUP BY ProductId,
        RegionCode;
UPDATE MinCosts,
        Core
        SET MinCosts.ID         = Core.ID,
            MinCosts.PriceCode  = Core.PriceCode
WHERE   Core.ProductId       = MinCosts.ProductId
        And Core.RegionCode = MinCosts.RegionCode
        And Core.Cost       = MinCosts.MinCost;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetOrderHeader` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50020 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 PROCEDURE `GetOrderHeader`(IN idparam  integer unsigned)
BEGIN

if (select AddressId from Orders.OrdersHead where rowid = idparam) is null then

SELECT   Writetime + interval reg.MoscowBias hour Writetime     ,
         oh.ClientCode                                          ,
         PriceDate + interval reg.MoscowBias hour PriceDate     ,
         clientAddition                           ClientComment ,
         RowCount                                               ,
         oh.PriceCode                                           ,
         cd.ShortName ClientShortName                           ,
         cd.FullName  ClientFullName                            ,
         cd.Adress    ClientAddress                             ,
         (SELECT c.contactText
         FROM    contacts.contact_groups cg
                 JOIN contacts.contacts c
                 ON      cg.Id          = c.ContactOwnerId
         WHERE   cd.ContactGroupOwnerId = cg.ContactGroupOwnerId
             AND cg.Type                = 0
             AND c.Type                 = 1 limit 1
         ) AS ClientPhone                     ,
         ifnull(iinv.FirmClientCode, i2.FirmClientCode) FirmClientCode                   ,
         ifnull(iinv.FirmClientCode2, i2.FirmClientCode2) FirmClientCode2                  ,
         ifnull(iinv.FirmClientCode3, i2.FirmClientCode3) FirmClientCode3                  ,
         MIN(i.PublicCostCorr) PublicCostCorr ,
         MIN(i.FirmCostCorr)   FirmCostCorr   ,
         (SELECT ROUND(SUM(ol.cost*ol.Quantity),2)
         FROM    orders.orderslist AS ol
         WHERE   ol.orderid= oh.RowId
         )             AS Summ            ,
         cdf.ShortName AS FirmShortName   ,
         cd.regionCode    ClientRegionCode,
         pd.FirmCode                      ,
         pd.pricename   PriceName           ,
         region         RegionName          ,
         cd.firmsegment OrderSegment        ,
         rcs.ServiceClient
      OR rcs.InvisibleOnFirm = 2 AS ServiceClient,
         cd.BillingCode                          ,
         pc.CostName                             ,
         oh.RowId                                 AS OrderId
FROM     usersettings.clientsdata                 AS cd ,
         usersettings.clientsdata                 AS cdf,
         usersettings.pricesdata                  AS pd ,
         usersettings.regionaldata                AS rd ,
         farm.regions                             AS reg,
         usersettings.retclientsset               AS rcs,
         orders.ordershead                        AS oh
         LEFT JOIN usersettings.includeregulation AS ir
         ON       ir.includeclientcode= oh.ClientCode
         LEFT JOIN usersettings.intersection i2
         ON       i2.clientcode = oh.clientcode
              AND i2.regioncode = oh.regioncode
              AND i2.pricecode  = oh.pricecode
         LEFT JOIN usersettings.intersection i
         ON       i.PriceCode  = oh.PriceCode
              AND i.regionCode = oh.regionCode
              AND i.ClientCode = IF(ir.primaryclientcode IS NULL, oh.ClientCode, ir.primaryclientcode)
         LEFT JOIN usersettings.includeregulation AS irinv
         ON       irinv.includeclientcode= oh.ClientCode
              AND irinv.includetype      =2
         LEFT JOIN usersettings.intersection iinv
         ON       iinv.PriceCode  = oh.PriceCode
              AND iinv.regionCode = oh.regionCode
              AND iinv.ClientCode = IF(irinv.primaryclientcode IS NULL, oh.ClientCode, irinv.primaryclientcode)
         LEFT JOIN usersettings.pricescosts pc
         ON       pc.costcode = i.costcode
WHERE    cd.firmcode          = oh.ClientCode
     AND oh.PriceCode         = pd.PriceCode
     AND cdf.firmcode         = pd.FirmCode
     AND rd.regionCode        = oh.regionCode
     AND rd.firmCode          = pd.FirmCode
     AND reg.regioncode       = cd.regioncode
     AND cd.firmcode          = rcs.clientcode
     AND oh.rowid             = idparam
GROUP BY oh.RowId;


else

SELECT   Writetime + interval reg.MoscowBias hour Writetime     ,
         oh.ClientCode                                          ,
         PriceDate + interval reg.MoscowBias hour PriceDate     ,
         clientAddition                           ClientComment ,
         RowCount                                               ,
         oh.PriceCode                                           ,
         cd.Name ClientShortName                           ,
         cd.FullName  ClientFullName                            ,
         a.Address    ClientAddress                             ,
         (SELECT c.contactText
         FROM    contacts.contact_groups cg
                 JOIN contacts.contacts c
                 ON      cg.Id          = c.ContactOwnerId
         WHERE   cd.ContactGroupOwnerId = cg.ContactGroupOwnerId
             AND cg.Type                = 0
             AND c.Type                 = 1 limit 1
         ) AS ClientPhone                     ,
         if(cd.SwapFirmCode or ifnull(os.SwapFirmCode, 0), ai.SupplierDeliveryId, i.SupplierClientId) FirmClientCode,
         if(cd.SwapFirmCode or ifnull(os.SwapFirmCode, 0), i.SupplierClientId, ai.SupplierDeliveryId)  FirmClientCode2,
         i.SupplierPaymentId FirmClientCode3,
         0 PublicCostCorr ,
         MIN(i.PriceMarkup)   FirmCostCorr   ,
         (SELECT ROUND(SUM(ol.cost*ol.Quantity),2)
         FROM    orders.orderslist AS ol
         WHERE   ol.orderid= oh.RowId
         )             AS Summ            ,
         cdf.ShortName AS FirmShortName   ,
         cd.regionCode    ClientRegionCode,
         pd.FirmCode                      ,
         pd.pricename   PriceName           ,
         region         RegionName          ,
         cd.segment OrderSegment        ,
         rcs.ServiceClient OR rcs.InvisibleOnFirm = 2 AS ServiceClient,
         cd.PayerId as BillingCode                          ,
         pc.CostName                             ,
         oh.RowId                                 AS OrderId
FROM     (Future.Clients                 AS cd ,
         usersettings.clientsdata                 AS cdf,
         usersettings.pricesdata                  AS pd ,
         usersettings.regionaldata                AS rd ,
         farm.regions                             AS reg,
         usersettings.retclientsset               AS rcs,
         orders.ordershead                        AS oh)
  join Future.Addresses a on a.Id = oh.AddressId LEFT JOIN Future.Intersection i ON i.PriceId  = oh.PriceCode AND i.RegionId = oh.regionCode AND i.ClientId = oh.ClientCode
  join Future.AddressIntersection ai on ai.AddressId = a.Id and ai.IntersectionId = i.Id LEFT JOIN usersettings.pricescosts pc ON pc.costcode = i.CostId
  left join Future.OrderSwap os on os.ClientId = oh.ClientCode and os.SupplierId = cdf.FirmCode
WHERE    cd.Id          = oh.ClientCode
     AND oh.PriceCode         = pd.PriceCode
     AND cdf.firmcode         = pd.FirmCode
     AND rd.regionCode        = oh.regionCode
     AND rd.firmCode          = pd.FirmCode
     AND reg.regioncode       = cd.regioncode
     AND cd.Id          = rcs.clientcode
     AND oh.rowid             = idparam
GROUP BY oh.RowId;


end if;

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetPrices` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50020 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 PROCEDURE `GetPrices`(IN ClientCodeIN INT UNSIGNED)
BEGIN
Declare ClientCodeP int unsigned;
SELECT  min(primaryclientcode) into ClientCodeP  FROM includeregulation where includeclientcode=ClientCodeIN;
if ClientCodeP is null then
set ClientCodeP =ClientCodeIN;
end if;
drop temporary table IF EXISTS Prices;
CREATE TEMPORARY TABLE
Prices(
  FirmCode INT UNSIGNED,
  PriceCode INT UNSIGNED,
  CostCode INT UNSIGNED,
  PriceSynonymCode INT UNSIGNED,
  RegionCode BIGINT UNSIGNED,
  AlowInt BOOL,
  Fresh BOOL,
  DelayOfPayment DECIMAL (5, 3),
  Upcost DECIMAL (7, 5),
  PublicUpCost DECIMAL (7, 5),
  MaxSynonymCode INT UNSIGNED,
  MaxSynonymFirmCrCode INT UNSIGNED,
  DisabledByClient BOOL,
  Actual BOOL,
  CostType BOOL,
  PriceDate DATETIME,
  ShowPriceName BOOL,
  PriceName VARCHAR (50),
  PositionCount INT UNSIGNED,
  MinReq SMALLINT UNSIGNED,
  ControlMinReq BOOL,
  CostCorrByClient BOOL,
  AllowOrder BOOL,
  ShortName VARCHAR (50),
  FirmCategory TINYINT UNSIGNED,
  MainFirm BOOL,
  Storage BOOL,
  INDEX (PriceCode),
  INDEX (RegionCode)


) ENGINE = MEMORY;
INSERT
INTO    Prices
SELECT  pricesdata.firmcode,
        i.pricecode,
        i.costcode,
        ifnull(pricesdata.ParentSynonym, pricesdata.pricecode) PriceSynonymCode,
        i.RegionCode,
        AlowInt,
        0,
        si.DelayOfPayment,
        round((1+pricesdata.UpCost/100) * (1+pricesregionaldata.UpCost/100) * (1+(i.FirmCostCorr+i.PublicCostCorr)/100), 5),
        i.PublicCostCorr,
        0,
        0,
       if(iu.id is not null, iu.DisabledByClient, i.DisabledByClient),
        to_days(now())-to_days(pi.PriceDate)< f.maxold,
        pricesdata.CostType,
        date_sub(pi.PriceDate, interval time_to_sec(date_sub(now(), interval unix_timestamp() second)) second),
        if(iu.id is not null, ru.ShowPriceName, r.ShowPriceName),
        PriceName,
        pi.RowCount,
        if(i.MinReq>0, i.MinReq, pricesregionaldata.MinReq),
        if(iu.id is not null AND ir.includetype IN (1), iu.ControlMinReq, i.ControlMinReq),
        if(ir.includetype is not null, 0, i.CostCorrByClient),
        (if(iu.id is not null, ru.OrderRegionMask, r.OrderRegionMask) & i.RegionCode) > 0,
        clientsdata.ShortName,
        if(iu.id is not null, iu.FirmCategory, i.FirmCategory),
        if(iu.id is not null, iu.FirmCategory>=ru.BaseFirmCategory, i.FirmCategory>=r.BaseFirmCategory),
        Storage
FROM usersettings.intersection i
  JOIN usersettings.pricesdata ON pricesdata.pricecode = i.pricecode
  JOIN usersettings.SupplierIntersection si on si.SupplierId = pricesdata.FirmCode and i.ClientCode = si.ClientId
  JOIN usersettings.PricesCosts pc on pc.CostCode = i.CostCode
    JOIN usersettings.PriceItems pi on pi.Id = pc.PriceItemId
      JOIN farm.formrules f on f.Id = pi.FormRuleId
    JOIN usersettings.clientsdata ON clientsdata.firmcode = pricesdata.firmcode
    JOIN usersettings.pricesregionaldata ON pricesregionaldata.regioncode = i.regioncode AND pricesregionaldata.pricecode = pricesdata.pricecode
    JOIN usersettings.RegionalData rd ON rd.RegionCode = i.regioncode AND rd.FirmCode = pricesdata.firmcode
  JOIN usersettings.clientsdata as AClientsData ON AClientsData.firmcode = i.clientcode and clientsdata.firmsegment = AClientsData.firmsegment
    JOIN usersettings.retclientsset r ON r.clientcode = AClientsData.FirmCode
  LEFT JOIN usersettings.intersection iu ON iu.pricecode = i.pricecode and iu.clientcode = ClientCodeIN and i.regioncode = iu.regioncode
  LEFT JOIN usersettings.retclientsset ru ON ru.clientcode = iu.clientcode
  LEFT JOIN usersettings.includeregulation ir ON ir.primaryclientcode = ClientCodeP AND ir.includeclientcode = ClientCodeIN
WHERE   i.DisabledByAgency = 0
    AND clientsdata.firmstatus = 1
    AND clientsdata.firmtype = 0
    AND (clientsdata.maskregion & i.regioncode) > 0
    AND (AClientsData.maskregion & i.regioncode) > 0
    AND pricesdata.agencyenabled = 1
    AND pricesdata.enabled = 1
    AND pricesdata.pricetype <> 1
    AND pricesregionaldata.enabled = 1
    AND if(not r.ServiceClient, clientsdata.FirmCode!=234, 1)
    AND (if(iu.id is not null, ru.WorkRegionMask, r.WorkRegionMask) & i.regioncode) > 0
    AND if(iu.id is not null AND ir.includetype IN (1), 1,  i.invisibleonclient = 0)
    AND if(iu.id is not null, iu.disabledbyagency = 0, 1)
    AND if(iu.id is not null AND ir.includetype IN (1), iu.invisibleonclient=0, 1)
    AND i.clientcode = ClientCodeP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetPrices2` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50020 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 PROCEDURE `GetPrices2`(IN ClientCodeIN INT UNSIGNED)
BEGIN
Declare ClientCodeP int unsigned;
SELECT  min(primaryclientcode) into ClientCodeP  FROM includeregulation where includeclientcode=ClientCodeIN;
if ClientCodeP is null then
set ClientCodeP =ClientCodeIN;
end if;
drop temporary table IF EXISTS Prices;
CREATE TEMPORARY TABLE
Prices(
  FirmCode INT UNSIGNED,
  PriceCode INT UNSIGNED,
  CostCode INT UNSIGNED,
  PriceSynonymCode INT UNSIGNED,
  RegionCode BIGINT UNSIGNED,

  DelayOfPayment DECIMAL (5, 3),
  Upcost DECIMAL (7, 5),
  PublicUpCost DECIMAL (7, 5),

  DisabledByClient BOOL,
  Actual BOOL,
  CostType BOOL,
  PriceDate DATETIME,
  ShowPriceName BOOL,
  PriceName VARCHAR (50),
  PositionCount INT UNSIGNED,
  MinReq MEDIUMINT UNSIGNED,
  ControlMinReq BOOL,
  CostCorrByClient BOOL,
  AllowOrder BOOL,
  ShortName VARCHAR (50),
  FirmCategory TINYINT UNSIGNED,
  MainFirm BOOL,
  Storage BOOL,
  TMPMaskRegion BIGINT UNSIGNED,
  TMPClientCode INT UNSIGNED,
  INDEX (PriceCode),
  INDEX (RegionCode)


) ENGINE = MEMORY;
INSERT
INTO    Prices
SELECT  pricesdata.firmcode,
        i.pricecode,
        i.costcode,
        ifnull(pricesdata.ParentSynonym, pricesdata.pricecode) PriceSynonymCode,
        i.RegionCode,
        si.DelayOfPayment,
        
        round((1+pricesdata.UpCost/100) * (1+pricesregionaldata.UpCost/100) * (1+(i.FirmCostCorr+i.PublicCostCorr)/100), 5),
        i.PublicCostCorr,
        
        
       if(iu.id is not null, iu.DisabledByClient, i.DisabledByClient),
        to_days(now())-to_days(pi.PriceDate)< f.maxold,
        pricesdata.CostType,
        pi.PriceDate,
        if(iu.id is not null, ru.ShowPriceName, r.ShowPriceName),
        PriceName,
        pi.RowCount,
        if(i.MinReq>0, i.MinReq, pricesregionaldata.MinReq),
        if(iu.id is not null AND ir.includetype IN (1), iu.ControlMinReq, i.ControlMinReq),
        if(ir.includetype is not null, 0, i.CostCorrByClient),
        (if(iu.id is not null, ru.OrderRegionMask, r.OrderRegionMask) & i.RegionCode) > 0,
        clientsdata.ShortName,
        if(iu.id is not null, iu.FirmCategory, i.FirmCategory),
        if(iu.id is not null, iu.FirmCategory>=ru.BaseFirmCategory, i.FirmCategory>=r.BaseFirmCategory),
        Storage,
AClientsData.maskregion,
AClientsData.FirmCode
FROM usersettings.intersection i
  JOIN usersettings.pricesdata ON pricesdata.pricecode = i.pricecode
  JOIN usersettings.SupplierIntersection si on si.SupplierId = pricesdata.FirmCode and i.ClientCode = si.ClientId
  JOIN usersettings.PricesCosts pc on pc.CostCode = i.CostCode
    JOIN usersettings.PriceItems pi on pi.Id = pc.PriceItemId
    JOIN farm.formrules f on f.Id = pi.FormRuleId
    JOIN usersettings.clientsdata ON clientsdata.firmcode = pricesdata.firmcode
    JOIN usersettings.pricesregionaldata ON pricesregionaldata.regioncode = i.regioncode AND pricesregionaldata.pricecode = pricesdata.pricecode
    JOIN usersettings.RegionalData rd ON rd.RegionCode = i.regioncode AND rd.FirmCode = pricesdata.firmcode
  JOIN usersettings.clientsdata as AClientsData ON AClientsData.firmcode = i.clientcode and clientsdata.firmsegment = AClientsData.firmsegment
  JOIN usersettings.clientsdata as SClientsData ON SClientsData.firmcode = ClientCodeIN and clientsdata.firmsegment = SClientsData.firmsegment
    JOIN usersettings.retclientsset r ON r.clientcode = AClientsData.FirmCode


  
  LEFT JOIN usersettings.intersection iu ON iu.pricecode = i.pricecode and iu.clientcode = ClientCodeIN and iu.regioncode = i.regioncode
  LEFT JOIN usersettings.retclientsset ru ON ru.clientcode = iu.clientcode
  LEFT JOIN usersettings.includeregulation ir ON ir.primaryclientcode = ClientCodeP AND ir.includeclientcode = ClientCodeIN
WHERE   i.DisabledByAgency = 0
    AND clientsdata.firmstatus = 1
    AND clientsdata.firmtype = 0
    AND (clientsdata.maskregion & i.regioncode) > 0
    AND (AClientsData.maskregion & i.regioncode) > 0
    AND (SClientsData.maskregion & i.regioncode) > 0
    AND pricesdata.agencyenabled = 1
    AND pricesdata.enabled = 1
    AND pricesdata.pricetype <> 1
    AND pricesregionaldata.enabled = 1
    AND if(not r.ServiceClient, clientsdata.FirmCode!=234, 1)
    AND (if(iu.id is not null, ru.WorkRegionMask, r.WorkRegionMask) & i.regioncode) > 0
    AND if(iu.id is not null AND ir.includetype IN (1), 1,  i.invisibleonclient = 0)
    AND if(iu.id is not null, iu.disabledbyagency = 0, 1)
    AND if(iu.id is not null AND ir.includetype IN (1), iu.invisibleonclient=0, 1)
    AND i.clientcode = ClientCodeP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetStatLog` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50020 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 PROCEDURE `GetStatLog`(IN inLogStart DATETIME, IN inLogEnd DATETIME)
BEGIN

  DROP TEMPORARY TABLE IF EXISTS tempdownlogs;
  CREATE TEMPORARY TABLE tempdownlogs(
    rowid INT UNSIGNED,
    priceitemid INT UNSIGNED,
    resultcode MEDIUMINT UNSIGNED,
    fixedtime DATETIME,
    LogTime datetime,
    KEY (rowid),
    KEY (priceitemid),
    KEY (resultcode)
  ) ENGINE = MEMORY;
  
  DROP TEMPORARY TABLE IF EXISTS tempdownlogs2;
  CREATE TEMPORARY TABLE tempdownlogs2(
    rowid INT UNSIGNED,
    priceitemid INT UNSIGNED,
    resultcode MEDIUMINT UNSIGNED,    
    LogTime datetime,
    KEY (rowid),
    KEY (priceitemid),
    KEY (resultcode)
  ) ENGINE = MEMORY;

  INSERT INTO tempdownlogs
  SELECT d.rowid, d.priceitemid, d.resultcode, NULL, d.LogTime
  FROM LOGS.downlogs d
  WHERE (inLogStart < d.logtime) AND (d.logtime < inLogEnd);

  update tempdownlogs t
    join usersettings.PriceItems pi on pi.Id = t.PriceItemId
  SET fixedtime = if (logtime > pi.LastDownload, null, pi.LastDownload)
  where t.ResultCode in (3, 5);
  
  drop temporary table if exists MaxUnfixedErrorTimes;
  create temporary table MaxUnfixedErrorTimes engine = memory
  select PriceItemId, max(logtime) as LogTime
  from tempdownlogs t
  where t.fixedtime is null and t.ResultCode in (3, 5)
  group by t.PriceItemId;
  
  delete t from tempdownlogs t
    join MaxUnfixedErrorTimes m on t.PriceItemId = m.PriceItemId
  where t.fixedtime is null and t.ResultCode in (3, 5) and t.logtime < m.LogTime;
  
  insert into tempdownlogs2
  select d.rowid, d.priceitemid, d.resultcode, max(d.LogTime)
  from LOGS.downlogs d
  where (inLogStart < d.logtime) AND (d.logtime < inLogEnd) and ResultCode = 2
  group by d.priceitemid;
  
  update tempdownlogs t1
    join tempdownlogs2 t2 on t1.PriceItemId = t2.PriceItemId
  set t1.fixedtime = if(t2.logtime > t1.logtime, t2.logtime, null)
  where t1.ResultCode in (3, 5) and t1.fixedtime is null;
  

  DROP TEMPORARY TABLE IF EXISTS tempformlogs;
  CREATE TEMPORARY TABLE tempformlogs(
    rowid INT UNSIGNED PRIMARY KEY,
    logtime DATETIME,
    priceitemid INT UNSIGNED,
    resultid MEDIUMINT UNSIGNED,
    fixedtime DATETIME,
    KEY priceitemid (rowid, priceitemid),
    KEY resultid (rowid, resultid)
  ) ENGINE = MEMORY;
  INSERT
  INTO tempformlogs
  SELECT
    rowid, logtime, priceitemid, resultid, NULL
  FROM
    LOGS.formlogs d
  WHERE
    (inLogStart < logtime) AND (logtime < inLogEnd);
  SELECT
    MIN(Rowid)
  INTO
    @minrowid
  FROM
    tempformlogs;
  UPDATE
    tempformlogs, LOGS.formlogs dl
  SET
    fixedtime = dl.logtime
  WHERE
    tempformlogs.priceitemid = dl.priceitemid
    AND tempformlogs.rowid >= @minrowid
    AND @minrowid < dl.rowid
    AND tempformlogs.rowid < dl.rowid
    AND dl.resultid IN
    (2, 3)
    AND tempformlogs.resultid = 5;
  SELECT
    1 AS LAppCode, 
    LogTime AS LLogTime, 
    logs.priceitemid AS LPriceItemId, 
    NULL AS LFirmName, 
    NULL AS LRegion, 
    NULL AS LFirmSegment,
    NULL AS LPriceName, 
    NULL AS LPriceCode, 
    NULL AS LForm, 
    NULL AS LUnform, 
    NULL AS LZero, 
    NULL AS LForb, 
    IF(ResultCode = 2, NULL, Addition) AS LAddition,
    IF(ResultCode = 2, NULL, IFNULL(ShortErrorMessage, Addition)) AS LShortErrorMessage, 
    srcTypes.Type As LSourceType,
    ResultCode AS LResultID, 1 AS LStatus
  FROM
    LOGS.downlogs AS LOGS
  LEFT JOIN farm.sourcetypes AS srcTypes ON srcTypes.Id = logs.SourceTypeId
  WHERE
    logs.priceitemid IS NULL
    AND logs.LogTime > inLogStart
    AND logs.LogTime < inLogEnd
  UNION
  SELECT
    1 AS LAppCode, 
    logs.LogTime AS LLogTime, 
    logs.priceitemid AS LPriceItemId, 
    cd.ShortName AS LFirmName, 
    r.Region AS LRegion, 
    cd.FirmSegment AS LFirmSegment, 
    IF(pd.CostType = 1, CONVERT(CONCAT(pd.PriceName, CONVERT(" [] " USING CP1251), pc.CostName) USING CP1251), pd.PriceName) AS LPriceName, 
    pd.PriceCode AS LPriceCode, 
    NULL AS LForm, 
    NULL AS LUnform, 
    NULL AS LZero, 
    NULL AS LForb, 
    IF(logs.ResultCode = 2, NULL, logs.Addition) AS LAddition,
    IF(logs.ResultCode = 2, NULL, IFNULL(ShortErrorMessage, Addition)) AS LShortErrorMessage, 
    srcTypes.Type As LSourceType,
    logs.ResultCode AS LResultID, 
    IF((logs.ResultCode = 2), 0, IF(tempdownlogs.fixedtime IS NULL, 1, 2)) AS LStatus
  FROM
    (LOGS.downlogs AS LOGS,
    usersettings.PriceItems pim,
    usersettings.clientsdata cd,
    usersettings.pricesdata pd,
    usersettings.pricescosts pc,
    farm.regions r,
    tempdownlogs)
  LEFT JOIN farm.sourcetypes AS srcTypes ON srcTypes.Id = logs.SourceTypeId
  WHERE
    pim.Id = logs.PriceItemId
    AND pc.PriceItemId = pim.Id
    AND pc.PriceCode = pd.PriceCode
    AND ((pd.CostType = 1) OR (pc.BaseCost = 1))
    AND cd.firmcode = pd.firmcode
    AND r.regioncode = cd.regioncode
    AND tempdownlogs.RowId = logs.RowID
    AND logs.LogTime > inLogStart
    AND logs.LogTime < inLogEnd
  UNION
  SELECT
    0 AS LAppCode, 
    LogTime AS LLogTime, 
    logs.priceitemid AS LPriceItemId, 
    NULL AS LFirmName, 
    NULL AS LRegion, 
    NULL AS LFirmSegment, 
    NULL AS LPriceName, 
    NULL AS LPriceCode, 
    IF(Form IS NULL, 0, Form) AS LForm, 
    IF(Unform IS NULL, 0, Unform) AS LUnform, 
    IF(Zero IS NULL, 0, Zero) AS LZero, 
    IF(Forb IS NULL, 0, Forb) AS LForb, 
    Addition AS LAddition, 
    Addition AS LShortErrorMessage, 
    null As LSourceType,
    ResultID AS LResultID, 
    1 AS LStatus
  FROM
    LOGS.formlogs AS LOGS
  WHERE
    logs.PriceItemId IS NULL
    AND logs.LogTime > inLogStart
    AND logs.LogTime < inLogEnd
  UNION
  SELECT
    0 AS LAppCode, 
    logs.LogTime AS LLogTime, 
    logs.priceitemid AS LPriceItemId, 
    cd.ShortName AS LFirmName, 
    r.Region AS LRegion, 
    cd.FirmSegment AS LFirmSegment, 
    IF(pd.CostType = 1, CONVERT(CONCAT(pd.PriceName, CONVERT(" [] " USING CP1251), pc.CostName) USING CP1251), pd.PriceName) AS LPriceName, 
    pd.PriceCode AS LPriceCode, 
    IF(logs.Form IS NULL, 0, logs.Form) AS LForm, 
    IF(logs.Unform IS NULL, 0, logs.Unform) AS LUnform,
    IF(logs.Zero IS NULL, 0, logs.Zero) AS LZero, 
    IF(logs.Forb IS NULL, 0, logs.Forb) AS LForb, 
    logs.Addition AS LAddition, 
    logs.Addition AS LShortErrorMessage, 
    null As LSourceType,
    logs.ResultID AS LResultID, 
    IF((logs.ResultID = 2) OR (logs.ResultID = 3), 0, IF(tempformlogs.fixedtime IS NULL, 1, 2)) AS LStatus
  FROM
    LOGS.formlogs AS LOGS,
    usersettings.PriceItems pim,
    usersettings.clientsdata cd,
    usersettings.pricesdata pd,
    usersettings.pricescosts pc,
    farm.regions r,
    tempformlogs
  WHERE
    pim.Id = logs.PriceItemId
    AND pc.PriceItemId = pim.Id
    AND pc.PriceCode = pd.PriceCode
    AND ((pd.CostType = 1) OR (pc.BaseCost = 1))
    AND cd.firmcode = pd.firmcode
    AND r.regioncode = cd.regioncode
    AND tempformlogs.RowId = logs.RowId
    AND logs.LogTime > inLogStart
    AND logs.LogTime < inLogEnd
  ORDER BY
    LLogTime;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `RetailFindByName` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50020 DEFINER=`EMK`@`emkwork.adc.analit.net`*/ /*!50003 PROCEDURE `RetailFindByName`(IN Name VARCHAR(255), IN Region bigint)
    SQL SECURITY INVOKER
BEGIN

  DROP TEMPORARY TABLE
  IF EXISTS ctlgs;
  CREATE TEMPORARY TABLE ctlgs ENGINE = MEMORY
  SELECT c.Id CatalogId
       , p.Id ProductId
       , c.NameId
       , cn.Name
       , c.FormId
  FROM
    catalogs.catalog c
    join catalogs.products p on p.catalogid = c.id
	join catalogs.catalognames cn on cn.id = c.NameId
  WHERE
    c.Name LIKE concat('%', Name, '%')
    AND c.hidden = 0
    AND p.hidden = 0;

  DROP TEMPORARY TABLE IF EXISTS FindByNameTable;
  CREATE TEMPORARY TABLE FindByNameTable ENGINE = MEMORY
  SELECT min(cc.Cost * ap.UpCost) MinBaseCost
	 , max(cc.Cost * ap.UpCost) MaxBaseCost
     , ctlgs.CatalogId
     , ctlgs.Name
     , cf.Form
     , pro.Name as Producer
     , core.CodeFirmCr as ProducerId
     , des.Name as description
     , count(DISTINCT ap.FirmCode) OfferCount
     , mnn.mnn
FROM
  (ctlgs,
  farm.core0 core,
  farm.CoreCosts cc,
  activeprices ap,
  catalogs.CatalogNames cn)
  join catalogs.CatalogForms cf on cf.id = ctlgs.FormId
  left join  catalogs.mnn on mnn.id = cn.mnnid
  left join catalogs.Producers pro on core.CodeFirmCr = pro.Id
  left join catalogs.descriptions des on des.id = cn.descriptionId
WHERE
  ap.RegionCode = Region
  AND core.pricecode = ap.pricecode
  AND core.ID = cc.Core_Id
  AND cc.PC_CostCode = ap.CostCode
  AND core.productid = ctlgs.productid
  AND cn.id = ctlgs.NameId
GROUP BY
ctlgs.CatalogId
ORDER BY
  ctlgs.name
, MinBaseCost;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `SelectCS` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50020 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 PROCEDURE `SelectCS`(IN inRegCode BIGINT(20), IN inUserCode INTEGER, IN inPriceCode INTEGER)
BEGIN
SELECT  intersection.id,
        concat(a.shortname, IF(primaryClientCode is not null, concat(' (', b.shortname, ')'), '')) as shortname,
        intersection.clientcode,
        if(c.disabledbyagency= 1 or c.InvisibleOnFirm = 1, 1, 0)  as Inactive,
        if(c.disabledbyfirm is null, 0, c.disabledbyfirm)                                                                                                                                                  as disabledbyfirm,
        intersection.firmclientcode                                                                                                                                                                        as FirmClientCode1,
        if(c.publiccostcorr is null, 0, c.publiccostcorr)        as publiccostcorr,
        if(c.costcorrbyclient is null, 1, c.costcorrbyclient)    as costcorrbyclient,
        if((primaryclientcode is not null) and ((includetype = 1)), if(intersection.InvisibleOnClient is null, 0, intersection.InvisibleOnClient), if(c.InvisibleOnClient is null, 0, c.InvisibleOnClient)) as InvisibleOnClient,
        usersettings.GetClientUpdateTime(a.FirmCode)                                                                                                                                                        as UpdateTime,
        intersection.pricecode,
        PriceType,
        if((primaryClientCode is not null) and (includetype in (0, 3)), ifnull(c.disabledbyclient, 0)=1, ifnull(intersection.disabledbyclient, 0)= 1) as DisabledByClient,
        primaryClientCode is not null                                                                                   as SlaveClient,
        if(c.firmcostcorr is null, 0, c.firmcostcorr)                                                                   as firmcostcorr,
        intersection.FirmClientCode2,
        intersection.FirmClientCode3,
        ifnull(CostName, '-') CostName,
        pc.CostCode,
        if((primaryClientCode is not null) and (includetype in (0, 3)), c.minreq, intersection.minreq) as minreq,
        if((primaryClientCode is not null) and (includetype in (0, 3)), ifnull(c.controlminreq, 0), ifnull(intersection.controlminreq, 0)) as controlminreq,
        intersection.invisibleonfirm,
        ir.primaryclientcode,

        if(ir.includetype in (0, 3), 0, includetype) as includetype
FROM    (intersection, pricesdata, clientsdata, retclientsset)
LEFT JOIN clientsdata as a
        ON a.firmcode      = intersection.clientcode
        and a.billingstatus= 1
        and a.firmsegment  = clientsdata.firmsegment
        and a.firmstatus   = 1
LEFT JOIN includeregulation ir
        ON IncludeClientCode = intersection.clientcode
        and not exists(select * from includeregulation c where c.IncludeClientCode = ir.PrimaryClientCode and c.IncludeType = 2)
LEFT JOIN clientsdata as b
        ON b.firmcode      = primaryClientCode
        and b.firmstatus   = 1
        and b.billingstatus= 1
LEFT JOIN retclientsset as rcs
        ON rcs.clientcode= primaryClientCode
LEFT JOIN intersection as c
        ON c.pricecode  = intersection.pricecode
        and c.regioncode= intersection.regioncode
        and c.clientcode= if(primaryclientcode is null, intersection.clientcode, primaryclientcode)
LEFT JOIN PricesCosts pc
        ON pc.costcode                                        = c.costcode
WHERE   pricesdata.pricecode                                  = intersection.pricecode
        and clientsdata.firmcode                              = pricesdata.firmcode
        and retclientsset.clientcode                          = a.firmcode
        and intersection.regioncode                           = inRegCode
        and (clientsdata.maskregion & intersection.regioncode)> 0
        and clientsdata.firmcode                              = inUserCode
        and pricesdata.pricecode                              = inPriceCode
        and clientsdata.firmstatus                            = 1
        and clientsdata.billingstatus                         = 1
        and intersection.invisibleonfirm                      < 2
        and retclientsset.invisibleonfirm                     < 2
        and clientsdata.firmtype                              = 0
        and (a.maskregion & intersection.regioncode)          > 0
        and ((primaryclientcode is not null and (includetype in (0, 1, 3))) or (primaryclientcode is null))
        and intersection.DisabledByAgency = 0;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `SetAFReplicationParamenter` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50020 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 PROCEDURE `SetAFReplicationParamenter`(IN ClientCodeParam INT UNSIGNED, IN PriceCodeParam INT UNSIGNED)
BEGIN

UPDATE AnalitFReplicationInfo,
       PricesData            ,
       OsUserAccessRight
SET    ForceReplication=1
WHERE  AnalitFReplicationInfo.UserId        =OsUserAccessRight.RowId
   AND PricesData.PriceCode     =PriceCodeParam
   AND PricesData.FirmCode      =AnalitFReplicationInfo.FirmCode
   AND OsUserAccessRight.ClientCode    =ClientCodeParam;


END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `UpdateCostType` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp1251 */ ;
/*!50003 SET character_set_results = cp1251 */ ;
/*!50003 SET collation_connection  = cp1251_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50020 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 PROCEDURE `UpdateCostType`(in inPriceCode int unsigned, in inCostType tinyint(1))
BEGIN
  declare oldCostType tinyint(1);
  declare basePriceItemId, CurrentCostCode, LastSourceId, LastFormRuleId, LastPriceItemId int unsigned;
  DECLARE done INT DEFAULT 0;
  DECLARE Costs CURSOR FOR
  select
    pc.CostCode
  from
    usersettings.pricescosts pc
  where
      pc.PriceCode = inPriceCode
  and pc.BaseCost != 1;
  DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = 1;
  
  select CostType
  into
    oldCostType
  from
    usersettings.pricesdata
  where
    PriceCode = inPriceCode;
  
  if ((oldCostType is null && inCostType is not null) || oldCostType <> inCostType) then
    update UserSettings.PricesData set CostType = inCostType where PriceCode = inPriceCode;
    
    
    if (oldCostType = 1) then
      delete from
        farm.sources
      using
        farm.sources,
        usersettings.priceitems,
        usersettings.pricescosts
      where
          sources.id = priceitems.SourceId
      and priceitems.Id = pricescosts.PriceItemId
      and pricescosts.PriceCode = inPriceCode
      and pricescosts.BaseCost != 1;
      delete from
        farm.formrules
      using
        farm.formrules,
        usersettings.priceitems,
        usersettings.pricescosts
      where
          formrules.id = priceitems.FormRuleId
      and priceitems.Id = pricescosts.PriceItemId
      and pricescosts.PriceCode = inPriceCode
      and pricescosts.BaseCost != 1;
      delete from
        usersettings.priceitems
      using
        usersettings.priceitems,
        usersettings.pricescosts
      where
          priceitems.Id = pricescosts.PriceItemId
      and pricescosts.PriceCode = inPriceCode
      and pricescosts.BaseCost != 1;
    end if;
    
    if (inCostType = 0) then
      
      select PriceItemId
      into
        basePriceItemId
      from
        usersettings.pricescosts
      where
          pricescosts.PriceCode = inPriceCode
      and BaseCost = 1;
      
      update
        usersettings.pricescosts
      set
        PriceItemId = basePriceItemId
      where
          pricescosts.PriceCode = inPriceCode
      and BaseCost != 1;
    else
      
      OPEN Costs;
      REPEAT
        FETCH Costs INTO CurrentCostCode;
        IF NOT done THEN
          
          insert into farm.sources () value ();
          select last_insert_id() into LastSourceId;
          
          insert into farm.formrules () values ();
          select last_insert_id() into LastFormRuleId;
          
          insert into usersettings.PriceItems
            (FormRuleId, SourceId)
            values
            (LastFormRuleId, LastSourceId);
          select last_insert_id() into LastPriceItemId;
          
          update usersettings.pricescosts set PriceItemId = LastPriceItemId where pricescosts.CostCode = CurrentCostCode;
        END IF;
      UNTIL done END REPEAT;
      CLOSE Costs;
    end if;
  end if;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `UpdateCS` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50020 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 PROCEDURE `UpdateCS`(
inOperatorName varchar(50),
inOperatorHost varchar(50),
inOperatorCode bigint(20),
inBrowser varchar(25),
inPriceCode int(32),
inClientCode int(32),
inIncludeType int(32),
inFirmClientCode1 varchar(200),
inFirmClientCode2 varchar(200),
inFirmClientCode3 varchar(200),
inPublicCostCorr decimal(6,3),
inFirmCostCorr decimal(6,3),
inInvisibleOnClient tinyint(1),
inCostCorrByClient tinyint(1),
inCostCode int(32),
inMinReq int(32),
inControlMinReq tinyint(1),
inID bigint(20),
inSlave tinyint(1)
)
BEGIN
set inFirmClientCode1 = trim(inFirmClientCode1);
set inFirmClientCode2 = trim(inFirmClientCode2);
set inFirmClientCode3 = trim(inFirmClientCode3);
UPDATE intersection
        SET PublicCostCorr= inPublicCostCorr,
        FirmCostCorr      = inFirmCostCorr,
        CostCode          = inCostCode,
        InvisibleOnClient = inInvisibleOnClient,
        CostCorrByClient  = inCostCorrByClient,
        MinReq            = inMinReq,
        ControlMinReq     = inControlMinReq
WHERE   id                = inID
        and not inSlave;
UPDATE intersection pc,
        includeregulation ir,
        intersection cc
        SET cc.PublicCostCorr= inPublicCostCorr,
        cc.FirmCostCorr      = inFirmCostCorr,
        cc.CostCode          = inCostCode,
        cc.InvisibleOnClient = if(ir.includetype = 1, cc.InvisibleOnClient, inInvisibleOnClient),
        cc.CostCorrByClient  = inCostCorrByClient,
        cc.MinReq            = if(ir.includetype = 1, cc.MinReq, inMinReq),
        cc.ControlMinReq     = if(ir.includetype = 1, cc.ControlMinReq, inControlMinReq)
WHERE   pc.id                = inID 
        and not inSlave
        and ir.primaryclientcode = pc.clientcode
        and cc.ClientCode        = ir.IncludeClientCode
        and cc.RegionCode        = pc.RegionCode
        and cc.PriceCode         = pc.PriceCode;
UPDATE intersection pc,
        includeregulation ir, 
        intersection cc 
        SET cc.FirmClientCode= inFirmClientCode1,
        cc.FirmClientCode2   = inFirmClientCode2, 
        cc.FirmClientCode3   = inFirmClientCode3 
WHERE   pc.id                = inID 
        and not inSlave 
        and ir.primaryclientcode = pc.clientcode 
        and cc.ClientCode        = ir.IncludeClientCode 
        and cc.RegionCode        = pc.RegionCode 
        and cc.PriceCode         = pc.PriceCode 
        and ir.IncludeType       = 2;
UPDATE intersection,
        pricesdata,
        pricesdata as a
        SET FirmClientCode        = if(length(inFirmClientCode1)> 0, inFirmClientCode1, FirmClientCode),
        FirmClientCode2           = if(length(inFirmClientCode2)> 0, inFirmClientCode2, FirmClientCode2),
        FirmClientCode3           = if(length(inFirmClientCode3)> 0, inFirmClientCode3, FirmClientCode3)
WHERE   intersection.clientcode   = inClientCode
        and intersection.pricecode= pricesdata.pricecode
        and pricesdata.firmcode   = a.firmcode
        and a.pricecode           = inPriceCode;
UPDATE intersection
        SET FirmClientCode= inFirmClientCode1,
        FirmClientCode2   = inFirmClientCode2,
        FirmClientCode3   = inFirmClientCode3,
        InvisibleOnClient = if(inSlave and inIncludeType = 1, inInvisibleOnClient, InvisibleOnClient),
        MinReq            = if(inSlave and inIncludeType = 1, inMinReq, MinReq),
        ControlMinReq     = if(inSlave and inIncludeType = 1, inControlMinReq, ControlMinReq)
WHERE   id                = inID;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `UpdatePasswords` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = '' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50020 DEFINER=`RootDBMS`@`127.0.0.1`*/ /*!50003 PROCEDURE `UpdatePasswords`(in UpdateClientCode integer unsigned)
BEGIN
   update retclientsset set
     BaseCostPassword = GeneratePassword(),
     CodesPassword = GeneratePassword(),
     SynonymPassword = GeneratePassword()
   where
     ClientCode = UpdateClientCode;
   update intersection
   set
     LastSent = default,
     UncommittedLastSent = default
   where
     ClientCode = UpdateClientCode;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!40103 SET TIME_ZONE=@OLD_TIME_ZONE */;

/*!40101 SET SQL_MODE=@OLD_SQL_MODE */;
/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */;
/*!40014 SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS */;
/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;
/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;
/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */;

-- Dump completed on 2012-01-20 16:47:39
